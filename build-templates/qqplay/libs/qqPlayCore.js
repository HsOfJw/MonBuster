var qqPlayCoreBuildInfo = { buildPath:'undefined',version:'undefined',creator:'wesleyxiao',buildTime:'Fri Nov 09 2018 13:20:45 GMT+0800 (GMT+08:00)'};function clone_(e){var t,i,r;if("object"!=typeof e||null===e)return e;if(e instanceof Array)for(t=[],i=0,r=e.length;i<r;i++)"object"==typeof e[i]&&null!=e[i]?t[i]=arguments.callee(e[i]):t[i]=e[i];else{t={};for(i in e)"object"==typeof e[i]&&null!=e[i]?t[i]=arguments.callee(e[i]):t[i]=e[i]}return t}function Canvas(){var e=arguments.length;this._shadowColor={r:0,g:0,b:0,a:0},this._shadowOffset={x:0,y:0},this._shadowRadius=0,this._textBaseLine=0,this._textAlign=0,this._useH5Mode=0,this._a=1,this._b=0,this._c=0,this._d=1,this._tx=0,this._ty=0,2==e&&(this.__nativeObj=new BK.CanvasNode(arguments[0],arguments[1]),this.setFlipXY(0,1),Object.getOwnPropertyNames(this.__nativeObj).forEach(function(e){var t=e;"scale"!=t&&"transform"!=t&&"contentSize"!=t&&"size"!=t&&"fontPath"!=t&&Object.defineProperty(this,t,{get:function(){return this.__nativeObj[t]},set:function(e){this.__nativeObj[t]=e}})},this),Object.defineProperty(Canvas.prototype,"fontPath",{get:function(){return this.__nativeObj.fontPath},set:function(e){BK.FileUtil.isFileExist(e)&&(this.__nativeObj.fontPath=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Canvas.prototype,"contentSize",{get:function(){return this.__nativeObj.contentSize},set:function(e){this.__nativeObj.contentSize=e,this.__nativeObj.resetCanvas()},enumerable:!0,configurable:!0}),Object.defineProperty(Canvas.prototype,"size",{get:function(){return this.__nativeObj.size},set:function(e){this.__nativeObj.size=e,this.__nativeObj.resetCanvas()},enumerable:!0,configurable:!0}),Object.defineProperty(Canvas.prototype,"textBaseline",{get:function(){return this._textBaseLine},set:function(e){switch(e){case 0:case 1:case 2:this._textBaseLine=e;break;case"bottom":case"Bottom":this._textBaseLine=0;break;case"Middle":case"middle":this._textBaseLine=1;break;case"Top":case"top":this._textBaseLine=2}},enumerable:!0,configurable:!0}),Object.defineProperty(Canvas.prototype,"textAlign",{get:function(){return this._textAlign},set:function(e){switch(e){case 0:case 1:case 2:this._textAlign=e;break;case"left":this._textAlign=0;break;case"center":this._textAlign=1;break;case"right":this._textAlign=2}this.__nativeObj.setTextAlign(this._textAlign)},enumerable:!0,configurable:!0}),Object.defineProperty(Canvas.prototype,"lineWidth",{get:function(){return this.__nativeObj.lineWidth},set:function(e){this.__nativeObj.lineWidth=e},enumerable:!0,configurable:!0}),Object.defineProperty(Canvas.prototype,"globalAlpha",{get:function(){return this.__nativeObj.globalAlpha},set:function(e){e=Math.min(1,e),e=Math.max(0,e),this.__nativeObj.globalAlpha=e},enumerable:!0,configurable:!0}),Object.defineProperty(Canvas.prototype,"fillColor",{get:function(){return this.__nativeObj.fillColor},set:function(e){this.__nativeObj.fillColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(Canvas.prototype,"strokeColor",{get:function(){return this.__nativeObj.strokeColor},set:function(e){this.__nativeObj.strokeColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(Canvas.prototype,"lineCap",{get:function(){return this.__nativeObj.lineCap},set:function(e){this.__nativeObj.lineCap=e},enumerable:!0,configurable:!0}),Object.defineProperty(Canvas.prototype,"lineJoin",{get:function(){return this.__nativeObj.lineJoin},set:function(e){this.__nativeObj.lineJoin=e},enumerable:!0,configurable:!0}),Object.defineProperty(Canvas.prototype,"miterLimit",{get:function(){return this.__nativeObj.miterLimit},set:function(e){this.__nativeObj.miterLimit=e},enumerable:!0,configurable:!0}))}function inverseMatrix(e,t,i,r,n,o){var a=e,s=i,h=n,c=t,l=r,u=o,d=a*l*1+s*u*0+h*c*0-h*l*0-s*c*1-a*u*0,_=-1*(1*c-0*u)/d,f=1*(0*c-0*l)/d,g=-1*(1*s-0*h)/d,p=-1*(0*a-0*s)/d,m=1*(s*u-h*l)/d,v=-1*(a*u-h*c)/d,S=g;g=_,_=S;S=m;m=f,f=S;S=p;return p=v,v=S,[1*(1*l-0*u)/d,g,_,1*(1*a-0*h)/d,f,p]}function bkWebGLGetInstance(){return gl||(gl=new BK.WebGL,attatchConst(),attachMethod(),gl.OpenOptMode=OpenOptMode,gl.viewport(0,0,BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height)),Object.prototype.hasOwnProperty.call(this,"renderTicker")&&renderTicker.setTickerCallBack(function(e,t){}),gl}function __bkIsSupportTypedArray(){if(void 0==isSupportTA){"android"==GameStatusInfo.platform&&(isSupportTA=!0);var e=BK.Director.queryDeviceInfo(),t=e.version.split(".");"ios"==e.platform&&Number(t[0])>=10||"android"==e.platform?isSupportTA=!0:(BK.Script.log(1,0,"Current Device dont supoort TypedArray.[info = "+JSON.stringify(e)+"]"),isSupportTA=!1)}return isSupportTA}function __TypedArrayGetData(e){if(Object.prototype.hasOwnProperty.call(e,"__rawBKData"))return e.__rawBKData;if(Object.prototype.hasOwnProperty.call(e,"__nativeObj"))return e.__nativeObj;if(0==__bkIsSupportTypedArray()){var t=e instanceof ArrayBuffer;return BK.Misc.arrayBufferToBKBuffer(t?e:e.buffer,t?0:e.byteOffset,e.byteLength)}return e}function checkFirstFrames(){0==firstFrameUpload&&(BK.MQQ.SsoRequest.send({},"cs.first_frame_drawn.local"),firstFrameUpload=!0)}function activeTexture(e){glpause||gl.glActiveTexture(e)}function attachShader(e,t){glpause||gl.glAttachShader(e,t)}function bindAttribLocation(e,t,i){glpause||gl.glBindAttribLocation(e,t,i)}function bindBuffer(e,t){glpause||gl.glBindBuffer(e,t)}function bindFramebuffer(e,t){glpause||gl.glBindFramebuffer(e,t)}function bindRenderbuffer(e,t){glpause||gl.glBindRenderbuffer(e,t)}function bindTexture(e,t){glpause||gl.glBindTexture(e,t)}function blendColor(e,t,i,r){glpause||gl.glBlendColor(e,t,i,r)}function blendEquation(e){glpause||gl.glBlendEquation(e)}function blendEquationSeparate(e,t){glpause||gl.glBlendEquationSeparate(e,t)}function blendFunc(e,t){glpause||gl.glBlendFunc(e,t)}function blendFuncSeparate(e,t,i,r){glpause||gl.glBlendFuncSeparate(e,t,i,r)}function bufferData(e,t,i){glpause||("number"!=typeof t?gl.glBufferData(e,__TypedArrayGetData(t),i):gl.glBufferData(e,t,i))}function bufferSubData(e,t,i){glpause||gl.glBufferSubData(e,t,__TypedArrayGetData(i))}function checkFramebufferStatus(e){if(!glpause)return gl.glCheckFramebufferStatus(e)}function clear(e){glpause||gl.glClear(e)}function clearColor(e,t,i,r){glpause||gl.glClearColor(e,t,i,r)}function clearDepth(e){glpause||gl.glClearDepth(e)}function clearStencil(e){glpause||gl.glClearStencil(e)}function colorMask(e,t,i,r){glpause||gl.glColorMask(e,t,i,r)}function compileShader(e){glpause||gl.glCompileShader(e)}function compressedTexImage2D(e,t,i,r,n,o,a){glpause||gl.glCompressedTexImage2D(e,t,i,r,n,o,a)}function compressedTexSubImage2D(e,t,i,r,n,o,a,s){glpause||gl.glCompressedTexSubImage2D(e,t,i,r,n,o,a,s)}function copyTexImage2D(e,t,i,r,n,o,a,s){glpause||gl.glCopyTexImage2D(e,t,i,r,n,o,a,s)}function copyTexSubImage2D(e,t,i,r,n,o,a,s){glpause||gl.glCopyTexSubImage2D(e,t,i,r,n,o,a,s)}function createBuffer(){return glpause?-1:gl.glCreateBuffer()}function createFramebuffer(){return glpause?-1:gl.glCreateFramebuffer()}function createProgram(){return glpause?-1:gl.glCreateProgram()}function createRenderbuffer(){return glpause?-1:gl.glCreateRenderbuffer()}function createShader(e){return glpause?-1:gl.glCreateShader(e)}function createTexture(){return glpause?-1:gl.glCreateTexture()}function cullFace(e){glpause||gl.glCullFace(e)}function deleteBuffer(e){glpause||gl.glDeleteBuffer(e)}function deleteFramebuffer(e){glpause||gl.glDeleteFramebuffer(e)}function deleteProgram(e){glpause||gl.glDeleteProgram(e)}function deleteRenderbuffer(e){glpause||gl.glDeleteRenderbuffer(e)}function deleteShader(e){glpause||gl.glDeleteShader(e)}function deleteTexture(e){glpause||gl.glDeleteTexture(e)}function depthFunc(e){glpause||gl.glDepthFunc(e)}function depthMask(e){glpause||gl.glDepthMask(e)}function depthRange(e,t){glpause||gl.glDepthRange(e,t)}function detachShader(e,t){glpause||gl.glDetachShader(e,t)}function disable(e){glpause||gl.glDisable(e)}function disableVertexAttribArray(e){glpause||gl.glDisableVertexAttribArray(e)}function drawArrays(e,t,i){glpause||(gl.glDrawArrays(e,t,i),i>0&&checkFirstFrames())}function drawElements(e,t,i,r){glpause||(gl.glDrawElements(e,t,i,r),t>0&&checkFirstFrames())}function enable(e){glpause||gl.glEnable(e)}function enableVertexAttribArray(e){glpause||gl.glEnableVertexAttribArray(e)}function finish(){glpause||gl.glFinish()}function flush(){glpause||gl.glFlush()}function framebufferRenderbuffer(e,t,i,r){glpause||gl.glFramebufferRenderbuffer(e,t,i,r)}function framebufferTexture2D(e,t,i,r,n){glpause||gl.glFramebufferTexture2D(e,t,i,r,n)}function frontFace(e){glpause||gl.glFrontFace(e)}function generateMipmap(e){glpause||gl.glGenerateMipmap(e)}function getAttribLocation(e,t){return glpause?-1:gl.glGetAttribLocation(e,t)}function getError(){return glpause?null:gl.glGetError()}function getShaderPrecisionFormat(e,t){return glpause?-1:gl.glGetShaderPrecisionFormat(e,t)}function getProgramInfoLog(e){return glpause?null:gl.glGetProgramInfoLog(e)}function getShaderInfoLog(e){return glpause?null:gl.glGetShaderInfoLog(e)}function getShaderSource(e){return glpause?null:gl.glGetShaderSource(e)}function getUniformLocation(e,t){return glpause?-1:gl.glGetUniformLocation(e,t)}function getVertexAttribOffset(e,t){return glpause?-1:gl.glGetVertexAttribOffset(e,t)}function hint(e,t){glpause||gl.glHint(e,t)}function isBuffer(e){return!glpause&&gl.glIsBuffer(e)}function isEnabled(e){return!glpause&&gl.glIsEnabled(e)}function isFramebuffer(e){return!glpause&&gl.glIsFramebuffer(e)}function isProgram(e){return!glpause&&gl.glIsProgram(e)}function isRenderbuffer(e){return!glpause&&gl.glIsRenderbuffer(e)}function isShader(e){return!glpause&&gl.glIsShader(e)}function isTexture(e){return!glpause&&gl.glIsTexture(e)}function lineWidth(e){glpause||gl.glLineWidth(e)}function linkProgram(e){glpause||gl.glLinkProgram(e)}function pixelStorei(e,t){glpause||gl.glPixelStorei(e,t)}function polygonOffset(e,t){glpause||gl.glPolygonOffset(e,t)}function readPixels(e,t,i,r,n,o,a){}function renderbufferStorage(e,t,i,r){glpause||gl.glRenderbufferStorage(e,t,i,r)}function sampleCoverage(e,t){glpause||gl.glSampleCoverage(e,t)}function scissor(e,t,i,r){glpause||gl.glScissor(e,t,i,r)}function shaderSource(e,t){glpause||gl.glShaderSource(e,t)}function stencilFunc(e,t,i){glpause||gl.glStencilFunc(e,t,i)}function stencilFuncSeparate(e,t,i,r){glpause||gl.glStencilFuncSeparate(e,t,i,r)}function stencilMask(e){glpause||gl.glStencilMask(e)}function stencilMaskSeparate(e,t){glpause||gl.glStencilMaskSeparate(e,t)}function stencilOp(e,t,i){glpause||gl.glStencilOp(e,t,i)}function stencilOpSeparate(e,t,i,r){glpause||gl.glStencilOpSeparate(e,t,i,r)}function texImage2D(e,t,i){if(!glpause)switch(arguments.length){case 6:var r=arguments[3],n=arguments[4],o=arguments[5];Object.prototype.hasOwnProperty.call(o,"__nativeObj")?gl.glTexImage2D(e,t,i,r,n,o.__nativeObj):Object.prototype.hasOwnProperty.call(o,"buffer")&&Object.prototype.hasOwnProperty.call(o.buffer,"eof")&&Object.prototype.hasOwnProperty.call(o.buffer,"pointer")&&Object.prototype.hasOwnProperty.call(o.buffer,"netOrder")&&o.width>0&&o.height>0?gl.glTexImage2D(e,t,i,r,n,o):Object.prototype.hasOwnProperty.call(o,"buffer")&&o.buffer.__proto__.hasOwnProperty("eof")&&o.buffer.__proto__.hasOwnProperty("pointer")&&o.buffer.__proto__.hasOwnProperty("netOrder")&&o.width>0&&o.height>0&&gl.glTexImage2D(e,t,i,r,n,o);break;case 9:var a=arguments[3],s=arguments[4],h=arguments[5],r=arguments[6],n=arguments[7],c=arguments[8];gl.glTexImage2D(e,t,i,a,s,h,r,n,c)}}function texParameterf(e,t,i){glpause||gl.glTexParameterf(e,t,i)}function texParameteri(e,t,i){glpause||gl.glTexParameteri(e,t,i)}function texSubImage2D(e,t,i,r){if(!glpause)switch(arguments.length){case 7:var n=arguments[4],o=arguments[5],a=arguments[6];Object.prototype.hasOwnProperty.call(a,"__nativeObj")?gl.glTexSubImage2D(e,t,i,r,n,o,a.__nativeObj):gl.glTexSubImage2D(e,t,i,r,n,o,a);break;case 9:var s=arguments[4],h=arguments[5],n=arguments[6],o=arguments[7],c=arguments[8];gl.glTexSubImage2D(e,t,i,r,s,h,n,o,c)}}function uniform1f(e,t){glpause||gl.glUniform1f(e,t)}function uniform2f(e,t,i){glpause||gl.glUniform2f(e,t,i)}function uniform3f(e,t,i,r){glpause||gl.glUniform3f(e,t,i,r)}function uniform4f(e,t,i,r,n){glpause||gl.glUniform4f(e,t,i,r,n)}function uniform1i(e,t){glpause||gl.glUniform1i(e,t)}function uniform2i(e,t,i){glpause||gl.glUniform2i(e,t,i)}function uniform3i(e,t,i,r){glpause||gl.glUniform3i(e,t,i,r)}function uniform4i(e,t,i,r,n){glpause||gl.glUniform4i(e,t,i,r,n)}function uniform1fv(e,t){glpause||gl.glUniform1fv(e,__TypedArrayGetData(t instanceof Array==1?new Float32Array(t):t))}function uniform2fv(e,t){glpause||gl.glUniform2fv(e,__TypedArrayGetData(t instanceof Array==1?new Float32Array(t):t))}function uniform3fv(e,t){glpause||gl.glUniform3fv(e,__TypedArrayGetData(t instanceof Array==1?new Float32Array(t):t))}function uniform4fv(e,t){glpause||gl.glUniform4fv(e,__TypedArrayGetData(t instanceof Array==1?new Float32Array(t):t))}function uniform1iv(e,t){glpause||gl.glUniform1iv(e,__TypedArrayGetData(t instanceof Array==1?new Int32Array(t):t))}function uniform2iv(e,t){glpause||gl.glUniform2iv(e,__TypedArrayGetData(t instanceof Array==1?new Int32Array(t):t))}function uniform3iv(e,t){glpause||gl.glUniform3iv(e,__TypedArrayGetData(t instanceof Array==1?new Int32Array(t):t))}function uniform4iv(e,t){glpause||gl.glUniform4iv(e,__TypedArrayGetData(t instanceof Array==1?new Int32Array(t):t))}function uniformMatrix2fv(e,t,i){glpause||gl.glUniformMatrix2fv(e,t,__TypedArrayGetData(i instanceof Array==1?new Float32Array(i):i))}function uniformMatrix3fv(e,t,i){glpause||gl.glUniformMatrix3fv(e,t,__TypedArrayGetData(i instanceof Array==1?new Float32Array(i):i))}function uniformMatrix4fv(e,t,i){glpause||gl.glUniformMatrix4fv(e,t,__TypedArrayGetData(i instanceof Array==1?new Float32Array(i):i))}function useProgram(e){glpause||gl.glUseProgram(e)}function validateProgram(e){glpause||gl.glValidateProgram(e)}function vertexAttrib1f(e,t){glpause||gl.glVertexAttrib1f(e,t)}function vertexAttrib2f(e,t,i){glpause||gl.glVertexAttrib2f(e,t,i)}function vertexAttrib3f(e,t,i,r){glpause||gl.glVertexAttrib3f(e,t,i,r)}function vertexAttrib4f(e,t,i,r,n){glpause||gl.glVertexAttrib4f(e,t,i,r,n)}function vertexAttrib1fv(e,t){glpause||gl.glVertexAttrib1fv(e,__TypedArrayGetData(t instanceof Array==1?new Float32Array(t):t))}function vertexAttrib2fv(e,t){glpause||gl.glVertexAttrib2fv(e,__TypedArrayGetData(t instanceof Array==1?new Float32Array(t):t))}function vertexAttrib3fv(e,t){glpause||gl.glVertexAttrib3fv(e,__TypedArrayGetData(t instanceof Array==1?new Float32Array(t):t))}function vertexAttrib4fv(e,t){glpause||gl.glVertexAttrib4fv(e,__TypedArrayGetData(t instanceof Array==1?new Float32Array(t):t))}function vertexAttribPointer(e,t,i,r,n,o,a){if(!glpause){if(void 0===a){var s={index:e,size:t,type:i,normalized:r,stride:n,offset:o};void 0===gl.recordVertexAttribPointer&&(gl.recordVertexAttribPointer=[]);for(var h=!1,c=0;c<gl.recordVertexAttribPointer.length;c++)if(gl.recordVertexAttribPointer[c].index==s.index){h=!0,gl.recordVertexAttribPointer[c]=s;break}0==h&&gl.recordVertexAttribPointer.push(s)}gl.glVertexAttribPointer(e,t,i,r,n,o)}}function viewport(e,t,i,r){glpause||gl.glViewport(e,t,i,r)}function getActiveAttrib(e,t){if(!glpause)return gl.glGetActiveAttrib(e,t)}function getActiveUniform(e,t){if(!glpause)return gl.glGetActiveUniform(e,t)}function getAttachedShaders(e){if(!glpause)return gl.glGetAttachedShaders(e)}function getBufferParameter(e,t){if(!glpause)return gl.glGetBufferParameter(e,t)}function getFramebufferAttachmentParameter(e,t,i){if(!glpause)return gl.glGetFramebufferAttachmentParameter(e,t,i)}function getProgramParameter(e,t){if(!glpause)return gl.glGetProgramParameter(e,t)}function getRenderbufferParameter(e,t){if(!glpause)return gl.glGetRenderbufferParameter(e,t)}function getShaderParameter(e,t){if(!glpause)return gl.glGetShaderParameter(e,t)}function getTexParameter(e,t){if(!glpause)return gl.glGetTexParameter(e,t)}function getVertexAttrib(e,t){if(!glpause)return gl.glGetVertexAttrib(e,t)}function getUniform(e,t){if(!glpause)return gl.glGetUniform(e,t)}function getParameter(e){if(!glpause)switch(e){case gl.ACTIVE_TEXTURE:case gl.ALPHA_BITS:case gl.ARRAY_BUFFER_BINDING:case gl.BLUE_BITS:case gl.CULL_FACE_MODE:case gl.CURRENT_PROGRAM:case gl.DEPTH_BITS:case gl.DEPTH_FUNC:case gl.ELEMENT_ARRAY_BUFFER_BINDING:case gl.FRAMEBUFFER_BINDING:case gl.FRONT_FACE:case gl.GENERATE_MIPMAP_HINT:case gl.GREEN_BITS:case gl.IMPLEMENTATION_COLOR_READ_FORMAT:case gl.IMPLEMENTATION_COLOR_READ_TYPE:case gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS:case gl.MAX_CUBE_MAP_TEXTURE_SIZE:case gl.MAX_FRAGMENT_UNIFORM_VECTORS:case gl.MAX_RENDERBUFFER_SIZE:case gl.MAX_TEXTURE_IMAGE_UNITS:case gl.MAX_TEXTURE_SIZE:case gl.MAX_VARYING_VECTORS:case gl.MAX_VERTEX_ATTRIBS:case gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS:case gl.MAX_VERTEX_UNIFORM_VECTORS:case gl.MAX_VIEWPORT_DIMS:case gl.NUM_COMPRESSED_TEXTURE_FORMATS:case gl.NUM_SHADER_BINARY_FORMATS:case gl.PACK_ALIGNMENT:case gl.RED_BITS:case gl.RENDERBUFFER_BINDING:case gl.SAMPLE_BUFFERS:case gl.SAMPLES:case gl.STENCIL_BACK_FAIL:case gl.STENCIL_BACK_FUNC:case gl.STENCIL_BACK_PASS_DEPTH_FAIL:case gl.STENCIL_BACK_PASS_DEPTH_PASS:case gl.STENCIL_BACK_REF:case gl.STENCIL_BACK_VALUE_MASK:case gl.STENCIL_BACK_WRITEMASK:case gl.STENCIL_BITS:case gl.STENCIL_CLEAR_VALUE:case gl.STENCIL_FAIL:case gl.STENCIL_FUNC:case gl.STENCIL_PASS_DEPTH_FAIL:case gl.STENCIL_PASS_DEPTH_PASS:case gl.STENCIL_REF:case gl.STENCIL_VALUE_MASK:case gl.STENCIL_WRITEMASK:case gl.SUBPIXEL_BITS:case gl.TEXTURE_BINDING_2D:case gl.TEXTURE_BINDING_CUBE_MAP:case gl.UNPACK_ALIGNMENT:case gl.BLEND_DST_ALPHA:case gl.BLEND_DST_RGB:case gl.BLEND_EQUATION_ALPHA:case gl.BLEND_EQUATION_RGB:case gl.BLEND_SRC_ALPHA:case gl.BLEND_SRC_RGB:return gl.glGetParameterInt(e,1);case gl.ALIASED_LINE_WIDTH_RANGE:case gl.ALIASED_POINT_SIZE_RANGE:case gl.DEPTH_RANGE:case gl.MAX_VIEWPORT_DIMS:return gl.glGetParameterFloat(e,2);case gl.BLEND:case gl.CULL_FACE:case gl.DEPTH_TEST:case gl.DEPTH_WRITEMASK:case gl.DITHER:case gl.POLYGON_OFFSET_FILL:case gl.SAMPLE_ALPHA_TO_COVERAGE:case gl.SAMPLE_COVERAGE:case gl.SAMPLE_COVERAGE_INVERT:case gl.SCISSOR_TEST:case gl.SHADER_COMPILER:case gl.STENCIL_TEST:return gl.glGetParameterBool(e,1);case gl.BLEND_COLOR:case gl.COLOR_CLEAR_VALUE:return gl.glGetParameterFloat(e,4);case gl.SCISSOR_BOX:case gl.VIEWPORT:return gl.glGetParameterInt(e,4);case gl.COLOR_WRITEMASK:return gl.glGetParameterBool(e,4);case gl.POLYGON_OFFSET_FACTOR:case gl.POLYGON_OFFSET_UNITS:case gl.SAMPLE_COVERAGE_VALUE:return gl.glGetParameterFloat(e,1);case gl.SHADER_BINARY_FORMATS:t=gl.glGetParameterInt(gl.NUM_SHADER_BINARY_FORMATS,1);return gl.glGetParameterInt(e,t);case gl.COMPRESSED_TEXTURE_FORMATS:var t=gl.glGetParameterInt(gl.NUM_COMPRESSED_TEXTURE_FORMATS,1);return gl.glGetParameterInt(e,t)}}function voidFunc(e,t,i,r,n,o,a,s,h,c){}function attchVoidMethod(){gl.methodWorking=!1,gl.activeTexture=voidFunc,gl.attachShader=voidFunc,gl.bindAttribLocation=voidFunc,gl.bindBuffer=voidFunc,gl.bindFramebuffer=voidFunc,gl.bindRenderbuffer=voidFunc,gl.bindTexture=voidFunc,gl.blendColor=voidFunc,gl.blendEquation=voidFunc,gl.blendEquationSeparate=voidFunc,gl.blendFunc=voidFunc,gl.blendFuncSeparate=voidFunc,gl.bufferData=voidFunc,gl.bufferData=voidFunc,gl.bufferSubData=voidFunc,gl.checkFramebufferStatus=voidFunc,gl.clear=voidFunc,gl.clearColor=voidFunc,gl.clearDepth=voidFunc,gl.clearStencil=voidFunc,gl.colorMask=voidFunc,gl.compileShader=voidFunc,gl.compressedTexImage2D=voidFunc,gl.compressedTexSubImage2D=voidFunc,gl.copyTexImage2D=voidFunc,gl.copyTexSubImage2D=voidFunc,gl.createBuffer=voidFunc,gl.createFramebuffer=voidFunc,gl.createProgram=voidFunc,gl.createRenderbuffer=voidFunc,gl.createShader=voidFunc,gl.createTexture=voidFunc,gl.cullFace=voidFunc,gl.deleteBuffer=voidFunc,gl.deleteFramebuffer=voidFunc,gl.deleteProgram=voidFunc,gl.deleteRenderbuffer=voidFunc,gl.deleteShader=voidFunc,gl.deleteTexture=voidFunc,gl.depthFunc=voidFunc,gl.depthMask=voidFunc,gl.depthRange=voidFunc,gl.detachShader=voidFunc,gl.disable=voidFunc,gl.disableVertexAttribArray=voidFunc,gl.drawArrays=voidFunc,gl.drawElements=voidFunc,gl.enable=voidFunc,gl.enableVertexAttribArray=voidFunc,gl.finish=voidFunc,gl.flush=voidFunc,gl.framebufferRenderbuffer=voidFunc,gl.framebufferTexture2D=voidFunc,gl.frontFace=voidFunc,gl.generateMipmap=voidFunc,gl.getAttribLocation=voidFunc,gl.getError=voidFunc,gl.getProgramInfoLog=voidFunc,gl.getShaderInfoLog=voidFunc,gl.getShaderSource=voidFunc,gl.getUniformLocation=voidFunc,gl.getVertexAttribOffset=voidFunc,gl.hint=voidFunc,gl.isBuffer=voidFunc,gl.isEnabled=voidFunc,gl.isFramebuffer=voidFunc,gl.isProgram=voidFunc,gl.isRenderbuffer=voidFunc,gl.isShader=voidFunc,gl.isTexture=voidFunc,gl.lineWidth=voidFunc,gl.linkProgram=voidFunc,gl.pixelStorei=voidFunc,gl.polygonOffset=voidFunc,gl.readPixels=voidFunc,gl.renderbufferStorage=voidFunc,gl.sampleCoverage=voidFunc,gl.scissor=voidFunc,gl.shaderSource=voidFunc,gl.stencilFunc=voidFunc,gl.stencilFuncSeparate=voidFunc,gl.stencilMask=voidFunc,gl.stencilMaskSeparate=voidFunc,gl.stencilOp=voidFunc,gl.stencilOpSeparate=voidFunc,gl.texImage2D=voidFunc,gl.texSubImage2D=voidFunc,gl.texParameterf=voidFunc,gl.texParameteri=voidFunc,gl.uniform1f=voidFunc,gl.uniform2f=voidFunc,gl.uniform3f=voidFunc,gl.uniform4f=voidFunc,gl.uniform1i=voidFunc,gl.uniform2i=voidFunc,gl.uniform3i=voidFunc,gl.uniform4i=voidFunc,gl.uniform1fv=voidFunc,gl.uniform2fv=voidFunc,gl.uniform3fv=voidFunc,gl.uniform4fv=voidFunc,gl.uniform1iv=voidFunc,gl.uniform2iv=voidFunc,gl.uniform3iv=voidFunc,gl.uniform4iv=voidFunc,gl.uniformMatrix2fv=voidFunc,gl.uniformMatrix3fv=voidFunc,gl.uniformMatrix4fv=voidFunc,gl.useProgram=voidFunc,gl.validateProgram=voidFunc,gl.vertexAttrib1f=voidFunc,gl.vertexAttrib2f=voidFunc,gl.vertexAttrib3f=voidFunc,gl.vertexAttrib4f=voidFunc,gl.vertexAttrib1fv=voidFunc,gl.vertexAttrib2fv=voidFunc,gl.vertexAttrib3fv=voidFunc,gl.vertexAttrib4fv=voidFunc,gl.vertexAttribPointer=voidFunc,gl.viewport=voidFunc,gl.getActiveAttrib=voidFunc,gl.getActiveUniform=voidFunc,gl.getAttachedShaders=voidFunc,gl.getBufferParameter=voidFunc,gl.getFramebufferAttachmentParameter=voidFunc,gl.getProgramParameter=voidFunc,gl.getRenderbufferParameter=voidFunc,gl.getShaderParameter=voidFunc,gl.getTexParameter=voidFunc,gl.getVertexAttrib=voidFunc,gl.getParameter=voidFunc,gl.getUniform=voidFunc,gl.getShaderPrecisionFormat=voidFunc}function attachMethod(){gl.methodWorking=!0,gl.activeTexture=activeTexture,gl.attachShader=attachShader,gl.bindAttribLocation=bindAttribLocation,gl.bindBuffer=bindBuffer,gl.bindFramebuffer=bindFramebuffer,gl.bindRenderbuffer=bindRenderbuffer,gl.bindTexture=bindTexture,gl.blendColor=blendColor,gl.blendEquation=blendEquation,gl.blendEquationSeparate=blendEquationSeparate,gl.blendFunc=blendFunc,gl.blendFuncSeparate=blendFuncSeparate,gl.bufferData=bufferData,gl.bufferData=bufferData,gl.bufferSubData=bufferSubData,gl.checkFramebufferStatus=checkFramebufferStatus,gl.clear=clear,gl.clearColor=clearColor,gl.clearDepth=clearDepth,gl.clearStencil=clearStencil,gl.colorMask=colorMask,gl.compileShader=compileShader,gl.compressedTexImage2D=compressedTexImage2D,gl.compressedTexSubImage2D=compressedTexSubImage2D,gl.copyTexImage2D=copyTexImage2D,gl.copyTexSubImage2D=copyTexSubImage2D,gl.createBuffer=createBuffer,gl.createFramebuffer=createFramebuffer,gl.createProgram=createProgram,gl.createRenderbuffer=createRenderbuffer,gl.createShader=createShader,gl.createTexture=createTexture,gl.cullFace=cullFace,gl.deleteBuffer=deleteBuffer,gl.deleteFramebuffer=deleteFramebuffer,gl.deleteProgram=deleteProgram,gl.deleteRenderbuffer=deleteRenderbuffer,gl.deleteShader=deleteShader,gl.deleteTexture=deleteTexture,gl.depthFunc=depthFunc,gl.depthMask=depthMask,gl.depthRange=depthRange,gl.detachShader=detachShader,gl.disable=disable,gl.disableVertexAttribArray=disableVertexAttribArray,gl.drawArrays=drawArrays,gl.drawElements=drawElements,gl.enable=enable,gl.enableVertexAttribArray=enableVertexAttribArray,gl.finish=finish,gl.flush=flush,gl.framebufferRenderbuffer=framebufferRenderbuffer,gl.framebufferTexture2D=framebufferTexture2D,gl.frontFace=frontFace,gl.generateMipmap=generateMipmap,gl.getAttribLocation=getAttribLocation,gl.getError=getError,gl.getProgramInfoLog=getProgramInfoLog,gl.getShaderInfoLog=getShaderInfoLog,gl.getShaderSource=getShaderSource,gl.getUniformLocation=getUniformLocation,gl.getVertexAttribOffset=getVertexAttribOffset,gl.hint=hint,gl.isBuffer=isBuffer,gl.isEnabled=isEnabled,gl.isFramebuffer=isFramebuffer,gl.isProgram=isProgram,gl.isRenderbuffer=isRenderbuffer,gl.isShader=isShader,gl.isTexture=isTexture,gl.lineWidth=lineWidth,gl.linkProgram=linkProgram,gl.pixelStorei=pixelStorei,gl.polygonOffset=polygonOffset,gl.readPixels=readPixels,gl.glReadPixels=voidFunc,gl.renderbufferStorage=renderbufferStorage,gl.sampleCoverage=sampleCoverage,gl.scissor=scissor,gl.shaderSource=shaderSource,gl.stencilFunc=stencilFunc,gl.stencilFuncSeparate=stencilFuncSeparate,gl.stencilMask=stencilMask,gl.stencilMaskSeparate=stencilMaskSeparate,gl.stencilOp=stencilOp,gl.stencilOpSeparate=stencilOpSeparate,gl.texImage2D=texImage2D,gl.texSubImage2D=texSubImage2D,gl.texParameterf=texParameterf,gl.texParameteri=texParameteri,gl.uniform1f=uniform1f,gl.uniform2f=uniform2f,gl.uniform3f=uniform3f,gl.uniform4f=uniform4f,gl.uniform1i=uniform1i,gl.uniform2i=uniform2i,gl.uniform3i=uniform3i,gl.uniform4i=uniform4i,gl.uniform1fv=uniform1fv,gl.uniform2fv=uniform2fv,gl.uniform3fv=uniform3fv,gl.uniform4fv=uniform4fv,gl.uniform1iv=uniform1iv,gl.uniform2iv=uniform2iv,gl.uniform3iv=uniform3iv,gl.uniform4iv=uniform4iv,gl.uniformMatrix2fv=uniformMatrix2fv,gl.uniformMatrix3fv=uniformMatrix3fv,gl.uniformMatrix4fv=uniformMatrix4fv,gl.useProgram=useProgram,gl.validateProgram=validateProgram,gl.vertexAttrib1f=vertexAttrib1f,gl.vertexAttrib2f=vertexAttrib2f,gl.vertexAttrib3f=vertexAttrib3f,gl.vertexAttrib4f=vertexAttrib4f,gl.vertexAttrib1fv=vertexAttrib1fv,gl.vertexAttrib2fv=vertexAttrib2fv,gl.vertexAttrib3fv=vertexAttrib3fv,gl.vertexAttrib4fv=vertexAttrib4fv,gl.vertexAttribPointer=vertexAttribPointer,gl.viewport=viewport,gl.getActiveAttrib=getActiveAttrib,gl.getActiveUniform=getActiveUniform,gl.getAttachedShaders=getAttachedShaders,gl.getBufferParameter=getBufferParameter,gl.getFramebufferAttachmentParameter=getFramebufferAttachmentParameter,gl.getProgramParameter=getProgramParameter,gl.getRenderbufferParameter=getRenderbufferParameter,gl.getShaderParameter=getShaderParameter,gl.getTexParameter=getTexParameter,gl.getVertexAttrib=getVertexAttrib,gl.getParameter=getParameter,gl.getUniform=getUniform,gl.getShaderPrecisionFormat=getShaderPrecisionFormat}function attatchConst(){gl.DEPTH_BUFFER_BIT=256,gl.STENCIL_BUFFER_BIT=1024,gl.COLOR_BUFFER_BIT=16384,gl.POINTS=0,gl.LINES=1,gl.LINE_LOOP=2,gl.LINE_STRIP=3,gl.TRIANGLES=4,gl.TRIANGLE_STRIP=5,gl.TRIANGLE_FAN=6,gl.ZERO=0,gl.ONE=1,gl.SRC_COLOR=768,gl.ONE_MINUS_SRC_COLOR=769,gl.SRC_ALPHA=770,gl.ONE_MINUS_SRC_ALPHA=771,gl.DST_ALPHA=772,gl.ONE_MINUS_DST_ALPHA=773,gl.DST_COLOR=774,gl.ONE_MINUS_DST_COLOR=775,gl.SRC_ALPHA_SATURATE=776,gl.FUNC_ADD=32774,gl.BLEND_EQUATION=32777,gl.BLEND_EQUATION_RGB=32777,gl.BLEND_EQUATION_ALPHA=34877,gl.FUNC_SUBTRACT=32778,gl.FUNC_REVERSE_SUBTRACT=32779,gl.BLEND_DST_RGB=32968,gl.BLEND_SRC_RGB=32969,gl.BLEND_DST_ALPHA=32970,gl.BLEND_SRC_ALPHA=32971,gl.CONSTANT_COLOR=32769,gl.ONE_MINUS_CONSTANT_COLOR=32770,gl.CONSTANT_ALPHA=32771,gl.ONE_MINUS_CONSTANT_ALPHA=32772,gl.BLEND_COLOR=32773,gl.ARRAY_BUFFER=34962,gl.ELEMENT_ARRAY_BUFFER=34963,gl.ARRAY_BUFFER_BINDING=34964,gl.ELEMENT_ARRAY_BUFFER_BINDING=34965,gl.STREAM_DRAW=35040,gl.STATIC_DRAW=35044,gl.DYNAMIC_DRAW=35048,gl.BUFFER_SIZE=34660,gl.BUFFER_USAGE=34661,gl.CURRENT_VERTEX_ATTRIB=34342,gl.FRONT=1028,gl.BACK=1029,gl.FRONT_AND_BACK=1032,gl.CULL_FACE=2884,gl.BLEND=3042,gl.DITHER=3024,gl.STENCIL_TEST=2960,gl.DEPTH_TEST=2929,gl.SCISSOR_TEST=3089,gl.POLYGON_OFFSET_FILL=32823,gl.SAMPLE_ALPHA_TO_COVERAGE=32926,gl.SAMPLE_COVERAGE=32928,gl.NO_ERROR=0,gl.INVALID_ENUM=1280,gl.INVALID_VALUE=1281,gl.INVALID_OPERATION=1282,gl.OUT_OF_MEMORY=1285,gl.CW=2304,gl.CCW=2305,gl.LINE_WIDTH=2849,gl.ALIASED_POINT_SIZE_RANGE=33901,gl.ALIASED_LINE_WIDTH_RANGE=33902,gl.CULL_FACE_MODE=2885,gl.FRONT_FACE=2886,gl.DEPTH_RANGE=2928,gl.DEPTH_WRITEMASK=2930,gl.DEPTH_CLEAR_VALUE=2931,gl.DEPTH_FUNC=2932,gl.STENCIL_CLEAR_VALUE=2961,gl.STENCIL_FUNC=2962,gl.STENCIL_FAIL=2964,gl.STENCIL_PASS_DEPTH_FAIL=2965,gl.STENCIL_PASS_DEPTH_PASS=2966,gl.STENCIL_REF=2967,gl.STENCIL_VALUE_MASK=2963,gl.STENCIL_WRITEMASK=2968,gl.STENCIL_BACK_FUNC=34816,gl.STENCIL_BACK_FAIL=34817,gl.STENCIL_BACK_PASS_DEPTH_FAIL=34818,gl.STENCIL_BACK_PASS_DEPTH_PASS=34819,gl.STENCIL_BACK_REF=36003,gl.STENCIL_BACK_VALUE_MASK=36004,gl.STENCIL_BACK_WRITEMASK=36005,gl.VIEWPORT=2978,gl.SCISSOR_BOX=3088,gl.COLOR_CLEAR_VALUE=3106,gl.COLOR_WRITEMASK=3107,gl.UNPACK_ALIGNMENT=3317,gl.PACK_ALIGNMENT=3333,gl.MAX_TEXTURE_SIZE=3379,gl.MAX_VIEWPORT_DIMS=3386,gl.SUBPIXEL_BITS=3408,gl.RED_BITS=3410,gl.GREEN_BITS=3411,gl.BLUE_BITS=3412,gl.ALPHA_BITS=3413,gl.DEPTH_BITS=3414,gl.STENCIL_BITS=3415,gl.POLYGON_OFFSET_UNITS=10752,gl.POLYGON_OFFSET_FACTOR=32824,gl.TEXTURE_BINDING_2D=32873,gl.SAMPLE_BUFFERS=32936,gl.SAMPLES=32937,gl.SAMPLE_COVERAGE_VALUE=32938,gl.SAMPLE_COVERAGE_INVERT=32939,gl.COMPRESSED_TEXTURE_FORMATS=34467,gl.DONT_CARE=4352,gl.FASTEST=4353,gl.NICEST=4354,gl.GENERATE_MIPMAP_HINT=33170,gl.BYTE=5120,gl.UNSIGNED_BYTE=5121,gl.SHORT=5122,gl.UNSIGNED_SHORT=5123,gl.INT=5124,gl.UNSIGNED_INT=5125,gl.FLOAT=5126,gl.DEPTH_COMPONENT=6402,gl.ALPHA=6406,gl.RGB=6407,gl.RGBA=6408,gl.LUMINANCE=6409,gl.LUMINANCE_ALPHA=6410,gl.UNSIGNED_SHORT_4_4_4_4=32819,gl.UNSIGNED_SHORT_5_5_5_1=32820,gl.UNSIGNED_SHORT_5_6_5=33635,gl.FRAGMENT_SHADER=35632,gl.VERTEX_SHADER=35633,gl.MAX_VERTEX_ATTRIBS=34921,gl.MAX_VERTEX_UNIFORM_VECTORS=36347,gl.MAX_VARYING_VECTORS=36348,gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,gl.MAX_TEXTURE_IMAGE_UNITS=34930,gl.MAX_FRAGMENT_UNIFORM_VECTORS=36349,gl.SHADER_TYPE=35663,gl.DELETE_STATUS=35712,gl.LINK_STATUS=35714,gl.VALIDATE_STATUS=35715,gl.ATTACHED_SHADERS=35717,gl.ACTIVE_UNIFORMS=35718,gl.ACTIVE_ATTRIBUTES=35721,gl.SHADING_LANGUAGE_VERSION=35724,gl.CURRENT_PROGRAM=35725,gl.NEVER=512,gl.LESS=513,gl.EQUAL=514,gl.LEQUAL=515,gl.GREATER=516,gl.NOTEQUAL=517,gl.GEQUAL=518,gl.ALWAYS=519,gl.KEEP=7680,gl.REPLACE=7681,gl.INCR=7682,gl.DECR=7683,gl.INVERT=5386,gl.INCR_WRAP=34055,gl.DECR_WRAP=34056,gl.VENDOR=7936,gl.RENDERER=7937,gl.VERSION=7938,gl.NEAREST=9728,gl.LINEAR=9729,gl.NEAREST_MIPMAP_NEAREST=9984,gl.LINEAR_MIPMAP_NEAREST=9985,gl.NEAREST_MIPMAP_LINEAR=9986,gl.LINEAR_MIPMAP_LINEAR=9987,gl.TEXTURE_MAG_FILTER=10240,gl.TEXTURE_MIN_FILTER=10241,gl.TEXTURE_WRAP_S=10242,gl.TEXTURE_WRAP_T=10243,gl.TEXTURE_2D=3553,gl.TEXTURE=5890,gl.TEXTURE_CUBE_MAP=34067,gl.TEXTURE_BINDING_CUBE_MAP=34068,gl.TEXTURE_CUBE_MAP_POSITIVE_X=34069,gl.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,gl.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,gl.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,gl.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,gl.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,gl.MAX_CUBE_MAP_TEXTURE_SIZE=34076,gl.TEXTURE0=33984,gl.TEXTURE1=33985,gl.TEXTURE2=33986,gl.TEXTURE3=33987,gl.TEXTURE4=33988,gl.TEXTURE5=33989,gl.TEXTURE6=33990,gl.TEXTURE7=33991,gl.TEXTURE8=33992,gl.TEXTURE9=33993,gl.TEXTURE10=33994,gl.TEXTURE11=33995,gl.TEXTURE12=33996,gl.TEXTURE13=33997,gl.TEXTURE14=33998,gl.TEXTURE15=33999,gl.TEXTURE16=34e3,gl.TEXTURE17=34001,gl.TEXTURE18=34002,gl.TEXTURE19=34003,gl.TEXTURE20=34004,gl.TEXTURE21=34005,gl.TEXTURE22=34006,gl.TEXTURE23=34007,gl.TEXTURE24=34008,gl.TEXTURE25=34009,gl.TEXTURE26=34010,gl.TEXTURE27=34011,gl.TEXTURE28=34012,gl.TEXTURE29=34013,gl.TEXTURE30=34014,gl.TEXTURE31=34015,gl.ACTIVE_TEXTURE=34016,gl.REPEAT=10497,gl.CLAMP_TO_EDGE=33071,gl.MIRRORED_REPEAT=33648,gl.FLOAT_VEC2=35664,gl.FLOAT_VEC3=35665,gl.FLOAT_VEC4=35666,gl.INT_VEC2=35667,gl.INT_VEC3=35668,gl.INT_VEC4=35669,gl.BOOL=35670,gl.BOOL_VEC2=35671,gl.BOOL_VEC3=35672,gl.BOOL_VEC4=35673,gl.FLOAT_MAT2=35674,gl.FLOAT_MAT3=35675,gl.FLOAT_MAT4=35676,gl.SAMPLER_2D=35678,gl.SAMPLER_CUBE=35680,gl.VERTEX_ATTRIB_ARRAY_ENABLED=34338,gl.VERTEX_ATTRIB_ARRAY_SIZE=34339,gl.VERTEX_ATTRIB_ARRAY_STRIDE=34340,gl.VERTEX_ATTRIB_ARRAY_TYPE=34341,gl.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,gl.VERTEX_ATTRIB_ARRAY_POINTER=34373,gl.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,gl.IMPLEMENTATION_COLOR_READ_TYPE=35738,gl.IMPLEMENTATION_COLOR_READ_FORMAT=35739,gl.COMPILE_STATUS=35713,gl.LOW_FLOAT=36336,gl.MEDIUM_FLOAT=36337,gl.HIGH_FLOAT=36338,gl.LOW_INT=36339,gl.MEDIUM_INT=36340,gl.HIGH_INT=36341,gl.FRAMEBUFFER=36160,gl.RENDERBUFFER=36161,gl.RGBA4=32854,gl.RGB5_A1=32855,gl.RGB565=36194,gl.DEPTH_COMPONENT16=33189,gl.STENCIL_INDEX8=36168,gl.DEPTH_STENCIL=34041,gl.RENDERBUFFER_WIDTH=36162,gl.RENDERBUFFER_HEIGHT=36163,gl.RENDERBUFFER_INTERNAL_FORMAT=36164,gl.RENDERBUFFER_RED_SIZE=36176,gl.RENDERBUFFER_GREEN_SIZE=36177,gl.RENDERBUFFER_BLUE_SIZE=36178,gl.RENDERBUFFER_ALPHA_SIZE=36179,gl.RENDERBUFFER_DEPTH_SIZE=36180,gl.RENDERBUFFER_STENCIL_SIZE=36181,gl.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,gl.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,gl.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,gl.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,gl.COLOR_ATTACHMENT0=36064,gl.DEPTH_ATTACHMENT=36096,gl.STENCIL_ATTACHMENT=36128,gl.DEPTH_STENCIL_ATTACHMENT=33306,gl.NONE=0,gl.FRAMEBUFFER_COMPLETE=36053,gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,gl.FRAMEBUFFER_UNSUPPORTED=36061,gl.FRAMEBUFFER_BINDING=36006,gl.RENDERBUFFER_BINDING=36007,gl.MAX_RENDERBUFFER_SIZE=34024,gl.INVALID_FRAMEBUFFER_OPERATION=1286,gl.UNPACK_FLIP_Y_WEBGL=37440,gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,gl.CONTEXT_LOST_WEBGL=37442,gl.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,gl.BROWSER_DEFAULT_WEBGL=37444,gl.SHADER_BINARY_FORMATS=36344,gl.NUM_SHADER_BINARY_FORMATS=36345,gl.NUM_COMPRESSED_TEXTURE_FORMATS=34466}function OpenOptMode(){gl.flushCommand&&isSupportTypeArray()&&attachMethodOpt(),buffer_data=new Float32Array(total_size)}function closeOptMode(){attachMethod()}function flushCommand(){next_index>0&&(gl.flushCommand(next_index,buffer_data),next_index=0)}function glCommitOpt(){flushCommand(),gl.commit()}function activeTextureOpt(e){next_index+2>total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_ACTIVE_TEXTURE,buffer_data[next_index+1]=e,next_index+=2}function attachShaderOpt(e,t){next_index+3>total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_ATTACH_SHADER,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,next_index+=3}function bindAttribLocationOpt(e,t,i){flushCommand(),bindAttribLocation(e,t,i)}function bindBufferOpt(e,t){next_index+3>total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_BIND_BUFFER,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,next_index+=3}function bindFramebufferOpt(e,t){flushCommand(),bindFramebuffer(e,t)}function bindRenderbufferOpt(e,t){flushCommand(),bindRenderbuffer(e,t)}function bindTextureOpt(e,t){next_index+3>total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_BIND_TEXTURE,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,next_index+=3}function blendColorOpt(e,t,i,r){next_index+5>total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_BLEND_COLOR,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i,buffer_data[next_index+4]=r,next_index+=5}function blendEquationOpt(e){next_index+2>total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_BLEND_EQUATION,buffer_data[next_index+1]=e,next_index+=2}function blendEquationSeparateOpt(e,t){next_index+3>total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_BLEND_EQUATION_SEPARATE,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,next_index+=3}function blendFuncOpt(e,t){next_index+3>total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_BLEND_FUNC,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,next_index+=3}function blendFuncSeparateOpt(e,t,i,r){next_index+5>total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_BLEND_FUNC_SEPARATE,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i,buffer_data[next_index+4]=r,next_index+=5}function bufferDataOpt(e,t,i){flushCommand(),bufferData(e,t,i)}function bufferSubDataOpt(e,t,i){flushCommand(),bufferSubData(e,t,i)}function checkFramebufferStatusOpt(e){flushCommand(),checkFramebufferStatus(e)}function clearOpt(e){next_index+2>total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_CLEAR,buffer_data[next_index+1]=e,next_index+=2}function clearColorOpt(e,t,i,r){next_index+5>total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_CLEAR_COLOR,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i,buffer_data[next_index+4]=r,next_index+=5}function clearDepthOpt(e){next_index+2>total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_CLEAR_DEPTH,buffer_data[next_index+1]=e,next_index+=2}function clearStencilOpt(e){next_index+2>total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_CLEAR_STENCIL,buffer_data[next_index+1]=e,next_index+=2}function colorMaskOpt(e,t,i,r){next_index+5>total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_COLOR_MASK,buffer_data[next_index+1]=e?1:0,buffer_data[next_index+2]=t?1:0,buffer_data[next_index+3]=i?1:0,buffer_data[next_index+4]=r?1:0,next_index+=5}function compileShaderOpt(e){next_index+2>total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_COMPILE_SHADER,buffer_data[next_index+1]=e,next_index+=2}function compressedTexImage2DOpt(e,t,i,r,n,o,a){flushCommand(),compressedTexImage2D(e,t,i,r,n,o,a)}function compressedTexSubImage2DOpt(e,t,i,r,n,o,a,s){flushCommand(),compressedTexSubImage2D(e,t,i,r,n,o,a,s)}function copyTexImage2DOpt(e,t,i,r,n,o,a,s){next_index+9>total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_COPY_TEX_IMAGE_2D,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i,buffer_data[next_index+4]=r,buffer_data[next_index+5]=n,buffer_data[next_index+6]=o,buffer_data[next_index+7]=a,buffer_data[next_index+8]=s,next_index+=9}function copyTexSubImage2DOpt(e,t,i,r,n,o,a,s){next_index+9>total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_COPY_TEX_SUB_IMAGE_2D,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i,buffer_data[next_index+4]=r,buffer_data[next_index+5]=n,buffer_data[next_index+6]=o,buffer_data[next_index+7]=a,buffer_data[next_index+8]=s,next_index+=9}function createBufferOpt(){return flushCommand(),createBuffer()}function createFramebufferOpt(){return flushCommand(),createFramebuffer()}function createProgramOpt(){return flushCommand(),createProgram()}function createRenderbufferOpt(){return flushCommand(),createRenderbuffer()}function createShaderOpt(e){return flushCommand(),createShader(e)}function createTextureOpt(){return flushCommand(),createTexture()}function cullFaceOpt(e){next_index+2>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_CULL_FACE,buffer_data[next_index+1]=e,next_index+=2}function deleteBufferOpt(e){next_index+2>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_DELETE_BUFFER,buffer_data[next_index+1]=e,next_index+=2}function deleteFramebufferOpt(e){next_index+2>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_DELETE_FRAME_BUFFER,buffer_data[next_index+1]=e,next_index+=2}function deleteProgramOpt(e){next_index+2>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_DELETE_PROGRAM,buffer_data[next_index+1]=e,next_index+=2}function deleteRenderbufferOpt(e){next_index+2>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_DELETE_RENDER_BUFFER,buffer_data[next_index+1]=e,next_index+=2}function deleteShaderOpt(e){next_index+2>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_DELETE_SHADER,buffer_data[next_index+1]=e,next_index+=2}function deleteTextureOpt(e){next_index+2>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_DELETE_TEXTURE,buffer_data[next_index+1]=e,next_index+=2}function depthFuncOpt(e){next_index+2>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_DEPTH_FUNC,buffer_data[next_index+1]=e,next_index+=2}function depthMaskOpt(e){next_index+2>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_DEPTH_MASK,buffer_data[next_index+1]=e?1:0,next_index+=2}function depthRangeOpt(e,t){next_index+3>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_DEPTH_RANGE,buffer_data[next_index+1]=e,buffer_data[next_index+1]=t,next_index+=3}function detachShaderOpt(e,t){next_index+3>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_DETACH_SHADER,buffer_data[next_index+1]=e,buffer_data[next_index+1]=t,next_index+=3}function disableOpt(e){next_index+2>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_DISABLE,buffer_data[next_index+1]=e,next_index+=2}function disableVertexAttribArrayOpt(e){next_index+2>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_DISABLE_VERTEX_ATTRIB_ARRAY,buffer_data[next_index+1]=e,next_index+=2}function drawArraysOpt(e,t,i){next_index+4>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_DRAW_ARRAYS,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i,next_index+=4,i>0&&checkFirstFrames()}function drawElementsOpt(e,t,i,r){next_index+5>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_DRAW_ELEMENTS,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i,buffer_data[next_index+4]=r,next_index+=5,t>0&&checkFirstFrames()}function enableOpt(e){next_index+2>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_ENABLE,buffer_data[next_index+1]=e,next_index+=2}function enableVertexAttribArrayOpt(e){next_index+2>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_ENABLE_VERTEX_ATTRIB_ARRAY,buffer_data[next_index+1]=e,next_index+=2}function finishOpt(){next_index+1>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_FINISH,next_index+=1}function flushOpt(){next_index+1>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_FLUSH,next_index+=1}function framebufferRenderbufferOpt(e,t,i,r){next_index+5>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_FRAME_BUFFER_RENDER_BUFFER,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i,buffer_data[next_index+4]=r,next_index+=5}function framebufferTexture2DOpt(e,t,i,r,n){next_index+6>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_FRAME_BUFFER_TEXTURE_2D,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i,buffer_data[next_index+4]=r,buffer_data[next_index+5]=n,next_index+=6}function frontFaceOpt(e){next_index+2>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_FRONT_FACE,buffer_data[next_index+1]=e,next_index+=2}function generateMipmapOpt(e){next_index+2>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_GENERATE_MIPMAP,buffer_data[next_index+1]=e,next_index+=2}function getActiveAttribOpt(e,t){return flushCommand(),getActiveAttrib(e,t)}function getActiveUniformOpt(e,t){return flushCommand(),getActiveUniform(e,t)}function getAttachedShadersOpt(e){return flushCommand(),getAttachedShaders(e)}function getAttribLocationOpt(e,t){return flushCommand(),getAttribLocation(e,t)}function getBufferParameterOpt(e,t){return flushCommand(),getBufferParameter(e,t)}function getParameterOpt(e){return flushCommand(),getParameter(e)}function getErrorOpt(){return flushCommand(),getError()}function getFramebufferAttachmentParameterOpt(e,t,i){return flushCommand(),getFramebufferAttachmentParameter(e,t,i)}function getProgramParameterOpt(e,t){return flushCommand(),getProgramParameter(e,t)}function getProgramInfoLogOpt(e){return flushCommand(),getProgramInfoLog(e)}function getRenderbufferParameterOpt(e,t){return flushCommand(),getRenderbufferParameter(e,t)}function getShaderParameterOpt(e,t){return flushCommand(),getShaderParameter(e,t)}function getShaderPrecisionFormatOpt(e,t){return flushCommand(),getShaderPrecisionFormat(e,t)}function getShaderInfoLogOpt(e){return flushCommand(),getShaderInfoLog(e)}function getShaderSourceOpt(e){return flushCommand(),getShaderSource(e)}function getTexParameterOpt(e,t){return flushCommand(),getTexParameter(e,t)}function getUniformOpt(e,t){return flushCommand(),getUniform(e,t)}function getUniformLocationOpt(e,t){return flushCommand(),getUniformLocation(e,t)}function getVertexAttribOpt(e,t){return flushCommand(),getVertexAttrib(e,t)}function getVertexAttribOffsetOpt(e,t){return flushCommand(),getVertexAttribOffset(e,t)}function hintOpt(e,t){next_index+3>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_HINT,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,next_index+=3}function isBufferOpt(e){return flushCommand(),isBuffer(e)}function isEnabledOpt(e){return flushCommand(),isEnabled(e)}function isFramebufferOpt(e){return flushCommand(),isFramebuffer(e)}function isProgramOpt(e){return flushCommand(),isProgram(e)}function isRenderbufferOpt(e){return flushCommand(),isRenderbuffer(e)}function isShaderOpt(e){return flushCommand(),isShader(e)}function isTextureOpt(e){return flushCommand(),isTexture(e)}function lineWidthOpt(e){next_index+2>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_LINE_WIDTH,buffer_data[next_index+1]=e,next_index+=2}function linkProgramOpt(e){next_index+2>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_LINK_PROGRAM,buffer_data[next_index+1]=e,next_index+=2}function pixelStoreiOpt(e,t){flushCommand(),pixelStorei(e,t)}function polygonOffsetOpt(e,t){next_index+3>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_POLYGON_OFFSET,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,next_index+=3}function readPixelsOpt(e,t,i,r,n,o,a){}function renderbufferStorageOpt(e,t,i,r){next_index+5>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_RENDER_BUFFER_STORAGE,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i,buffer_data[next_index+4]=r,next_index+=5}function sampleCoverageOpt(e,t){next_index+3>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_SAMPLE_COVERAGE,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t?1:0,next_index+=3}function scissorOpt(e,t,i,r){next_index+5>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_SCISSOR,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i,buffer_data[next_index+4]=r,next_index+=5}function shaderSourceOpt(e,t){flushCommand(),shaderSource(e,t)}function stencilFuncOpt(e,t,i){next_index+4>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_STENCIL_FUNC,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i,next_index+=4}function stencilFuncSeparateOpt(e,t,i,r){next_index+5>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_STENCIL_FUNC_SEPARATE,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i,buffer_data[next_index+4]=r,next_index+=5}function stencilMaskOpt(e){next_index+2>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_STENCIL_MASK,buffer_data[next_index+1]=e,next_index+=2}function stencilMaskSeparateOpt(e,t){next_index+3>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_STENCIL_MASK_SEPARATE,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,next_index+=3}function stencilOpOpt(e,t,i){next_index+4>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_STENCIL_OP,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i,next_index+=4}function stencilOpSeparateOpt(e,t,i,r){next_index+5>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_STENCIL_OP_SEPARATE,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i,buffer_data[next_index+4]=r,next_index+=5}function texImage2DOpt(e,t,i){switch(flushCommand(),arguments.length){case 6:var r=arguments[3],n=arguments[4],o=arguments[5];Object.prototype.hasOwnProperty.call(o,"__nativeObj")?gl.glTexImage2D(e,t,i,r,n,o.__nativeObj):Object.prototype.hasOwnProperty.call(o,"buffer")&&Object.prototype.hasOwnProperty.call(o.buffer,"eof")&&Object.prototype.hasOwnProperty.call(o.buffer,"pointer")&&Object.prototype.hasOwnProperty.call(o.buffer,"netOrder")&&o.width>0&&o.height>0&&gl.glTexImage2D(e,t,i,r,n,o);break;case 9:var a=arguments[3],s=arguments[4],h=arguments[5],r=arguments[6],n=arguments[7],c=arguments[8];gl.glTexImage2D(e,t,i,a,s,h,r,n,c)}}function texParameterfOpt(e,t,i){next_index+4>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_TEX_PARAMETER_F,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i,next_index+=4}function texParameteriOpt(e,t,i){next_index+4>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_TEX_PARAMETER_I,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i,next_index+=4}function texSubImage2DOpt(e,t,i,r,n,o,a,s,h){flushCommand(),texSubImage2D(e,t,i,r,n,o,a,s,h)}function texSubImage2DOpt(e,t,i,r,n,o,a){flushCommand(),texSubImage2D(e,t,i,r,n,o,a)}function uniform1fOpt(e,t){next_index+3>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_1F,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,next_index+=3}function uniform2fOpt(e,t,i){next_index+4>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_2F,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i,next_index+=4}function uniform3fOpt(e,t,i,r){next_index+5>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_3F,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i,buffer_data[next_index+4]=r,next_index+=5}function uniform4fOpt(e,t,i,r,n){next_index+6>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_4F,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i,buffer_data[next_index+4]=r,buffer_data[next_index+5]=n,next_index+=6}function uniform1iOpt(e,t){next_index+3>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_1I,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,next_index+=3}function uniform2iOpt(e,t,i){next_index+4>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_2I,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i,next_index+=4}function uniform3iOpt(e,t,i,r){next_index+5>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_3I,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i,buffer_data[next_index+4]=r,next_index+=5}function uniform4iOpt(e,t,i,r,n){next_index+6>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_4I,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i,buffer_data[next_index+4]=r,buffer_data[next_index+5]=n,next_index+=6}function uniform1fvOpt(e,t){next_index+3+t.length>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_1FV,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t.length,buffer_data.set(t,next_index+3),next_index+=3+t.length}function uniform2fvOpt(e,t){next_index+3+t.length>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_2FV,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t.length,buffer_data.set(t,next_index+3),next_index+=3+t.length}function uniform3fvOpt(e,t){next_index+3+t.length>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_3FV,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t.length,buffer_data.set(t,next_index+3),next_index+=3+t.length}function uniform4fvOpt(e,t){next_index+3+t.length>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_4FV,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t.length,buffer_data.set(t,next_index+3),next_index+=3+t.length}function uniform1ivOpt(e,t){next_index+3+t.length>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_1IV,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t.length,buffer_data.set(t,next_index+3),next_index+=3+t.length}function uniform2ivOpt(e,t){next_index+3+t.length>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_2IV,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t.length,buffer_data.set(t,next_index+3),next_index+=3+t.length}function uniform3ivOpt(e,t){next_index+3+t.length>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_3IV,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t.length,buffer_data.set(t,next_index+3),next_index+=3+t.length}function uniform4ivOpt(e,t){next_index+3+t.length>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_4IV,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t.length,buffer_data.set(t,next_index+3),next_index+=3+t.length}function uniformMatrix2fvOpt(e,t,i){next_index+4+i.length>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_MATRIX_2FV,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i.length,buffer_data.set(i,next_index+4),next_index+=4+i.length}function uniformMatrix3fvOpt(e,t,i){next_index+4+i.length>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_MATRIX_3FV,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i.length,buffer_data.set(i,next_index+4),next_index+=4+i.length}function uniformMatrix4fvOpt(e,t,i){next_index+4+i.length>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_MATRIX_4FV,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i.length,buffer_data.set(i,next_index+4),next_index+=4+i.length}function useProgramOpt(e){next_index+2>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_USE_PROGRAM,buffer_data[next_index+1]=e,next_index+=2}function validateProgramOpt(e){next_index+2>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_VALIDATE_PROGRAM,buffer_data[next_index+1]=e,next_index+=2}function vertexAttrib1fOpt(e,t){next_index+3>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_VERTEX_ATTRIB_1F,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,next_index+=3}function vertexAttrib2fOpt(e,t,i){next_index+4>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_VERTEX_ATTRIB_2F,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i,next_index+=4}function vertexAttrib3fOpt(e,t,i,r){next_index+5>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_VERTEX_ATTRIB_3F,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i,buffer_data[next_index+4]=r,next_index+=5}function vertexAttrib4fOpt(e,t,i,r,n){next_index+6>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_VERTEX_ATTRIB_4F,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i,buffer_data[next_index+4]=r,buffer_data[next_index+5]=n,next_index+=6}function vertexAttrib1fvOpt(e,t){next_index+3+t.length>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_VERTEX_ATTRIB_1FV,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t.length,buffer_data.set(t,next_index+3),next_index+=3+t.length}function vertexAttrib2fvOpt(e,t){next_index+3+t.length>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_VERTEX_ATTRIB_2FV,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t.length,buffer_data.set(t,next_index+3),next_index+=3+t.length}function vertexAttrib3fvOpt(e,t){next_index+3+t.length>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_VERTEX_ATTRIB_3FV,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t.length,buffer_data.set(t,next_index+3),next_index+=3+t.length}function vertexAttrib4fvOpt(e,t){next_index+3+t.length>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_VERTEX_ATTRIB_4FV,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t.length,buffer_data.set(t,next_index+3),next_index+=3+t.length}function vertexAttribPointerOpt(e,t,i,r,n,o){next_index+7>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_VERTEX_ATTRIB_POINTER,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i,buffer_data[next_index+4]=r?1:0,buffer_data[next_index+5]=n,buffer_data[next_index+6]=o,next_index+=7}function viewportOpt(e,t,i,r){next_index+5>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_VIEW_PORT,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=i,buffer_data[next_index+4]=r,next_index+=5}function isSupportTypeArray(){if("android"==GameStatusInfo.platform)return!0;var e=BK.Director.queryDeviceInfo(),t=e.version.split(".");return"ios"==e.platform&&Number(t[0])>=10}function attachMethodOpt(){gl.activeTexture=activeTextureOpt,gl.attachShader=attachShaderOpt,gl.bindAttribLocation=bindAttribLocationOpt,gl.bindBuffer=bindBufferOpt,gl.bindFramebuffer=bindFramebufferOpt,gl.bindRenderbuffer=bindRenderbufferOpt,gl.bindTexture=bindTextureOpt,gl.blendColor=blendColorOpt,gl.blendEquation=blendEquationOpt,gl.blendEquationSeparate=blendEquationSeparateOpt,gl.blendFunc=blendFuncOpt,gl.blendFuncSeparate=blendFuncSeparateOpt,gl.bufferData=bufferDataOpt,gl.bufferData=bufferDataOpt,gl.bufferSubData=bufferSubDataOpt,gl.checkFramebufferStatus=checkFramebufferStatusOpt,gl.clear=clearOpt,gl.clearColor=clearColorOpt,gl.clearDepth=clearDepthOpt,gl.clearStencil=clearStencilOpt,gl.colorMask=colorMaskOpt,gl.compileShader=compileShaderOpt,gl.compressedTexImage2D=compressedTexImage2DOpt,gl.compressedTexSubImage2D=compressedTexSubImage2DOpt,gl.copyTexImage2D=copyTexImage2DOpt,gl.copyTexSubImage2D=copyTexSubImage2DOpt,gl.createBuffer=createBufferOpt,gl.createFramebuffer=createFramebufferOpt,gl.createProgram=createProgramOpt,gl.createRenderbuffer=createRenderbufferOpt,gl.createShader=createShaderOpt,gl.createTexture=createTextureOpt,gl.cullFace=cullFaceOpt,gl.deleteBuffer=deleteBufferOpt,gl.deleteFramebuffer=deleteFramebufferOpt,gl.deleteProgram=deleteProgramOpt,gl.deleteRenderbuffer=deleteRenderbufferOpt,gl.deleteShader=deleteShaderOpt,gl.deleteTexture=deleteTextureOpt,gl.depthFunc=depthFuncOpt,gl.depthMask=depthMaskOpt,gl.depthRange=depthRangeOpt,gl.detachShader=detachShaderOpt,gl.disable=disableOpt,gl.disableVertexAttribArray=disableVertexAttribArrayOpt,gl.drawArrays=drawArraysOpt,gl.drawElements=drawElementsOpt,gl.enable=enableOpt,gl.enableVertexAttribArray=enableVertexAttribArrayOpt,gl.finish=finishOpt,gl.flush=flushOpt,gl.framebufferRenderbuffer=framebufferRenderbufferOpt,gl.framebufferTexture2D=framebufferTexture2DOpt,gl.frontFace=frontFaceOpt,gl.generateMipmap=generateMipmapOpt,gl.getActiveAttrib=getActiveAttribOpt,gl.getActiveUniform=getActiveUniformOpt,gl.getAttachedShaders=getAttachedShadersOpt,gl.getAttribLocation=getAttribLocationOpt,gl.getBufferParameter=getBufferParameterOpt,gl.getParameter=getParameterOpt,gl.getError=getErrorOpt,gl.getFramebufferAttachmentParameter=getFramebufferAttachmentParameterOpt,gl.getProgramParameter=getProgramParameterOpt,gl.getProgramInfoLog=getProgramInfoLogOpt,gl.getRenderbufferParameter=getRenderbufferParameterOpt,gl.getShaderParameter=getShaderParameterOpt,gl.getShaderPrecisionFormat=getShaderPrecisionFormatOpt,gl.getShaderInfoLog=getShaderInfoLogOpt,gl.getShaderSource=getShaderSourceOpt,gl.getTexParameter=getTexParameterOpt,gl.getUniform=getUniformOpt,gl.getUniformLocation=getUniformLocationOpt,gl.getVertexAttrib=getVertexAttribOpt,gl.getVertexAttribOffset=getVertexAttribOffsetOpt,gl.hint=hintOpt,gl.isBuffer=isBufferOpt,gl.isEnabled=isEnabledOpt,gl.isFramebuffer=isFramebufferOpt,gl.isProgram=isProgramOpt,gl.isRenderbuffer=isRenderbufferOpt,gl.isShader=isShaderOpt,gl.isTexture=isTextureOpt,gl.lineWidth=lineWidthOpt,gl.linkProgram=linkProgramOpt,gl.pixelStorei=pixelStoreiOpt,gl.polygonOffset=polygonOffsetOpt,gl.readPixels=readPixelsOpt,gl.renderbufferStorage=renderbufferStorageOpt,gl.sampleCoverage=sampleCoverageOpt,gl.scissor=scissorOpt,gl.shaderSource=shaderSourceOpt,gl.stencilFunc=stencilFuncOpt,gl.stencilFuncSeparate=stencilFuncSeparateOpt,gl.stencilMask=stencilMaskOpt,gl.stencilMaskSeparate=stencilMaskSeparateOpt,gl.stencilOp=stencilOpOpt,gl.stencilOpSeparate=stencilOpSeparateOpt,gl.texImage2D=texImage2DOpt,gl.texImage2D=texImage2DOpt,gl.texParameterf=texParameterfOpt,gl.texParameteri=texParameteriOpt,gl.texSubImage2D=texSubImage2DOpt,gl.texSubImage2D=texSubImage2DOpt,gl.uniform1f=uniform1fOpt,gl.uniform2f=uniform2fOpt,gl.uniform3f=uniform3fOpt,gl.uniform4f=uniform4fOpt,gl.uniform1i=uniform1iOpt,gl.uniform2i=uniform2iOpt,gl.uniform3i=uniform3iOpt,gl.uniform4i=uniform4iOpt,gl.uniform1fv=uniform1fvOpt,gl.uniform2fv=uniform2fvOpt,gl.uniform3fv=uniform3fvOpt,gl.uniform4fv=uniform4fvOpt,gl.uniform1iv=uniform1ivOpt,gl.uniform2iv=uniform2ivOpt,gl.uniform3iv=uniform3ivOpt,gl.uniform4iv=uniform4ivOpt,gl.uniformMatrix2fv=uniformMatrix2fvOpt,gl.uniformMatrix3fv=uniformMatrix3fvOpt,gl.uniformMatrix4fv=uniformMatrix4fvOpt,gl.useProgram=useProgramOpt,gl.validateProgram=validateProgramOpt,gl.vertexAttrib1f=vertexAttrib1fOpt,gl.vertexAttrib2f=vertexAttrib2fOpt,gl.vertexAttrib3f=vertexAttrib3fOpt,gl.vertexAttrib4f=vertexAttrib4fOpt,gl.vertexAttrib1fv=vertexAttrib1fvOpt,gl.vertexAttrib2fv=vertexAttrib2fvOpt,gl.vertexAttrib3fv=vertexAttrib3fvOpt,gl.vertexAttrib4fv=vertexAttrib4fvOpt,gl.vertexAttribPointer=vertexAttribPointerOpt,gl.viewport=viewportOpt,gl.glCommit=glCommitOpt}function SandBoxCanvas(){var e=arguments.length;this._shadowColor={r:0,g:0,b:0,a:0},this._shadowOffset={x:0,y:0},this._shadowRadius=0,this._textBaseLine=0,this._textAlign=0,this._useH5Mode=0,this._a=1,this._b=0,this._c=0,this._d=1,this._tx=0,this._ty=0,2==e&&(this.__nativeObj=new BK.SandBoxCanvasNode(arguments[0],arguments[1]),this.setFlipXY(0,1),Object.getOwnPropertyNames(this.__nativeObj).forEach(function(e){var t=e;"scale"!=t&&"transform"!=t&&"contentSize"!=t&&"size"!=t&&"fontPath"!=t&&Object.defineProperty(this,t,{get:function(){return this.__nativeObj[t]},set:function(e){this.__nativeObj[t]=e}})},this),Object.defineProperty(SandBoxCanvas.prototype,"fontPath",{get:function(){return this.__nativeObj.fontPath},set:function(e){BK.FileUtil.isFileExist(e)&&(this.__nativeObj.fontPath=e)},enumerable:!0,configurable:!0}),Object.defineProperty(SandBoxCanvas.prototype,"contentSize",{get:function(){return this.__nativeObj.contentSize},set:function(e){this.__nativeObj.contentSize=e,this.__nativeObj.resetCanvas()},enumerable:!0,configurable:!0}),Object.defineProperty(SandBoxCanvas.prototype,"size",{get:function(){return this.__nativeObj.size},set:function(e){this.__nativeObj.size=e,this.__nativeObj.resetCanvas()},enumerable:!0,configurable:!0}),Object.defineProperty(SandBoxCanvas.prototype,"textBaseline",{get:function(){return this._textBaseLine},set:function(e){switch(e){case 0:case 1:case 2:this._textBaseLine=e;break;case"bottom":case"Bottom":this._textBaseLine=0;break;case"Middle":case"middle":this._textBaseLine=1;break;case"Top":case"top":this._textBaseLine=2}},enumerable:!0,configurable:!0}),Object.defineProperty(SandBoxCanvas.prototype,"textAlign",{get:function(){return this._textAlign},set:function(e){switch(e){case 0:case 1:case 2:this._textAlign=e;break;case"left":this._textAlign=0;break;case"center":this._textAlign=1;break;case"right":this._textAlign=2}this.__nativeObj.setTextAlign(this._textAlign)},enumerable:!0,configurable:!0}),Object.defineProperty(SandBoxCanvas.prototype,"lineWidth",{get:function(){return this.__nativeObj.lineWidth},set:function(e){this.__nativeObj.lineWidth=e},enumerable:!0,configurable:!0}),Object.defineProperty(SandBoxCanvas.prototype,"globalAlpha",{get:function(){return this.__nativeObj.globalAlpha},set:function(e){e=Math.min(1,e),e=Math.max(0,e),this.__nativeObj.globalAlpha=e},enumerable:!0,configurable:!0}),Object.defineProperty(SandBoxCanvas.prototype,"fillColor",{get:function(){return this.__nativeObj.fillColor},set:function(e){this.__nativeObj.fillColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(SandBoxCanvas.prototype,"strokeColor",{get:function(){return this.__nativeObj.strokeColor},set:function(e){this.__nativeObj.strokeColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(SandBoxCanvas.prototype,"lineCap",{get:function(){return this.__nativeObj.lineCap},set:function(e){this.__nativeObj.lineCap=e},enumerable:!0,configurable:!0}),Object.defineProperty(SandBoxCanvas.prototype,"lineJoin",{get:function(){return this.__nativeObj.lineJoin},set:function(e){this.__nativeObj.lineJoin=e},enumerable:!0,configurable:!0}),Object.defineProperty(SandBoxCanvas.prototype,"miterLimit",{get:function(){return this.__nativeObj.miterLimit},set:function(e){this.__nativeObj.miterLimit=e},enumerable:!0,configurable:!0}))}function __dispatchEvent(e,t,i){BK.Script.log(0,0,"__dispatchEvent err:"+e+" cmd:"+t+" data:"+i),Array.isArray(__browserMsgHdl.listenerInfos)&&__browserMsgHdl.listenerInfos.length<=0&&"sc.init_global_var.local"==t&&(GameStatusInfo=JSON.parse(i)),__browserMsgHdl.listenerInfos.forEach(function(r){if(r.cmd==t){var n=r.callback;try{n(e,t,JSON.parse(i))}catch(e){console.log(e),BK.Script.log(0,0,"JSON parse error:"+e+" data: "+i)}}},this),BK.MQQ.SsoRequest.listenerInfos.forEach(function(r){if(r.cmd==t){var n=r.callback;try{"cs.get_file_data.local"==t?n(e,t,i):n(e,t,JSON.parse(i))}catch(e){console.log(e),BK.Script.log(0,0,"JSON parse error:"+e+" data: "+i)}}},this)}function registerRedPackageListener(){function e(){BK.Script.log(1,0,"on onGameLoad  for redpackage "+localStorage.loadRedpackage),"1"!==localStorage.loadRedpackage&&(localStorage.loadRedpackage="1",BK.QQ.isOpenActivityPage()&&BK.QQ.showRedPackageActivityPage())}function t(){BK.Script.log(1,0,"on onGameForeground for redpackage "+localStorage.loadRedpackage),localStorage.loadRedpackage="0"}BK.isBrowser?(BK.Script.log(1,0,"set listener for notifyJSEVent redpackage h5"),BK.MQQ.SsoRequest.addListener("sc.init_global_var.local",this,e),BK.MQQ.SsoRequest.addListener("sc.game_enter_foreground.local",this,t)):(BK.Script.log(1,0,"set listener for notifyJSEVent redpackage not h5"),function(){BK.Script.log(1,0,"on onGameLoad  for redpackage not H5"),BK.QQ.isOpenActivityPage()&&BK.QQ.showRedPackageActivityPage()}()),BK.MQQ.SsoRequest.addListener("apollo_router_light.apollo_activity_linkcmd_query_new_redpacket",BK.QQ,BK.QQ.onNewRedPackage.bind(BK.QQ))}var hasBK=!("object"!=typeof BK),isBrowser=!hasBK;if(isBrowser){"undefined"!=typeof BK==0&&(BK={},BK.isBrowser=!0),function(e,t){if("object"==typeof e){var i=function(){var e=function(){function e(){}return e.open=function(e){t.send({url:e},"cs.openWebView.local")},e.openTransparent=function(e,i,r){void 0===i&&(i=1);var n="cs.openWebViewWithoutUrl.local";r&&(__browserMsgHdl.removeListener(n,this),__browserMsgHdl.addListener(n,this,r)),t.send({url:e},n)},e.closeTransparent=function(e){t.send({taskId:e},"cs.closeWebview.local")},e.onMessageHandle=function(e){},e}(),t=function(){function e(){}return e.ssoRequestCallBack=function(e,t,i){BK.Script.log(0,0,"ssoRequestCallBack cmd:"+t+" errCode:"+e+" data:"+JSON.stringify(i)),__dispatchEvent(e,i.cmd,JSON.stringify(i.data))},e.sendSSO=function(t,i){__browserMsgHdl.addListener("cs.ssoMessage.local",this,this.ssoRequestCallBack),e.send({cmd:i,data:JSON.stringify(t)},"cs.ssoMessage.local")},e.addListener=function(e,t,i){__browserMsgHdl.addListener(e,t,i)},e.removeListener=function(e,t){__browserMsgHdl.removeListener(e,t)},e.send=function(e,t){-1!=t.indexOf("cs.")&&-1!=t.indexOf(".local")?"undefined"!=typeof __browserMsg?__browserMsg.send(JSON.stringify(e),t):void 0!==window.webkit.messageHandlers&&window.webkit.messageHandlers.cmWebGameSend.postMessage({data:JSON.stringify(e),cmd:t}):BK.MQQ.SsoRequest.sendSSO(e,t)},e.sendWebMessage=function(t,i){e.send({cmd:i,data:JSON.stringify(t)},"sc.web_callback_game.local")},e}(),i=function(){function e(){}return e.accountCallBack=function(t,i,r){var n="0";1===r.nickname?n="1":1===r.avatar&&(n="2");var o=i+"_"+n;e.accountCallBackArr[o]&&(0,e.accountCallBackArr[o])(r.openId,r.data)},e.getNick=function(t,i){e.accountCallBackArr["cs.get_userInfo.local_1"]=i,BK.MQQ.SsoRequest.addListener("cs.get_userInfo.local",this,this.accountCallBack),BK.MQQ.SsoRequest.send({openId:t,nickname:1},"cs.get_userInfo.local")},e.getHead=function(t,i){e.accountCallBackArr["cs.get_userInfo.local_2"]=i,BK.MQQ.SsoRequest.addListener("cs.get_userInfo.local",this,this.accountCallBack),BK.MQQ.SsoRequest.send({openId:t,avatar:1},"cs.get_userInfo.local")},e.accountCallBackArr=[],e}(),r=function(){function e(){}return e.log=function(e,t,i){"undefined"!=typeof GameStatusInfo&&this.compareVersion(GameStatusInfo.QQVer,"7.6.0")>=0&&("undefined"!=typeof __browserMsg?__browserMsg.log(e,t,"webGame_log",i,""):void 0!==window.webkit.messageHandlers&&window.webkit.messageHandlers.cmWebGameLog.postMessage({level:e,errcode:t,info1:"webGame_log",info2:i,info3:""}))},e.compareVersion=function(t,i){var r=t.split("."),n=i.split("."),o=r[0]-n[0];return 0==o&&t!=i?e.compareVersion(r.splice(1).join("."),n.splice(1).join(".")):o},e}(),n=function(){function e(){}return e.base64ToUint8Array=function(e){var t,i,r,n,o,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=.75*e.length,h=e.length,c=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var l=new ArrayBuffer(s),u=new Uint8Array(l);for(t=0;t<h;t+=4)i=a.indexOf(e[t]),r=a.indexOf(e[t+1]),n=a.indexOf(e[t+2]),o=a.indexOf(e[t+3]),u[c++]=i<<2|r>>4,u[c++]=(15&r)<<4|n>>2,u[c++]=(3&n)<<6|63&o;return u},e.upload=function(e,t,i){for(var r=e.length>1024?1024:e.length,n=new Uint8Array(r),o=0;o<r/2;o++)n[o]=e[o];for(o=e.length-r/2;o<e.length;o++)n[o]=e[o];var a=BK.Crypt.core_md5(n,r),s=new Date,h=s.getFullYear()+(s.getMonth()+1<10?0+(s.getMonth()+1):s.getMonth()+1)+s.getDate(),c=t.tmpSecretId,l=t.upLoadPrefUrl,u=t.downloadUrl,d=t.sessionToken,_=t.signature,f=t.signTime,g="/"+GameStatusInfo.gameId+"_"+BK.Crypt.bin2hex(a)+GameStatusInfo.gameId+"_"+h+".png";l=l.replace(new RegExp("http://","gm"),"");var p="put\n"+g+"\n\nhost="+l+"&x-cos-storage-class=nearline\n",m="sha1\n"+f+"\n"+BK.Crypt.hex_sha1(p)+"\n",v="q-sign-algorithm=sha1&q-ak="+c+"&q-sign-time="+f+"&q-key-time="+f+"&q-header-list=host;x-cos-storage-class&q-url-param-list=&q-signature="+BK.Crypt.hex_hmac_sha1(_,m),S=new XMLHttpRequest;S.onreadystatechange=function(){4==this.readyState&&(200==this.status?(BK.Script.log(0,0," on response res = "+this.status+"   "+JSON.stringify(this.HEADERS_RECEIVED)),u.charAt(u.length-1)==g.charAt(0)&&"/"==g.charAt(0)&&(u=u.slice(0,u.length-1)),i(this.status,u+g)):i(this.status,""))},S.open("put","https://"+l+g,!0),S.setRequestHeader("x-cos-storage-class","nearline"),S.setRequestHeader("x-cos-security-token",d),S.setRequestHeader("authorization",v),S.send(e)},e.uploadFromFile=function(e,t){var i="cs.get_file_data.local",r={cmd:i,path:e};t&&(BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,function(e,i,r){var n=BK.FileUtil.base64ToUint8Array(r);BK.FileUtil.uploadFromBuff(n,t)}),BK.MQQ.SsoRequest.send(r,i))},e.uploadFromBuff=function(e,t){BK.QQ.queryCloudSignature(function(i,r){BK.FileUtil.upload(e,r,t)})},e}(),o=function(){function e(){}return e.share=function(e,t){if(e.inner=1,t){var i="sc.share_game_to_friend_result.local";BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,function(e,i,r){t(e,i,r),this.shareUpload(0==e?0:1),BK.MQQ.SsoRequest.removeListener(i,this)}.bind(this))}BK.Script.log(0,0,"share "+JSON.stringify(e)),BK.MQQ.SsoRequest.send(e,"cs.game_shell_share_callback.local")},e.shareToMQQ=function(e,i,r,n){var o="cs.share_game_result.local",a={cmd:o,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,gameVersion:GameStatusInfo.gameVersion,roomId:GameStatusInfo.roomId,title:e,summary:i,detailUrl:r,picUrl:n};t.send(a,o)},e.getRankList=function(t,i){var r={cmd:this.CMSHOW_SRV_GET_RANK_LIST,from:"default",objType:1,objId:0,busType:3,busId:GameStatusInfo.gameId.toString()};i&&(i.objType&&(r.objType=i.objType),i.objId&&(r.objId=i.objId),i.from&&(r.from=i.from)),BK.Script.log(1,1,"BK.QQ.reqGetRankList! "+JSON.stringify(r)),void 0!=r?(e._getRankListCallBack=t,BK.MQQ.SsoRequest.removeListener(this.CMSHOW_SRV_GET_RANK_LIST,this),BK.MQQ.SsoRequest.addListener(this.CMSHOW_SRV_GET_RANK_LIST,this,this._event4GetRankList),BK.MQQ.SsoRequest.sendSSO(r,this.CMSHOW_SRV_GET_RANK_LIST)):BK.Script.log(0,0,"reqGetRankList data undefined!")},e.consumeItems=function(e,t){var i="apollo_game_item.consume_game_items",r={cmd:i,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,items:e};t&&(BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,function(e,i,r){var n=[],o=[];0==e&&(n=r.data.succList,o=r.data.failList),t(e,n,o)})),BK.MQQ.SsoRequest.sendSSO(r,i)},e.getUserGameItems=function(e){var t="apollo_aio_game.get_user_game_items",i={cmd:t,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId};e&&(BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,function(t,i,r){if(void 0!=r){var n={};n.data=r.data,e(t,i,n)}})),BK.MQQ.SsoRequest.sendSSO(i,t)},e.buyGameItems=function(e,t,i){var r="apollo_aio_game.buy_game_items",n={cmd:r,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,curreType:e,itemIdList:t};i&&(BK.MQQ.SsoRequest.removeListener(r,this),BK.MQQ.SsoRequest.addListener(r,this,function(e,t,r){if(void 0!=r){var n={};n.data=r.data,i(e,t,n)}})),BK.MQQ.SsoRequest.sendSSO(n,r)},e.queryCloudSignature=function(e){var t="cs.fetch_cloud_signature.local",i={cmd:t,now:(new Date).getTime()/1e3-1,delta:600};e&&(BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,function(t,i,r){e(t,r)}),BK.MQQ.SsoRequest.send(i,t))},e.notifyCloseGame=function(){var e={gameId:GameStatusInfo.gameId,roomId:0};BK.Script.log(0,0,"BK.QQ.notifyCloseGame!gameId = "+e.gameId+", roomId = "+e.roomId),BK.MQQ.SsoRequest.send(e,"cs.close_room.local")},e.CMSHOW_SRV_GET_RANK_LIST="apollo_router_game.game_rank_linkcmd_get_fri_rank_for_engine",e.shareToArk=function(e,i,r,n,o,a){"boolean"==typeof n&&(n=1==n?1:0);var s="cs.share_game_in_ark.local",h="sc.share_game_to_friend_result.local";"android"==GameStatusInfo.platform&&0==GameStatusInfo.QQVer.indexOf("7.6.0")&&(s="cs.game_shell_share_callback.local");var c={cmd:s,summary:i,picUrl:r,gameId:GameStatusInfo.gameId,roomId:e,gameMode:GameStatusInfo.gameMode,isSelectFriend:n,extendInfo:o};BK.Script.log(0,0,"ShareToArk summary="+c.summary+" roomId="+c.roomId+"  gameMode="+c.gameMode+"picUrl="+c.picUrl+"  gameId="+c.gameId),a&&(BK.MQQ.SsoRequest.removeListener(h,this),BK.MQQ.SsoRequest.addListener(h,this,a)),t.send(c,s)},e.shareToArkFromFile=function(e,t,i,r){BK.FileUtil.uploadFromFile(r,function(r,n){BK.QQ.shareToArk(e,t,n,!0,i)})},e.shareToArkFromBuff=function(e,t,i,r){BK.FileUtil.uploadFromBuff(r,function(r,n){200==r&&BK.QQ.shareToArk(e,t,n,!0,i)})},e.createShortCut=function(e,t){var i="";e&&(i=e);var r={extendInfo:i};if(t){var n="cs.create_xy_shortcut.local";BK.MQQ.SsoRequest.removeListener(n,this),BK.MQQ.SsoRequest.addListener(n,this,function(e,i,r){t(e,i,r),BK.MQQ.SsoRequest.removeListener(i,this)})}BK.MQQ.SsoRequest.send(r,"cs.create_xy_shortcut.local"),BK.Script.log(0,0,"createShortCut")},e.fetchOpenKey=function(e){var t="cs.on_get_open_key.local",i={gameId:GameStatusInfo.gameId};e&&(BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,e)),BK.MQQ.SsoRequest.send(i,t)},e.scoreUpload=function(e,t,i){var r="apollo_aio_game.report_user_score_3rd",n={cmd:r,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,version:GameStatusInfo.gameVersion,roomId:GameStatusInfo.roomId,gData:e};i&&(n.arkData=i),t&&(BK.MQQ.SsoRequest.removeListener(r,this),BK.MQQ.SsoRequest.addListener(r,this,t)),BK.MQQ.SsoRequest.sendSSO(n,r)},e._getRankListCallBack=void 0,e._event4GetRankList=function(t,i,r){BK.Script.log(1,1,"BK.QQ.reqGetRankList! callback cmd:"+i+" errCode:"+t+"  data:"+JSON.stringify(r)),void 0!=e._getRankListCallBack&&e._getRankListCallBack(t,i,r),BK.MQQ.SsoRequest.removeListener(this.CMSHOW_SRV_GET_RANK_LIST,this)},e.uploadScoreWithoutRoom=function(e,t,i){var r="apollo_report_result.single_user_result",n=Math.floor((new Date).getTime()/1e3),o={from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,version:GameStatusInfo.gameVersion,aioType:1,ts:n.toString(),src:GameStatusInfo.src,mode:void 0!==e?e:1,userData:t.userData,attr:t.attr};i&&(BK.MQQ.SsoRequest.removeListener(r,this),BK.MQQ.SsoRequest.addListener(r,this,i)),BK.MQQ.SsoRequest.sendSSO(o,r)},e.getRankListWithoutRoom=function(e,t,i,r){var n="apollo_router_game.apollo_user_rankinglist_linkcmd_custom_ranking",o=Math.floor((new Date).getTime()/1e3),a={from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,version:GameStatusInfo.gameVersion,ts:o.toString(),attr:void 0!==e?e:"score",order:void 0!==t?t:1,rankType:void 0!==i?i:0};r&&(BK.MQQ.SsoRequest.removeListener(n,this),BK.MQQ.SsoRequest.addListener(n,this,r)),BK.MQQ.SsoRequest.sendSSO(a,n)},e.qPayPurchase=function(e,t,i,r){var n=1,o={gameOrientation:e,transparent:n=1==t?1:0,businessType:2,url:"https://cmshow.qq.com/apollo/html/game-platform/buy-props.html?_wv=3&adtag=inside_game&gameId="+GameStatusInfo.gameId+"&gameOrientation="+e+"&itemList="+encodeURI(JSON.stringify(i))};if(r){var a="sc.apolloGameWebMessage.local";BK.MQQ.SsoRequest.removeListener(a,this),BK.MQQ.SsoRequest.addListener(a,this,function(e,t,i){0==e&&i.op&&"apolloGamePlatform.buyProps"==i.op&&r(i.data.code,i.data)}.bind(this))}BK.MQQ.SsoRequest.send(o,"cs.openWebViewWithoutUrl.local")},e.getGameItemList=function(e){var t="apollo_aio_game.get_game_itemList",i={cmd:t,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId};e&&(BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,e)),BK.MQQ.SsoRequest.sendSSO(i,t)},e.rollbackGameItems=function(e,t){var i="apollo_game_item.rollback_game_items",r={cmd:i,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,items:e};t&&(BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,function(e,i,r){var n=[],o=[];0==e&&(n=r.data.succList,o=r.data.failList),t(e,n,o)}.bind(this))),BK.MQQ.SsoRequest.sendSSO(r,i)},e.shareUpload=function(e){var t=e.toString();BK.QQ.uploadData("clickShowOffButton","",t,"","","")},e.uploadData=function(e,t,i,r,n,o){var a="cs.report_data_2_compass.local",s=GameStatusInfo.gameId;"ios"==GameStatusInfo.platform&&(e=e.toString(),i=i.toString());var h={cmd:a,actionName:e,enter:t,entry:t,result:i,r2:s.toString(),r3:r,r4:n,r5:o};BK.MQQ.SsoRequest.sendSSO(h,a)},e.saveGameData=function(e,t){var i="apollo_private_data.set_user_data",r=Math.floor((new Date).getTime()/1e3),n={openId:GameStatusInfo.openId,gameId:GameStatusInfo.gameId,version:GameStatusInfo.gameVersion,from:GameStatusInfo.platform,ts:r.toString(),data:e};t&&(BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,t)),BK.MQQ.SsoRequest.send(n,i)},e.loadGameData=function(e){var t="apollo_private_data.get_user_data",i=Math.floor((new Date).getTime()/1e3),r={openId:GameStatusInfo.openId,gameId:GameStatusInfo.gameId,version:GameStatusInfo.gameVersion,from:GameStatusInfo.platform,ts:i.toString()};e&&(BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,e)),BK.MQQ.SsoRequest.send(r,t)},e.reportGameResult=function(e,t){var i="apollo_router_game.apollo_reportcm_linkcmd_game_result";e.gameId=GameStatusInfo.gameId,GameStatusInfo.isWhiteUser>0&&BK.Script.log(1,1,"reportGameResult :"+e),BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,function(e,i,r){BK.QQ.checkNewRedPackage(),t&&t(e,i,r)}),BK.MQQ.SsoRequest.send(e,i)},e.sendB2CRedPacket=function(e,t){if(t){var i="sc.send_b2c_redpacket_result.local";BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,function(e,i,r){t(e,i,r),BK.MQQ.SsoRequest.removeListener(i,this)})}var r={groupPushData:{gameRedPacketId:1,gameId:GameStatusInfo.gameId,extraInfo:e}};BK.Script.log(1,1,"sendB2CRedPacket:"+JSON.stringify(r)),BK.MQQ.SsoRequest.send(r,"cs.send_b2c_redpacket.local"),BK.Script.log(0,0,"sendB2CRedPacket")},e}(),a=function(){function e(){}return e.close=function(){BK.MQQ.SsoRequest.sendWebMessage({},"cs.close_room.local")},e.packUp=function(){BK.MQQ.SsoRequest.sendWebMessage({},"cs.make_room_min.local")},e}(),s=function(){function e(){}return e}();return{Webview:e,SsoRequest:t,Account:i,Script:r,FileUtil:n,QQ:o,Game:a,Misc:s}}();void 0===e.MQQ&&(e.MQQ={Webview:i.Webview,SsoRequest:i.SsoRequest,Account:i.Account}),void 0===e.FileUtil&&(e.FileUtil=i.FileUtil),void 0===e.Script&&(e.Script=i.Script),void 0===e.QQ&&(e.QQ=i.QQ),void 0===e.Game&&(e.Game=i.Game),void 0===e.Misc&&(e.Misc=i.Misc)}}(BK),function(e,t){t.Script.setErrorObserver=function(e){},e._globalErrorCallback_=function(e){}}(this,BK),BK.Misc.compQQVersion||(BK.Misc.compQQVersion=function(e,t){for(var i=e.split("."),r=t.split("."),n=Math.min(3,Math.min(i.length,r.length)),o=0;o<n;o++)if(i[o]!=r[o])return i[o]<r[o];return!0},BK.Misc.qqVerLessthan=function(e,t){for(var i=e.split("."),r=t.split("."),n=Math.min(3,Math.min(i.length,r.length)),o=0;o<n;o++)if(i[o]<r[o])return!0;return!1});var CMSHOW_SRV_CHECK_NEW_RED_PACKAGE="apollo_router_light.apollo_activity_linkcmd_query_new_redpacket",redPackageOpenCount=0;BK.QQ.isUserInRedPackageActivity=function(){var e=GameStatusInfo.commFlagBits>>1&1&&310!==GameStatusInfo.src;return BK.Script.log(1,1,"redPackage  isUserInRedPackageActivity: "+e),e},BK.QQ.isOpenActivityPage=function(){var e=GameStatusInfo.commFlagBits>>2&1&&310!==GameStatusInfo.src;return BK.Script.log(1,1,"redPackage  isOpenActivityPage: "+e),e},BK.QQ.showRedPackageActivityPage=function(){if(BK.QQ.isOpenActivityPage()&&0===redPackageOpenCount){var e="http://cmshow.qq.com/act_apollo/h5_act/gameRedPacket/html/popup.html?game_id="+GameStatusInfo.gameId+"&page=ad&_cwv=1&wv=3&adtag=engine";BK.Script.log(1,0,"redPackage  \u6253\u5f00\u6e38\u620f\u6d6e\u5c42 :"+e),BK.MQQ.Webview.openTransparent(e),redPackageOpenCount++}},BK.QQ.checkNewRedPackage=function(){if(BK.QQ.isUserInRedPackageActivity()){var e={cmd:CMSHOW_SRV_CHECK_NEW_RED_PACKAGE,gameId:GameStatusInfo.gameId.toString()};BK.MQQ.SsoRequest.send(e,CMSHOW_SRV_CHECK_NEW_RED_PACKAGE)}},BK.QQ.onNewRedPackage=function(e,t,i){if(BK.Script.log(1,0,"BK.QQ.onNewRedPackage  redPackage errCode = "+e+" cmd = "+t+" data = "+JSON.stringify(i)),0==e)if(i.data&&i.data.redPacket&&i.data.redPacket.actId&&i.data.redPacket.taskId){var r=i.data.redPacket,n="http://cmshow.qq.com/act_apollo/h5_act/gameRedPacket/html/popup.html?game_id="+GameStatusInfo.gameId+"&page=task&task_id="+r.taskId+"&_cwv=1&wv=3&adtag=engine";BK.MQQ.Webview.openTransparent(n)}else BK.Script.log(1,0,"request new red package  redPackage ,\u6ca1\u6709\u65b0\u7ea2\u5305\u4efb\u52a1\u89e6\u53d1");else BK.Script.log(1,0,"request new red package Failed!  redPackage ErrCode:"+e)}}else{!function(e,t){"object"==typeof e&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Emitter=t())}(BK,function(){var e=function(){function e(e,t,i){this.once=i,this.target=e,this.callback=t}return e}();return function(){function t(){this._emits={}}return t.prototype.__emit_get=function(e){return this._emits[e]||(this._emits[e]=new Array),this._emits[e]},t.prototype.__emit_put=function(e,t){this.__emit_get(e).push(t)},t.prototype.__emit_exists=function(e,t){for(var i=this.__emit_get(e),r=!1,n=0;n<i.length;n++)if(i[n].target==t){r=!0;break}return r},t.prototype.dispose=function(){delete this._emits},t.prototype.on=function(t,i,r,n){if(0==this.__emit_exists(t,i)){var o=new e(i,r,n);this.__emit_put(t,o)}else BK.Script.log(0,0,"BK.bkEmitter.on!has found, event = "+t+", target = "+JSON.stringify(i))},t.prototype.off=function(e,t){for(var i=this.__emit_get(e),r=0;r<i.length;r++)if(i[r].target==t){i.splice(r,1);break}},t.prototype.offAll=function(e){Object.keys(this._emits).forEach(function(t){this.off(t,e)}.bind(this))},t.prototype.emitAll=function(e,t){for(var i=new Array,r=this.__emit_get(e),n=0;n<r.length;n++){var o={event:e,source:this,target:r[n].target,extras:t};r[n].callback&&r[n].callback(o),1==r[n].once&&i.push(r[n].target)}for(n=0;n<i.length;n++)this.off(e,i[n])},t.prototype.emitOnce=function(e,t){for(var i=new Array,r=this.__emit_get(e),n=0;n<r.length;n++)if(1==r[n].once){var o={event:e,source:this,target:r[n].target,extras:t};i.push(r[n].target),r[n].callback&&r[n].callback(o)}for(n=0;n<i.length;n++)this.off(e,i[n])},t}()}),function(e,t){"object"==typeof e&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.DNS=t())}(BK,function(){function e(){this.records=[],this.running=!1}return e.prototype.exists=function(e){for(var t=0;t<this.records.length;t++)if(this.records[t].hostname===e)return!0;return!1},e.prototype.query=function(e,t){for(var i=0;i<this.records.length;i++)if(this.records[i].af===t&&this.records[i].hostname===e)return this.records[i];return null},e.prototype.update=function(e,t,i,r){for(var n=0;n<this.records.length;n++)if(this.records[n].af===i&&this.records[n].hostname===e)return void this.records[n].callbacks.push(t);this.records.push({af:i,timeout:r,hostname:e,callbacks:[t]})},e.prototype.delete=function(e){for(var t=this.records.length-1;t>=0;t--)if(this.records[t].hostname===e){this.records.splice(t,1);break}},e.prototype.start=function(){if(!this.running){this.running=!0;var e=this;BK.Director.ticker.add(function(t,i){e.records.length&&BK.Misc.handleDNSQueryResult()})}},e.prototype.queryIPAddress=function(e,t,i,r){var n=!this.exists(e);if(void 0==i&&(i=2),void 0==r&&(r=0),this.update(e,t,i,r),n){var o=this;o.start(),BK.Misc.queryIPAddress(e,function(t,i,r){var n=o.query(e,i);if(n)for(var a=n.callbacks,s=0;s<a.length;s++)a[s].call(o,t,i,r);o.delete(e)},i,r)}},new e}),function(e,t){"object"==typeof e&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.HTTPParser=t())}(this,function(){function e(e){this.onHeaders=void 0,this.onComplete=void 0,this.reinitialize(e)}var t=/^HTTP\/1\.([01]) ([0-9]{3})(?: ((?:[\x21-\x7E](?:[\t ]+[\x21-\x7E])*)*))?$/,i=/^([!#$%'*+\-.^_`|~0-9A-Za-z]+):[\t ]*((?:[\x21-\x7E](?:[\t ]+[\x21-\x7E])*)*)[\t ]*$/,r=/^[\t ]+(.*)$/;return e.prototype.reinitialize=function(t){this.execute=this._executeHeader,this.type=t,t===e.RESPONSE&&(this._state=1),this._err=void 0,this._flags=0,this._contentLen=void 0,this._nbytes=0,this._nhdrbytes=0,this._nhdrpairs=0,this._buf="",this._seenCR=!1,this.headers={},this.httpMajor=1,this.httpMinor=void 0,this.maxHeaderPairs=2e3,this.method=void 0,this.url=void 0,this.statusCode=void 0,this.statusText=void 0},e.prototype._processHdrLine=function(e){switch(this._state){case 2:if(0===e.length)return void this._headersEnd();if(null===(l=i.exec(e))){if(null===(l=r.exec(e)))return this.execute=this._executeError,this._err=new Error("Malformed header line"),this.execute(this._err),this._err;var n=l[1];n.length>0&&BK.Script.log(1,0,"processHdrLine!extra = "+n)}else{var o=l[1],a=l[2];switch(o.toLowerCase()){case"connection":"close"===(s=a.toLowerCase()).substring(0,5)?this._flags|=4:"keep-alive"===s.substring(0,10)?this._flags|=2:"upgrade"===s.substring(0,7)&&(this._flags|=8);break;case"transfer-encoding":var s=a.toLowerCase();"chunked"===s.substring(0,7)&&(this._flags|=1);break;case"upgrade":this._flags|=32;break;case"content-length":var h=parseInt(a,10);if(isNaN(h)||h>524288)return this.execute=this._executeError,this._err=new Error("Bad Content-Length: "+inspect(h)),this.execute(this._err),this._err;this._contentLen=h}var c=this.maxHeaderPairs;(c<=0||++this._nhdrpairs<c)&&(this.headers[o.toLowerCase()]=a)}break;case 1:if(0===e.length)return!0;var l=t.exec(e);if(null===l)return this.execute=this._executeError,this._err=new Error("Malformed status line"),this.execute(this._err),this._err;this.httpMinor=parseInt(l[1],10),this.statusCode=parseInt(l[2],10),this.statusText=l[3]||"",this._state=2;break;default:return this.execute=this._executeError,this._err=new Error("Unexpected HTTP parser state: "+this._state),this.execute(this._err),this._err}},e.prototype._headersEnd=function(){var e=this._flags,t=this.method&&this.method.toLowerCase(),i=40==(40&e)||"connect"===t,r=0==(4&e),n=this._contentLen;if(this._buf="",this._seenCR=!1,this._nbytes=0,(0===this.httpMajor&&9===this.httpMinor||0===this.httpMinor&&0==(2&e))&&(r=!1),(16&e)>0)return this.onComplete&&this.onComplete(),void this.reinitialize(this.type);if(this.onHeaders){var o=this.headers;!0===this.onHeaders(this.httpMajor,this.httpMinor,o,this.method,this.url,this.statusCode,this.statusText,i,r)&&(e=this._flags|=64)}i?(this.onComplete&&this.onComplete(),this._state=3):(0===n||(64&e)>0||0==(1&e)&&void 0===n&&!this._needsEOF())&&(this.onComplete&&this.onComplete(),this.reinitialize(this.type))},e.prototype._executeHeader=function(e){for(var t,i,r,n=0,o=e.length,a=this._seenCR,s=this._buf,h=this._nhdrbytes;n<o;){if(a)if(a=!1,10===e.charCodeAt(n)){if(++n,i=this._processHdrLine(s),s="","object"==typeof i)return this._err=i,this.execute(this._err),i;if(void 0===i&&2!==(l=this._state))return l<3&&n<o?(i=this.execute(e.slice(n)),"number"!=typeof i?(this._err=i,this.execute(this._err),i):n+i):(3===l&&this.reinitialize(this.type),n)}else if(s+="\r",++h>81920)return this.execute=this._executeError,this._err=new Error("Header size limit exceeded (81920)"),this.execute(this._err),this._err;if(!((t=e.indexOf("\r\n",n))>-1)){var c;if(13===e.charCodeAt(o-1)?(a=!0,c=o-1):c=o,(h+=c-n)>81920)return this.execute=this._executeError,this._err=new Error("Header size limit exceeded (81920)"),this.execute(this._err),this._err;s+=e.substring(n,c);break}if((r=t-n)>0){if((h+=r)>81920)return this.execute=this._executeError,this._err=new Error("Header size limit exceeded (81920)"),this.execute(this._err),this._err;s+=e.substring(n,t)}if(n=t+2,i=this._processHdrLine(s),s="","object"==typeof i)return this._err=i,this.execute(this._err),i;if(void 0===i){var l=this._state;if(2!==l)return l<3&&n<o?(i=this.execute(e.slice(n)),"number"!=typeof i?(this._err=i,this.execute(this._err),i):n+i):(3===l&&this.reinitialize(this.type),n)}}return this._buf=s,this._seenCR=a,this._nhdrbytes=h,o},e.prototype._executeError=function(e){return BK.Script.log(1,0,"_executeError!err = "+e.message),this._err},e.prototype.execute=e.prototype._executeHeader,e.prototype._needsEOF=function(){if(this.type===e.REQUEST)return!1;var t=this.statusCode,i=this._flags;return!(void 0!==t&&(204===t||304===t||1===parseInt(t/100,1))||64&i)&&!((1&i)>0||void 0!=this._contentLen)},e.REQUEST=0,e.RESPONSE=1,e}),enGameHallSucc=0,eReqDataLenErr=1e3,eReqMagicErr=1001,eReqFrontCmdErr=1002,eReqBackCmdErr=1003,eReqBackSrcErr=1004,eReqFromIdErr=1005,eSTDecryErr=1006,eReqDecryErr=1007,eSTExpire=1008,eSystmeErr=1009,eVerUnvalid=1010,eReqLimit=1011,eGetSvrErr=1012,eInitMemErr=2001,eQueryMemErr=2002,eUpdateMemErr=2003,eDelMemErr=2004,eGetConfigErr=2005,eNotifyCreateErr=2006,eGetRoomIdErr=2007,eCmdInvalid=2008,eRoomNotExist=2009,eInBlackList=2010,eMatchTimeOut=2011,eGetRoomErr=3e3,eRoomStatusErr=3001,eIsNotCreator=3002,eIsNotInRoom=3003,eFlushTsErr=3004,eLogoutIdErr=3005,eIsNotInSvc=3006,eUsrOverFlow=3007,eRoomOverFlow=3008,eRoomIsExist=3009,eRmvUsrErr=3010,eLoginSysErr=3011,eUsrHasLoginErr=3012,eRoomIsFullErr=3013,eCreateRoomErr=3014,ePlayerHasJoin=3015,eUgcDataAnti=3020,eFowardToClientErr=4e3,eFowardToSvrErr=4001;var DebugRecommandRoomSvrHost="139.199.216.130",DebugRecommandRoomSvrPort=10060,NormalRecommandRoomSvrHost="139.199.216.128",NormalRecommandRoomSvrPort=10060,TLVType=new Object;TLVType.Int8=33,TLVType.Uint8=34,TLVType.Int16=33,TLVType.Uint16=36,TLVType.Int32=37,TLVType.Uint32=38,TLVType.Int64=39,TLVType.Uint64=40,TLVType.Byte=41,TLVType.Double=42,TLVType.Float=43,TLVType.Int8Repeated=49,TLVType.Uint8Repeated=50,TLVType.Int16Repeated=51,TLVType.Uint16Repeated=52,TLVType.Int32Repeated=53,TLVType.Uint32Repeated=54,TLVType.Int64Repeated=55,TLVType.Uint64Repeated=56,TLVType.ByteRepeated=57,TLVType.DoubleRepeated=58,TLVType.FloatRepeated=59;var fixedHeaderLen=120,HeaderLen=12,currentGameMode=GameStatusInfo.gameMode,fromPlatform=GameStatusInfo.platform,currentAioType=GameStatusInfo.aioType,currentPlayerOpenId=GameStatusInfo.openId,isMaster=GameStatusInfo.isMaster;NETWORK_ENVIRONMENT_QQ_RELEASE=0,NETWORK_ENVIRONMENT_QQ_DEBUG=1,NETWORK_ENVIRONMENT_DEMO_DEV=2,CMSHOW_SRV_CMD_JOIN_ROOM="apollo_aio_game.join_room",CMSHOW_SRV_CMD_QUIT_GAME="apollo_aio_game.quit_room",CMSHOW_SRV_CMD_START_GAME="apollo_aio_game.start_game",CMSHOW_SRV_CMD_CANCEL_GAME="apollo_aio_game.cancel_game_room",CMSHOW_SRV_CMD_CUSTOM_GAME_LOGIC="apollo_game_openapi.custom_game_logic",CMSHOW_SRV_GET_RANK_LIST="apollo_router_game.game_rank_linkcmd_get_fri_rank_for_engine",CMSHOW_SC_CMD_STOP_GAME="sc.force_stop_game.local",CMSHOW_CS_CMD_MINI_WND="cs.make_room_min.local",CMSHOW_CS_CMD_CLOSE_WND="cs.close_room.local",CMSHOW_CS_CMD_CREATE_ROOM="cs.create_room.local",CMSHOW_CS_CMD_JOIN_ROOM="cs.join_room.local",CMSHOW_CS_CMD_SEND_GAME_MSG="cs.send_game_msg.local",CMSHOW_CS_CMD_GAME_TIPS="cs.game_tips.local",CMSHOW_CS_CMD_GET_PLAYER_DRESS="cs.get_dress_path.local",CMSHOW_CS_CMD_GAME_READY="cs.game_ready.local",CMSHOW_CS_CMD_GAME_START="cs.game_start.local",CMSHOW_CS_CMD_SAVE_RECOMM_VIP="cs.save_recommend_ip.local",CMSHOW_CS_CMD_GET_SRV_IP_PORT="cs.get_server_ip_port.local",CMSHOW_CS_CMD_CHECK_PUBACCOUNT_STATE="cs.check_pubAccount_state.local",CMSHOW_CS_CMD_ENTER_PUBACCOUNT_CARD="cs.enter_pubAccount_card.local",CMSHOW_CS_CMD_SHARE_PIC="cs.share_pic.local",CMSHOW_CS_CMD_SHARE_IN_ARK="cs.share_game_in_ark.local",CMSHOW_CS_CMD_QUERY_CLOUD_SIGNATURE="cs.fetch_cloud_signature.local",CMSHOW_AIO_PAUSE="sc.aio_pause.local",CMSHOW_AIO_RESUME="sc.aio_resume.local",CMD_CMSHOW_GAME_ENTER_BACKGROUND="sc.game_enter_background.local",CMD_CMSHOW_GAME_ENTER_FORGROUND="sc.game_enter_foreground.local",CMD_CMSHOW_GAME_MAXIMIZE="sc.game_maximize.local",CMD_CMSHOW_GAME_MINIMIZE="sc.game_minimize.local",CMSHOW_CS_CMD_AUDIOROOM_ENTERN="cs.audioRoom_enter.local",CMSHOW_CS_CMD_AUDIOROOM_EXIT="cs.audioRoom_exit.local",CMSHOW_CS_CMD_AUDIOROOM_UPDATEUSERINFO="cs.audioRoom_update_userinfo.local",CMSHOW_CS_CMD_AUDIOROOM_SET_MIC="cs.audioRoom_set_mic.local",CMSHOW_CS_CMD_AUDIOROOM_SET_SPEAKER="cs.audioRoom_set_speaker.local",CMSHOW_CS_CMD_AUDIOROOM_INIT="cs.audioRoom_init.local",CMSHOW_CS_CMD_AUDIOROOM_DISCONNECT="cs.audioRoom_disconnect.local",CMSHOW_CS_CMD_AUDIOROOM_CAMERASWITCH="cs.audioRoom_cameraswitch.local",CMSHOW_CS_CMD_AUDIOROOM_SET_BEAUTY="cs.audioRoom_set_beauty.local",CMSHOW_CS_CMD_AUDIOROOM_REQ_AUDIO_SESSION="cs.audioRoom_req_audio_session.local",CMSHOW_CS_CMD_LOAD_PACKAGE="cs.load_subpackage.local",CMSHOW_CS_CMD_LOAD_PERCENTAGE_NOTIFY="sc.load_percentage_nofity.local",CMSHOW_CS_CMD_FILE_CORRECTNESS_CHECK="cs.file_correctness_check.local",CMSHOW_CS_CMD_SHOW_ONE_MORE_PAGE="cs.show_one_more_page.local";var currentRenderMode,glpause;checkRenderMode=function(){0==currentRenderMode&&(BK.Script.renderMode=1,currentRenderMode=1)}(function(e,t){e.QQ=function(){return new function(){this.gameCfg=clone_(GameStatusInfo),this.gameCfg.gameId=parseInt(this.gameCfg.gameId),this.gameCfg.gameMode=0,GameStatusInfo.gameMode=0,this.hasJoinRoomSucc=!1,this.arkData={modeWording:""},this.setArkData=function(e){this.arkData.modeWording=e},this.gameCfg.roomId&&(this.gameCfg.roomId=parseInt(this.gameCfg.roomId)),1==this.gameCfg.isMaster?this.gameCfg.isCreator=!0:this.gameCfg.isCreator=!1,this.delegate={},this.ssoJoinRoomCallback,this.ssoJoinRoomCallbackPublic,BK.MQQ.SsoRequest.addListener(CMD_CMSHOW_GAME_ENTER_BACKGROUND,this,function(){BK.Director.tickerPause()}.bind(this)),BK.MQQ.SsoRequest.addListener(CMD_CMSHOW_GAME_ENTER_FORGROUND,this,function(){BK.Director.tickerResume()}.bind(this)),BK.MQQ.SsoRequest.addListener(CMD_CMSHOW_GAME_MINIMIZE,this,function(){var e="android"==GameStatusInfo.platform?1:2;renderTicker.paused=!0,glpause=!0,1==e&&BK.Director.tickerPause()}.bind(this)),BK.MQQ.SsoRequest.addListener(CMD_CMSHOW_GAME_MAXIMIZE,this,function(){renderTicker.paused=!1,glpause=!1,BK.Director.tickerResume()}.bind(this)),this.queryCloudSignature=function(e){if(BK.Misc.compQQVersion(GameStatusInfo.QQVer,"7.6.3")){if(e){var t=JSON.parse(GameStatusInfo.extInfo),i=t.certInfo.credentials,r=i.tmpSecretId,n=i.sessionToken,o=t.certInfo.upLoadPrefUrl,a=t.certInfo.downLoadPrefUrl,s=((c=new Date).getFullYear(),c.getMonth()+1<10?c.getMonth():c.getMonth(),c.getDate(),(l=c.getTime()/1e3-1)+";"+(l+600)),h=BK.Crypt.hex_hmac_sha1(i.tmpSecretKey,s);e(0,u={tmpSecretId:r,upLoadPrefUrl:o,downloadUrl:a,sessionToken:n,signature:h,signTime:s})}}else{var c=new Date,l=parseInt(c.getTime()/1e3)-1,u={cmd:CMSHOW_CS_CMD_QUERY_CLOUD_SIGNATURE,now:l,delta:600};e&&(BK.MQQ.SsoRequest.removeListener(CMSHOW_CS_CMD_QUERY_CLOUD_SIGNATURE,this),BK.MQQ.SsoRequest.addListener(CMSHOW_CS_CMD_QUERY_CLOUD_SIGNATURE,this,function(t,i,r){e(t,r)}),BK.MQQ.SsoRequest.send(u,CMSHOW_CS_CMD_QUERY_CLOUD_SIGNATURE))}},this.qGetRankBoard=function(e,t,i,r){var n={gameOrientation:e,openId:GameStatusInfo.openId,transparent:1,businessType:2,url:"http://cmshow.qq.com/apollo/html/game-platform/general-chart.html?gameId="+GameStatusInfo.gameId+"&_wwv=2&gameOrientation="+e};BK.MQQ.SsoRequest.send(n,"cs.openWebViewWithoutUrl.local")},this.qPayPurchase=function(e,t,i,r){var n=1;n=1==t?1:0;var o={gameOrientation:e,openId:GameStatusInfo.openId,transparent:n,businessType:1,itemList:i};if(r){var a="sc.apolloGameWebMessage.local";BK.MQQ.SsoRequest.removeListener(a,this),BK.MQQ.SsoRequest.addListener(a,this,function(e,t,i){0==e&&i.op&&"apolloGamePlatform.buyProps"==i.op&&r(i.data.code,i.data)}.bind(this))}BK.MQQ.SsoRequest.send(o,"cs.openWebViewWithoutUrl.local")},this.consumeItems=function(e,t){var i="apollo_game_item.consume_game_items",r={cmd:i,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,items:e};t&&(BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,function(e,i,r){var n=[],o=[];0==e&&(n=r.data.succList,o=r.data.failList),t(e,n,o)}.bind(this))),BK.MQQ.SsoRequest.send(r,i)},this.rollbackGameItems=function(e,t){var i="apollo_game_item.rollback_game_items",r={cmd:i,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,items:e};t&&(BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,function(e,i,r){var n=[],o=[];0==e&&(n=r.data.succList,o=r.data.failList),t(e,n,o)}.bind(this))),BK.MQQ.SsoRequest.send(r,i)},this.shareToMQQ=function(e,t,i,r){var n="cs.share_game_result.local",o={cmd:n,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,gameVersion:GameStatusInfo.gameVersion,roomId:GameStatusInfo.roomId,title:e,summary:t,detailUrl:i,picUrl:r};BK.MQQ.SsoRequest.send(o,n)},this.scoreUpload=function(e,t,i){BK.Script.log(1,1,"\u6210\u7ee9\u4e0a\u62a5 scoreData:"+JSON.stringify(e));var r="apollo_aio_game.report_user_score_3rd",n={cmd:r,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,version:GameStatusInfo.gameVersion,roomId:GameStatusInfo.roomId,gData:e,src:GameStatusInfo.src};i&&(n.arkData=i),t&&(BK.MQQ.SsoRequest.removeListener(r,this),BK.MQQ.SsoRequest.addListener(r,this,t)),BK.MQQ.SsoRequest.send(n,r)},this.getRoomUserScoreInfo=function(e,t){var i="apollo_aio_game.get_room_info_3rd",r={cmd:i,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,version:GameStatusInfo.gameVersion,roomId:e};t&&(BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,t)),BK.MQQ.SsoRequest.send(r,i)},this.getUserGameinfo=function(e,t,i){var r="apollo_aio_game.get_user_gameinfo_3rd",n={cmd:r,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,version:GameStatusInfo.gameVersion,roomId:GameStatusInfo.roomId,toOpenId:e,cycleNum:t};i&&(BK.MQQ.SsoRequest.removeListener(r,this),BK.MQQ.SsoRequest.addListener(r,this,i)),BK.MQQ.SsoRequest.send(n,r)},this.getUserCurrencyInfo=function(e,t){var i="apollo_aio_game.get_user_curreInfo",r={cmd:i,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,version:GameStatusInfo.gameVersion,mask:e};t&&(BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,t)),BK.MQQ.SsoRequest.send(r,i)},this.getCmshowDressInfo=function(e,t){var i="cs.get_dress_path.local";t&&(BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,t));var r={openId:e};BK.MQQ.SsoRequest.send(r,"cs.get_dress_path.local")},this.getGameItemList=function(e){var t="apollo_aio_game.get_game_itemList",i={cmd:t,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId};e&&(BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,e)),BK.MQQ.SsoRequest.send(i,t)},this.getUserGameItems=function(e){var t="apollo_aio_game.get_user_game_items",i={cmd:t,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId};e&&(BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,e)),BK.MQQ.SsoRequest.send(i,t)},this.buyGameItems=function(e,t,i){var r="apollo_aio_game.buy_game_items",n={cmd:r,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,curreType:e,itemIdList:t};i&&(BK.MQQ.SsoRequest.removeListener(r,this),BK.MQQ.SsoRequest.addListener(r,this,i)),BK.MQQ.SsoRequest.send(n,r)},this.notifyNewRoom=function(e,t){var i={gameId:this.gameCfg.gameId,roomId:e,retcode:t};this.gameCfg.roomId||(this.gameCfg.roomId=e),BK.Script.log(0,0,"BK.QQ.notifyNewRoom!gameId = "+i.gameId+", roomId = "+i.roomId+", retCode = "+t),BK.MQQ.SsoRequest.send(i,CMSHOW_CS_CMD_CREATE_ROOM)},this.notifyHideGame=function(){var e={gameId:this.gameCfg.gameId,roomId:this.gameCfg.roomId};BK.Script.log(0,0,"BK.QQ.notifyHideGame!gameId = "+e.gameId+", roomId = "+e.roomId),1==("android"==GameStatusInfo.platform?1:2)&&(BK.Script.renderMode=0,currentRenderMode=0),BK.MQQ.SsoRequest.send(e,CMSHOW_CS_CMD_MINI_WND)},this.notifyCloseGame=function(){this._closeRoom();var e={gameId:this.gameCfg.gameId,roomId:this.gameCfg.roomId};BK.Script.log(0,0,"BK.QQ.notifyCloseGame!gameId = "+e.gameId+", roomId = "+e.roomId),BK.MQQ.SsoRequest.send(e,CMSHOW_CS_CMD_CLOSE_WND)},this.notifyReadyGame=function(){var e={gameId:this.gameCfg.gameId,roomId:this.gameCfg.roomId};BK.MQQ.SsoRequest.send(e,CMSHOW_CS_CMD_GAME_READY)},this.notifyGameTips=function(e){var t={gameId:this.gameCfg.gameId,roomId:this.gameCfg.roomId,tips:e};BK.MQQ.SsoRequest.send(t,CMSHOW_CS_CMD_GAME_TIPS)},this.notifyGameTipsWaiting=function(){this.notifyGameTips("\u7b49\u5f85\u73a9\u5bb6\u52a0\u5165")},this.notifyGameTipsSomeOneJoinRoom=function(e){this.notifyGameTips(e+"\u52a0\u5165\u623f\u95f4")},this.notifyGameTipsSomeOneLeaveRoom=function(e){this.notifyGameTips(e+"\u79bb\u5f00\u623f\u95f4")},this.notifyGameTipsReady=function(){this.notifyGameTips("\u6e38\u620f\u5373\u5c06\u5f00\u59cb")},this.notifyGameTipsPlaying=function(){this.notifyGameTips("\u6e38\u620f\u8fdb\u884c\u4e2d")},this.notifyGameTipsGameOver=function(){this.notifyGameTips("\u6e38\u620f\u5df2\u7ed3\u675f")},this.inviteFriend=function(e,t){var i="cs.invite_friends.local",r={cmd:i,wording:e,gameId:this.gameCfg.gameId,gameMode:8,extendInfo:{}};t&&(r.roomId=t),BK.MQQ.SsoRequest.send(r,i)},this.uploadData=function(e,t,i,r,n,o){var a="cs.report_data_2_compass.local",s=this.gameCfg.gameId;"ios"==this.gameCfg.platform&&(e=e.toString(),i=i.toString());var h={cmd:a,actionName:e,enter:t,entry:t,result:i,r2:s.toString(),r3:r,r4:n,r5:o};BK.MQQ.SsoRequest.send(h,a)},this.sharePic=function(e){var t={gameId:this.gameCfg.gameId,roomId:this.gameCfg.roomId,path:e};BK.MQQ.SsoRequest.send(t,CMSHOW_CS_CMD_SHARE_PIC)};var e={},t={};this.loadPackage=function(i,r,n){if(!GameStatusInfo||"xcode"===GameStatusInfo.devPlatform)return BK.Script.log(1,1,"bk.qq.loadpackage xcode demo ."),r(i,0);var o=GameStatusInfo.QQVer.split(".");if(Number(o[0])<7||7==Number(o[0])&&Number(o[1])<7||7==Number(o[0])&&7==Number(o[1])&&Number(o[2])<5)return BK.Script.log(1,1,"bk.qq.loadpackage old version before 775 ."),r(i,0);var a={xyId:GameStatusInfo.gameId,packName:i};r&&(e[i]=r),n&&(t[i]=n),BK.MQQ.SsoRequest.send(a,CMSHOW_CS_CMD_LOAD_PACKAGE)},this.onLoadPackageFinish=function(t,i,r){BK.Script.log(0,0,"BK.QQ.onLoadPackageFinish errCode = "+t+" cmd = "+i+" data = "+JSON.stringify(r)),r.packName&&e[r.packName]&&(e[r.packName](r.packName,r.result),e[r.packName]=void 0)},BK.MQQ.SsoRequest.addListener(CMSHOW_CS_CMD_LOAD_PACKAGE,this,this.onLoadPackageFinish.bind(this)),this.onLoadPackagePercentage=function(e,i,r){BK.Script.log(0,0,"BK.QQ.onLoadPackagePercentage errCode = "+e+" cmd = "+i+" data = "+JSON.stringify(r)),r.packName&&t[r.packName]&&(t[r.packName](r.packName,r.percentage),t[r.packName]=void 0)},BK.MQQ.SsoRequest.addListener(CMSHOW_CS_CMD_LOAD_PERCENTAGE_NOTIFY,this,this.onLoadPackagePercentage.bind(this)),this.checkPakcage=function(e,t){var i={xyId:GameStatusInfo.gameId,packName:e};this.checkpakcageCallback=t,BK.MQQ.SsoRequest.removeListener(CMSHOW_CS_CMD_FILE_CORRECTNESS_CHECK,this),BK.MQQ.SsoRequest.addListener(CMSHOW_CS_CMD_FILE_CORRECTNESS_CHECK,this,this._evnet4Checkpackage.bind(this)),BK.MQQ.SsoRequest.send(i,CMSHOW_CS_CMD_FILE_CORRECTNESS_CHECK)},this.checkpakcageCallback=void 0,this._evnet4Checkpackage=function(e,t,i){BK.Script.log(0,0,"BK.QQ._evnet4Checkpackage!errCode = "+e+", cmd = "+t+", data = "+JSON.stringify(i)),this.checkpakcageCallback&&this.checkpakcageCallback(i.packName,i.result),this.checkpakcageCallback=void 0,BK.MQQ.SsoRequest.removeListener(CMSHOW_CS_CMD_FILE_CORRECTNESS_CHECK,this)},this.addSSOJoinRoomCallBack=function(e){this.ssoJoinRoomCallbackPublic=e},this.checkPubAccountState=function(e,t){t&&(BK.MQQ.SsoRequest.removeListener(CMSHOW_CS_CMD_CHECK_PUBACCOUNT_STATE,this),BK.MQQ.SsoRequest.addListener(CMSHOW_CS_CMD_CHECK_PUBACCOUNT_STATE,this,t));var i=CMSHOW_CS_CMD_CHECK_PUBACCOUNT_STATE,r={cmd:i,puin:e};BK.MQQ.SsoRequest.send(r,i)},this.enterPubAccountCard=function(e){var t=CMSHOW_CS_CMD_ENTER_PUBACCOUNT_CARD,i={cmd:t,puin:e};BK.MQQ.SsoRequest.send(i,t)},this.fetchOpenKey=function(e){var t="cs.on_get_open_key.local",i={gameId:GameStatusInfo.gameId};e&&(BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,e)),BK.MQQ.SsoRequest.send(i,t)},this.listenGameEventEnterBackground=function(e,t){var i="sc.game_enter_background.local";t&&(BK.MQQ.SsoRequest.removeListener(i,e),BK.MQQ.SsoRequest.addListener(i,e,t))},this.listenGameEventEnterForeground=function(e,t){var i="sc.game_enter_foreground.local";t&&(BK.MQQ.SsoRequest.removeListener(i,e),BK.MQQ.SsoRequest.addListener(i,e,t))},this.listenGameEventMaximize=function(e,t){var i="sc.game_maximize.local";t&&(BK.MQQ.SsoRequest.removeListener(i,e),BK.MQQ.SsoRequest.addListener(i,e,t))},this.listenGameEventMinimize=function(e,t){var i="sc.game_minimize.local";t&&(BK.MQQ.SsoRequest.removeListener(i,e),BK.MQQ.SsoRequest.addListener(i,e,t))},this._event4GetVIPInfo=function(e,t,i){BK.Script.log(0,0,"BK.QQ._event4GetVIPInfo!errCode = "+e+" cmd = "+t+" data = "+JSON.stringify(i)),this.delegate.onGetVIPInfoEvent&&this.delegate.onGetVIPInfoEvent(e,t,i),BK.MQQ.SsoRequest.removeListener(CMSHOW_CS_CMD_GET_SRV_IP_PORT,this)},this.notifyGetVIPInfo=function(){BK.MQQ.SsoRequest.send({},CMSHOW_CS_CMD_GET_SRV_IP_PORT),BK.MQQ.SsoRequest.removeListener(CMSHOW_CS_CMD_GET_SRV_IP_PORT,this),BK.MQQ.SsoRequest.addListener(CMSHOW_CS_CMD_GET_SRV_IP_PORT,this,this._event4GetVIPInfo.bind(this))},this.notifySaveRecommVIP=function(e,t){BK.Script.log(0,0,"BK.QQ.notifySaveRecommVIP!ip = "+e+", port = "+t);var i={gameId:this.gameCfg.gameId,roomId:this.game.roomId,ip:e,port:t};BK.MQQ.SsoRequest.send(i,CMSHOW_CS_CMD_SAVE_RECOMM_VIP)},this._event4GetPlayerDress=function(e,t,i){BK.Script.log(0,0,"BK.QQ._event4GetPlayerDress!errCode = "+e+", cmd = "+t+", data = "+JSON.stringify(i)),this.delegate.onGetPlayerDressEvent&&this.delegate.onGetPlayerDressEvent(e,t,i),BK.MQQ.SsoRequest.removeListener(CMSHOW_CS_CMD_GET_PLAYER_DRESS,this)},this.notifyGetPlayerDress=function(e){var t={openId:e};BK.MQQ.SsoRequest.removeListener(CMSHOW_CS_CMD_GET_PLAYER_DRESS,this),BK.MQQ.SsoRequest.addListener(CMSHOW_CS_CMD_GET_PLAYER_DRESS,this,this._event4GetPlayerDress.bind(this)),BK.MQQ.SsoRequest.send(t,CMSHOW_CS_CMD_GET_PLAYER_DRESS)},this._startGameLocal=function(e,t){var i={gameId:this.gameCfg.gameId,roomId:this.gameCfg.roomId,resp:t,retcode:e,gameMode:this.gameCfg.gameMode};BK.MQQ.SsoRequest.send(i,CMSHOW_CS_CMD_GAME_START)},this.notifyJoinRoom=function(e,t,i){e&&e.length>0?e.forEach(function(e){var r=e.openId==currentPlayerOpenId;BK.Script.log(1,1,"player.openid="+e.openId+" currentPlayerOpenId="+currentPlayerOpenId);var n=0;t&&t.data&&t.data.avRoomId&&(n=t.data.avRoomId);var o=0;t&&t.data&&t.data.sdkAppId&&(o=t.data.sdkAppId);var a=0;t&&t.data&&t.data.accountType&&(a=t.data.accountType);var s={gameId:this.gameCfg.gameId,openId:e.openId,isCreator:this.gameCfg.isCreator&&e.openId==currentPlayerOpenId?1:0,roomId:this.gameCfg.roomId,resp:t,retcode:i,gameMode:this.gameCfg.gameMode,avRoomId:n,sdkAppId:o,accountType:a,isMine:r,isDisableSendMsg:1};BK.Script.log(0,0,"BK.QQ.notifyJoinroom isDisableSendMsg: "+s.isDisableSendMsg),BK.MQQ.SsoRequest.send(s,CMSHOW_CS_CMD_JOIN_ROOM)},this):BK.Script.log(0,0,"BK.QQ.notifyJoinRoom!newJoinPlayers data error")},this.sendGameMsg=function(){if(this.gameCfg.roomId&&this.gameCfg.roomId>0){var e={gameId:this.gameCfg.gameId,openId:GameStatusInfo.openId,roomId:this.gameCfg.roomId,gameMode:this.gameCfg.gameMode};BK.Script.log(0,0,"SendGameMsg : gameId="+e.gameId+"  openId="+e.openId+" roomId="+e.roomId+"  gameMode="+e.gameMode),BK.MQQ.SsoRequest.send(e,CMSHOW_CS_CMD_SEND_GAME_MSG)}},this.shareToArk=function(e,t,i,r,n,o){if(BK.Misc.compQQVersion(GameStatusInfo.QQVer,"7.6.3"))this._oldShareToArk(e,t,i,r,n,o);else{var a={summary:t,extendInfo:n,localPicPath:"",picUrl:"",activityId:0,reqCode:1};0==i.indexOf("GameRes://")||0==i.indexOf("GameSandBox://")?a.localPicPath=i:a.picUrl=i,this._share(a,o)}},this._share=function(e,t){if(e.inner=1,e.localPicPath){if(t){var i="sc.share_game_to_friend_result.local";BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,function(e,i,r){t(e,i,r),this.shareUpload(0==e?0:1),BK.MQQ.SsoRequest.removeListener(i,this)}.bind(this))}BK.Script.log(0,0,"share "+JSON.stringify(e)),BK.MQQ.SsoRequest.send(e,"cs.game_shell_share_callback.local")}else{var r="\u8f7b\u6e38\u620f";e.gameName&&(r=e.gameName);var n="\u4e00\u8d77\u6765\u73a9\u6e38\u620f\u5427~";e.summary&&(n=e.summary),BK.QQ.defaultSharePic(r,n,function(i,r,n){if(t){var o="sc.share_game_to_friend_result.local";BK.MQQ.SsoRequest.removeListener(o,this),BK.MQQ.SsoRequest.addListener(o,this,function(e,i,r){t(e,i,r),this.shareUpload(0==e?0:1),BK.MQQ.SsoRequest.removeListener(i,this)}.bind(this))}0==i&&(e.localPicPath=n),BK.Script.log(0,0,"share with default pic"+JSON.stringify(e)),BK.MQQ.SsoRequest.send(e,"cs.game_shell_share_callback.local")}.bind(this))}},this.share=function(e,t){this._share(e,function(e,i,r){if(0==e){var n=r.ret,o=r.shareTo,a=1==r.isFirstShare;t(n,o,a)}else t(e,-1,!1)}.bind(this))},this.shareUpload=function(e){var t=e.toString();BK.QQ.uploadData("clickShowOffButton","",t,"","","")},this._oldShareToArk=function(e,t,i,r,n,o){"boolean"==typeof r&&(r=1==r?1:0);var a={summary:t,picUrl:i,gameId:this.gameCfg.gameId,roomId:e,gameMode:this.gameCfg.gameMode,isSelectFriend:r,extendInfo:n};if(o){var s="sc.share_game_to_friend_result.local";BK.MQQ.SsoRequest.removeListener(s,this),BK.MQQ.SsoRequest.addListener(s,this,function(e,t,i){o(e,t,i),this.shareUpload(0==e?0:1),BK.MQQ.SsoRequest.removeListener(t,this)}.bind(this))}BK.Script.log(0,0,"ShareToArk summary="+a.summary+" roomId="+a.roomId+"  gameMode="+a.gameMode+"picUrl="+a.picUrl+"  gameId="+a.gameId),BK.MQQ.SsoRequest.send(a,CMSHOW_CS_CMD_SHARE_IN_ARK)},this.sendB2CRedPacket=function(e,t){if(t){var i="sc.send_b2c_redpacket_result.local";BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,function(e,i,r){t(e,i,r),BK.MQQ.SsoRequest.removeListener(i,this)}.bind(this))}var r={groupPushData:{gameRedPacketId:1,gameId:GameStatusInfo.gameId,extraInfo:e}};BK.Script.log(1,1,"sendB2CRedPacket:"+JSON.stringify(r)),BK.MQQ.SsoRequest.send(r,"cs.send_b2c_redpacket.local"),BK.Script.log(0,0,"sendB2CRedPacket")},this.createShortCut=function(e,t){var i="";e&&(i=e);var r={extendInfo:i};if(t){var n="cs.create_xy_shortcut.local";BK.MQQ.SsoRequest.removeListener(n,this),BK.MQQ.SsoRequest.addListener(n,this,function(e,i,r){t(e,i,r),BK.MQQ.SsoRequest.removeListener(i,this)}.bind(this))}BK.MQQ.SsoRequest.send(r,"cs.create_xy_shortcut.local"),BK.Script.log(0,0,"createShortCut")},this.defaultSharePic=function(e,t,i){e||(e="\u8f7b\u6e38\u620f"),t||(t="\u4e00\u8d77\u6765\u73a9\u5427\uff01");var r=1;if(BK.FileUtil.isFileExist("GameRes://inviteIcon.png")){var n=BK.Image.loadImage("GameRes://inviteIcon.png");if(n){var o=n.height,a=n.width;r=Math.abs(o/a-304/540)<.01?3:2}else BK.Script.log(1,1,"defaultSharePic loadImage inviteIcon failed.")}else r=1;1==r?i(-1,r,null):3==r?this.generateQRCodeAnd169(e,t,function(e,t){i(e,r,t)}.bind(this),"GameSandBox://shareDefault.png"):i(-1,r,null)},this.generateQRCodeAnd169=function(e,t,i,r){i(0,this.composeShare(e,t,"GameRes://inviteIcon.png","GameRes://share_logo.png",r))},this.composeShare=function(e,t,i,r,n){var o="GameSandBox://compose.png";n&&(o=n);var a=BK.Image.loadImage(i),s=new BK.Canvas(750,750);if(s.fillColor={r:1,g:1,b:1,a:1},s.fillRect(0,0,750,750),BK.FileUtil.isFileExist(r)){s.drawImage(r,0,0,125,28,32,32,126,27)}a&&s.drawImage(i,0,0,a.width,a.height,0,330,750,420);s.fillColor={r:0,g:0,b:0,a:1},s.drawStyle=0,s.setTextAlign(1),s.setTextSize(40),s.textBaseLine="bottom",s.textAlign="left",s.fillText(e,35,258);s.fillColor={r:137/255,g:137/255,b:137/255,a:.5},s.drawStyle=0,s.setTextAlign(1),s.setTextSize(30),s.textBaseLine="bottom",s.textAlign="left",s.fillText(t,35,215);s.fillColor={r:1,g:1,b:1,a:1};var h=this.generatePureQRCode();s.drawImage(h,0,0,256,256,600,64,120,120);return s.fillColor={r:0,g:0,b:0,a:1},s.drawStyle=0,s.setTextAlign(1),s.setTextSize(19),s.textBaseLine="bottom",s.textAlign="left",s.fillText("\u957f\u6309\u626b\u7801\u5373\u73a9",600,28),s.saveTo(o),s.dispose(),o},this.generatePureQRCode=function(e){var t="GameSandBox://qrcode.png";e&&(t=e);var i={width:256,height:256,colorDark:{r:0,g:0,b:0,a:1},colorLight:{r:1,g:1,b:1,a:1},correctLevel:2},r="http://cmshow.qq.com/apollo/html/game-platform/scan-game.html?gameId="+GameStatusInfo.gameId.toString()+"&src=203";return BK.QRCode.createQRCodeToFile(t,r,i),t},this._event4QuitGame=function(e,t,i){BK.Script.log(0,0,"BK.QQ._event4QuitGame errCode = "+e+" cmd = "+t+" data = "+JSON.stringify(i)),this.delegate.onQuitGameEvent&&this.delegate.onQuitGameEvent(e,t,i),BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_CMD_QUIT_GAME,this)},this._event4CancelGame=function(e,t,i){BK.Script.log(0,0,"BK.QQ._event4CancelGame errCode = "+e+" cmd = "+t+" data = "+JSON.stringify(i)),this.delegate.onCancelGameEvent&&this.delegate.onCancelGameEvent(e,t,i),BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_CMD_CANCEL_GAME,this)},this.notifyQuitGameSrv=function(){var e={cmd:CMSHOW_SRV_CMD_QUIT_GAME,from:this.gameCfg.platform,gameId:this.gameCfg.gameId,roomId:this.gameCfg.roomId};BK.Script.log(0,0,"BK.QQ.notifyQuitGameSrv!, cmd = "+e.cmd+", from = "+e.from+", gameId = "+e.gameId+", roomId = "+e.roomId),BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_CMD_QUIT_GAME,this),BK.MQQ.SsoRequest.addListener(CMSHOW_SRV_CMD_QUIT_GAME,this,this._event4QuitGame.bind(this)),BK.MQQ.SsoRequest.send(e,CMSHOW_SRV_CMD_QUIT_GAME)},this.notifyCancelGameSrv=function(){var e={cmd:CMSHOW_SRV_CMD_CANCEL_GAME,from:this.gameCfg.platform,gameId:this.gameCfg.gameId,roomId:this.gameCfg.roomId};BK.Script.log(0,0,"BK.QQ.notifyCancelGameSrv!, cmd = "+e.cmd+", from = "+e.from+", gameId = "+e.gameId+", roomId = "+e.roomId),BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_CMD_CANCEL_GAME,this),BK.MQQ.SsoRequest.addListener(CMSHOW_SRV_CMD_CANCEL_GAME,this,this._event4CancelGame.bind(this)),BK.MQQ.SsoRequest.send(e,CMSHOW_SRV_CMD_CANCEL_GAME)},this._event4StartGame=function(e,t,i){BK.Script.log(0,0,"BK.QQ._event4StartGame! errCode = "+e+" cmd = "+t+" data = "+JSON.stringify(i)),this.hasStartGameSucc=0==e,this._startGameLocal(e,i),this.delegate.onStartGameEvent&&this.delegate.onStartGameEvent(e,t,i),BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_CMD_START_GAME,this)},this.notifyStartGameSrv=function(){var e={cmd:CMSHOW_SRV_CMD_START_GAME,from:this.gameCfg.platform,gameId:this.gameCfg.gameId,roomId:this.gameCfg.roomId};BK.Script.log(0,0,"BK.QQ.notifyStartGameSrv!, cmd = "+e.cmd+", from = "+e.from+", gameId = "+e.gameId+", roomId = "+e.roomId),BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_CMD_START_GAME,this),BK.MQQ.SsoRequest.addListener(CMSHOW_SRV_CMD_START_GAME,this,this._event4StartGame.bind(this)),BK.MQQ.SsoRequest.send(e,CMSHOW_SRV_CMD_START_GAME)},this._event4JoinRoom=function(e,t,i){BK.Script.log(0,0,"BK.QQ._event4JoinRoom errCode = "+e+" cmd = "+t+" data = "+JSON.stringify(i)),this.hasJoinRoomSucc=0==e,this.delegate.onJoinRoomEvent&&this.delegate.onJoinRoomEvent(e,t,i),BK.QQ.notifyJoinRoom(this.newJoinPlayers,i,e),BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_CMD_JOIN_ROOM,this),this.ssoJoinRoomCallback&&this.ssoJoinRoomCallback(e,t,i),this.ssoJoinRoomCallbackPublic&&(i.gameId=this.gameCfg.gameId,i.gameRoomId=this.gameCfg.roomId,i.avRoomId=i.data.avRoomId?i.data.avRoomId:0,i.sdkAppId=i.data.sdkAppId?i.data.sdkAppId:0,i.accountType=i.data.accountType?i.data.accountType:0,this.ssoJoinRoomCallbackPublic(e,t,i))},this.notifyNewOrJoinRoomSrv=function(e,t,i,r){var n={cmd:CMSHOW_SRV_CMD_JOIN_ROOM,from:this.gameCfg.platform,aioType:this.gameCfg.aioType,gameId:this.gameCfg.gameId,version:this.gameCfg.gameVersion,roomId:t,opType:i,gameMode:this.gameCfg.gameMode,roomVol:this.roomVol,arkData:this.arkData,src:r};BK.Script.log(1,1,"BK.QQ.notifyNewOrJoinRoomSrv!, cmd = "+n.cmd+", from = "+n.from+", aioType = "+n.aioType+", gameId = "+n.gameId+", version = "+n.version+", roomId = "+n.roomId+", opType = "+n.opType),this.newJoinPlayers=e,BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_CMD_JOIN_ROOM,this),BK.MQQ.SsoRequest.addListener(CMSHOW_SRV_CMD_JOIN_ROOM,this,this._event4JoinRoom.bind(this)),BK.MQQ.SsoRequest.send(n,CMSHOW_SRV_CMD_JOIN_ROOM)},this._customGameLogicCallBack=void 0,this._event4CustomLogic=function(e,t,i){void 0!=this._customGameLogicCallBack&&this._customGameLogicCallBack(e,t,i),BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_CMD_CUSTOM_GAME_LOGIC,this)},this.reqCustomLogic=function(e,t){void 0!=e?(this._customGameLogicCallBack=t,BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_CMD_CUSTOM_GAME_LOGIC,this),BK.MQQ.SsoRequest.addListener(CMSHOW_SRV_CMD_CUSTOM_GAME_LOGIC,this,this._event4CustomLogic.bind(this)),BK.MQQ.SsoRequest.send(e,CMSHOW_SRV_CMD_CUSTOM_GAME_LOGIC)):BK.Script.log(0,0,"reqCustomLogic data undefined!")},this._getRankListLogicCallBack=void 0,this._event4GetRankList=function(e,t,i){BK.Script.log(1,1,"BK.QQ.reqGetRankList! callback cmd"+t+" errCode:"+e+"  data:"+JSON.stringify(i)),void 0!=this._getRankListLogicCallBack&&this._getRankListLogicCallBack(e,t,i),BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_GET_RANK_LIST,this)},this.getRankList=function(e,t){var i={cmd:CMSHOW_SRV_GET_RANK_LIST,from:"default",objType:1,objId:0,busType:3,busId:this.gameCfg.gameId.toString()};t&&(t.objType&&(i.objType=t.objType),t.objId&&(i.objId=t.objId),t.from&&(i.from=t.from)),BK.Script.log(1,1,"BK.QQ.reqGetRankList! "+JSON.stringify(i)),void 0!=i?(this._getRankListLogicCallBack=e,BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_GET_RANK_LIST,this),BK.MQQ.SsoRequest.addListener(CMSHOW_SRV_GET_RANK_LIST,this,this._event4GetRankList.bind(this)),BK.MQQ.SsoRequest.send(i,CMSHOW_SRV_GET_RANK_LIST)):BK.Script.log(0,0,"reqGetRankList data undefined!")},this._pushPublicMsgCallBack=void 0,this._event4PushPublicMsg=function(e,t,i){BK.Script.log(1,1,"BK.QQ.pushPublicMsg! callback cmd"+t+" errCode:"+e+"  data:"+JSON.stringify(i)),void 0!=this._pushPublicMsgCallBack&&this._pushPublicMsgCallBack(e,t,i)},this.pushPublicMsg=function(e,t){var i={gameid:this.gameCfg.gameId,templateid:t.templateid,report_ts:t.report_ts,tmpl_param:t.tmpl_param};BK.Script.log(1,1,"BK.QQ.pushPublicMsg! "+JSON.stringify(i)),void 0!=i?(this._pushPublicMsgCallBack=e,BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_PUSH_PUBLIC_MSG,this),BK.MQQ.SsoRequest.addListener(CMSHOW_SRV_PUSH_PUBLIC_MSG,this,this._event4PushPublicMsg.bind(this)),BK.MQQ.SsoRequest.send(i,CMSHOW_SRV_PUSH_PUBLIC_MSG)):BK.Script.log(0,0,"pushPublicMsg data undefined!")},this.hasJoinRoom=function(){return this.hasJoinRoomSucc},this.hasStartGame=function(){return this.hasStartGameSucc},this._event4StopGame=function(e,t,i){BK.Script.log(0,0,"BK.QQ._event4StopGame!errCode = "+e+" cmd = "+t+" data = "+JSON.stringify(i)),this._closeRoom(),this.delegate.onStopGameEvent&&this.delegate.onStopGameEvent(e,t,i)},this._closeRoom=function(e){BK.QQ.isNeedSSOServer=void 0==e||null==e||e,1==Boolean(BK.QQ.isNeedSSOServer)&&(this.hasStartGameSucc||this.gameCfg.roomId&&0!=this.gameCfg.roomId&&(this.gameCfg.isCreator?this.notifyCancelGameSrv():this.notifyQuitGameSrv()))},this.uploadScoreWithoutRoom=function(e,t,i){var r="apollo_report_result.single_user_result",n=Math.floor((new Date).getTime()/1e3),o={from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,version:GameStatusInfo.gameVersion,aioType:GameStatusInfo.aioType,ts:n.toString(),src:GameStatusInfo.src,mode:void 0!==e?e:1,userData:t.userData,attr:t.attr};i&&(BK.MQQ.SsoRequest.removeListener(r,this),BK.MQQ.SsoRequest.addListener(r,this,i)),BK.MQQ.SsoRequest.send(o,r)},this.getRankListWithoutRoom=function(e,t,i,r){var n="apollo_router_game.apollo_user_rankinglist_linkcmd_custom_ranking",o=Math.floor((new Date).getTime()/1e3),a={from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,version:GameStatusInfo.gameVersion,ts:o.toString(),attr:void 0!==e?e:"score",order:void 0!==t?t:1,rankType:void 0!==i?i:0};r&&(BK.MQQ.SsoRequest.removeListener(n,this),BK.MQQ.SsoRequest.addListener(n,this,r)),BK.MQQ.SsoRequest.send(a,n)},this.saveGameData=function(e,t){var i="apollo_private_data.set_user_data",r=Math.floor((new Date).getTime()/1e3),n={openId:GameStatusInfo.openId,gameId:GameStatusInfo.gameId,version:GameStatusInfo.gameVersion,from:GameStatusInfo.platform,ts:r.toString(),data:e};t&&(BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,t)),BK.MQQ.SsoRequest.send(n,i)},this.loadGameData=function(e){var t="apollo_private_data.get_user_data",i=Math.floor((new Date).getTime()/1e3),r={openId:GameStatusInfo.openId,gameId:GameStatusInfo.gameId,version:GameStatusInfo.gameVersion,from:GameStatusInfo.platform,ts:i.toString()};e&&(BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,e)),BK.MQQ.SsoRequest.send(r,t)},this.reportGameResult=function(e,t){var i="apollo_router_game.apollo_reportcm_linkcmd_game_result";e.gameId=GameStatusInfo.gameId,GameStatusInfo.isWhiteUser>0&&BK.Script.log(1,1,"reportGameResult :"+e),BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,function(e,i,r){this.checkNewRedPackage(),t&&t(e,i,r)}.bind(this)),BK.MQQ.SsoRequest.send(e,i)},this.updateScoreLocal=function(e){BK.MQQ.SsoRequest.send({gameId:GameStatusInfo.gameId,score:e},"cs.game_update_score.local")},this.getRedPacketResult=function(e,t){var i="cs.get_redPacket_result.local";t&&(BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,t)),BK.MQQ.SsoRequest.send({gameId:GameStatusInfo.gameId,score:e},i)},this.listenRedPacketEvent=function(e){var t="sc.web_callback_game.local";e&&(BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,e))},this.skipGame=function(e,t){var i={xyId:e,extendInfo:t,src:302};BK.MQQ.SsoRequest.send(i,"cs.create_xy.local");var r=new Date,n=r.getFullYear(),o=r.getMonth()+1,a=r.getDate(),s=r.getHours(),h=""+n+(o=(""+o).length<2?"0"+o:o)+(a=""+a<2?"0"+a:a)+(s=""+s<2?"0"+s:s);BK.QQ.uploadData("gameAtoB","302",1,e,h,"")},BK.MQQ.SsoRequest.addListener(CMSHOW_SC_CMD_STOP_GAME,this,this._event4StopGame.bind(this)),CMSHOW_SRV_CHECK_NEW_RED_PACKAGE="apollo_router_light.apollo_activity_linkcmd_query_new_redpacket",GameStatusInfo.commFlagBits||(GameStatusInfo.commFlagBits=0),BK.Script.log(1,1,"redPackage  commonFlagBits : "+GameStatusInfo.commFlagBits),this.isUserInRedPackageActivity=function(){var e=GameStatusInfo.commFlagBits>>1&1&&310!==GameStatusInfo.src;return BK.Script.log(1,1,"redPackage  isUserInRedPackageActivity: "+e),e},this.isOpenActivityPage=function(){var e=GameStatusInfo.commFlagBits>>2&1&&310!==GameStatusInfo.src;return BK.Script.log(1,1,"redPackage  isOpenActivityPage: "+e),e},this.showRedPackageActivityPage=function(){BK.Director.ticker.setTimeout(function(){var e="http://cmshow.qq.com/act_apollo/h5_act/gameRedPacket/html/popup.html?game_id="+GameStatusInfo.gameId+"&page=ad&_cwv=1&wv=3&adtag=engine";BK.MQQ.Webview.openTransparent(e)}.bind(this),100,this)},this.checkNewRedPackage=function(){if(this.isUserInRedPackageActivity()){var e={cmd:CMSHOW_SRV_CHECK_NEW_RED_PACKAGE,gameId:GameStatusInfo.gameId.toString()};BK.Script.log(1,1,"redPackage \u53d1\u9001\u65b0\u7ea2\u5305\u68c0\u67e5:"+JSON.stringify(e)),BK.MQQ.SsoRequest.send(e,CMSHOW_SRV_CHECK_NEW_RED_PACKAGE)}},this.onNewRedPackage=function(e,t,i){if(BK.Script.log(0,0,"BK.QQ.onNewRedPackage  redPackage errCode = "+e+" cmd = "+t+" data = "+JSON.stringify(i)),0==e)if(i.data&&i.data.redPacket&&i.data.redPacket.actId&&i.data.redPacket.taskId){var r=i.data.redPacket,n="http://cmshow.qq.com/act_apollo/h5_act/gameRedPacket/html/popup.html?game_id="+GameStatusInfo.gameId+"&page=task&task_id="+r.taskId+"&_cwv=1&wv=3&adtag=engine";BK.MQQ.Webview.openTransparent(n)}else BK.Script.log(1,1,"request new red package  redPackage ,\u6ca1\u6709\u65b0\u7ea2\u5305\u4efb\u52a1\u89e6\u53d1");else BK.Script.log(1,1,"request new red package Failed!  redPackage ErrCode:"+e)}}}()}(BK)),BK.Room=function(){this.roomId,this.gameId,this.mId,this.ownerId,this.createTs,this.status,this.playerNum,this.ip0,this.ip1,this.msgSeq=1,this.ackSeq,this.lastFrame=0,this.startGameTs=0,this.createRoomCallBack,this.queryRoomInfoCallBack,this.joinRoomCallBack,this.leaveRoomCallBack,this.startGameCallBack,this.broadcastDataCallBack,this.sensitiveWordCallBack,this.setUserDataCallBack,this.getUserDataCallBack,this.sendSyncOptCallBack,this.forceStopGameCallBack,this.frameSyncListener,this.queryFrameDataCallBack,this.matchGameCallBack,this.queryMatchGameCallBack,this.quitMatchGameCallBack,this.disconnectNetCallBack,this.reJoinRoomCallBack,this.socket=new BK.Socket,this.reqArray=new Array,this.newJoinPlayers=[],this.currentPlayers=[],this.isCreator=1==GameStatusInfo.isMaster,this.gameStatusInfo=GameStatusInfo,this.serverConnected,this._environment=GameStatusInfo.isWhiteUser,this.headerVersion=769,this.recommandRoomSvrHost=NormalRecommandRoomSvrHost,this.recommandRoomSvrPort=NormalRecommandRoomSvrPort,this.netTimeOutTs=0,this.options=null,this.setArkData=function(e){BK.QQ.setArkData(e)},this.setRoomVol=function(e){BK.QQ.roomVol=e},this.read32BytesToString=function(e){for(var t="",i=0;i<32;i++){var r=e.readUint8Buffer();t+=String.fromCharCode(r)}return t},this.writeOpenIdIntoBuffer=function(e,t){var i=new BK.Buffer(32);if(open&&32==t.length)for(n=0;n<32;n++){var r=t.charCodeAt(n);i.writeUint8Buffer(r)}else{for(var n=0;n<32;n++)i.writeUint8Buffer(0);BK.Script.log(0,0,"writeOpenIdIntoBuffer.length is not 32 bytes,Write empty data")}e.writeBuffer(i)},this.addHeader=function(e,t,i){e.writeUint16Buffer(4660),e.writeUint16Buffer(this.headerVersion),e.writeUint16Buffer(0),e.writeUint16Buffer(i),e.writeUint32Buffer(t)},this.addFixedHeader=function(e,t,i,r,n,o,a,s,h){void 0==o&&(o=""),void 0==a&&(a=0),void 0==s&&(s=0),void 0==h&&(h=0),e.writeUint16Buffer(72),e.writeUint16Buffer(t),e.writeUint32Buffer(0),e.writeUint64Buffer(1111),e.writeUint64Buffer(i),e.writeUint64Buffer(r),this.writeOpenIdIntoBuffer(e,n),this.writeOpenIdIntoBuffer(e,o),e.writeUint64Buffer(a),e.writeUint64Buffer(s),e.writeUint64Buffer(h)},this.getHeader=function(e){var t=e.readUint16Buffer(),i=e.readUint16Buffer(),r=e.readUint16Buffer(),n=e.readUint16Buffer(),o=e.readUint32Buffer(),a=new Object;return a.magic=t,a.ver=i,a.stlen=n,a.bodyLen=o,a.seq=r,a},this.getFixedHeader=function(e){var t=e.readUint16Buffer(),i=e.readUint16Buffer(),r=e.readUint32Buffer(),n=e.readUint64Buffer(),o=e.readUint64Buffer(),a=e.readUint64Buffer(),s="",h="";s=this.read32BytesToString(e),h=this.read32BytesToString(e);var c=e.readUint64Buffer(),l=e.readUint64Buffer(),u=e.readUint64Buffer(),d=new Object;return d.fixLen=t,d.cmd=i,d.ret=r,d.date=n,d.gameId=o,d.roomId=a,d.fromId=s,d.toId=h,d.token=c,d.appId=l,d.accessToken=u,d},this.getRequestCommonBuffer=function(e,t,i,r,n,o,a){var s,h,c=0;if(a&&(a.rewind(),c=a.length),h=new BK.Stream(BK.Security.getST()),s=new BK.Stream(fixedHeaderLen+c+n,1),this.addFixedHeader(s,e,t,i,r),c>0)for(u=0;u<c;u++)s.writeUint8Buffer(a.readUint8Buffer());if(n>0)for(var l=new BK.Stream(o.bkJSTLVGetBuffer()),u=0;u<l.length;u++)s.writeUint8Buffer(l.readUint8Buffer());s=BK.Misc.arrayBufferToBKBuffer(s.data),BK.Security.encrypt(s),s=new BK.Stream(s);var d=new BK.Stream(HeaderLen+s.length+h.length);return this.addHeader(d,s.length,h.length),d.writeBuffer(h),d.writeBuffer(s),d.data},this.matchGame=function(e,t,i){this.mId=t,this.gameId=parseInt(e),BK.QQ.gameCfg.gameMode=6,GameStatusInfo.gameMode=6;var r=this.socket.connect(this.recommandRoomSvrHost,this.recommandRoomSvrPort);BK.Script.log(0,0,"socket con ="+r),-1==r?BK.Script.log(0,0,"socket connect failed! "+r):this.serverConnected=1,this.matchGameCallBack=i;var n=new Object;n.cmd=36,n.arg0=e,n.arg1=t,this.reqArray.push(n),BK.Script.log(0,0,"createRoom ")},this.requestMatch=function(e,t){BK.Script.log(0,0,"match game request in");var i=new BK.Buffer(fixedHeaderLen,1);this.addFixedHeader(i,36,e,0,t);var r=BK.Security.getST();BK.Security.encrypt(i);var n=r.bufferLength(),o=new BK.Buffer(HeaderLen+i.bufferLength()+n,1);return this.addHeader(o,i.bufferLength(),n),o.writeBuffer(r),o.writeBuffer(i),BK.Script.log(0,0,"match game request buffer : "+o.bufferLength()+" body len:"+i.bufferLength()),o},this.queryMatchGame=function(e,t,i){BK.Script.log(0,0,"queryMatchGame in "),this.mId=t,this.gameId=parseInt(e),this.queryMatchGameCallBack=i;var r=new Object;r.cmd=38,r.arg0=e,r.arg1=t,this.reqArray.push(r)},this.requestQueryMatch=function(e,t){BK.Script.log(0,0,"query match game request in");var i=new BK.Buffer(fixedHeaderLen,1);this.addFixedHeader(i,38,e,0,t);var r=BK.Security.getST();BK.Security.encrypt(i);var n=r.bufferLength(),o=new BK.Buffer(HeaderLen+i.bufferLength()+n,1);return this.addHeader(o,i.bufferLength(),n),o.writeBuffer(r),o.writeBuffer(i),BK.Script.log(0,0,"query match game request buffer : "+o.bufferLength()+" body len:"+i.bufferLength()),o},this.quitMatchGame=function(e,t,i){BK.Script.log(0,0,"quitMatchGame in "),this.mId=t,this.gameId=parseInt(e),this.quitMatchGameCallBack=i;var r=new Object;r.cmd=40,r.arg0=e,r.arg1=t,this.reqArray.push(r)},this.requestQuitMatch=function(e,t){BK.Script.log(0,0,"quit match game request in");var i=new BK.Buffer(fixedHeaderLen,1);this.addFixedHeader(i,40,e,0,t);var r=BK.Security.getST();BK.Security.encrypt(i);var n=r.bufferLength(),o=new BK.Buffer(HeaderLen+i.bufferLength()+n,1);return this.addHeader(o,i.bufferLength(),n),o.writeBuffer(r),o.writeBuffer(i),BK.Script.log(0,0,"quit match game request buffer : "+o.bufferLength()+" body len:"+i.bufferLength()),o},this.createRoom=function(e,t,i){if(this.mId=t,this.gameId=parseInt(e),1!=this.serverConnected){var r=this.socket.connect(this.recommandRoomSvrHost,this.recommandRoomSvrPort);BK.Script.log(0,0,"socket con ="+r),-1==r?BK.Script.log(0,0,"socket connect failed! "+r):this.serverConnected=1}this.createRoomCallBack=i;var n=new Object;n.cmd=6,n.arg0=e,n.arg1=t,this.reqArray.push(n),BK.Script.log(0,0,"createRoom ")},this.requestCreateRoom=function(e,t){var i=Number(this.roomId);i||(i=0),BK.Script.log(0,0,"create room request ");var r=new BK.Buffer(fixedHeaderLen,1);this.addFixedHeader(r,6,e,i,t);var n=BK.Security.getST();BK.Security.encrypt(r);var o=n.bufferLength(),a=new BK.Buffer(HeaderLen+r.bufferLength()+o,1);return this.addHeader(a,r.bufferLength(),o),a.writeBuffer(n),a.writeBuffer(r),BK.Script.log(0,0,"create room request buffer : "+a.bufferLength()+" body len:"+r.bufferLength()),a},this.requestQueryRoom=function(){var e=new BK.Buffer(fixedHeaderLen,1);this.addFixedHeader(e,10,this.gameId,this.roomId,this.mId);var t=BK.Security.getST();BK.Security.encrypt(e);var i=t.bufferLength(),r=new BK.Buffer(HeaderLen+e.bufferLength()+i,1);return this.addHeader(r,e.bufferLength(),i),r.writeBuffer(t),r.writeBuffer(e),r},this.queryRoom=function(e,t,i,r){this.mId=i,this.roomId=parseFloat(t),this.gameId=parseInt(e),this.queryRoomInfoCallBack=r;var n=new Object;n.cmd=10,this.reqArray.push(n),BK.Script.log(0,0,"queryRoom push")},this.joinRoom=function(e,t,i,r){this.joinRoomCallBack=t,BK.QQ.isNeedSSOServer=void 0==r||null==r||r,BK.Script.log(0,0,"BK.QQ.notifyJoinroom isDisableSendMsg   isAuto: "+i+",isAutoSendJoin:  "+BK.QQ.isAutoSendJoinRoomNotify);var n=new Object;n.cmd=2,n.arg0=e,this.reqArray.push(n)},this.requestJoinRoom=function(e){BK.Script.log(0,0,"join room request");var t=new BK.Buffer(fixedHeaderLen+5,1);this.addFixedHeader(t,2,this.gameId,this.roomId,this.mId);var i=new BK.TLV(5);i.bkJSTLVWriteUInt8(e,TLVType.Uint8,201),t.writeBuffer(i.bkJSTLVGetBuffer());var r=BK.Security.getST();BK.Security.encrypt(t);var n=r.bufferLength(),o=new BK.Buffer(HeaderLen+t.bufferLength()+n,1);return this.addHeader(o,t.bufferLength(),n),o.writeBuffer(r),o.writeBuffer(t),o},this.setReJoinRoomCallBack=function(e){this.reJoinRoomCallBack=e},this.reConnectAndJoinRoom=function(){var e=this.socket.connect(this.gameSvrIp,this.gameSvrPort);if(BK.Script.log(0,0,"socket con ="+e),-1==e)return BK.Script.log(0,0,"socket connect failed! "+e),-1;this.serverConnected=1,0==e&&BK.Script.log(0,0,"socket connect =0 "),e>=0&&(BK.Script.log(0,0,"rejoinroom send"),this.joinRoom(1,function(e,t){BK.Script.log(0,0,"rejoinroom statusCode:"+e+" roomid is "+t.roomId),this.reJoinRoomCallBack&&this.reJoinRoomCallBack(e,this)}))},this.leaveRoom=function(e,t){void 0==t&&(t=-1);var i=new Object;i.cmd=4,i.arg0=t,this.reqArray.push(i),this.leaveRoomCallBack=e,BK.Script.log(0,0,"leaveRoom push")},this.setLeaveRoomCallback=function(e){this.leaveRoomCallBack=e},this.requestLeaveRoom=function(e){var t=new BK.TLV(44),i=new BK.Buffer(40,1);this.writeOpenIdIntoBuffer(i,this.mId),i.writeUint64Buffer(e),t.bkJSTLVWriteBuffer(i,TLVType.Byte,201);var r=new BK.Buffer(fixedHeaderLen+t.bkJSTLVGetLength(),1);this.addFixedHeader(r,4,this.gameId,this.roomId,this.mId),r.writeBuffer(t.bkJSTLVGetBuffer());var n=BK.Security.getST(),o=n.bufferLength();return BK.Security.encrypt(r),buff=new BK.Buffer(HeaderLen+r.bufferLength()+o,1),this.addHeader(buff,r.bufferLength(),o),buff.writeBuffer(n),buff.writeBuffer(r),BK.Script.log(0,0,"leave room buffer : "+buff.bufferLength()+" body len:"+r.bufferLength()),buff},this._startGame=function(e){this.startGameCallBack=e;var t=new Object;t.cmd=8,this.reqArray.push(t),BK.Script.log(0,0,"startGame push")},this.startGame=function(e){GameStatusInfo.devPlatform?(BK.Script.log(0,0,"startGame dev:"),this._startGame(e)):1==BK.QQ.hasJoinRoomSucc?(BK.Script.log(0,0,"startGame qq:cmsrv confirm joinRoom response"),this._startGame(e)):(BK.Script.log(0,0,"startGame qq:waiting cmsvr joiroom response"),BK.QQ.delegate.onJoinRoomEvent=function(t,i,r){BK.Script.log(0,0,"startGame qq:wait finish.start Game"),this._startGame(e)}.bind(this))},this.setStartGameCallback=function(e){this.startGameCallBack=e},this.requestStartGame=function(){var e=new BK.Buffer(fixedHeaderLen,1);this.addFixedHeader(e,8,this.gameId,this.roomId,this.mId);var t=BK.Security.getST();BK.Security.encrypt(e);var i=t.bufferLength(),r=new BK.Buffer(HeaderLen+e.bufferLength()+i,1);return this.addHeader(r,e.bufferLength(),i),r.writeBuffer(t),r.writeBuffer(e),r},this.setBroadcastDataCallBack=function(e){this.broadcastDataCallBack=e},this.sendBroadcastData=function(e){var t=new Object;t.cmd=1,t.arg0=e,this.reqArray.push(t)},this.requestsendBroadcastData=function(e){var t=e.capacity?e.capacity:e.bufferLength(),i=new BK.Buffer(fixedHeaderLen+t,1);this.addFixedHeader(i,1,this.gameId,this.roomId,this.mId),i.writeBuffer(e);var r=BK.Security.getST();BK.Security.encrypt(i);var n=r.bufferLength(),o=new BK.Buffer(HeaderLen+i.bufferLength()+n,1);return this.addHeader(o,i.bufferLength(),n),o.writeBuffer(r),o.writeBuffer(i),o},this.setSensitiveWordCallBack=function(e){this.sensitiveWordCallBack=e},this.sendSensitiveWordData=function(e){var t=new Object;t.cmd=50,t.arg0=e,this.reqArray.push(t)},this.requestSendSendSensitiveWordData=function(e){var t=e.capacity?e.capacity:e.bufferLength(),i=new BK.Buffer(fixedHeaderLen+t,1);this.addFixedHeader(i,50,this.gameId,this.roomId,this.mId),i.writeBuffer(e);var r=BK.Security.getST();BK.Security.encrypt(i);var n=r.bufferLength(),o=new BK.Buffer(HeaderLen+i.bufferLength()+n,1);return this.addHeader(o,i.bufferLength(),n),o.writeBuffer(r),o.writeBuffer(i),o},this.setUserData=function(e,t){BK.Script.log(0,0,"setUserData call"),this.setUserDataCallBack=t;var i=new Object;i.cmd=32,i.arg0=e,this.reqArray.push(i),BK.Script.log(0,0,"setUserData push")},this.requestSetUserData=function(e){var t=e.capacity?e.capacity:e.bufferLength(),i=new BK.Buffer(fixedHeaderLen+t,1);this.addFixedHeader(i,32,this.gameId,this.roomId,this.mId),i.writeBuffer(e);var r=BK.Security.getST();BK.Security.encrypt(i);var n=r.bufferLength(),o=new BK.Buffer(HeaderLen+i.bufferLength()+n,1);return this.addHeader(o,i.bufferLength(),n),o.writeBuffer(r),o.writeBuffer(i),o},this.getUserData=function(e,t){void 0==e&&(e=0),this.getUserDataCallBack=t;var i=new Object;i.cmd=34,i.arg0=e,this.reqArray.push(i),BK.Script.log(0,0,"getUserData push roomId = "+e)},this.requestGetUserData=function(e){var t=new BK.Buffer(fixedHeaderLen,1);this.addFixedHeader(t,34,this.gameId,this.roomId,this.mId);var i=BK.Security.getST();BK.Security.encrypt(t);var r=i.bufferLength(),n=new BK.Buffer(HeaderLen+t.bufferLength()+r,1);return this.addHeader(n,t.bufferLength(),r),n.writeBuffer(i),n.writeBuffer(t),n},this.syncOpt=function(e,t,i,r,n){this.sendSyncOptCallBack=n;var o=new Object;o.cmd=14,o.arg0=e,o.arg1=t,o.arg2=i,o.arg3=r,this.reqArray.push(o)},this.sendSyncOpt=function(e,t){var i=new BK.Buffer(1,1);i.writeUint8Buffer(0);var r=new BK.Buffer(1,1);r.writeUint8Buffer(0),this.syncOpt(i,e,r,void 0,t)},this.requestSyncOpt=function(e,t,i,r){var n=20+(e.capacity?e.capacity:e.bufferLength())+4+(t.capacity?t.capacity:t.bufferLength())+4+(i.capacity?i.capacity:i.bufferLength());if(r){var o=r.capacity?r.capacity:r.bufferLength();n=n+4+o,BK.Script.log(0,0,"requestSyncOpt with item len"+o)}var a=new BK.TLV(n);a.bkJSTLVWriteUInt32(this.msgSeq,TLVType.Uint32,201),a.bkJSTLVWriteUInt32(this.lastFrame,TLVType.Uint32,202),a.bkJSTLVWriteBuffer(e,TLVType.Byte,203),a.bkJSTLVWriteBuffer(t,TLVType.Byte,204),a.bkJSTLVWriteBuffer(i,TLVType.Byte,205),r&&a.bkJSTLVWriteBuffer(r,TLVType.Byte,206),BK.Script.log(0,0,"requestSyncOpt this.msgSeq:"+this.msgSeq+" this.lastFrame:"+this.lastFrame);a.bkJSParseTLV();BK.Script.log(0,0,"requestSyncOpt tlv len:"+a.bkJSTLVGetLength()+" fix header:"+fixedHeaderLen);var s=new BK.Buffer(fixedHeaderLen+a.bkJSTLVGetLength(),1);this.addFixedHeader(s,14,this.gameId,this.roomId,this.mId),s.writeBuffer(a.bkJSTLVGetBuffer());var h=BK.Security.getST();BK.Security.encrypt(s);var c=h.bufferLength(),l=new BK.Buffer(HeaderLen+s.bufferLength()+c,1);return this.addHeader(l,s.bufferLength(),c),l.writeBuffer(h),l.writeBuffer(s),this.msgSeq+=1,l},this.setFrameSyncListener=function(e){this.frameSyncListener=e},this.queryFrameData=function(e,t,i){this.queryFrameDataCallBack=i;var r=new Object;r.cmd=18,r.arg0=e,r.arg1=t,this.reqArray.push(r)},this.requestQueryFrameData=function(e,t){var i=new BK.TLV(22);i.bkJSTLVWriteUInt32(this.lastFrame,TLVType.Uint32,201),i.bkJSTLVWriteUInt32(e,TLVType.Uint32,202),i.bkJSTLVWriteUInt16(t,TLVType.Uint16,203);var r=new BK.Buffer(fixedHeaderLen+i.bkJSTLVGetLength(),1);this.addFixedHeader(r,18,this.gameId,this.roomId,this.mId),r.writeBuffer(i.bkJSTLVGetBuffer());var n=BK.Security.getST();BK.Security.encrypt(r);var o=n.bufferLength(),a=new BK.Buffer(HeaderLen+r.bufferLength()+o,1);return this.addHeader(a,r.bufferLength(),o),a.writeBuffer(n),a.writeBuffer(r),a},this.sendControlCommand=function(e,t,i,r){var n=new Object;n.cmd=48,n.arg0=e,n.arg1=t,n.arg2=i,this.reqArray.push(n),this.controlCommandCallback=r},this.requestControlCommand=function(e,t,i){var r=new BK.TLV(14+t.bufferLength()+i.bufferLength());r.bkJSTLVWriteBuffer(t,TLVType.Byte,201),r.bkJSTLVWriteUInt16(e,TLVType.Uint16,202),r.bkJSTLVWriteBuffer(i,TLVType.Byte,203);var n=new BK.Buffer(fixedHeaderLen+r.bkJSTLVGetLength(),1);this.addFixedHeader(n,48,this.gameId,this.roomId,this.mId),n.writeBuffer(r.bkJSTLVGetBuffer()),BK.Security.encrypt(n);var o=BK.Security.getST(),a=o.bufferLength(),s=new BK.Buffer(HeaderLen+n.bufferLength()+a,1);return this.addHeader(s,n.bufferLength(),a),s.writeBuffer(o),s.writeBuffer(n),s},this.sendKeepAlive=function(){var e=new Object;e.cmd=12,this.reqArray.push(e),0!=this.netTimeOutTs&&BK.Time.timestamp-this.netTimeOutTs>5&&this.disconnectNetCallBack&&this.disconnectNetCallBack()},this.requestSendKeepAlive=function(){var e=new BK.Buffer(fixedHeaderLen,1);this.addFixedHeader(e,12,this.gameId,this.roomId,this.mId);var t=BK.Security.getST();BK.Security.encrypt(e);var i=t.bufferLength(),r=new BK.Buffer(HeaderLen+e.bufferLength()+i,1);return this.addHeader(r,e.bufferLength(),i),r.writeBuffer(t),r.writeBuffer(e),r},this.recvCreateRoom=function(e,t){BK.Script.log(0,0,"recvCreateRoom bodyLen="+t);var i=e.readBuffer(t),r=new BK.TLV(i).bkJSParseTLV();if(r){var n=r.tag202,o=n.readUint8Buffer(),a=n.readUint8Buffer(),s=n.readUint16Buffer();n.readUint64Buffer(),n.readUint32Buffer();var h=n.readUint8Buffer(),c=n.readUint8Buffer(),l=n.readUint8Buffer(),u=n.readUint8Buffer(),d=r.tag201,_=d.readUint8Buffer(),f=d.readUint8Buffer(),g=d.readUint16Buffer();d.readUint64Buffer(),d.readUint32Buffer();var p=d.readUint8Buffer(),m=d.readUint8Buffer(),v=d.readUint8Buffer(),S=d.readUint8Buffer(),b=new Object;return b.ipType_1=o,b.resServe_1=a,b.ipType_2=_,b.resServe_2=f,b.port_1=s,b.ip_1=h+"."+c+"."+l+"."+u,b.port_2=g,b.ip_2=p+"."+m+"."+v+"."+S,this.ip0=b.ip_1,this.ip1=b.ip_2,b}return void BK.Script.log(0,0,"recvCreateRoom parse failed.")},this.recvQueryRoom=function(e,t){BK.Script.log(0,0,"recvQueryRoom bodyLen:"+t);var i=e.readBuffer(t),r=new BK.TLV(i).bkJSParseTLV();if(r){var n=r.tag202,o=n.readUint8Buffer(),a=n.readUint8Buffer(),s=n.readUint16Buffer();n.readUint64Buffer(),n.readUint32Buffer();var h=n.readUint8Buffer(),c=n.readUint8Buffer(),l=n.readUint8Buffer(),u=n.readUint8Buffer(),d=r.tag201,_=d.readUint8Buffer(),f=d.readUint8Buffer(),g=d.readUint16Buffer();d.readUint64Buffer(),d.readUint32Buffer();var p=d.readUint8Buffer(),m=d.readUint8Buffer(),v=d.readUint8Buffer(),S=d.readUint8Buffer(),b=r.tag203,T=this.read32BytesToString(b),B=b.readUint64Buffer(),E=b.readUint8Buffer(),y=b.readUint8Buffer(),x=r.tag205;void 0==x&&(x=0);for(var C=[],R=0;R<y;R++){var A={};A.uid=this.read32BytesToString(b),A.status=b.readUint8Buffer(),C.push(A)}var I=new Object;return I.ipType_1=o,I.resServe_1=a,I.ipType_2=_,I.resServe_2=f,I.port_1=s,I.ip_1=h+"."+c+"."+l+"."+u,I.port_2=g,I.ip_2=p+"."+m+"."+v+"."+S,I.ownerId=T,I.createTs=B,I.status=E,I.playerNum=y,I.ext_num=x,this.ip0=I.ip_1,this.ip1=I.ip_2,this.ownerId=T,this.createTs=B,this.status=E,this.playerNum=y,this.players=C,I}return void BK.Script.log(0,0,"recvQueryRoom parse failed.bodyLen is 0")},this.recvJoinRoom=function(e,t){for(var i=e.readBuffer(t),r=new BK.TLV(i).bkJSParseTLV().tag201,n=this.read32BytesToString(r),o=r.readUint64Buffer(),a=r.readUint8Buffer(),s=r.readUint8Buffer(),h=[],c=0;c<s;c++){var l={},u=this.read32BytesToString(r),d=r.readUint64Buffer(),a=r.readUint8Buffer();l.openId=u,l.status=a,l.joinTs=d,h.push(l)}if(this.ownerId=n,this.createTs=o,this.status=a,this.playerNum=s,0==this.currentPlayers.length)h.forEach(function(e){this.newJoinPlayers.push(e)},this);else{var _=[];BK.Script.log(0,0,"recvJoinRoom!curPlayers = "+JSON.stringify(this.currentPlayers)),BK.Script.log(0,0,"recvJoinRoom!joinPlayers = "+JSON.stringify(h));for(c=0;c<h.length;c++){for(var l=h[c],f=!1,g=0;g<this.currentPlayers.length;g++)if(this.currentPlayers[g].openId==l.openId){f=!0;break}0==f&&_.push(l)}this.newJoinPlayers=_,BK.Script.log(0,0,"recvJoinRoom!newPlayers = "+JSON.stringify(this.newJoinPlayers))}this.currentPlayers=h,BK.Script.log(0,0,"recvJoinRoom ownerId="+n+",createTs ="+o+",playerNum:"+s)},this.recvLeaveRoom=function(e,t){var i=e.readBuffer(t),r=new BK.TLV(i).bkJSParseTLV();if(r){var n=r.tag201,o=this.read32BytesToString(n),a=e.readUint64Buffer(),s=new Object;return BK.Script.log(0,0,"recvLeaveRoom!ret = "+a),s.reason=a,s.logOutId=o,this.currentPlayers.splice(this.currentPlayers.indexOf(o)),s}return void BK.Script.log(0,0,"recvLeaveRoom parse failed.bodylen is "+t)},this.recvStartGame=function(e,t){this.startGameTs=BK.Time.timestamp,BK.Script.log(0,0,"recvStartGame")},this.recvPushFrameSync=function(e,t){for(var i=e.readBuffer(t),r=new BK.TLV(i).bkJSParseTLV(),n=(r.tag201,r.tag202,r.tag203),o=new Array,a=0;a<n.length;a++){var s=n[a].readUint32Buffer();this.lastFrame=s;var h=n[a].bufferLength()-4;BK.Script.log(0,0,"sync recv len= "+n[a].bufferLength()+" frameData.length="+n.length);for(var c=new Array;h>0;){BK.Script.log(0,0,"push frameNo="+this.lastFrame);var l=n[a].readUint16Buffer();BK.Script.log(0,0,"push databuf 2 datalen="+l);var u=this.read32BytesToString(n[a]),d=n[a].readUint64Buffer(),_={openId:u,itemId:d,dataBuffer:n[a].readBuffer(l)};BK.Script.log(0,0,"push databuf openid="+u),BK.Script.log(0,0,"push databuf itemid="+d),c.push(_),h-=42,h-=l}c.frameSeq=s,o.push(c)}this.frameSyncListener(o)},this.recvQueryFrameSync=function(e,t){var i=e.readBuffer(t),r=new BK.TLV(i).bkJSParseTLV();if(!r)return BK.Script.log(0,0,"recvQueryFrameSync empty."),void this.queryFrameDataCallBack(0,void 0);for(var n=r.tag201,o=new Array,a=0;a<n.length;a++){var s=n[a].readUint32Buffer(),h=n[a].bufferLength()-4;BK.Script.log(0,0,"sync query recv = "+n[a].bufferLength()+" frameData.length="+n.length);for(var c=new Array;h>0;){BK.Script.log(0,0,"push frameNo="+this.lastFrame);var l=n[a].readUint16Buffer();BK.Script.log(0,0,"push databuf 2 datalen="+l);var u=this.read32BytesToString(n[a]),d=n[a].readUint64Buffer(),_={openId:u,itemId:d,dataBuffer:n[a].readBuffer(l)};BK.Script.log(0,0,"push databuf openid="+u),BK.Script.log(0,0,"push databuf itemid="+d),c.push(_),h-=42,h-=l}c.frameSeq=s,o.push(c)}BK.Script.log(0,0,"query end"),this.queryFrameDataCallBack(0,o)},this.recvControlCommand=function(e,t){var i=e.readBuffer(t),r=new BK.TLV(i).bkJSParseTLV(),n={};r.tag201&&(n=JSON.parse(r.tag201.readAsString())),this.controlCommandCallback&&this.controlCommandCallback(0,n)},this.recvSSOJoinRoom=function(e,t,i){if(BK.Script.log(1,1,"recvSSOJoinRoom = true data="+JSON.stringify(i)),0==e){var r=i.data.avRoomId,n=i.data.sdkAppId,o=i.data.accountType;GameStatusInfo.avAppId=n,GameStatusInfo.avAccountType=o,GameStatusInfo.avRoomId=r,GameStatusInfo.roomId=this.roomId}},this.handleServerError=function(e,t){switch(BK.Script.log(0,1,"handleServerError!cmd = "+e.cmd+", errCode = "+e.ret),e.cmd){case 6:this.createRoomCallBack(e.ret,null,e.roomId);break;case 7:this.roomId=e.roomId,this.createRoomCallBack(header.ret,null,e.roomId);break;case 11:this.queryRoomInfoCallBack(e.ret,null);break;case 3:this.joinRoomCallBack(e.ret,this);break;case 4:case 5:this.leaveRoomCallBack(e.ret,null);break;case 9:this.startGameCallBack(e.ret);break;case 1:this.broadcastDataCallBack(e.fromId,null);break;case 51:this.sensitiveWordCallBack(e.ret,e.fromId,null);break;case 33:this.setUserDataCallBack(e.ret);break;case 35:this.getUserDataCallBack(e.ret,null);break;case 15:this.sendSyncOptCallBack(e.ret,null);break;case 16:break;case 19:this.queryFrameDataCallBack(e.ret,null);break;case 37:this.matchGameCallBack(e.ret);break;case 39:this.queryMatchGameCallBack(e.ret);break;case 41:this.quitMatchGameCallBack(e.ret);break;case 49:this.controlCommandCallback&&this.controlCommandCallback(e.ret,{})}},this.handleRecv=function(e){var t=this.getHeader(e);if(0!=t.stlen){e.readBuffer(t.stlen);BK.Script.log(0,0,"st.len = "+t.stlen)}var i=e.readBuffer(t.bodyLen);BK.Security.decrypt(i);var r=this.getFixedHeader(i);if(this.netTimeOutTs=0,0==r.ret)switch(BK.Script.log(0,0,"handleRecv = "+r.cmd+",bodyLen="+t.bodyLen+",bodyreal="+i.bufferLength()),r.cmd){case 7:this.roomId=r.roomId;var n=this.recvCreateRoom(i,i.bufferLength()-fixedHeaderLen);BK.Script.log(0,0,"magic = "+t.magic+",stlen = "+t.stlen+",bodyLen="+t.bodyLen+",cmd="+r.cmd+",roomId="+r.roomId),this.createRoomCallBack(r.ret,n,r.roomId),BK.QQ.notifyNewRoom(this.roomId,r.ret);break;case 11:var o=this.recvQueryRoom(i,i.bufferLength()-fixedHeaderLen);this.queryRoomInfoCallBack(r.ret,o),BK.Script.log(0,0,"magic = "+t.magic+",stlen = "+t.stlen+",bodyLen="+t.bodyLen+",cmd="+r.cmd+",roomId="+r.roomId);break;case 3:if(this.recvJoinRoom(i,i.bufferLength()-fixedHeaderLen),this.joinRoomCallBack(r.ret,this),1==Boolean(BK.QQ.isNeedSSOServer))for(var a=0;a<this.newJoinPlayers.length;a++)if(this.newJoinPlayers[a].openId==currentPlayerOpenId)return BK.QQ.ssoJoinRoomCallback=this.recvSSOJoinRoom.bind(this),void BK.QQ.notifyNewOrJoinRoomSrv(this.newJoinPlayers,this.roomId,this.ownerId==GameStatusInfo.openId?1:2);BK.QQ.notifyJoinRoom(this.newJoinPlayers,{},r.ret);break;case 5:var s=this.recvLeaveRoom(i,i.bufferLength()-fixedHeaderLen);this.leaveRoomCallBack&&this.leaveRoomCallBack(r.ret,s);break;case 9:this.recvStartGame(i,i.bufferLength()-fixedHeaderLen),this.startGameCallBack(r.ret),1==Boolean(BK.QQ.isNeedSSOServer)&&BK.QQ.notifyStartGameSrv(),0==r.ret&&(BK.QQ.hasJoinRoomSucc=!1);break;case 1:h=i.readBuffer(i.bufferLength()-fixedHeaderLen);this.broadcastDataCallBack(r.fromId,h,r.toId);break;case 51:h=i.readBuffer(i.bufferLength()-fixedHeaderLen);this.sensitiveWordCallBack(r.ret,r.fromId,h,r.toId);break;case 33:h=i.readBuffer(i.bufferLength()-fixedHeaderLen);this.setUserDataCallBack(r.ret);break;case 35:var h=i.readBuffer(i.bufferLength()-fixedHeaderLen);this.getUserDataCallBack(r.ret,h);break;case 15:var c=i.readUint32Buffer();this.ackSeq=c,this.sendSyncOptCallBack(r.ret,c);break;case 16:this.recvPushFrameSync(i,i.bufferLength()-fixedHeaderLen);break;case 19:this.recvQueryFrameSync(i,i.bufferLength()-fixedHeaderLen);break;case 37:this.matchGameCallBack(r.ret);break;case 39:this.roomId=r.roomId,this.queryMatchGameCallBack(r.ret);break;case 41:this.roomId=r.roomId,this.quitMatchGameCallBack(r.ret);break;case 49:this.recvControlCommand(i,i.bufferLength()-fixedHeaderLen)}else this.handleServerError(r)},this.requestSocket=function(e){var t;switch(BK.Script.log(0,0,"requestSocket = "+e.cmd),e.cmd){case 6:t=this.requestCreateRoom(e.arg0,e.arg1);break;case 10:t=this.requestQueryRoom();break;case 2:t=this.requestJoinRoom(e.arg0);break;case 4:t=this.requestLeaveRoom(e.arg0);break;case 8:t=this.requestStartGame();break;case 1:t=this.requestsendBroadcastData(e.arg0);break;case 50:t=this.requestSendSendSensitiveWordData(e.arg0);break;case 32:t=this.requestSetUserData(e.arg0);break;case 34:t=this.requestGetUserData(e.arg0);break;case 14:t=this.requestSyncOpt(e.arg0,e.arg1,e.arg2,e.arg3);break;case 18:t=this.requestQueryFrameData(e.arg0,e.arg1);break;case 36:t=this.requestMatch(e.arg0,e.arg1);break;case 38:t=this.requestQueryMatch(e.arg0,e.arg1);break;case 40:t=this.requestQuitMatch(e.arg0,e.arg1);break;case 12:t=this.requestSendKeepAlive(),0==this.netTimeOutTs&&(this.netTimeOutTs=BK.Time.timestamp);break;case 48:var i=new BK.Buffer,r=new BK.Buffer;i.writeAsString(e.arg1),r.writeAsString(e.arg2),t=this.requestControlCommand(e.arg0,i,r)}void 0!=t&&(BK.Script.log(0,0,"requestSocket = "+e.cmd),this.socket.send(t))},this.seperatePackHandle=function(){for(;;){var e=this.socket.receiveNotRemove(),t=e.bufferLength(),i=this.getHeader(e),r=i.stlen+i.bodyLen+HeaderLen;if(BK.Script.log(0,0,"this.socket.receive():totalLen = "+t+"  onePackLen="+r),t==r){BK.Script.log(0,0,"  this.socket.receive():onePackLen="+r),void 0!=(n=this.socket.receive(r))&&this.handleRecv(n);break}if(t<r){BK.Script.log(0,0,"  this.socket.receive():part of onePackLen="+r);break}if(t>r){BK.Script.log(0,0,"  this.socket.receive():Multipacks onePackLen="+r);var n=this.socket.receive(r);void 0!=n&&this.handleRecv(n)}}},this.curConnRetrys=0,this.curConnTimeout=0,this.prevNetState=0,this.reConnectTime=0,this.updateNet=function(){var e=this.socket.update(),t=this.socket.state;if(-1!=e)switch(this.prevNetState){case 0:switch(t){case 3:this.onErrorEvent(this);break;case 1:this.onConnectingEvent(this);break;case 2:this.onConnectedEvent(this)}break;case 1:switch(t){case 2:switch(e){case 2:this.onConnectedEvent();break;case 3:BK.Script.log(0,0,"BK.Socket.update!unexcepted status")}}break;case 2:switch(t){case 2:this.onUpdateEvent();break;default:this.onErrorEvent()}}else switch(BK.Script.log(0,0,"BK.Socket.DisconnectEvent prevNetState="+this.prevNetState),this.prevNetState){case 3:case 2:case 1:this.onDisconnectEvent()}return this.prevNetState=t,e},this.onErrorEvent=function(){BK.Script.log(0,0,"BK.Socket.ErrorEvent")},this.onUpdateEvent=function(){return 0},this.onTimeoutEvent=function(){BK.Script.log(0,0,"BK.Socket.TimeoutEvent")},this.onConnectingEvent=function(){BK.Script.log(0,0,"BK.Socket.ConnectingEvent")},this.onConnectedEvent=function(){BK.Script.log(0,0,"BK.Socket.ConnectedEvent"),this.connectedNetCallback&&this.connectedNetCallback()},this.onReconnectEvent=function(){BK.Script.log(0,0,"BK.Socket.ReconnectEvent")},this.onDisconnectEvent=function(){BK.Script.log(0,0,"BK.Socket.DisconnectEvent"),this.disconnectNetCallBack&&this.disconnectNetCallBack(),this.reConnectTime<3?(BK.Script.log(0,0,"BK.Socket.DisconnectEvent reconnectAndJoinRoom"),(BK.Time.timestamp-this.startGameTs)/60<5?(this.reConnectTime++,this.reConnectAndJoinRoom()):BK.Script.log(0,0,"BK.Socket.DisconnectEvent over 5 min")):this.terminatedNetCallback&&this.terminatedNetCallback()},this.setConnectedNetCallBack=function(e){this.connectedNetCallback=e},this.setDisconnectNetCallBack=function(e){this.disconnectNetCallBack=e},this.setTerminatedNetCallback=function(e){this.terminatedNetCallback=e},this.updateSocket=function(){var e=this.updateNet();if((3==e||2==e)&&this.reqArray.length>0){var t=this.reqArray.pop();void 0!=t&&null!=t&&this.requestSocket(t)}return 3!=e&&1!=e||this.seperatePackHandle(),e},this.createAndJoinRoom=function(e,t,i,r,n){this.createRoom(e,t,function(e,t,o){0==e?(BK.Script.log(0,0,"\u521b\u5efa\u6e38\u620f statusCode:"+e+" roomId:"+o),this.gameSvrIp=t.ip_2,this.gameSvrPort=t.port_2,this.roomSvrIp=t.ip_1,this.roomSvrPort=t.port_1,this.socket.close(),this.socket.connect(this.gameSvrIp,this.gameSvrPort),this.joinRoom(0,function(e,t){BK.Script.log(0,0,"\u52a0\u5165\u623f\u95f4 statusCode:"+e+" roomid is "+t.roomId),0==e&&(GameStatusInfo.roomId=t.roomId,BK.QQ.gameCfg.roomId=t.roomId),n?1==BK.QQ.hasJoinRoomSucc?i(e,this):BK.QQ.delegate.onJoinRoomEvent=function(t,r,n){i(e,this)}.bind(this):i(e,this)},r,n)):i(e,this)})},this.queryAndJoinRoom=function(e,t,i,r,n,o){1!=this.serverConnected&&(this.socket.close(),this.socket.connect(this.recommandRoomSvrHost,this.recommandRoomSvrPort)),this.queryRoom(e,t,i,function(e,t){0==e?(this.gameSvrIp=t.ip_2,this.gameSvrPort=t.port_2,this.roomSvrIp=t.ip_1,this.roomSvrPort=t.port_1,this.socket.close(),this.socket.connect(this.gameSvrIp,this.gameSvrPort),this.joinRoom(0,function(e,t){BK.QQ.hasJoinRoomSucc=!0,BK.Script.log(0,0,"\u52a0\u5165\u623f\u95f4 statusCode:"+e+" roomid is "+t.roomId),r(e,this)},n,o)):r(e,void 0)})},this.socialMatch=function(e){this.roomId=Number(GameStatusInfo.roomId),BK.Script.log(1,1,"1v1\u5339\u914d \u73a9\u5bb6\u6765\u6e90:"+GameStatusInfo.src+" \u623f\u95f4\u53f7:"+GameStatusInfo.roomId),this.createRoom(GameStatusInfo.gameId,GameStatusInfo.openId,function(t,i,r){BK.Script.log(1,1,"1v1\u5339\u914d \u521b\u5efa\u623f\u95f4 statusCode:"+t+" roomid:"+r),0==t?(this.isCreator=!0,this.gameSvrIp=i.ip_2,this.gameSvrPort=i.port_2,this.roomSvrIp=i.ip_1,this.roomSvrPort=i.port_1,this.socket.close(),this.socket.connect(this.gameSvrIp,this.gameSvrPort),this.joinRoom(GameStatusInfo.src,function(t,i){BK.Script.log(1,1,"1v1\u5339\u914d \u52a0\u5165\u623f\u95f4 statusCode:"+t+" roomid:"+i.roomId),0==t?(BK.Script.log(1,1,"1v1\u5339\u914d \u52a0\u5165\u623f\u95f4\u6210\u529f"),e(t,i)):(BK.Script.log(1,1,"1v1\u5339\u914d \u52a0\u5165\u623f\u95f4\u5931\u8d25 statusCode:"+t+" \u5177\u4f53\u9519\u8bef\u7801\u53c2\u89c1http://hudong.qq.com/docs/engine/api/BK.MQQ.ErrorCode.html"),e(t,this))},!0,!0)):2007==t?(this.isCreator=!1,this.queryRoom(GameStatusInfo.gameId,GameStatusInfo.roomId,GameStatusInfo.openId,function(t,i){BK.Script.log(1,1,"1v1\u5339\u914d \u67e5\u8be2\u623f\u95f4 statusCode:"+t+" roomId:"+r+" \u623f\u95f4\u4e2d\u73a9\u5bb6\u6570:"+i.playerNum),0==t&&i?(this.gameSvrIp=i.ip_2,this.gameSvrPort=i.port_2,this.roomSvrIp=i.ip_1,this.roomSvrPort=i.port_1,this.socket.close(),this.socket.connect(this.gameSvrIp,this.gameSvrPort),this.joinRoom(GameStatusInfo.src,function(t,i){BK.Script.log(1,1,"1v1\u5339\u914d \u52a0\u5165\u623f\u95f4 statusCode:"+t+" roomid:"+i.roomId),0==t?(BK.Script.log(1,1,"1v1\u5339\u914d \u52a0\u5165\u623f\u95f4\u6210\u529f"),e(t,i)):(BK.Script.log(1,1,"1v1\u5339\u914d \u52a0\u5165\u623f\u95f4\u5931\u8d25 statusCode:"+t+" \u5177\u4f53\u9519\u8bef\u7801\u53c2\u89c1http://hudong.qq.com/docs/engine/api/BK.MQQ.ErrorCode.html"),e(t,this))},!0,!0)):(BK.Script.log(1,1,"1v1\u5339\u914d \u67e5\u8be2\u623f\u95f4\u5931\u8d25 statusCode:"+t+" \u5177\u4f53\u9519\u8bef\u7801\u53c2\u89c1http://hudong.qq.com/docs/engine/api/BK.MQQ.ErrorCode.html"),e(t,this))})):(BK.Script.log(1,1,"1v1\u5339\u914d \u521b\u5efa\u623f\u95f4\u5931\u8d25 statusCode:"+t+" \u5177\u4f53\u9519\u8bef\u7801\u53c2\u89c1http://hudong.qq.com/docs/engine/api/BK.MQQ.ErrorCode.html"),e(t,this))})},this.showOneMorePage=function(e,t){var i=[],r=0;if(t&&2==t.length)for(var n=0;n<t.length;n++){r=2!=e&&GameStatusInfo.openId==t[n]?e:2==e?2:2!=e&&GameStatusInfo.openId!=t[n]?1-e:-1;o={openId:t[n],scoreState:r};BK.Script.log(1,1,"\u73a9\u5bb6\u4fe1\u606f playerInfo:"+JSON.stringify(o)),i.push(o)}else if(this.newJoinPlayers){if(this.newJoinPlayers.forEach(function(t){r=2!=e&&GameStatusInfo.openId==t.openId?e:2==e?2:2!=e&&GameStatusInfo.openId!=t.openId?1-e:-1;var n={openId:t.openId,scoreState:r};BK.Script.log(1,1,"\u73a9\u5bb6\u4fe1\u606f playerInfo:"+JSON.stringify(n)),i.push(n)},this),this.isCreator){2!=e?r=e:2==e&&(r=2);var o={openId:this.ownerId,scoreState:r};BK.Script.log(1,1,"\u73a9\u5bb6\u4fe1\u606f playerInfo:"+JSON.stringify(o)),i.push(o)}}else BK.Script.log(1,1,"\u518d\u6765\u4e00\u5c40\u5931\u8d25\uff0copenIds\uff08\u81ea\u5efa\u540e\u53f0\uff09\u6216newJoinPlayers\uff08\u975e\u81ea\u5efa\u540e\u53f0\uff09\u4e3anull\u6216\u8005undefined");var a={scoreState:e,playerInfos:i};BK.Script.log(1,1,"\u518d\u6765\u4e00\u5c40\u6210\u529f data:"+JSON.stringify(a)),BK.MQQ.SsoRequest.send(a,CMSHOW_CS_CMD_SHOW_ONE_MORE_PAGE)},this.forceLeaveRoom=function(e,t){var i=new Object;i.cmd=4,i.arg0=t,this.leaveRoomCallBack=e;var r=this.requestLeaveRoom(i.arg0),n=this.socket.update();3==n||2==n?(this.socket.send(r),BK.Script.log(0,0,"forceLeaveRoom push")):BK.Script.log(0,0,"forceLeaveRoom push Failed. Socket not allow Send.")},this._event4StopGame=function(e,t,i){BK.Script.log(0,0,"BK.Room._event4StopGame!errCode = "+e+", cmd = "+t+", data = "+JSON.stringify(i)),0==e&&this.forceLeaveRoom(function(e,t){BK.Script.log(0,0,"forceLeaveRoom callback")},0)},BK.MQQ.SsoRequest.addListener(CMSHOW_SC_CMD_STOP_GAME,this,this._event4StopGame.bind(this)),this.addDebugFunctions=function(){this.createFixedRoom=function(e,t,i,r){this.roomId=i,this.mId=t,this.gameId=e;var n=this.socket.connect(this.recommandRoomSvrHost,this.recommandRoomSvrPort);BK.Script.log(0,0,"socket con ="+n),-1!=n&&BK.Script.log(0,0,"socket connect failed! "+n),this.createRoomCallBack=r;var o=new Object;o.cmd=6,o.arg0=e,o.arg1=t,this.reqArray.push(o),BK.Script.log(0,0,"create Fixed Room ")},this.createAndJoinFixedRoom=function(e,t,i,r,n){this.createFixedRoom(e,t,i,function(e,t,i){0==e?(BK.Script.log(0,0,"\u521b\u5efa\u56fa\u5b9a\u623f\u95f4\u53f7 \u6e38\u620f statusCode:"+e+" roomId:"+i),this.gameSvrIp=t.ip_2,this.gameSvrPort=t.port_2,this.roomSvrIp=t.ip_1,this.roomSvrPort=t.port_1,this.socket.close(),this.socket.connect(this.gameSvrIp,this.gameSvrPort),this.joinRoom(0,function(e,t){BK.Script.log(0,0,"\u52a0\u5165\u623f\u95f4 statusCode:"+e+" roomid is "+t.roomId),r(e,this)},n)):r(e,this)})},this.requestCreateRoom=function(e,t){var i=this.roomId;i||(i=0),BK.Script.log(0,0,"create fixed room request in fixedRoomId:"+i);var r=new BK.Buffer(fixedHeaderLen,1);this.addFixedHeader(r,6,e,i,t);var n=BK.Security.getST();BK.Security.encrypt(r);var o=n.bufferLength(),a=new BK.Buffer(HeaderLen+r.bufferLength()+o,1);return this.addHeader(a,r.bufferLength(),o),a.writeBuffer(n),a.writeBuffer(r),BK.Script.log(0,0,"create room request buffer : "+a.bufferLength()+" body len:"+r.bufferLength()),a}},Object.defineProperty(this,"environment",{get:function(){return this._environment},set:function(e){BK.Script.log(0,0,"Set Environment failed!Can't set the environment!!!")}}),GameStatusInfo.devPlatform?(this._environment=NETWORK_ENVIRONMENT_DEMO_DEV,BK.Script.log(1,1,"\u5f53\u524d\u73af\u5883\u4e3a---\u5f00\u53d1\u73af\u5883")):1==GameStatusInfo.isWhiteUser?(this._environment=NETWORK_ENVIRONMENT_QQ_DEBUG,BK.Script.log(1,1,"\u5f53\u524d\u73af\u5883\u4e3a---\u624bQ\u5f00\u53d1\u73af\u5883")):(this._environment=NETWORK_ENVIRONMENT_QQ_RELEASE,BK.Script.log(1,1,"\u5f53\u524d\u73af\u5883\u4e3a---\u6b63\u5f0f\u73af\u5883")),this._environment==NETWORK_ENVIRONMENT_QQ_DEBUG?(this.headerVersion=769,this.recommandRoomSvrHost=DebugRecommandRoomSvrHost,this.recommandRoomSvrPort=DebugRecommandRoomSvrPort):this._environment==NETWORK_ENVIRONMENT_DEMO_DEV&&(this.addDebugFunctions(),this.headerVersion=257,this.recommandRoomSvrHost=DebugRecommandRoomSvrHost,this.recommandRoomSvrPort=DebugRecommandRoomSvrPort)},function(e,t){"object"==typeof e&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.URL=t())}(BK,function(){return function(){function e(){return new RegExp(/(.*?)\.?([^\.]*?)\.?(com|net|org|biz|ws|in|me|co\.uk|co|org\.uk|ltd\.uk|plc\.uk|me\.uk|edu|mil|br\.com|cn\.com|eu\.com|hu\.com|no\.com|qc\.com|sa\.com|se\.com|se\.net|us\.com|uy\.com|ac|co\.ac|gv\.ac|or\.ac|ac\.ac|af|am|as|at|ac\.at|co\.at|gv\.at|or\.at|asn\.au|com\.au|edu\.au|org\.au|net\.au|id\.au|be|ac\.be|adm\.br|adv\.br|am\.br|arq\.br|art\.br|bio\.br|cng\.br|cnt\.br|com\.br|ecn\.br|eng\.br|esp\.br|etc\.br|eti\.br|fm\.br|fot\.br|fst\.br|g12\.br|gov\.br|ind\.br|inf\.br|jor\.br|lel\.br|med\.br|mil\.br|net\.br|nom\.br|ntr\.br|odo\.br|org\.br|ppg\.br|pro\.br|psc\.br|psi\.br|rec\.br|slg\.br|tmp\.br|tur\.br|tv\.br|vet\.br|zlg\.br|br|ab\.ca|bc\.ca|mb\.ca|nb\.ca|nf\.ca|ns\.ca|nt\.ca|on\.ca|pe\.ca|qc\.ca|sk\.ca|yk\.ca|ca|cc|ac\.cn|com\.cn|edu\.cn|gov\.cn|org\.cn|bj\.cn|sh\.cn|tj\.cn|cq\.cn|he\.cn|nm\.cn|ln\.cn|jl\.cn|hl\.cn|js\.cn|zj\.cn|ah\.cn|gd\.cn|gx\.cn|hi\.cn|sc\.cn|gz\.cn|yn\.cn|xz\.cn|sn\.cn|gs\.cn|qh\.cn|nx\.cn|xj\.cn|tw\.cn|hk\.cn|mo\.cn|cn|cx|cz|de|dk|fo|com\.ec|tm\.fr|com\.fr|asso\.fr|presse\.fr|fr|gf|gs|co\.il|net\.il|ac\.il|k12\.il|gov\.il|muni\.il|ac\.in|co\.in|org\.in|ernet\.in|gov\.in|net\.in|res\.in|is|it|ac\.jp|co\.jp|go\.jp|or\.jp|ne\.jp|ac\.kr|co\.kr|go\.kr|ne\.kr|nm\.kr|or\.kr|li|lt|lu|asso\.mc|tm\.mc|com\.mm|org\.mm|net\.mm|edu\.mm|gov\.mm|ms|nl|no|nu|pl|ro|org\.ro|store\.ro|tm\.ro|firm\.ro|www\.ro|arts\.ro|rec\.ro|info\.ro|nom\.ro|nt\.ro|se|si|com\.sg|org\.sg|net\.sg|gov\.sg|sk|st|tf|ac\.th|co\.th|go\.th|mi\.th|net\.th|or\.th|tm|to|com\.tr|edu\.tr|gov\.tr|k12\.tr|net\.tr|org\.tr|com\.tw|org\.tw|net\.tw|ac\.uk|uk\.com|uk\.net|gb\.com|gb\.net|vg|sh|kz|ch|info|ua|gov|name|pro|ie|hk|com\.hk|org\.hk|net\.hk|edu\.hk|us|tk|cd|by|ad|lv|eu\.lv|bz|es|jp|cl|ag|mobi|eu|co\.nz|org\.nz|net\.nz|maori\.nz|iwi\.nz|io|la|md|sc|sg|vc|tw|travel|my|se|tv|pt|com\.pt|edu\.pt|asia|fi|com\.ve|net\.ve|fi|org\.ve|web\.ve|info\.ve|co\.ve|tel|im|gr|ru|net\.ru|org\.ru|hr|com\.hr|ly|xyz)$/)}function t(e){return decodeURIComponent(e.replace(/\+/g," "))}function i(e,t){var i=e.charAt(0),r=t.split(i);return i===e?r:(e=parseInt(e.substring(1),10),r[e<0?r.length+e:e-1])}function r(e,i){for(var r=e.charAt(0),n=i.split("&"),o=[],a={},s=[],h=e.substring(1),c=0,l=n.length;c<l;c++)if((o=n[c].match(/(.*?)=(.*)/))||(o=[n[c],n[c],""]),""!==o[1].replace(/\s/g,"")){if(o[2]=t(o[2]||""),h===o[1])return o[2];(s=o[1].match(/(.*)\[([0-9]+)\]/))?(a[s[1]]=a[s[1]]||[],a[s[1]][s[2]]=o[2]):a[o[1]]=o[2]}return r===e?a:a[h]}return function(t,n){var o,a={};if("tld?"===t)return e();if(n=n||window.location.toString(),!t)return n;if(t=t.toString(),o=n.match(/^mailto:([^\/].+)/))a.protocol="mailto",a.email=o[1];else{if((o=n.match(/(.*?)\/#\!(.*)/))&&(n=o[1]+o[2]),(o=n.match(/(.*?)#(.*)/))&&(a.hash=o[2],n=o[1]),a.hash&&t.match(/^#/))return r(t,a.hash);if((o=n.match(/(.*?)\?(.*)/))&&(a.query=o[2],n=o[1]),a.query&&t.match(/^\?/))return r(t,a.query);if((o=n.match(/(.*?)\:?\/\/(.*)/))&&(a.protocol=o[1].toLowerCase(),n=o[2]),(o=n.match(/(.*?)(\/.*)/))&&(a.path=o[2],n=o[1]),a.path=(a.path||"").replace(/^([^\/])/,"/$1"),t.match(/^[\-0-9]+$/)&&(t=t.replace(/^([^\/])/,"/$1")),t.match(/^\//))return i(t,a.path.substring(1));if((o=i("/-1",a.path.substring(1)))&&(o=o.match(/(.*?)\.(.*)/))&&(a.file=o[0],a.filename=o[1],a.fileext=o[2]),(o=n.match(/(.*)\:([0-9]+)$/))&&(a.port=o[2],n=o[1]),(o=n.match(/(.*?)@(.*)/))&&(a.auth=o[1],n=o[2]),a.auth&&(o=a.auth.match(/(.*)\:(.*)/),a.user=o?o[1]:a.auth,a.pass=o?o[2]:void 0),a.hostname=n.toLowerCase(),"."===t.charAt(0))return i(t,a.hostname);e()&&(o=a.hostname.match(e()))&&(a.tld=o[3],a.domain=o[2]?o[2]+"."+o[3]:void 0,a.sub=o[1]||void 0),a.port||("http"===a.protocol||"ws"===a.protocol?a.port="80":"https"!==a.protocol&&"wss"!==a.protocol||(a.port="443"))}return t in a?a[t]:"{}"===t?a:void 0}}()});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(e,t){"object"==typeof e&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.WebSocket=t())}(BK,function(){var e=function(){function e(){this._wsArray=[],BK.Director.ticker.add(function(t,i){e.Instance.dispatchEvent()})}return e.prototype.add=function(e){this._wsArray.push(e),BK.Script.log(1,0,"SocketEventMgr.add!so = "+e)},e.prototype.del=function(e){var t=this._wsArray.indexOf(e,0);t>=0&&(this._wsArray.splice(t,1),BK.Script.log(1,0,"SocketEventMgr.del!so = "+e))},e.prototype.dispatchEvent=function(){this._wsArray.forEach(function(e,t,i){e&&e.update()})},e.Instance=new e,e}(),t=function(){function t(e,t){this.ip=e,this.port=t,this.__nativeObj=new BK.Socket,this.prevConnTs=0,this.curConnRetrys=0,this.curConnTimeout=0,this.prevNetState=0,this.prevNetStateUpdateFlag=!1,this.options={ConnectRetryCount:3,ConnectTimeoutInterval:3e3}}return t.prototype.__internalClose=function(){return this.__nativeObj?this.__nativeObj.close():-2},t.prototype.__internalSend=function(e){return this.__nativeObj?this.__nativeObj.send(e):-2},t.prototype.__internalRecv=function(e){if(this.__nativeObj)return this.__nativeObj.receive(e)},t.prototype.__internalUpdate=function(){return this.__nativeObj?this.__nativeObj.update():-2},t.prototype.__internalConnect=function(){if(this.__nativeObj){var e=this.__nativeObj.connect(this.ip,this.port),t=this.curNetState();switch(this.prevNetState){case 3:this.onReconnectEvent(this);case 0:switch(t){case 3:this.onErrorEvent(this);break;case 1:case 4:this.prevConnTs=BK.Time.clock,this.curConnTimeout||(this.curConnTimeout=this.options.ConnectTimeoutInterval),this.onConnectingEvent(this),e=0;break;case 2:case 5:this.onConnectedEvent(this),e=0}}return this.prevNetState=t,this.prevNetStateUpdateFlag=!0,e}return-2},t.prototype.__internalCanReadLength=function(){return this.__nativeObj?this.__nativeObj.canReadLength():0},t.prototype.__internalIsEnableSSL=function(){return!!this.__nativeObj&&this.__nativeObj.getSSLEnable()},t.prototype.__internalEnableSSL=function(e){this.__nativeObj&&this.__nativeObj.setSSLEnable(e)},t.prototype.__internalUpdateSSL=function(){var e=this.__internalUpdate(),t=this.curNetState();if(-1!=e)switch(this.prevNetState){case 1:switch(t){case 2:BK.Script.log(1,0,"BK.Socket.update.ssl!connected, ip = "+this.ip+", port = "+this.port);break;case 4:case 5:break;default:i=BK.Time.clock;return 1e3*(r=BK.Time.diffTime(this.prevConnTs,i))>=this.curConnTimeout&&(this.curConnRetrys=this.curConnRetrys+1,this.curConnRetrys<this.options.ConnectRetryCount?(this.close(),this.connect(),this.curConnTimeout=2*this.curConnTimeout):(this.onTimeoutEvent(this),this.close())),e}break;case 2:break;case 4:switch(t){case 5:switch(e){case 2:case 3:this.clearState(),this.onConnectedEvent(this)}break;default:var i=BK.Time.clock,r=BK.Time.diffTime(this.prevConnTs,i);return 1e3*r>=this.curConnTimeout&&(this.curConnRetrys=this.curConnRetrys+1,this.curConnRetrys<this.options.ConnectRetryCount?(this.close(),this.connect(),this.curConnTimeout=2*this.curConnTimeout):(this.onTimeoutEvent(this),this.close())),e}break;case 5:switch(t){case 5:this.onUpdateEvent(this);break;case 3:this.onDisconnectEvent(this);break;default:this.onErrorEvent(this)}}else switch(this.prevNetState){case 2:case 1:this.onDisconnectEvent(this);break;case 4:case 6:case 5:this.onErrorEvent(this)}return this.prevNetStateUpdateFlag||(this.prevNetState=t,this.prevNetStateUpdateFlag=!0),e},t.prototype.__internalUpdateNoSSL=function(){var e=this.__internalUpdate(),t=this.curNetState();if(-1!=e)switch(this.prevNetState){case 1:switch(t){case 2:switch(e){case 2:this.clearState(),this.onConnectedEvent(this);break;case 3:BK.Script.log(1,0,"BK.Socket.update!unexcepted status")}break;default:var i=BK.Time.clock;return 1e3*BK.Time.diffTime(this.prevConnTs,i)>=this.curConnTimeout&&(this.curConnRetrys=this.curConnRetrys+1,this.curConnRetrys<this.options.ConnectRetryCount?(this.close(),this.connect(),this.curConnTimeout=2*this.curConnTimeout):(this.onTimeoutEvent(this),this.close())),e}break;case 2:switch(t){case 2:this.onUpdateEvent(this);break;case 3:this.onDisconnectEvent(this);break;default:this.onErrorEvent(this)}}else switch(this.prevNetState){case 2:case 1:this.onDisconnectEvent(this)}return this.prevNetStateUpdateFlag||(this.prevNetState=t,this.prevNetStateUpdateFlag=!0),e},t.prototype.curNetState=function(){return this.__nativeObj?this.__nativeObj.state:0},t.prototype.close=function(){var t=this.__internalClose();return t||(this.prevNetState=0,this.prevNetStateUpdateFlag=!0),e.Instance.del(this),t},t.prototype.send=function(e){var i=this.__internalSend(e);return i<0&&(this.onErrorEvent(this),t.prototype.close.call(this)),i},t.prototype.recv=function(e){return this.__internalRecv(e)},t.prototype.canRecvLength=function(){return this.__internalCanReadLength()},t.prototype.update=function(){return this.prevNetStateUpdateFlag=!1,this.isEnableSSL()?this.__internalUpdateSSL():this.__internalUpdateNoSSL()},t.prototype.connect=function(){var t=this.curNetState();if(0==t||3==t){var i=this.__internalConnect();return i||e.Instance.add(this),i}return 0},t.prototype.isEnableSSL=function(){return this.__internalIsEnableSSL()},t.prototype.enableSSL=function(e){this.__internalEnableSSL(e)},t.prototype.onErrorEvent=function(e){BK.Script.log(1,0,"BK.Socket.ErrorEvent")},t.prototype.onUpdateEvent=function(e){return 0},t.prototype.onTimeoutEvent=function(e){BK.Script.log(1,0,"BK.Socket.TimeoutEvent")},t.prototype.onConnectingEvent=function(e){BK.Script.log(1,0,"BK.Socket.ConnectingEvent")},t.prototype.onConnectedEvent=function(e){BK.Script.log(1,0,"BK.Socket.ConnectedEvent")},t.prototype.onReconnectEvent=function(e){BK.Script.log(1,0,"BK.Socket.ReconnectEvent")},t.prototype.onDisconnectEvent=function(e){BK.Script.log(1,0,"BK.Socket.DisconnectEvent")},t.prototype.clearState=function(){},t}(),i=function(){function e(e,t){this.data=e,this.isBinary=t}return e}(),r=function(e){function t(t,i,r,n,o){var a=e.call(this,t,i)||this;return a.path=n||"/",a.host=r,a.query=o,a.httpVer=1.1,a.httpParser=new HTTPParser(HTTPParser.RESPONSE),a.version=13,a.protocols=new Array,a.extensions=new Array,a.delegate={onOpen:null,onClose:null,onError:null,onMessage:null,onSendComplete:null},a.options||(a.options={}),a.options.DrainSegmentCount=8,a.options.DefaultSegmentSize=4096,a.options.PingPongInterval=0,a.options.HandleShakeRequestTimeout=1e4,a.options.HandleShakeResponseTimeout=1e4,a.options.CloseAckTimeout=2e3,a.options.PingPongTimeout=3e3,a.clear(),a}return __extends(t,e),t.prototype.clear=function(){this.mask4=new BK.Buffer(4,!1),this.txbuf=new BK.Buffer(128,!0),this.rxbuf=new BK.Buffer(128,!0),this.txMsgQue=new Array,this.rxbufQue=new Array,this.udataQue=new Array,this.peerClosed=!1,this.txSegCount=0,this.rxSegCount=0,this.rxFrameType=-1,this.isFinalSeg=!1,this.inTxSegFrame=!1,this.inRxSegFrame=!1,this.inPartialTxbuf=!1,this.inPingFrame=!1,this.inPongFrame=!1,this.errcode=65535,this.state=0,this.parseState=0,this.phaseTimeout=0,this.pingpongTimer=0,this.prevPhaseTickCount=0,this.prevPingPongTickCount=0,this.framePackageCount=0},t.prototype.getReadyState=function(){return this.state},t.prototype.getErrorCode=function(){return this.errcode},t.prototype.getErrorString=function(){return this.message},t.prototype.randomN=function(e){for(var t=new BK.Buffer(e,!1),i=0;i<e;i++){var r=Math.round(65535*Math.random());t.writeUint8Buffer(r)}return t},t.prototype.toHex=function(e){if(e>=0&&e<=9)return e.toString();switch(e){case 10:return"A";case 11:return"B";case 12:return"C";case 13:return"D";case 14:return"E";case 15:return"F"}return"u"},t.prototype.bufferToHexString=function(e){var t="";for(e.rewind();!e.eof;){var i=e.readUint8Buffer();t=t.concat("x"+this.toHex((240&i)>>4)+this.toHex(15&i)+" ")}return t},t.prototype.startPhaseTimeout=function(e){if(6==e)this.phaseTimeout=e,this.prevPhaseTickCount=0;else switch(this.state){case 2:1==e&&(this.phaseTimeout=e,this.prevPhaseTickCount=BK.Time.clock);break;case 3:2==e&&(this.phaseTimeout=e,this.prevPhaseTickCount=BK.Time.clock);break;case 1:3==e&&(this.phaseTimeout=e,this.prevPhaseTickCount=BK.Time.clock);break;case 4:switch(e){case 4:this.options.PingPongTimeout=Math.min(this.options.PingPongTimeout,this.options.PingPongInterval)}this.phaseTimeout=e,this.prevPhaseTickCount=BK.Time.clock}},t.prototype.handlePhaseTimeout=function(){if(6!=this.phaseTimeout){var t=BK.Time.diffTime(this.prevPhaseTickCount,BK.Time.clock);switch(this.phaseTimeout){case 1:1e3*t>this.options.HandleShakeRequestTimeout&&(BK.Script.log(1,0,"BK.WebSocket.handlePhaseTimeout!handshake request timeout"),this.prevPhaseTickCount=BK.Time.clock,this.state=-1,this.errcode=4096,this.message="handshake request timeout",e.prototype.close.call(this),this.delegate.onError&&this.delegate.onError(this));break;case 2:1e3*t>this.options.HandleShakeResponseTimeout&&(BK.Script.log(1,0,"BK.WebSocket.handlePhaseTimeout!handshake response timeout"),this.prevPhaseTickCount=BK.Time.clock,this.state=-1,this.errcode=4097,this.message="handshake response timeout",e.prototype.close.call(this),this.delegate.onError&&this.delegate.onError(this));break;case 3:1e3*t>this.options.CloseAckTimeout&&(BK.Script.log(1,0,"BK.WebSocket.handlePhaseTimeout!close ack timeout"),this.prevPhaseTickCount=BK.Time.clock,e.prototype.close.call(this),1==this.state?this.peerClosed?this.delegate.onClose&&this.delegate.onClose(this):(this.errcode=1006,this.message="abnormal close",this.delegate.onError&&this.delegate.onError(this),this.startPhaseTimeout(6)):this.delegate.onError&&this.delegate.onError(this));break;case 4:1e3*t>this.options.PingPongTimeout&&(BK.Script.log(1,0,"BK.WebSocket.handlePhaseTimeout!receive pong timeout"),this.prevPhaseTickCount=BK.Time.clock)}}},t.prototype.restartPingPongTimer=function(){4==this.state&&this.options.PingPongInterval>0&&(this.prevPingPongTickCount=BK.Time.clock)},t.prototype.handlePingPongTimer=function(){4==this.state&&this.options.PingPongInterval>0&&1e3*BK.Time.diffTime(this.prevPingPongTickCount,BK.Time.clock)>this.options.PingPongInterval&&(this.inPingFrame=!1,this.txPingData=this.randomN(16),this.sendPingFrame(this.txPingData),this.restartPingPongTimer())},t.prototype.doHandshakePhase=function(){var t="",i=this.query?"?"+this.query:"";t=t.concat("GET "+this.path+i+" HTTP/"+this.httpVer+"\r\n"),t=(t=(t=80==this.port||443==this.port?t.concat("Host: "+this.host+"\r\n"):t.concat("Host: "+this.host+":"+this.port+"\r\n")).concat("Upgrade: websocket\r\n")).concat("Connection: Upgrade\r\n"),t=this.isEnableSSL()?t.concat("Origin: https://"+this.host+"\r\n"):t.concat("Origin: http://"+this.host+"\r\n");var r=this.randomN(16),n=BK.Misc.encodeBase64FromBuffer(r);if(t=t.concat("Sec-WebSocket-Key: "+n+"\r\n"),t=t.concat("Sec-WebSocket-Version: "+this.version+"\r\n"),this.query)for(var o=this.query.split("&"),a=0;a<o.length;a++){var s=o[a].split("=");s.length>0&&(t=t.concat(s[0]+": "+s[1]+"\r\n"))}t=t.concat("\r\n");var h=BK.Misc.sha1(n.concat("258EAFA5-E914-47DA-95CA-C5AB0DC85B11"));this.handshakeSig=BK.Misc.encodeBase64FromBuffer(h);var c=new BK.Buffer(t.length,!1);c.writeAsString(t,!1),0<e.prototype.send.call(this,c)&&(this.state=2,this.startPhaseTimeout(1))},t.prototype.doSvrHandshakePhase1=function(t){var i=this;t&&(this.httpParser.onComplete||(this.httpParser.onComplete=function(){for(var t in i.httpParser.headers);i.doSvrHandshakePhase2()?(i.restartPingPongTimer(),i.startPhaseTimeout(6),i.delegate.onOpen&&i.delegate.onOpen(i)):(i.errcode=4098,i.message="handshake parse error",i.startPhaseTimeout(6),e.prototype.close.call(i),i.delegate.onError&&i.delegate.onError(i))}),this.httpParser.execute(t),2==this.state&&(this.state=3,this.startPhaseTimeout(2)))},t.prototype.doSvrHandshakePhase2=function(){switch(this.httpParser.statusCode){case 101:return void 0==this.httpParser.headers.upgrade?(this.state=-1,BK.Script.log(1,0,"BK.WebSocket.doSvrHandshakePhase2!missing 'upgrade' header"),!1):void 0==this.httpParser.headers.connection?(this.state=-1,BK.Script.log(1,0,"BK.WebSocket.doSvrHandshakePhase2!missing 'connection' header"),!1):"upgrade"!=this.httpParser.headers.connection.toLowerCase()?(this.state=-1,BK.Script.log(1,0,"BK.WebSocket.doSvrHandshakePhase2!error 'connection' header"),!1):void 0==this.httpParser.headers["sec-websocket-accept"]?(this.state=-1,BK.Script.log(1,0,"BK.WebSocket.doSvrHandshakePhase2!missing 'sec-websocket-accept' header"),!1):this.handshakeSig!=this.httpParser.headers["sec-websocket-accept"]?(this.state=-1,BK.Script.log(1,0,"BK.WebSocket.doSvrHandshakePhase2!error 'sec-websocket-accept' header"),!1):(this.state=4,!0)}return!1},t.prototype.doFrameDataPhase=function(e,i,r){void 0===r&&(r=!1);var n=6,o=e.length;this.extensions.length,n+=o;var a=new BK.Buffer(n,!1),s=0,h=!1;switch(this.version){case 13:h=!0,s=128}var c=!0;switch(i){case 1:case 2:r?this.inTxSegFrame?(c=!1,i=0):(c=!1,this.inTxSegFrame=!0):this.inTxSegFrame&&(i=0)}if(c?a.writeUint8Buffer(128|15&i):a.writeUint8Buffer(15&i),o<126?a.writeUint8Buffer(s|127&e.length):o<65536?(a.writeUint8Buffer(126|s),t.isLittleEndian?(a.writeUint8Buffer((65280&o)>>8),a.writeUint8Buffer(255&o)):(a.writeUint8Buffer(255&o),a.writeUint8Buffer((65280&o)>>8))):BK.Script.log(1,0,"BK.WebSocket.doFrameDataPhase!js don't support 64bit data type"),h){var l=this.randomN(4);BK.Misc.encodeBufferXorMask4(e,l),a.writeBuffer(l)}return a.writeBuffer(e),a},t.prototype.doSvrFrameDataPhase=function(e){if(!e)return!0;for(;!e.eof;){switch(this.parseState){case 0:this.mask4.rewind(),this.rxbuf=new BK.Buffer(this.options.DefaultSegmentSize,!0),this.maskBit=0,this.rxbuflen=0,this.isFinalSeg=!1,this.parseState=1;case 1:var i=e.readUint8Buffer();switch(this.isFinalSeg=!!(128&i),this.opcode=15&i,this.version){case 13:switch(this.opcode){case 3:case 4:case 5:case 6:case 7:case 11:case 12:case 13:case 14:case 15:return this.errcode=1002,this.message="protocol error",BK.Script.log(1,0,"BK.WebSocket.doSvrFrameDataPhase!unknown opcode = "+this.opcode),!1}}switch(this.opcode){case 8:case 9:case 10:case 0:break;default:if(!this.isFinalSeg&&1!=this.opcode&&2!=this.opcode)return this.errcode=1003,this.message="unsupported data",BK.Script.log(1,0,"BK.WebSocket.doSvrFrameDataPhase!illegal opcode = "+this.opcode),!1;if(-1==this.rxFrameType)this.rxFrameType=this.opcode;else if(this.rxFrameType!=this.opcode)return this.errcode=1002,this.message="protocol error",BK.Script.log(1,0,"BK.WebSocket.doSvrFrameDataPhase!rxFrameType = "+this.rxFrameType+", illegal opcode = "+this.opcode),!1}if(this.parseState=2,e.eof)return!0;case 2:var r=e.readUint8Buffer();switch(this.maskBit=(128&r)>>7,127&r){case 126:if(this.parseState=3,e.eof)return!0;break;case 127:if(this.parseState=5,e.eof)return!0;break;default:if(this.rxbuflen=127&r,1==this.maskBit?this.parseState=13:this.parseState=17,this.rxbuflen>0&&e.eof)return!0}}switch(this.parseState){case 3:n=e.readUint8Buffer();if(t.isLittleEndian?this.rxbuflen|=(255&n)<<8:this.rxbuflen|=255&n,e.eof)return!0;case 4:var n=e.readUint8Buffer();if(t.isLittleEndian?this.rxbuflen|=255&n:this.rxbuflen|=(255&n)<<8,1==this.maskBit?this.parseState=13:this.parseState=17,this.rxbuflen>0&&e.eof)return!0;break;case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:return this.errcode=1002,this.message="protocol errors",BK.Script.log(1,0,"BK.WebSocket.doSvrFrameDataPhase!js don't support 64bit data type"),!1}switch(this.parseState){case 13:if(this.mask4.writeUint8Buffer(e.readUint8Buffer()),this.parseState=14,e.eof)return!0;case 14:if(this.mask4.writeUint8Buffer(e.readUint8Buffer()),this.parseState=15,e.eof)return!0;case 15:if(this.mask4.writeUint8Buffer(e.readUint8Buffer()),this.parseState=16,e.eof)return!0;case 16:if(this.mask4.writeUint8Buffer(e.readUint8Buffer()),this.parseState=17,e.eof)return!0}if(17==this.parseState){var o=e.length-e.pointer;if(o<=this.rxbuflen-this.rxbuf.length?this.rxbuf.writeBuffer(e.readBuffer(o)):this.rxbuf.writeBuffer(e.readBuffer(this.rxbuflen-this.rxbuf.length)),this.rxbuf.length==this.rxbuflen)if(this.rxSegCount=this.rxSegCount+1,this.parseState=0,this.isFinalSeg)switch(this.rxbuf.rewind(),this.opcode){case 8:BK.Script.log(0,0,"BK.WebSocket.doSvrFrameDataPhase!receive close frame"),this.handleCloseFrame();break;case 9:BK.Script.log(0,0,"BK.WebSocket.doSvrFrameDataPhase!receive ping frame"),this.handlePingFrame();break;case 10:BK.Script.log(0,0,"BK.WebSocket.doSvrFrameDataPhase!receive pong frame"),this.handlePongFrame();break;default:this.rxbufQue.push(this.rxbuf),this.recvFrameFromRxQ(this.rxFrameType),this.rxSegCount=0,this.rxFrameType=-1}else this.rxbuf.rewind(),this.rxbufQue.push(this.rxbuf)}}return!0},t.prototype.handleCloseFrame=function(){if(this.peerClosed=!0,4==this.state){var e=this.rxbuf.readUint16Buffer(),t=this.rxbuf.readBuffer(this.rxbuflen-2);if(e?(this.errcode=e,this.message=t.readAsString()):(this.errcode=1005,this.message="no status recv"),BK.Script.log(1,0,"BK.WebSocket.handleCloseFrame!errcode = "+this.errcode+", msg = "+this.message),this.sendCloseFrame(this.errcode,this.message?this.message:""),BK.Script.log(1,0,"BK.WebSocket.handleCloseFrame! closed by romote peer"),this.close(),this.state=0,this.delegate.onMessage)for(;this.udataQue.length>0;){i=this.udataQue.shift();this.delegate.onMessage(this,i)}this.delegate.onClose&&this.delegate.onClose(this)}else if(1==this.state){if(BK.Script.log(1,0,"BK.WebSocket.handleCloseFrame!normal closed"),this.close(),this.state=0,this.delegate.onMessage)for(;this.udataQue.length>0;){var i=this.udataQue.shift();this.delegate.onMessage(this,i)}this.delegate.onClose&&this.delegate.onClose(this)}},t.prototype.handlePingFrame=function(){if(4==this.state){if(this.rxbuflen>125)return this.errcode=4099,void(this.message="ping packet large");if(this.inPongFrame)return void BK.Script.log(1,0,"BK.WebSocket.handlePingFrame!already recv ping, drop it.");this.rxPongData=new BK.Buffer(this.rxbuflen,!0),this.rxPongData.writeBuffer(this.rxbuf.readBuffer(this.rxbuflen)),this.sendPongFrame(this.rxPongData)}},t.prototype.handlePongFrame=function(){if(4==this.state){var e=new BK.Buffer(this.rxbuflen,!0);e.writeBuffer(this.rxbuf.readBuffer(this.rxbuflen)),this.startPhaseTimeout(6),BK.Script.log(0,0,"BK.WebSocket.handlePongFrame!pong data = "+this.bufferToHexString(e))}},t.prototype.sendFrameFromTxQ=function(t){if(4==this.state&&this.packageSendCheck()){if(this.inPartialTxbuf){if(!((l=e.prototype.send.call(this,this.txbuf))>0))return BK.Script.log(1,l,"BK.WebSocket.sendFrameFromTxQ!partial send failed, data type = "+t),!1;if(this.restartPingPongTimer(),l<this.txbuf.length){var i=this.txbuf.length-l,r=new BK.Buffer(i,!1);return this.txbuf.rewind(),this.txbuf.jumpBytes(l),r.writeBuffer(this.txbuf.readBuffer(i)),this.txbuf=r,!1}this.framePackageCount++,this.inPartialTxbuf=!1}for(var n=!0,o=0;o<this.txMsgQue.length;o++){for(var a=this.txMsgQue[o];a.length>0;){var s=a.shift(),h=a.length>0,c=this.doFrameDataPhase(s,t,h),l=e.prototype.send.call(this,c);if(!(l>0)){n=!1,BK.Script.log(1,l,"BK.WebSocket.sendFrameFromTxQ!send failed, data type = "+t);break}if(this.restartPingPongTimer(),l<c.length){c.rewind(),c.jumpBytes(l),this.txbuf.rewind(),this.txbuf.writeBuffer(c.readBuffer(c.length-l)),this.inPartialTxbuf=!0,n=!1,BK.Script.log(1,0,"BK.WebSocket.sendFrameFromTxQ!partial send, total size = "+c.length+", tx size = "+l);break}if(0==a.length&&(this.inTxSegFrame=!1),this.framePackageCount++,!this.packageSendCheck())return}if(0==a.length&&this.txMsgQue.shift(),!n)break;if(!this.packageSendCheck())return}return n&&!this.txMsgQue.length&&this.inTxSegFrame&&(this.inTxSegFrame=!1),n}},t.prototype.recvFrameFromRxQ=function(e){for(var t=2==e,r=new BK.Buffer(128,!0);this.rxbufQue.length>0;){var n=this.rxbufQue.shift();r.writeBuffer(n)}0==t&&r.writeUint8Buffer(0),r.rewind(),this.udataQue.push(new i(r,t))},t.prototype.__sendBinaryFrame=function(e,t){var i=e.length,r=this.options.DefaultSegmentSize,n=0;e.rewind();for(var o=new Array;i>r;){a=new BK.Buffer(r,!1);e.rewind(),e.jumpBytes(n),a.writeBuffer(e.readBuffer(r)),a.rewind(),o.push(a),n+=r,i-=r}if(i>0){var a=new BK.Buffer(i,!1);e.rewind(),e.jumpBytes(n),a.writeBuffer(e.readBuffer(i)),a.rewind(),o.push(a)}return this.txMsgQue.push(o),this.txFrameType=t,this.sendFrameFromTxQ(t)},t.prototype.sendTextFrame=function(e){if(4!=this.state)return!1;var t=new BK.Buffer(128,!0);return t.writeAsString(e,!1),t.rewind(),this.__sendBinaryFrame(t,1)},t.prototype.sendBinaryFrame=function(e){if(4==this.state)return this.__sendBinaryFrame(e,2)},t.prototype.sendCloseFrame=function(i,r){if(!this.isSendClose){this.isSendClose=!0;var n=new BK.Buffer(r.length+1,!1),o=new BK.Buffer(3+r.length,!1);t.isLittleEndian?(o.writeUint8Buffer((65280&i)>>8),o.writeUint8Buffer(255&i)):(o.writeUint8Buffer(255&i),o.writeUint8Buffer((65280&i)>>8)),n.writeAsString(r,!0),o.writeBuffer(n);var a=this.doFrameDataPhase(o,8);0<e.prototype.send.call(this,a)&&(0==this.peerClosed&&(this.state=1,this.startPhaseTimeout(3)),BK.Script.log(1,0,"BK.WebSocket.sendCloseFrame!code = "+i+", reason = "+r))}},t.prototype.sendPingFrame=function(t){if(!this.inPingFrame){BK.Script.log(0,0,"BK.WebSocket.sendPingFrame!ping data = "+this.bufferToHexString(t));var i=this.doFrameDataPhase(t,9);0<e.prototype.send.call(this,i)&&(this.inPingFrame=!0,this.startPhaseTimeout(4))}},t.prototype.sendPongFrame=function(t){if(!this.inPongFrame){var i=this.doFrameDataPhase(t,10);0<e.prototype.send.call(this,i)&&(this.inPongFrame=!0)}},t.prototype.clearState=function(){this.state=0},t.prototype.onErrorEvent=function(t){0!=this.state&&1!=this.state&&(e.prototype.onErrorEvent.call(this,t),this.state=-1,this.errcode=1006,this.message="abnormal closure",this.delegate.onError&&this.delegate.onError(this))},t.prototype.onTimeoutEvent=function(t){e.prototype.onErrorEvent.call(this,t),this.state=0,this.errcode=-1e3,this.message="socket connect timeout",this.delegate.onError&&this.delegate.onError(this)},t.prototype.onDisconnectEvent=function(t){switch(e.prototype.onDisconnectEvent.call(this,t),this.state){case 2:case 3:case 4:this.state=-1,this.errcode=1006,this.message="abnormal closure",this.delegate.onError&&this.delegate.onError(this);break;case 1:this.state=0,this.delegate.onClose&&this.delegate.onClose(this),BK.Script.log(1,0,"BK.WebSocket.onDisconnectEvent!enter closed state")}},t.prototype.onConnectedEvent=function(t){e.prototype.onConnectedEvent.call(this,t),0==this.state&&(this.clear(),this.doHandshakePhase())},t.prototype.phaseBufferCheck=function(e){for(var t=0,i=0;!e.eof;)if(i++,e.readUint8Buffer()=="\r\n\r\n".charCodeAt(t)){if(++t=="\r\n\r\n".length)return i}else t=0;return-1},t.prototype.packageSendCheck=function(){return this.framePackageCount<this.options.DrainSegmentCount},t.prototype.onUpdateEvent=function(t){switch(this.framePackageCount=0,e.prototype.onUpdateEvent.call(this,t),this.state){case 2:case 3:if((o=t.canRecvLength())>0){var i=this.recv(o),r=this.phaseBufferCheck(i);if(i.rewind(),r<i.length){var n=i.readBuffer(r);if(void 0!=n&&this.doSvrHandshakePhase1(n.readAsString(!0)),this.handlePhaseTimeout(),4!=this.state){BK.Script.log(1,0,"BK.Websocket websocket state expected ESTABLISHED!");break}if(BK.Script.log(1,0,"BK.Websocket pointer:"+i.pointer+"length:"+i.length),void 0!=i)for(;!i.eof;)if(!this.doSvrFrameDataPhase(i)){this.sendCloseFrame(this.errcode,this.message?this.message:""),this.delegate.onError&&this.delegate.onError(this);break}if(this.delegate.onMessage)for(;this.udataQue.length>0;){h=this.udataQue.shift();this.delegate.onMessage(this,h)}this.txMsgQue.length>0&&this.sendFrameFromTxQ(this.txFrameType),this.delegate.onSendComplete&&this.delegate.onSendComplete(this),this.inPongFrame=!1,this.handlePhaseTimeout(),this.handlePingPongTimer()}else void 0!=i&&this.doSvrHandshakePhase1(i.readAsString(!0)),this.handlePhaseTimeout()}break;case 4:for(var o=t.canRecvLength();o>0;){var a=o,s=this.recv(o);if(void 0!=s)for(;!s.eof;){if(!this.doSvrFrameDataPhase(s)){this.sendCloseFrame(this.errcode,this.message?this.message:""),this.delegate.onError&&this.delegate.onError(this);break}if(0==this.state)return}if((o=t.canRecvLength())==a)break}if(this.delegate.onMessage)for(;this.udataQue.length>0;){h=this.udataQue.shift();this.delegate.onMessage(this,h)}this.txMsgQue.length>0&&this.sendFrameFromTxQ(this.txFrameType),this.delegate.onSendComplete&&this.delegate.onSendComplete(this),this.inPongFrame=!1,this.handlePhaseTimeout(),this.handlePingPongTimer();break;case 1:if((o=t.canRecvLength())>0&&this.doSvrFrameDataPhase(this.recv(o))&&this.delegate.onMessage)for(;this.udataQue.length>0;){var h=this.udataQue.shift();this.delegate.onMessage(this,h)}this.handlePhaseTimeout()}return 0},t.isLittleEndian=BK.Misc.isLittleEndian(),t}(t),n=function(){function e(e,t){this.data=e,this.isBinary=t}return e}();return function(){function e(e){var t=this;this.__url=e,this.options=null,this.inTrans=!1,this.isPendingConn=!0,this.txdataQ=new Array;var i=BK.URL("{}",e);this.scheme=i.protocol,this.port=i.port,this.path=i.path,this.query=i.query,this.host=i.hostname,BK.DNS.queryIPAddress(i.hostname,function(e,i,n){switch(n=t.ipListFilter(n),e){case 0:BK.Script.log(1,0,"BK.WebSocket.queryIPAddress!iplist = "+JSON.stringify(n)),t.iplist=n,t.__nativeObj=new r(n[0],t.port,t.host,t.path,t.query),BK.Notification.on("game_network_change",t,function(e){this.__nativeObj.close(),this.__nativeObj.delegate.onClose(this.__nativeObj)}.bind(t),!0),"wss"==t.scheme&&t.__nativeObj.enableSSL(!0),t.options&&(t.setOptions(t.options),t.options=null),t.isPendingConn&&(t.connect(),t.isPendingConn=!1),t.__nativeObj.delegate.onOpen=function(e){t.txdataQ.length>0&&t.send(t.txdataQ.shift()),t.onOpen?t.onOpen(t):t.onopen&&t.onopen.call(t)},t.__nativeObj.delegate.onClose=function(e){var i={};i.code=t.getErrorCode(),i.reason=t.getErrorString(),t.onClose?t.onClose(t,i):t.onclose&&t.onclose.call(t,i)},t.__nativeObj.delegate.onError=function(e){var i={};i.code=t.getErrorCode(),i.reason=t.getErrorString(),t.onError?t.onError(t,i):t.onerror&&t.onerror.call(t,i)},t.__nativeObj.delegate.onMessage=function(e,i){if(t.onMessage)t.onMessage(t,i);else if(t.onmessage){if(1==i.isBinary){var r=i.data;r.rewind();for(var n=new ArrayBuffer(r.length),o=new DataView(n);!r.eof;)o.setUint8(r.pointer,r.readUint8Buffer());i.data=n}t.onmessage.call(t,i)}},t.__nativeObj.delegate.onSendComplete=function(e){for(var i=t.txdataQ.length;i>0&&t.__nativeObj.packageSendCheck();i--){var r=t.txdataQ.shift();r.isBinary?t.__sendBinaryFrame(r.data):t.__nativeObj.sendTextFrame(r.data)}}}})}return Object.defineProperty(e.prototype,"url",{get:function(){return this.__url},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this.getReadyState()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bufferedAmount",{get:function(){for(var e=0,t=0;t<this.txdataQ.length;t++)e+=this.txdataQ[t].data.length;return e},enumerable:!0,configurable:!0}),e.prototype.__sendBinaryFrame=function(e){if(Object.prototype.hasOwnProperty.call(e,"__rawBKData"))return this.__nativeObj.sendBinaryFrame(e.__rawBKData);if(e instanceof Int8Array==1||e instanceof Uint8Array==1||e instanceof Int16Array==1||e instanceof Uint16Array==1||e instanceof Int32Array==1||e instanceof Uint32Array==1||e instanceof Float32Array==1){for(var t=new BK.Buffer(e.byteLength),i=new DataView(e.buffer),r=0;r<e.byteLength;r++)t.writeUint8Buffer(i.getUint8(r));return this.__nativeObj.sendBinaryFrame(t)}if(e instanceof ArrayBuffer==1){for(var t=new BK.Buffer(e.byteLength),i=new DataView(e),r=0;r<e.byteLength;r++)t.writeUint8Buffer(i.getUint8(r));return this.__nativeObj.sendBinaryFrame(t)}return this.__nativeObj.sendBinaryFrame(e)},e.prototype.ipListFilter=function(e){var t=new Array;return e.forEach(function(e){for(var i=!1,r=0;r<t.length;r++)if(e==t[r]){i=!0;break}0==i&&t.push(e)}),t},e.prototype.getReadyState=function(){return this.__nativeObj?this.__nativeObj.getReadyState():0},e.prototype.getErrorCode=function(){return this.__nativeObj?this.__nativeObj.getErrorCode():65535},e.prototype.getErrorString=function(){return this.__nativeObj?this.__nativeObj.getErrorString():""},e.prototype.close=function(){4==this.getReadyState()&&this.__nativeObj.sendCloseFrame(1e3,"see ya")},e.prototype.connect=function(){return!this.__nativeObj||0!=this.__nativeObj.connect()},e.prototype.send=function(e){var t=this.getReadyState();if(1==t||0==t)return!1;if("string"==typeof e){if(this.__nativeObj.packageSendCheck()&&4==t)return this.__nativeObj.sendTextFrame(e);this.txdataQ.push(new n(e,!1))}else if("object"==typeof e){if(this.__nativeObj.packageSendCheck()&&4==t)return this.__sendBinaryFrame(e);this.txdataQ.push(new n(e,!0))}return!1},e.prototype.setOptions=function(e){this.__nativeObj?(e.DrainSegmentCount&&(this.__nativeObj.options.DrainSegmentCount=e.DrainSegmentCount),e.DefaultSegmentSize&&(this.__nativeObj.options.DefaultSegmentSize=e.DefaultSegmentSize),e.PingPongInterval&&(this.__nativeObj.options.PingPongInterval=e.PingPongInterval),e.HandleShakeRequestTimeout&&(this.__nativeObj.options.HandleShakeRequestTimeout=e.HandleShakeRequestTimeout),e.HandleShakeResponseTimeout&&(this.__nativeObj.options.HandleShakeResponseTimeout=e.HandleShakeResponseTimeout),e.CloseAckTimeout&&(this.__nativeObj.options.CloseAckTimeout=e.CloseAckTimeout),e.PingPongTimeout&&(this.__nativeObj.options.PingPongTimeout=e.PingPongTimeout)):this.options=e},e}()});var SheetSprite=function(){function e(e,t,i,r,n,o,a){this.size={width:0,height:0},this.flipU=0,this.flipV=1,this.stretchX=1,this.stretchY=1,r&&(this.flipU=r),n&&(this.flipV=n),o&&(this.stretchX=o),a&&(this.stretchY=a),t&&(this.size.width=t),i&&(this.size.height=i),this.textureInfo=e,this.onInit(this.size.width,this.size.height),this.adjustWithTextureInfo(e)}return e.prototype.onInit=function(e,t){this.createSprites(e,t),Object.getOwnPropertyNames(this.__nativeObj).forEach(function(e){var t=e;Object.defineProperty(this,t,{get:function(){return this.__nativeObj[t]},set:function(e){this.__nativeObj[t]=e}})},this),Object.defineProperty(this,"size",{get:function(){return this.__nativeObj.contentSize},set:function(e){this.__nativeObj.contentSize=e,this.updateSize(this.textureInfo)}}),Object.defineProperty(this,"anchor",{get:function(){return this.__nativeObj.localAnchor},set:function(e){this.__nativeObj.localAnchor=e}})},e.prototype.updateSize=function(e){if(1==e.frameInfo.trimmed){var t=e.frameInfo.spriteSourceSize.x,i=e.frameInfo.spriteSourceSize.y,r=e.frameInfo.spriteSourceSize.w,n=e.frameInfo.spriteSourceSize.h,o=e.frameInfo.sourceSize,a=this.__nativeObj.contentSize;t=a.width*t/o.w,i=a.height*i/o.h,r=a.width*r/o.w,n=a.height*n/o.h,this.contentSprite.position={x:t,y:i},this.contentSprite.contentSize={width:r,height:n}}else this.contentSprite.contentSize=this.__nativeObj.contentSize},e.prototype.adjustWithTextureInfo=function(e){if(e){this.textureInfo=e;var t=e.texture,i=e.frameInfo;this.updateSize(e),this.currTexturePath=e.texturePath;t=new BK.Texture(this.currTexturePath);this.contentSprite.setTexture(t),this.contentSprite.adjustTexturePosition(i.frame.x,i.frame.y,i.frame.w,i.frame.h,i.rotated)}},e.prototype.setTexture=function(e){this.__nativeObj.setTexture(e)},e.prototype.dispose=function(){BK.Director.ticker.remove(this),this.__nativeObj.dispose()},e.prototype.removeChild=function(e){return this.__nativeObj.removeChild(e)},e.prototype.removeChildById=function(e,t){return this.__nativeObj.removeChildById(e,t)},e.prototype.removeChildByName=function(e,t){return this.__nativeObj.removeChildByName(e,t)},e.prototype.removeFromParent=function(){return this.__nativeObj.removeFromParent()},e.prototype.addChild=function(e,t){return this.__nativeObj.addChild(e,t)},e.prototype.hittest=function(e){return this.__nativeObj.hittest(e)},e.prototype.convertToWorldSpace=function(e){return this.__nativeObj.convertToWorldSpace(e)},e.prototype.convertToNodeSpace=function(e){return this.__nativeObj.convertToNodeSpace(e)},e.prototype.createSprites=function(e,t){this.__nativeObj=new BK.SpriteNode(e,t,{},this.flipU,this.flipV,this.stretchX,this.stretchY),this.contentSprite=new BK.SpriteNode(e,t,{},this.flipU,this.flipV,this.stretchX,this.stretchY),this.__nativeObj.addChild(this.contentSprite)},e}();BK.SheetSprite||(BK.SheetSprite=SheetSprite);var SpriteSheetCache=function(){function e(){this.sheets={},this.jsonConfigs={}}return e.prototype.getFrameInfoByFilename=function(e){for(var t in this.jsonConfigs)if(this.jsonConfigs.hasOwnProperty(t)){var i=this.jsonConfigs[t],r=(this.sheets[t],i.frames),n=i.meta;this.fullWidth=n.size.w,this.fullHeight=n.size.h;for(var o=0;o<r.length;o++){var a=r[o];if(e==a.filename){var s={x:0,y:1,w:0,h:0},h=a.rotated,c=a.trimmed,l=a.spriteSourceSize,u=a.sourceSize;return h?(s.x=a.frame.x,s.y=this.fullHeight-a.frame.y-a.frame.w,s.w=a.frame.w,s.h=a.frame.h):(s.x=a.frame.x,s.y=this.fullHeight-a.frame.y-a.frame.h,s.w=a.frame.w,s.h=a.frame.h),l.y=u.h-l.y-l.h,{filename:e,frame:s,rotated:h,trimmed:c,spriteSourceSize:l,sourceSize:u}}}}return null},e.prototype.getTexturePathByFilename=function(e){for(var t in this.jsonConfigs)if(this.jsonConfigs.hasOwnProperty(t))for(var i=this.jsonConfigs[t].frames,r=0;r<i.length;r++)if(i[r].filename==e)return t;return null},e.prototype.loadSheet=function(e,t,i,r,n,o,a){var s=BK.FileUtil.readFile(e).readAsString();if(s){var h=JSON.parse(s);void 0===t&&(t=e.replace(/.json$/,".png")),this.jsonConfigs[t]=h,void 0===i&&(i=4),i=4,void 0===r&&(r=1),void 0===n&&(n=1),void 0===o&&(o=1),void 0===a&&(a=1);var c=new BK.Texture(t,i,r,n,o,a);this.sheets[t]=c}else BK.Script.log(0,0,"loadSheet Failed.Please check path")},e.prototype.removeSheet=function(e,t){if(this.jsonConfigs[t])for(var i in this.jsonConfigs)if(this.jsonConfigs.hasOwnProperty(i)){r=this.jsonConfigs[i];i==t&&(delete this.jsonConfigs[t],BK.Script.log(0,0,"Delete jsonConfigs key:"+i+" val:"+r))}if(this.sheets[t])for(var i in this.sheets)if(this.sheets.hasOwnProperty(i)){var r=this.sheets[i];i==t&&(delete this.sheets[t],BK.Script.log(0,0,"Delete sheets key:"+i+" val:"+r))}},e.prototype.getTextureByFilename=function(e){var t=this.getFrameInfoByFilename(e),i=this.getTexturePathByFilename(e);return t&&i?new BK.Texture(i):(BK.Script.log(0,0,"getTexture Failed.Please check path"),null)},e.prototype.getSprite=function(e,t,i){var r=this.getTextureFrameInfoByFileName(e);if(r){var n=r.frameInfo,o=r.texturePath,a=new BK.Texture(o);if(t||(t=n.frame.w),i||(i=n.frame.h),BK.Script.log(0,0,"getSprite  texture:"+a+" width:"+t+" height:"+i),n.trimmed)return s=new BK.SheetSprite(r,t,i);var s=new BK.Sprite(t,i,a,0,1,1,1);return s.adjustTexturePosition(n.frame.x,n.frame.y,n.frame.w,n.frame.h,n.rotated),s}return null},e.prototype.createSheetSprite=function(e,t,i){var r=this.getTextureFrameInfoByFileName(e);if(r){var n=r.frameInfo,o=r.texturePath,a=new BK.Texture(o);return t||(t=n.frame.w),i||(i=n.frame.h),BK.Script.log(0,0,"SheetSprite  texture:"+a+" width:"+t+" height:"+i),new BK.SheetSprite(r,t,i)}return null},e.prototype.getTextureFrameInfoByFileName=function(e){var t=this.getFrameInfoByFilename(e),i=this.getTexturePathByFilename(e);return t&&i?{frameInfo:t,texturePath:i}:null},e}(),Sprite9=function(){function e(e,t,i,r,n,o){void 0===n&&(n={x:0,y:0}),this._size={width:0,height:0},this.__nativeObj=new BK.Node,this.onInit(),this._grid=r,this._size={width:t,height:t},this._leftTop=new BK.Sprite(r.left,r.top,i,0,1,1,1),this._leftTop.position={x:0,y:t-r.top},this._leftTop.zOrder=99999,this._leftTop.name="_leftTop",this.__nativeObj.addChild(this._leftTop),this._centerTop=new BK.Sprite(e-r.left-r.right,r.top,i,0,1,1,1),this._centerTop.position={x:r.left,y:t-r.top},this._centerTop.zOrder=99999,this._centerTop.name="_centerTop",this.__nativeObj.addChild(this._centerTop),this._rightTop=new BK.Sprite(r.right,r.top,i,0,1,1,1),this._rightTop.position={x:e-r.right,y:t-r.top},this._rightTop.zOrder=99999,this._rightTop.name="_rightTop",this.__nativeObj.addChild(this._rightTop),this._leftCenter=new BK.Sprite(r.left,t-r.top-r.bottom,i,0,1,1,1),this._leftCenter.position={x:0,y:r.bottom},this._leftCenter.name="_leftCenter",this.__nativeObj.addChild(this._leftCenter),this._centerCenter=new BK.Sprite(e-r.left-r.right,t-r.top-r.bottom,i,0,1,1,1),this._centerCenter.position={x:r.left,y:r.bottom},this._centerCenter.name="_centerCenter",this.__nativeObj.addChild(this._centerCenter),this._rightCenter=new BK.Sprite(r.right,t-r.bottom-r.top,i,0,1,1,1),this._rightCenter.position={x:e-r.right,y:r.bottom},this._rightCenter.name="_rightCenter",this.__nativeObj.addChild(this._rightCenter),this._leftBottom=new BK.Sprite(r.left,r.bottom,i,0,1,1,1),this._leftBottom.position={x:0,y:0},this._leftBottom.name="_leftBottom",this.__nativeObj.addChild(this._leftBottom),this._centerBottom=new BK.Sprite(e-r.left-r.right,r.bottom,i,0,1,1,1),this._centerBottom.position={x:r.left,y:0},this._centerBottom.name="_centerBottom",this.__nativeObj.addChild(this._centerBottom),this._rightBottom=new BK.Sprite(r.right,r.bottom,i,0,1,1,1),this._rightBottom.position={x:e-r.right,y:0},this._rightBottom.name="_rightBottom",this.__nativeObj.addChild(this._rightBottom),1==o?(this._leftTop.adjustTexturePosition(n.x+(t-r.top),n.y+(e-r.left),r.left,r.top,o),this._centerTop.adjustTexturePosition(n.x+(t-r.top),n.y+r.right,e-r.left-r.right,r.top,o),this._rightTop.adjustTexturePosition(n.x+(t-r.top),n.y,r.right,r.top,o),this._leftCenter.adjustTexturePosition(n.x+r.bottom,n.y+(e-r.left),r.left,t-r.top-r.bottom,o),this._centerCenter.adjustTexturePosition(n.x+r.bottom,n.y+r.right,e-r.left-r.right,t-r.top-r.bottom,o),this._rightCenter.adjustTexturePosition(n.x+r.bottom,n.y,r.right,t-r.bottom-r.top,o),this._leftBottom.adjustTexturePosition(n.x,n.y+(e-r.left),r.left,r.bottom,o),this._centerBottom.adjustTexturePosition(n.x,n.y+r.right,e-r.left-r.right,r.bottom,o),this._rightBottom.adjustTexturePosition(n.x,n.y,r.right,r.bottom,o)):(this._leftTop.adjustTexturePosition(0+n.x,t-r.top+n.y,r.left,r.top),this._centerTop.adjustTexturePosition(r.left+n.x,t-r.top+n.y,e-r.left-r.right,r.top),this._rightTop.adjustTexturePosition(e-r.right+n.x,t-r.top+n.y,r.right,r.top),this._leftCenter.adjustTexturePosition(0+n.x,r.bottom+n.y,r.left,t-r.top-r.bottom),this._centerCenter.adjustTexturePosition(r.left+n.x,r.bottom+n.y,e-r.left-r.right,t-r.top-r.bottom),this._rightCenter.adjustTexturePosition(e-r.right+n.x,r.bottom+n.y,r.right,t-r.bottom-r.top),this._leftBottom.adjustTexturePosition(0+n.x,0+n.y,r.left,r.bottom),this._centerBottom.adjustTexturePosition(r.left+n.x,0+n.y,e-r.left-r.right,r.bottom),this._rightBottom.adjustTexturePosition(e-r.right+n.x,0+n.y,r.right,r.bottom))}return e.prototype.onInit=function(){Object.getOwnPropertyNames(this.__nativeObj).forEach(function(e){var t=e;"size"!=t&&Object.defineProperty(this,t,{get:function(){return this.__nativeObj[t]},set:function(e){this.__nativeObj[t]=e}})},this)},Object.defineProperty(e.prototype,"alpha",{get:function(){return this._rightBottom.vertexColor.a},set:function(e){this._leftTop.vertexColor={r:1,g:1,b:1,a:e},this._centerTop.vertexColor={r:1,g:1,b:1,a:e},this._rightTop.vertexColor={r:1,g:1,b:1,a:e},this._leftCenter.vertexColor={r:1,g:1,b:1,a:e},this._centerCenter.vertexColor={r:1,g:1,b:1,a:e},this._rightCenter.vertexColor={r:1,g:1,b:1,a:e},this._leftBottom.vertexColor={r:1,g:1,b:1,a:e},this._centerBottom.vertexColor={r:1,g:1,b:1,a:e},this._rightBottom.vertexColor={r:1,g:1,b:1,a:e}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},set:function(e){this._size=e;var t=e.width-this._grid.left-this._grid.right,i=e.height-this._grid.top-this._grid.bottom;this._leftTop.position={x:0,y:e.height-this._grid.top},this._leftCenter.size={width:this._grid.left,height:i},this._leftCenter.position={x:0,y:this._grid.bottom},this._rightCenter.size={width:this._grid.right,height:i},this._rightCenter.position={x:e.width-this._grid.right,y:this._grid.bottom},this._centerCenter.size={width:t,height:i},this._centerTop.size={width:t,height:this._grid.top},this._centerTop.position={x:this._grid.left,y:e.height-this._grid.top},this._centerBottom.size={width:t,height:this._grid.bottom},this._centerBottom.position={x:this._grid.left,y:0},this._rightCenter.size={width:this._grid.right,height:i},this._rightCenter.position={x:e.width-this._grid.right,y:this._grid.bottom},this._rightBottom.position={x:e.width-this._grid.right,y:0},this._rightTop.position={x:e.width-this._grid.right,y:e.height-this._grid.top}},enumerable:!0,configurable:!0}),e.prototype.pos=function(e,t){this.__nativeObj.position={x:e,y:t}},e.prototype.dispose=function(){this.__nativeObj.dispose()},e.prototype.attachBody=function(e){this.__nativeObj.attachComponent(e)},e.prototype.addChild=function(e){this.__nativeObj.addChild(e)},e.prototype.removeChildById=function(e,t){return this.__nativeObj.removeChildById(e,t)},e.prototype.removeChildByName=function(e,t){return this.__nativeObj.removeChildByName(e,t)},e.prototype.removeFromParent=function(){return this.__nativeObj.removeFromParent()},e.prototype.hittest=function(e){return this.__nativeObj.hittest(e)},e}();BK.SpriteSheetCache||(BK.SpriteSheetCache=new SpriteSheetCache),BK.Sprite9||(BK.Sprite9=Sprite9),function(e,t){"object"==typeof e&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.AnimatedSprite=t())}(BK,function(){return function(){function e(e){this.paused=!1,this.delayUnits=1/30,this.tmpPlayingIdx=0,this.previousTs=-1,this.playedCount=0,this.size={width:0,height:0},this.readyTextureInfo(e),this.onInit(this.size.width,this.size.height),this.displayFrame(0),this.paused=!0,BK.Director.ticker.add(function(e,t,i){i.update(e,t)},this)}return e.prototype.onInit=function(e,t){this.createSprites(e,t),Object.getOwnPropertyNames(this.__nativeObj).forEach(function(e){var t=e;Object.defineProperty(this,t,{get:function(){return this.__nativeObj[t]},set:function(e){this.__nativeObj[t]=e}})},this),Object.defineProperty(this,"size",{get:function(){return this.__nativeObj.contentSize},set:function(e){this.__nativeObj.contentSize=e,this.displayFrame(this.currDisplayIdx)}}),Object.defineProperty(this,"anchor",{get:function(){return this.__nativeObj.localAnchor},set:function(e){this.__nativeObj.localAnchor=e,this.displayFrame(this.currDisplayIdx)}})},e.prototype.setTexture=function(e){this.__nativeObj.setTexture(e)},e.prototype.dispose=function(){BK.Director.ticker.remove(this),this.__nativeObj.dispose()},e.prototype.removeChild=function(e){return this.__nativeObj.removeChild(e)},e.prototype.removeChildById=function(e,t){return this.__nativeObj.removeChildById(e,t)},e.prototype.removeChildByName=function(e,t){return this.__nativeObj.removeChildByName(e,t)},e.prototype.removeFromParent=function(){return this.__nativeObj.removeFromParent()},e.prototype.addChild=function(e,t){return this.__nativeObj.addChild(e,t)},e.prototype.hittest=function(e){return this.__nativeObj.hittest(e)},e.prototype.convertToWorldSpace=function(e){return this.__nativeObj.convertToWorldSpace(e)},e.prototype.convertToNodeSpace=function(e){return this.__nativeObj.convertToNodeSpace(e)},e.prototype.createSprites=function(e,t){this.__nativeObj=new BK.SpriteNode(e,t,{},0,1,1,1),this.contentSprite=new BK.SpriteNode(e,t,{},0,1,1,1),this.__nativeObj.addChild(this.contentSprite)},e.prototype.readyTextureInfo=function(e){var t=this;this.textureInfoArr=[],e.forEach(function(e){e.texturePath&&(e.texture=new BK.Texture(e.texturePath),t.textureInfoArr.push(e),t.size={width:e.frameInfo.sourceSize.w,height:e.frameInfo.sourceSize.h})})},e.prototype.displayFrame=function(e){if(this.textureInfoArr.length>0){var t=this.textureInfoArr[e];if(t){this.currDisplayIdx=e;var i=t.texture,r=t.frameInfo;if(1==t.frameInfo.trimmed){var n=t.frameInfo.spriteSourceSize.x,o=t.frameInfo.spriteSourceSize.y,a=t.frameInfo.spriteSourceSize.w,s=t.frameInfo.spriteSourceSize.h,h=t.frameInfo.sourceSize,c=this.__nativeObj.contentSize;n=c.width*n/h.w,o=c.height*o/h.h,a=c.width*a/h.w,s=c.height*s/h.h,this.contentSprite.position={x:n,y:o},this.contentSprite.contentSize={width:a,height:s}}else this.contentSprite.contentSize=this.__nativeObj.contentSize;this.currTexturePath&&this.currTexturePath==t.texturePath||(BK.Script.log(1,-1,"this.currTexture != tex"),this.currTexturePath=t.texturePath,this.contentSprite.setTexture(i)),this.contentSprite.adjustTexturePosition(r.frame.x,r.frame.y,r.frame.w,r.frame.h,r.rotated)}else BK.Script.log(1,-1,"displayFrame failed! textureInfo is null. index is "+e)}else BK.Script.log(1,-1,"displayFrame failed! textureInfoArr.length is 0")},e.prototype.render=function(){this.tmpPlayingIdx>this.textureInfoArr.length-1&&(this.tmpPlayingIdx=0),this.displayFrame(this.tmpPlayingIdx),this.tmpPlayingIdx++,this.currDisplaySum++,this.updateCallback()},e.prototype.update=function(e,t){0==this.paused&&(this.previousTs<0?(this.previousTs=e,this.render()):e-this.previousTs>1e3*this.delayUnits&&(this.previousTs=e,this.render()))},e.prototype.play=function(e,t){void 0===e&&(e=0),void 0===t&&(t=-1),e>this.textureInfoArr.length-1?this.tmpPlayingIdx=0:this.tmpPlayingIdx=e,this.paused=!1,this.repeatCount=t,this.currDisplaySum=0,this.playedCount=0},e.prototype.stop=function(e){void 0===e&&(e=-1),this.paused=!0,e>-1&&this.displayFrame(e)},e.prototype.updateCallback=function(){var e=this.textureInfoArr.length;this.currDisplaySum%e==0&&(this.playedCount=parseInt(String(this.currDisplaySum/e)),this.completeCallback&&this.completeCallback(this,this.playedCount),this.repeatCount>0&&this.repeatCount<=this.playedCount&&(this.endCallback&&this.endCallback(this,this.playedCount),this.stop()))},e.prototype.setCompleteCallback=function(e){this.completeCallback=e},e.prototype.setEndCallback=function(e){this.endCallback=e},e}()}),Canvas.prototype.setImagePath=function(e){if(e){this.imagePath=e;var t=new BK.Texture(e);this.__nativeObj.setTexture(t)}},Canvas.prototype.getImagePath=function(){return this.imagePath},Canvas.prototype.setTexture=function(e){this.__nativeObj.setTexture(e)},Canvas.prototype.setFlipXY=function(e,t){this.__nativeObj.setUVFlip(e,t)},Canvas.prototype.setUVFlip=function(e,t){this.__nativeObj.setUVFlip(e,t)},Canvas.prototype.setUVWrap=function(e,t){this.__nativeObj.setUVWrap(e,t)},Canvas.prototype.setXYStretch=function(e,t){this.__nativeObj.setXYStretch(e,t)},Canvas.prototype.adjustTexturePosition=function(e,t,i,r,n){this.__nativeObj.adjustTexturePosition(e,t,i,r,n)},Canvas.prototype.addChild=function(e){return this.__nativeObj.addChild(e)},Canvas.prototype.dispose=function(){return this.__nativeObj.dispose()},Canvas.prototype.removeChild=function(e){return this.__nativeObj.removeChild(e)},Canvas.prototype.removeChildById=function(e){return this.__nativeObj.removeChildById(e)},Canvas.prototype.removeChildByName=function(e){return this.__nativeObj.removeChildByName(e)},Canvas.prototype.removeChildByTag=function(e){return this.__nativeObj.removeChildByTag(e)},Canvas.prototype.queryChildAtIndex=function(e){return this.__nativeObj.queryChildAtIndex(e)},Canvas.prototype.queryChildById=function(e){return this.__nativeObj.queryChildById(e)},Canvas.prototype.queryChildByName=function(e){return this.__nativeObj.queryChildByName(e)},Canvas.prototype.queryChildByTag=function(e){return this.__nativeObj.queryChildByTag(e)},Canvas.prototype.getChildCount=function(){return this.__nativeObj.getChildCount()},Canvas.prototype.removeFromParent=function(){return this.__nativeObj.removeFromParent()},Canvas.prototype.attachComponent=function(e){return this.__nativeObj.attachComponent(e)},Canvas.prototype.detachComponent=function(e){return this.__nativeObj.detachComponent(e)},Canvas.prototype.queryComponent=function(e){return this.__nativeObj.queryComponent(e)},Canvas.prototype.queryComponentList=function(e){return this.__nativeObj.queryComponentList(e)},Canvas.prototype.hittest=function(e){return this.__nativeObj.hittest(e)},Canvas.prototype.isEqual=function(e){return this.__nativeObj.isEqual(e)},Canvas.prototype.convertToWorldSpace=function(e){return this.__nativeObj.convertToWorldSpace(e)},Canvas.prototype.convertToNodeSpace=function(e){return this.__nativeObj.convertToNodeSpace(e)},Canvas.prototype.setAtlas=function(e,t){if(this.__nativeObj){BK.CanvasSheetCache.loadSheet(e);var i=BK.CanvasSheetCache.getTexturePathByFilename(t),r=new BK.Texture(i);this.__nativeObj.setTexture(r);var n=BK.CanvasSheetCache.getFrameInfoByFilename(t);this.__nativeObj.adjustTexturePosition(n.frame.x,n.frame.y,n.frame.w,n.frame.h,n.rotated)}return 0},Canvas.prototype.useH5Mode=function(){return this.__nativeObj?(this._useH5Mode=1,1==arguments.length?(this._useH5Mode=arguments[0],this.__nativeObj.useH5Mode(arguments[0])):this.__nativeObj.useH5Mode()):0},Canvas.prototype.drawCircle=function(){return this.__nativeObj?this.__nativeObj.drawCircle(arguments[0],arguments[1],arguments[2]):0},Canvas.prototype.drawEllipse=function(){return this.__nativeObj?this.__nativeObj.drawEllipse(arguments[0],arguments[1],arguments[2],arguments[3]):0},Canvas.prototype.drawImage=function(){if(this.__nativeObj){var e=arguments.length;if(9==e)this.__nativeObj.drawImage(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8]);else if(5==e)this.__nativeObj.drawImage(arguments[0],0,0,0,0,arguments[1],arguments[2],arguments[3],arguments[4]);else{if(3!=e)return;this.__nativeObj.drawImage(arguments[0],0,0,0,0,arguments[1],arguments[2],0,0)}this._innerSetTransform()}return 0},Canvas.prototype.fill=function(){return this.__nativeObj?this.__nativeObj.fill():0},Canvas.prototype.stroke=function(){return this.__nativeObj?this.__nativeObj.stroke():0},Canvas.prototype.rect=function(){return this.__nativeObj?this.__nativeObj.rect(arguments[0],arguments[1],arguments[2],arguments[3]):0},Canvas.prototype.fillRect=function(){return this.__nativeObj?this.__nativeObj.fillRect(arguments[0],arguments[1],arguments[2],arguments[3]):0},Canvas.prototype.strokeRect=function(){return this.__nativeObj?this.__nativeObj.strokeRect(arguments[0],arguments[1],arguments[2],arguments[3]):0},Canvas.prototype.clearRect=function(){return this.__nativeObj?this.__nativeObj.clearRect(arguments[0],arguments[1],arguments[2],arguments[3]):0},Canvas.prototype.beginPath=function(){return this.__nativeObj?this.__nativeObj.beginPath():0},Canvas.prototype.closePath=function(){return this.__nativeObj?this.__nativeObj.closePath():0},Canvas.prototype.moveTo=function(){return this.__nativeObj?this.__nativeObj.moveTo(arguments[0],arguments[1]):0},Canvas.prototype.lineTo=function(){return this.__nativeObj?this.__nativeObj.lineTo(arguments[0],arguments[1]):0},Canvas.prototype.arcTo=function(){return this.__nativeObj?this.__nativeObj.arcTo(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]):0},Canvas.prototype.arc=function(){if(this.__nativeObj){var e=arguments.length;if(5==e)return this.__nativeObj.arc(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);if(6==e)return this.__nativeObj.arc(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])}return 0},Canvas.prototype.quadraticCurveTo=function(){return this.__nativeObj?this.__nativeObj.quadraticCurveTo(arguments[0],arguments[1],arguments[2],arguments[3]):0},Canvas.prototype.bezierCurveTo=function(){return this.__nativeObj?this.__nativeObj.bezierCurveTo(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]):0},Canvas.prototype.save=function(){return this.__nativeObj?this.__nativeObj.save():0},Canvas.prototype.restore=function(){return this.__nativeObj?this.__nativeObj.restore():0},Canvas.prototype.fillText=function(){if(3==arguments.length){var e=this.measureText(arguments[0],2048,1024),t=arguments[1],i=arguments[2];switch(1==this._useH5Mode?2-this._textBaseLine:this._textBaseLine){case 1:i-=.5*e.height;break;case 2:i-=1*e.height}switch(this._textAlign){case 1:t-=.5*e.width;break;case 2:t-=1*e.width}this.__nativeObj.fillText(arguments[0],t,i,Math.min(2048,e.width),Math.min(1024,e.height)),this._innerSetTransform()}return 0},Canvas.prototype.clip=function(){return this.__nativeObj?this.__nativeObj.clip():0},Canvas.prototype.isPointInPath=function(){if(this.__nativeObj)return this.__nativeObj.isPointInPath(arguments[0],arguments[1])},Canvas.prototype.createImageData=function(){var e=arguments.length;if(this.__nativeObj&&2==e){var t=new BK.Buffer(arguments[0]*arguments[1]*4);return t.__inner_image_width=arguments[0],t.__inner_image_height=arguments[1],t}},Canvas.prototype.getImageData=function(){var e=arguments.length;if(this.__nativeObj&&4==e){var t=this.__nativeObj.getImageData(arguments[0],arguments[1],arguments[2],arguments[3]);return t.__inner_image_width=arguments[2],t.__inner_image_height=arguments[3],t}},Canvas.prototype.putImageData=function(){var e=arguments.length;if(this.__nativeObj&&3==e){var t=arguments[0],i=arguments[1],r=arguments[2];t instanceof ArrayBuffer&&(t=BK.Util.Buffer.typedArrayToBKBuffer(new Uint8Array(t)),arguments[0]=t);var n=t.__inner_image_width,o=t.__inner_image_height;return this.__nativeObj.putImageData(arguments[0],i,r,n,o)}},Canvas.prototype.scale=function(){if(this.__nativeObj)return BK.Script.log(0,0,"bk.canvas. scale  :"+arguments[0]+" , "+arguments[1]),this.__nativeObj.scales(arguments[0],arguments[1])},Canvas.prototype.scales=function(){if(this.__nativeObj)return BK.Script.log(0,0,"bk.canvas. scales  :"+arguments[0]+" , "+arguments[1]),this.__nativeObj.scales(arguments[0],arguments[1])},Canvas.prototype.rotate=function(){if(this.__nativeObj)return BK.Script.log(0,0,"bk.canvas. rotate  :"+arguments[0]),this.__nativeObj.rotate(arguments[0])},Canvas.prototype.translate=function(){if(this.__nativeObj){var e=GameStatusInfo.QQVer.split(".");7==Number(e[0])&&Number(7==e[1]&&Number(e[2])<=5)?(this._tx=arguments[0],this._ty=arguments[1],this._innerSetTransform()):this.__nativeObj.translate(arguments[0],arguments[1])}},Canvas.prototype.transform=function(){if(this.__nativeObj)return this.__nativeObj.transforms(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},Canvas.prototype.transforms=function(){return this.setTransform(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},Canvas.prototype.setTransform=function(){if(this.__nativeObj){var e=GameStatusInfo.QQVer.split(".");if(Number(e[0])<7||7==Number(e[0])&&Number(e[1])<7){if("ios"==GameStatusInfo.platform){var t=inverseMatrix(this._a,this._b,this._c,this._d,this._tx,this._ty);this.__nativeObj.transforms(t[0],t[1],t[2],t[3],t[4],t[5])}return this._a=arguments[0],this._b=arguments[1],this._c=arguments[2],this._d=arguments[3],this._tx=arguments[4],this._ty=arguments[5],this.__nativeObj.transforms(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])}return this._a=arguments[0],this._b=arguments[1],this._c=arguments[2],this._d=arguments[3],this._tx=arguments[4],this._ty=arguments[5],this.__nativeObj.setTransform(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])}},Canvas.prototype._innerSetTransform=function(){if(this.__nativeObj){var e=GameStatusInfo.QQVer.split(".");if(7==Number(e[0])&&Number(7==e[1]&&Number(e[2])<=5))return this.__nativeObj.setTransform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},Canvas.prototype.shadowColor=function(){if(this._shadowColor=arguments[0],this.__nativeObj)return this.__nativeObj.setTextShadow(this._shadowOffset.x,this._shadowOffset.y,this._shadowRadius,this._shadowColor)},Canvas.prototype.shadowRadius=function(){if(this._shadowRadius=arguments[0],this.__nativeObj)return this.__nativeObj.setTextShadow(this._shadowOffset.x,this._shadowOffset.y,this._shadowRadius,this._shadowColor)},Canvas.prototype.shadowOffsetX=function(){if(this._shadowOffset.x=arguments[0],this.__nativeObj)return this.__nativeObj.setTextShadow(this._shadowOffset.x,this._shadowOffset.y,this._shadowRadius,this._shadowColor)},Canvas.prototype.shadowOffsetY=function(){if(this._shadowOffset.y=arguments[0],this.__nativeObj)return this.__nativeObj.setTextShadow(this._shadowOffset.x,this._shadowOffset.y,this._shadowRadius,this._shadowColor)},Canvas.prototype.clear=function(){if(this.__nativeObj)return this.__nativeObj.clear()},Canvas.prototype.getTexture=function(){return this.__nativeObj?this.__nativeObj.getTexture():null},Canvas.prototype.drawText=function(){return this.__nativeObj&&(this.__nativeObj.drawText(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]),this._innerSetTransform()),null},Canvas.prototype.setTextSize=function(){return this.__nativeObj?this.__nativeObj.setTextSize(arguments[0]):null},Canvas.prototype.setTextAlign=function(){if(this.__nativeObj){switch(arguments[0]){case 0:case 1:case 2:this._textAlign=arguments[0];break;case"left":this._textAlign=0;break;case"center":this._textAlign=1;break;case"right":this._textAlign=2}return this.__nativeObj.setTextAlign(this._textAlign)}return null},Canvas.prototype.setTextBold=function(){return this.__nativeObj?this.__nativeObj.setTextBold(arguments[0]):null},Canvas.prototype.setTextItalic=function(){return this.__nativeObj?this.__nativeObj.setTextItalic(arguments[0]):null},Canvas.prototype.measureText=function(){return this.__nativeObj?this.__nativeObj.measureText(arguments[0],arguments[1],arguments[2]):null},Canvas.prototype.updateCanvasTexture=function(){return this.__nativeObj?this.__nativeObj.updateCanvasTexture():null},Canvas.prototype.saveTo=function(){var e=arguments.length;return this.__nativeObj&&1==e&&this.__nativeObj.saveTo(arguments[0]),null},Canvas.prototype.toDataURL=function(){if(this.__nativeObj){var e="GameSandBox://cmdataUrltest.png";this.__nativeObj.saveTo(e);var t=BK.FileUtil.readFile(e);BK.FileUtil.deleteFile(e);var i=BK.Misc.encodeBase64FromBuffer(t);return i&&(i="data:image/png;base64,"+i),i}return""},BK.Canvas=Canvas,BK.Script.log(0,0,"Load Canvas.js succeed."),BK.Sprite.__proto__.setImagePath=function(e){if(e){this.imagePath=e;var t=new BK.Texture(e);this.setTexture(t)}},BK.Sprite.__proto__.getImagePath=function(){return this.imagePath},BK.Sprite.__proto__.setAtlas=function(e,t){BK.SpriteSheetCache.loadSheet(e);var i=BK.SpriteSheetCache.getTexturePathByFilename(t),r=new BK.Texture(i);this.setTexture(r);var n=BK.SpriteSheetCache.getFrameInfoByFilename(t);return this.adjustTexturePosition(n.frame.x,n.frame.y,n.frame.w,n.frame.h,n.rotated),0},BK.Script.log(0,0,"Load Sprite.js succeed.");var gl;if(BK.ScreenShot=function(){function e(){if(void 0==o){"android"==GameStatusInfo.platform&&(o=!0);var e=BK.Director.queryDeviceInfo(),t=e.version.split(".");"ios"==e.platform&&Number(t[0])>=10||"android"==e.platform?o=!0:(BK.Script.log(1,0,"Current Device dont supoort TypedArray.[info = "+JSON.stringify(e)+"]"),o=!1)}return o}function t(t){if(Object.prototype.hasOwnProperty.call(t,"__rawBKData"))return t.__rawBKData;if(Object.prototype.hasOwnProperty.call(t,"__nativeObj"))return t.__nativeObj;if(0==e()){if(t instanceof Uint16Array==1){for(var i=new BK.Buffer(t.byteLength,!1),r=0;r<t.length;r++)i.writeUint16Buffer(t[r]);return i}if(t instanceof Float32Array==1){for(var i=new BK.Buffer(t.byteLength,!1),r=0;r<t.length;r++)i.writeFloatBuffer(t[r]);return i}}return t}function i(){var e=gl.glCreateShader(gl.VERTEX_SHADER);0!=e&&(gl.glShaderSource(e,"attribute vec2 pos; attribute vec2 inUVs; varying lowp vec2 outUVs; void main() { gl_Position = vec4(pos, 0, 1); outUVs = inUVs; }"),gl.glCompileShader(e));var t=gl.glCreateShader(gl.FRAGMENT_SHADER);0!=t&&(gl.glShaderSource(t,"varying lowp vec2 outUVs; uniform sampler2D uSampler; void main() { gl_FragColor = texture2D(uSampler, outUVs); }"),gl.glCompileShader(t));var i=gl.glCreateProgram();return gl.glAttachShader(i,e),gl.glAttachShader(i,t),gl.glLinkProgram(i),gl.glDeleteShader(e),gl.glDeleteShader(t),i}function r(e,t){gl.glActiveTexture(gl.TEXTURE1);var i=gl.glCreateTexture(),r=gl.glGetParameterInt(gl.TEXTURE_BINDING_2D,1);gl.glBindTexture(gl.TEXTURE_2D,i),gl.glTexParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.glTexParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.glTexParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.glTexParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.glTexImage2D(gl.TEXTURE_2D,0,gl.RGBA,e,t,0,gl.RGBA,gl.UNSIGNED_BYTE,null);var n=gl.glCreateFramebuffer();gl.glBindFramebuffer(gl.FRAMEBUFFER,n),gl.glFramebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,i,0);var o=gl.glCheckFramebufferStatus(gl.FRAMEBUFFER);return o!=gl.FRAMEBUFFER_COMPLETE&&BK.Script.log(1,-1,"_createFramebuffer!failed, status = "+o),gl.glActiveTexture(gl.TEXTURE1),gl.glBindTexture(gl.TEXTURE_2D,r),{tex:i,fbo:n}}function n(e){var n=i();gl.glUseProgram(n);var o=gl.glGetAttribLocation(n,"pos"),a=gl.glGetAttribLocation(n,"inUVs"),s=gl.glGetUniformLocation(n,"uSampler");gl.glActiveTexture(gl.TEXTURE0);var h=gl.glCreateTexture(),c=gl.glGetParameterInt(gl.TEXTURE_BINDING_2D,1);gl.glBindTexture(gl.TEXTURE_2D,h),gl.glTexParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.glTexParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.glTexParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.glTexParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.glTexImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,e),gl.glUniform1i(s,0);var l=gl.glGetParameterInt(gl.ARRAY_BUFFER_BINDING,1),u=gl.glGetParameterInt(gl.ELEMENT_ARRAY_BUFFER_BINDING,1),d=new Float32Array([-1,-1,0,1,1,-1,1,1,1,1,1,0,-1,1,0,0]),_=gl.glCreateBuffer();gl.glBindBuffer(gl.ARRAY_BUFFER,_),gl.glEnableVertexAttribArray(o),gl.glVertexAttribPointer(o,2,gl.FLOAT,!1,16,0),gl.glVertexAttribPointer(a,2,gl.FLOAT,!1,16,8),gl.glBufferData(gl.ARRAY_BUFFER,t(d),gl.STATIC_DRAW);var f=new Uint16Array([0,1,2,0,2,3]),g=gl.glCreateBuffer();gl.glBindBuffer(gl.ELEMENT_ARRAY_BUFFER,g),gl.glBufferData(gl.ELEMENT_ARRAY_BUFFER,t(f),gl.STATIC_DRAW);var p=new BK.Buffer(e.width*e.height*4),m=gl.glGetParameterInt(gl.FRAMEBUFFER_BINDING,1),v=r(e.width,e.height);gl.glClearColor(1,1,1,1),gl.glClear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT|gl.STENCIL_BUFFER_BIT),gl.glDrawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0),gl.glReadPixels(0,0,e.width,e.height,gl.RGBA,gl.UNSIGNED_BYTE,p),gl.glBindFramebuffer(gl.FRAMEBUFFER,m);for(var S=0,b=1;b<=10;b++){gl.glUseProgram(b);var T=gl.glGetAttribLocation(b,"Position"),B=gl.glGetAttribLocation(b,"SourceColor"),E=gl.glGetAttribLocation(b,"TexCoordIn");if(-1!=T&&-1!=B&&-1!=E){S=1;break}}return gl.glBindBuffer(gl.ARRAY_BUFFER,l),1==S?(gl.glEnableVertexAttribArray(T),gl.glEnableVertexAttribArray(B),gl.glEnableVertexAttribArray(E),gl.glVertexAttribPointer(T,3,gl.FLOAT,!1,36,0),gl.glVertexAttribPointer(B,4,gl.FLOAT,!1,36,12),gl.glVertexAttribPointer(E,2,gl.FLOAT,!1,36,28)):(gl.glEnableVertexAttribArray(0),gl.glEnableVertexAttribArray(1),gl.glEnableVertexAttribArray(2),gl.glVertexAttribPointer(0,3,gl.FLOAT,!1,36,0),gl.glVertexAttribPointer(1,4,gl.FLOAT,!1,36,12),gl.glVertexAttribPointer(2,2,gl.FLOAT,!1,36,28)),gl.glBindBuffer(gl.ELEMENT_ARRAY_BUFFER,u),gl.glActiveTexture(gl.TEXTURE0),gl.glBindTexture(gl.TEXTURE_2D,c),gl.glDeleteProgram(n),gl.glDeleteTexture(h),gl.glDeleteTexture(v.tex),gl.glDeleteFramebuffer(v.fbo),p}if(this.origin={x:0,y:0},this.size={width:0,height:0},GameStatusInfo){BK.Misc.compQQVersion||(BK.Misc.compQQVersion=function(e,t){for(var i=e.split("."),r=t.split("."),n=Math.min(3,Math.min(i.length,r.length)),o=0;o<n;o++)if(i[o]!=r[o])return i[o]<r[o];return!0});var o;gl||(gl=new BK.WebGL,function(){gl.DEPTH_BUFFER_BIT=256,gl.STENCIL_BUFFER_BIT=1024,gl.COLOR_BUFFER_BIT=16384,gl.TRIANGLES=4,gl.TEXTURE_BINDING_2D=32873,gl.ARRAY_BUFFER=34962,gl.ARRAY_BUFFER_BINDING=34964,gl.ELEMENT_ARRAY_BUFFER=34963,gl.ELEMENT_ARRAY_BUFFER_BINDING=34965,gl.STATIC_DRAW=35044,gl.UNSIGNED_BYTE=5121,gl.UNSIGNED_SHORT=5123,gl.FLOAT=5126,gl.RGBA=6408,gl.FRAGMENT_SHADER=35632,gl.VERTEX_SHADER=35633,gl.LINK_STATUS=35714,gl.CURRENT_PROGRAM=35725,gl.NEAREST=9728,gl.LINEAR=9729,gl.TEXTURE_MAG_FILTER=10240,gl.TEXTURE_MIN_FILTER=10241,gl.TEXTURE_WRAP_S=10242,gl.TEXTURE_WRAP_T=10243,gl.TEXTURE_2D=3553,gl.TEXTURE0=33984,gl.TEXTURE1=33985,gl.ACTIVE_TEXTURE=34016,gl.REPEAT=10497,gl.CLAMP_TO_EDGE=33071,gl.MIRRORED_REPEAT=33648,gl.FRAMEBUFFER=36160,gl.RENDERBUFFER=36161,gl.COLOR_ATTACHMENT0=36064,gl.DEPTH_ATTACHMENT=36096,gl.STENCIL_ATTACHMENT=36128,gl.NONE=0,gl.FRAMEBUFFER_COMPLETE=36053,gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,gl.FRAMEBUFFER_UNSUPPORTED=36061,gl.FRAMEBUFFER_BINDING=36006,gl.RENDERBUFFER_BINDING=36007,gl.INVALID_FRAMEBUFFER_OPERATION=1286}()),BK.Misc.compQQVersion(GameStatusInfo.QQVer,"7.6.1")&&(this.doImage_rotate180=n),BK.Misc.compQQVersion(GameStatusInfo.QQVer,"7.6.1")&&(this.bufferFromScreenShot_760=function(e,t,i,r,n){var o=gl.glCreateTexture();gl.glActiveTexture(gl.TEXTURE1),gl.glBindTexture(gl.TEXTURE_2D,o),gl.glTexParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.glTexParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.glTexParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.glTexParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.glTexImage2D(gl.TEXTURE_2D,0,gl.RGBA,BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height,0,gl.RGBA,gl.UNSIGNED_BYTE,null);var a=gl.glGetParameterInt(gl.FRAMEBUFFER_BINDING,1),s=gl.glGetParameterInt(gl.RENDERBUFFER_BINDING,1),h=gl.glCreateRenderbuffer();gl.glBindRenderbuffer(gl.RENDERBUFFER,h),gl.glRenderbufferStorage(gl.RENDERBUFFER,35056,BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height),gl.glBindRenderbuffer(gl.RENDERBUFFER,s);var c=gl.glCreateFramebuffer();gl.glBindFramebuffer(gl.FRAMEBUFFER,c),gl.glFramebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,o,0),gl.glFramebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,h),gl.glFramebufferRenderbuffer(gl.FRAMEBUFFER,gl.STENCIL_ATTACHMENT,gl.RENDERBUFFER,h);var l,u=gl.glCheckFramebufferStatus(gl.FRAMEBUFFER);return u==gl.FRAMEBUFFER_COMPLETE?(BK.Render.render(e,0),l=new BK.Buffer(r*n*4),gl.glReadPixels(t,i,r,n,gl.RGBA,gl.UNSIGNED_BYTE,l)):BK.Script.log(1,-1,"bufferFromScreenShot_760!framebuffer failed, code = "+u),gl.glBindFramebuffer(gl.FRAMEBUFFER,a),gl.glDeleteTexture(o),gl.glDeleteRenderbuffer(h),gl.glDeleteFramebuffer(c),l})}this.isInScreen=function(){(void 0==this.origin.x||this.origin.x<0||this.origin.x>BK.Director.screenPixelSize.width)&&(this.origin.x=0),(void 0==this.origin.y||this.origin.y<0||this.origin.y>BK.Director.screenPixelSize.height)&&(this.origin.y=0),(void 0==this.size.width||this.size.width<=0||this.size.width>BK.Director.screenPixelSize.width-this.origin.x)&&(this.origin.x=0,this.size.width=BK.Director.screenPixelSize.width),(void 0==this.size.height||this.size.height<=0||this.size.height>BK.Director.screenPixelSize.height-this.origin.y)&&(this.origin.y=0,this.size.height=BK.Director.screenPixelSize.height)},this.isInNode=function(e){(void 0==this.origin.x||this.origin.x<0||this.origin.x>e.contentSize.width)&&(this.origin.x=0),(void 0==this.origin.y||this.origin.y<0||this.origin.y>e.contentSize.height)&&(this.origin.y=0),(void 0==this.size.width||this.size.width<=0)&&(this.size.width=e.contentSize.width),(void 0==this.size.height||this.size.height<=0)&&(this.size.height=e.contentSize.height)},this.saveImage=function(e,t,i){GameStatusInfo&&BK.Misc.compQQVersion(GameStatusInfo.QQVer,"7.6.1")?(e=this.doImage_rotate180({buffer:e,width:this.size.width,height:this.size.height}),BK.Image.saveImage(e,this.size.width,this.size.height,t,i)):BK.Image.saveImage(e,this.size.width,this.size.height,t,i,1)},this.shotToFile=function(e,t){this.isInScreen();var i="";if(this.bufferFromScreenShot_760){var r=this.bufferFromScreenShot_760(BK.Director.root,this.origin.x,this.origin.y,this.size.width,this.size.height);void 0!=r&&(i="GameSandBox://"+e,this.saveImage(r,i,t))}else{i="GameSandBox://"+e+"."+t;var n=new BK.RenderTexture(BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height);BK.Render.renderToTexture(BK.Director.root,n),n.writeToDiskWithXY(i,this.origin.x,this.origin.y,this.size.width,this.size.height)}return i},this.shotToBuff=function(){if(this.isInScreen(),this.bufferFromScreenShot_760)return this.bufferFromScreenShot_760(BK.Director.root,this.origin.x,this.origin.y,this.size.width,this.size.height);var e=new BK.RenderTexture(BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height);return BK.Render.renderToTexture(BK.Director.root,e),e.readPixels(this.origin.x,this.origin.y,this.size.width,this.size.height)},this.shotToFileFromNode=function(e,t,i){this.isInNode(e);var r="";if(this.bufferFromScreenShot_760){var n=this.bufferFromScreenShot_760(e,this.origin.x+e.position.x,this.origin.y+e.position.y,this.size.width,this.size.height);void 0!=n&&(r="GameSandBox://"+t,this.saveImage(n,r,i))}else{r="GameSandBox://"+t+"."+i;var o=new BK.RenderTexture(BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height);BK.Render.renderToTexture(e,o),o.writeToDiskWithXY(r,this.origin.x+e.position.x,this.origin.y+e.position.y,this.size.width,this.size.height)}return r},this.shotToBuffFromNode=function(e){if(this.isInNode(e),this.bufferFromScreenShot_760)return this.bufferFromScreenShot_760(e,this.origin.x+e.position.x,this.origin.y+e.position.y,this.size.width,this.size.height);var t=new BK.RenderTexture(BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height);return BK.Render.renderToTexture(e,t),t.readPixels(this.origin.x+e.position.x,this.origin.y+e.position.y,this.size.width,this.size.height)},this.shotToFileFromGL=function(e,t,i,r){BK.Notification.on("frame_final",this,function(){this.isInScreen();var e=new BK.WebGL,n="GameSandBox://"+t,o=new BK.Buffer(this.size.height*this.size.width*4);e.glReadPixels(this.origin.x,this.origin.y,this.size.width,this.size.height,6408,5121,o),this.saveImage(o,n,i),r&&r(n+"."+i)}.bind(this),!0)},this.shotToBuffFromGL=function(e,t){BK.Notification.on("frame_final",this,function(){this.isInScreen();var e=new BK.Buffer(this.size.height*this.size.width*4);(new BK.WebGL).glReadPixels(this.origin.x,this.origin.y,this.size.width,this.size.height,6408,5121,e),t&&t(e)}.bind(this),!0)}},function(e,t){"object"==typeof e&&(e.MQQ.Webview.openTransparent=t().openTransparent,e.MQQ.Webview.closeTransparent=t().closeTransparent,e.MQQ.Webview.sendMessageToWebView=t().sendMessageToWebView,e.MQQ.Webview.onMessageHandle=t().onMessageHandle)}(BK,function(){function e(e,t,i){void 0===t&&(t=1);var r="cs.openWebViewWithoutUrl.local",n={url:e,gameOrientation:t,businessType:2};GameStatusInfo.devPlatform&&BK.Script.log(0,0,"BK.MQQ.Webview.openTransparent rely QQ.Call Failed!"),i&&(BK.MQQ.SsoRequest.removeListener(r,this),BK.MQQ.SsoRequest.addListener(r,this,i)),BK.MQQ.SsoRequest.send(n,r)}function t(e){var t={taskId:e};BK.MQQ.SsoRequest.send(t,"cs.closeWebview.local")}function i(e,t){var i={taskId:e,msg:t};BK.MQQ.SsoRequest.send(i,"cs.apolloGameTargetWebMessage.local")}function r(e){BK.MQQ.SsoRequest.addListener("sc.web_callback_game.local",null,function(t,i,r){e&&e(i,r)})}return{openTransparent:e,closeTransparent:t,sendMessageToWebView:i,onMessageHandle:r}}),function(e,t){"object"==typeof e&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Audio=t())}(BK,function(){var e=BK.Audio,t=function(){function t(t,i,r){this.__nativeObj=new e(t,i,r),this._type=t,this.path=i,this._loopCount=r}return Object.defineProperty(t.prototype,"type",{set:function(e){1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5")&&this.__nativeObj.setAudioParam("type",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"musicPath",{set:function(e){1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5")&&this.__nativeObj.setAudioParam("musicPath",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loopCount",{set:function(e){1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5")&&this.__nativeObj.setAudioParam("loopCount",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentTime",{get:function(){if(1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5"))return this.__nativeObj.currentTime},set:function(e){1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5")&&this.__nativeObj.setAudioParam("currentTime",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){if(1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5"))return this.__nativeObj.volume},set:function(e){1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5")&&this.__nativeObj.setAudioParam("volume",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"audioType",{set:function(e){1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5")&&this.__nativeObj.setAudioParam("audioType",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){if(1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5"))return this.__nativeObj.duration},enumerable:!0,configurable:!0}),t.pauseAllBackground=function(){if(this.playingBackgrounds)for(var e=0;e<this.playingBackgrounds.length;e++){var t=this.playingBackgrounds[e];"string"!=typeof t.music&&t.music.pauseMusic()}},t.resumeAllBackground=function(){if(this.playingBackgrounds)for(var t=0;t<this.playingBackgrounds.length;t++){var i=this.playingBackgrounds[t];"string"!=typeof i.music?(i.music.resumeMusic(),BK.Script.log(0,0," music.resumeMusic not string")):(BK.Script.log(0,0," music.resumeMusic "+typeof i.music),e.playMusic(i.type,i.music,i.loop))}},t.removeBackgrounFromArray=function(e){if(this.playingBackgrounds)for(var i=0;i<t.playingBackgrounds.length;i++)t.playingBackgrounds[i].music},t.addBackgroundToArray=function(e,i,r){var n={music:e,type:i,loop:r};void 0===this.playingBackgrounds&&(this.playingBackgrounds=[]);for(var o=0;o<t.playingBackgrounds.length;o++)t.playingBackgrounds[o].music;this.playingBackgrounds.push(n)},t.playMusic=function(i,r,n){var o=new e(i,r,n);o.startMusic(function(){}),0==i&&t.addBackgroundToArray(o,i,n)},t.prototype.startMusic=function(i){"ios"===GameStatusInfo.platform&&GameStatusInfo.QQVer.indexOf("7.5.8")>-1?e.playMusic(this._type,this.path,this._loopCount):(null!=i&&void 0!=i?this.__nativeObj.startMusic(i):this.__nativeObj.startMusic(),0==this._type&&t.addBackgroundToArray(this.__nativeObj,this._type,this._loopCount))},t.prototype.pauseMusic=function(){"ios"===GameStatusInfo.platform&&GameStatusInfo.QQVer.indexOf("7.5.8")>-1||(this.__nativeObj.pauseMusic(),0==this._type&&t.removeBackgrounFromArray(this.__nativeObj))},t.prototype.resumeMusic=function(){"ios"===GameStatusInfo.platform&&GameStatusInfo.QQVer.indexOf("7.5.8")>-1||(this.__nativeObj.resumeMusic(),0==this._type&&t.addBackgroundToArray(this.__nativeObj,this._type,this._loopCount))},t.prototype.stopMusic=function(){"ios"===GameStatusInfo.platform&&GameStatusInfo.QQVer.indexOf("7.5.8")>-1||(0==this._type&&t.removeBackgrounFromArray(this.__nativeObj),this.__nativeObj.stopMusic())},t.prototype.seekTo=function(e){1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5")&&this.__nativeObj.seekTo(e)},t}();return Object.defineProperty(t,"switch",{get:function(){return e.switch},set:function(t){e.switch=t},enumerable:!0,configurable:!0}),t}),BK.MQQ&&BK.MQQ.Account){var headCacheDir_1="GameSandBox://_head/";BK.FileUtil.isFileExist(headCacheDir_1)||BK.FileUtil.makeDir(headCacheDir_1),BK.MQQ.Account.getHeadEx||(BK.MQQ.Account.getHeadEx=function(e,t){BK.MQQ.Account.getHead(e,function(i,r){if(r&&r.buffer&&r.width&&r.height)if(BK.Image.saveImage)BK.Image.saveImage(r.buffer,r.width,r.height,headCacheDir_1+i,"jpg"),t(i,headCacheDir_1+i+".jpg");else{var n=new BK.Texture(r.buffer,r.width,r.height),o=new BK.Sprite(r.width,r.height,n,0,0,1,1),a=new BK.RenderTexture(r.width,r.height);BK.Render.renderToTexture(o.__nativeObj?o.__nativeObj:o,a),a.saveTo(headCacheDir_1+i),t(e,headCacheDir_1+i)}else t(e,"")})}),BK.MQQ.Account.getUserInfo=function(e){if(1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5")){var t="cs.get_user_info.local";e&&(BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,function(t,i,r){e(t,r)}),BK.MQQ.SsoRequest.send(null,t))}else e(-1,null)},BK.MQQ.Account.getFriends=function(e){if(1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5")){var t="cs.get_app_friends.local";e&&(BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,function(t,i,r){e(t,r)}),BK.MQQ.SsoRequest.send(null,t))}else e(-1,null)},BK.MQQ.Account.getLocation=function(e){if(1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5")){var t="cs.get_location.local";e&&(BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,function(t,i,r){e(t,r)}),BK.MQQ.SsoRequest.send(null,t))}else e(-1,null)},BK.MQQ.Account.getCity=function(e){if(1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5")){var t="cs.get_city.local";e&&(BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,function(t,i,r){e(t,r)}),BK.MQQ.SsoRequest.send(null,t))}else e(-1,null)},BK.MQQ.Account.preloadUserInfoList=function(e,t){if(1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5")){var i="cs.preload_userInfoList.local";if(t){var r={openIdList:e};BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,function(e,i,r){t(e)}),BK.MQQ.SsoRequest.send(r,i)}}else t(-1)},BK.MQQ.Account.queryNick=function(e,t,i,r,n){var o=new BK.QQNickCanvas(e,t,i,r,function(e,t){n(o.__nativeObj,t)})},BK.MQQ.Account.queryHead=function(e,t,i,r,n){var o=new BK.QQAvatarCanvas(e,t,i,r,null,function(e,t){n(o.__nativeObj,t)})},BK.MQQ.Account.login=function(e){if(1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.8.0")){var t="cs.xy_login.local";BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,function(t,i,r){r&&r.type&&("complete"==r.type&&e&&e.complete&&e.complete(r),"unauthorized"==r.type&&e&&e.fail&&e.fail(r),"failure"==r.type&&e&&e.fail&&e.fail(r),"success"==r.type&&e&&e.success&&e.success(r))}),BK.MQQ.SsoRequest.send(null,t)}else e&&e.fail&&e.fail({ret:1,type:"verionErr"})}}BK.Misc.compQQVersion||(BK.Misc.compQQVersion=function(e,t){for(var i=e.split("."),r=t.split("."),n=Math.min(3,Math.min(i.length,r.length)),o=0;o<n;o++)if(i[o]!=r[o])return i[o]<r[o];return!0},BK.Misc.qqVerLessthan=function(e,t){for(var i=e.split("."),r=t.split("."),n=Math.min(3,Math.min(i.length,r.length)),o=0;o<n;o++){if(i[o]<r[o])return!0;if(i[o]>r[o])return!1}return!1}),function(e,t){"object"==typeof e&&(e.TouchEventDispatch=function(){var e=BK.TouchEvent.getAllTouchEvent,t=BK.TouchEvent.getTouchEvent,i=BK.TouchEvent.updateTouchStatus;return{TouchEventDispatch:function(){function r(){}return r.listenAllTouch=function(e,t){void 0===this.listenerInfos&&(this.listenerInfos=[]);var i={obj:e,callback:t};this.listenerInfos.push(i)},r.remove=function(e){for(var t=-1,i=this.listenerInfos.length,r=0;r<i;r++)this.listenerInfos[r].obj==e&&(t=r);-1!=t&&this.listenerInfos.splice(t,1)},r.dispatch=function(e){e&&this.listenerInfos.forEach(function(t){t.callback(e)})},r.getTouchEvent=function(){var e=t();return e&&this.dispatch([e]),e},r.getAllTouchEvent=function(){var t=e();return t&&this.dispatch(t),t},r.updateTouchStatus=function(){i()},r.listenerInfos=[],r}()}}().TouchEventDispatch)}(BK),function(e,t){e.TouchEvent=function(){return function(){function e(){}return e.getTouchEvent=function(){return BK.TouchEventDispatch.getTouchEvent()},e.getAllTouchEvent=function(){return BK.TouchEventDispatch.getAllTouchEvent()},e.updateTouchStatus=function(){BK.TouchEventDispatch.updateTouchStatus()},e}()}()}(BK),function(e,t){function i(t,i){try{e.gl&&0==r&&(r=!0,o()),a(t,i),e.gl&&e.gl.__oldGlCommit()}catch(e){}BK.Notification.emitAll("frame_final",{})}var r=!1,n=function(){},o=function(){this.__gl=bkWebGLGetInstance(),this.__oldGlCommit=this.__gl.glCommit,this.__gl.glCommit=n,this.__gl.__oldGlCommit=this.__oldGlCommit,n.bind(this.__gl)};BK.Notification=new BK.Emitter;var a=e._tickerCallback_;e._tickerCallback_=i}(this),function(e,t){function i(t){r&&r(t.message?t.message:t,t.stack),e.Script&&e.Script.onerror&&e.Script.onerror(t)}var r=void 0;t.Script.setErrorObserver=function(e){r=e},e._globalErrorCallback_=i,t.MQQ.SsoRequest.addListener("cs.xy_error_info.local",this,function(e,t,r){i(r.data)})}(this,BK),function(e,t){function i(e){if(!(e.indexOf("GameRes://")<0)){var t=e.substring("GameRes://".length,e.length),i=t.indexOf("/");if(!(i<0)){var r=t.substring(0,i);if(r&&""!=r)for(var n in o.subpackages){var a=o.subpackages[n];if(a&&a.root&&a.root===r&&a.name)return a.name}}}}if(GameStatusInfo&&"xcode"!==GameStatusInfo.devPlatform){var r=GameStatusInfo.QQVer.split(".");if(Number(r[0])<7||7==Number(r[0])&&Number(r[1])<7||7==Number(r[0])&&7==Number(r[1])&&Number(r[2])<5)t.Script.log(1,0,"775 \u4ee5\u4e0b\u624bq \u7248\u672c");else{var n=t.FileUtil.readFile("GameRes://gameConfig.json");if(n){var o=JSON.parse(n.readAsString(!0));o&&o.subpackages&&(t.Script.innerLoadLib=t.Script.loadlib,t.Script.loadlib=function(e){var r=i(e);r?t.QQ.checkPakcage(r,function(i,r){0==r?t.Script.innerLoadLib(e):t.Script.log(1,1,"\u7ec8\u7aef\u6821\u9a8c\u5b50\u5305\u5b8c\u6574\u6027\u5931\u8d25 pack:"+i+"  code:"+r)}):t.Script.innerLoadLib(e)})}}}else t.Script.log(1,0,"Xcode \u73af\u5883")}(0,BK),function(e,t){if(BK.Notification){BK.MQQ.SsoRequest.addListener("sc.game_enter_background.local",null,function(){BK.Notification.emitAll("game_enter_background",{})}.bind(this)),BK.MQQ.SsoRequest.addListener("sc.game_enter_foreground.local",null,function(){BK.Notification.emitAll("game_enter_foreground",{})}.bind(this)),BK.MQQ.SsoRequest.addListener("sc.game_maximize.local",null,function(){BK.Notification.emitAll("game_maximize",{})}.bind(this)),BK.MQQ.SsoRequest.addListener("sc.game_minimize.local",null,function(){BK.Notification.emitAll("game_minimize",{})}.bind(this)),BK.MQQ.SsoRequest.addListener("sc.game_shell_pack_up.local",null,function(){BK.Notification.emitAll("game_pack_up",{})}.bind(this)),BK.MQQ.SsoRequest.addListener("sc.game_shell_close.local",null,function(){BK.Notification.emitAll("game_close",{}),isBrowser?BK.MQQ.SsoRequest.sendTo({},"cs.close_room.local"):BK.MQQ.SsoRequest.send({},"cs.close_room.local")}.bind(this)),BK.MQQ.SsoRequest.addListener("sc.network_change.local",null,function(e,t,i){void 0===i.type?BK.Script.log(1,1,"net work change .data is worng!"):BK.Notification.emitAll("game_network_change",i.type)}.bind(this))}}(),function(e,t){e.FileUtil.upload=function(){function e(e,t,i){function r(e,t){i(t,f+d)}for(var n=e.length>1024?1024:e.length,o=new Uint8Array(n),a=0;a<n/2;a++)o[a]=e.readUint8Buffer();e.jumpBytes(e.length-n);for(a=n/2;a<n;a++)o[a]=e.readUint8Buffer();e.rewind();var s=new Date,h=s.getFullYear()+(s.getMonth()+1<10?0+(s.getMonth()+1):s.getMonth()+1)+s.getDate(),c=t.signTime,l=t.tmpSecretId,u=t.sessionToken,d="/"+GameStatusInfo.gameId+"_"+BK.Crypt.bin2hex(BK.Crypt.core_md5(o,n))+GameStatusInfo.gameId+"_"+h+".png",_=t.upLoadPrefUrl.replace(new RegExp("http://","gm"),""),f=t.downloadUrl,g=t.signature,p="put\n"+d+"\n\nhost="+_+"&x-cos-storage-class=nearline\n",m="sha1\n"+c+"\n"+BK.Crypt.hex_sha1(p)+"\n",v="q-sign-algorithm=sha1&q-ak="+l+"&q-sign-time="+c+"&q-key-time="+c+"&q-header-list=host;x-cos-storage-class&q-url-param-list=&q-signature="+BK.Crypt.hex_hmac_sha1(g,m),S=new BK.HttpUtil("https://"+_+d);S.setHttpMethod("put"),S.setHttpHeader("host",_),S.setHttpHeader("x-cos-storage-class","nearline"),S.setHttpHeader("x-cos-security-token",u),S.setHttpHeader("authorization",v),S.setBodyCompatible(!1),S.setHttpRawBody(e),S.requestAsync(r)}return BK.FileUtil.uploadFromFile=function(e,t){var i=BK.FileUtil.readFile(e);i&&i.length>0?BK.FileUtil.uploadFromBuff(i,t):(BK.Script.log(1,1,"uploadFromFile failed.file is empty!"),t(-1,""))},BK.FileUtil.uploadFromBuff=function(t,i){BK.QQ.queryCloudSignature(function(r,n){e(t,n,i)})},BK.FileUtil.uploadFromNode=function(t,i){var r=new BK.RenderTexture(BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height);BK.Render.renderToTexture(t,r),r.writeToDiskWithXY("GameSandBox://temp.png",t.position.x,t.position.y,t.contentSize.width,t.contentSize.height);var n=BK.FileUtil.readFile("GameSandBox://temp.png");BK.QQ.queryCloudSignature(function(t,r){e(n,r,i)})},BK.FileUtil.uploadNode=function(t,i,r,n,o,a){var s=new BK.RenderTexture(BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height);BK.Render.renderToTexture(t,s),s.writeToDiskWithXY("GameSandBox://temp.png",i,r,n,o);var h=BK.FileUtil.readFile("GameSandBox://temp.png");BK.QQ.queryCloudSignature(function(t,i){e(h,i,a)})},e}()}(BK),BK.QQ.shareToArkFromFile=function(e,t,i,r){BK.FileUtil.uploadFromFile(r,function(r,n){BK.QQ.shareToArk(e,t,n,!0,i)})},BK.QQ.shareToArkFromBuff=function(e,t,i,r){BK.FileUtil.uploadFromBuff(r,function(r,n){200==r&&BK.QQ.shareToArk(e,t,n,!0,i)})},BK.QQ.shareToArkFromNode=function(e,t,i,r){BK.FileUtil.uploadFromNode(r,function(r,n){200==r&&BK.QQ.shareToArk(e,t,n,!0,i)})},BK.QQ.shareToArkFromGLShot=function(e,t,i,r){var n=new BK.ScreenShot;n.origin={x:r.x,y:r.y},n.size={width:r.width,height:r.height};var o="GameSandBox://"+BK.Time.timestamp;n.shotToFileFromGL(void 0,o,"png",function(r){BK.FileUtil.uploadFromFile(r,function(r,n){200==r&&BK.QQ.shareToArk(e,t,n,!0,i),BK.FileUtil.isFileExist(o)&&BK.FileUtil.deleteFile(o)})})},function(e,t){"object"==typeof e&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.UIEventHandler=t())}(this,function(){function e(){this.eveFuncTb=[],this._eventMap={1:[],2:[],3:[]},this.rootNode=BK.Director.root,this.nodeTreeHittest=function(e,t){if(1==e.canUserInteract&&0==e.hidden){if(e.children)for(var i=e.children,r=i.length-1;r>=0;r--){var n=i[r],o=this.nodeTreeHittest(n,t);if(void 0!=o)return o}return 1==e.hittest(t)?e:void 0}},this.treeHittest=function(e){return this.nodeTreeHittest(this.rootNode,e)},this.setRootNode=function(e){this.rootNode=e},this.addNodeEvent=function(e,t,i){var r={};r.obj=e,r.func=i;for(var n=!1,o=0;o<this._eventMap[t].length;o++)this._eventMap[t][o].obj==e&&(n=!0);0==n?this._eventMap[t].push(r):BK.Script.log(1,0,"Add Same Node Event has added Event Before.")},this.removeNodeEvent=function(e,t){for(var i=-1,r=0;r<this._eventMap[t].length;r++)this._eventMap[t][r].obj==e&&(i=r);i>=0&&(this._eventMap[t].splice(i,1),BK.Script.log(1,0,"Remove Node Event Succeed!"))},this.triggerEvent=function(e,t,i,r){for(var n=0;n<this._eventMap[t].length;n++){var o=this._eventMap[t][n];if(e&&o.obj==e){var a=o.func;a&&a(e,t,i,r)}}},this.triggerAllNodeEvent=function(e){for(var t=0;t<this._eventMap[e].length;t++){var i=this._eventMap[e][t],r=i.func,n=i.obj;r&&r(n,e)}},this.isFirstTouchDown=-1,this.currentNode=void 0,this.touchUpdate=function(e){if(void 0!=e)for(var n=0;n<e.length;n++)for(var o=e[n],a=0;a<o.length;a++){var s=o[a].x,h=o[a].y;if(2==o[a].status)if(-1==this.isFirstTouchDown){this.isFirstTouchDown=o[a].id;var c=this.treeHittest({x:s,y:h});c?(this.currentNode=c,this.triggerEvent(this.currentNode,t,s,h)):this.currentNode=void 0}else BK.Script.log(0,0,"detectGesture begin not first id:"+o[a].id+" x:"+s+" y:"+h);else 3==o[a].status?-1!=this.isFirstTouchDown&&o[a].id==this.isFirstTouchDown?this.currentNode&&this.triggerEvent(this.currentNode,i,s,h):BK.Script.log(0,0,"detectGesture moved! Failed touchArr[i].id = "+o[a].id):1==o[a].status&&(-1!=this.isFirstTouchDown&&o[a].id==this.isFirstTouchDown?(this.isFirstTouchDown=-1,this.currentNode&&(this.triggerEvent(this.currentNode,r,s,h),this.currentNode=void 0)):BK.Script.log(0,0,"detectGesture end!!!Failed!!! touchArr[i].id= "+o[a].id+" this.isFirstTouchDown:"+this.isFirstTouchDown))}},this.detectGesture=function(){var e=BK.TouchEvent.getAllTouchEvent();this.touchUpdate(e),BK.TouchEvent.updateTouchStatus()},"function"==typeof BK.TouchEventDispatch?BK.TouchEventDispatch.listenAllTouch(this,this.touchUpdate.bind(this)):BK.Director.ticker.add(function(e,t){this&&this.detectGesture()}.bind(this))}var t=1,i=2,r=3;return new e}),function(e,t){"object"==typeof e&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Button=t())}(BK,function(){function e(e,t,i,r){this.touchStatus=0,this.normalTexture=void 0,this.pressTexture=void 0,this.disableTexture=void 0,this.normalTextureOffset={frame:{x:0,y:0,w:0,h:0},rotated:!1},this.pressTextureOffset={frame:{x:0,y:0,w:0,h:0},rotated:!1},this.disableTextureOffset={frame:{x:0,y:0,w:0,h:0},rotated:!1},this.touchInsideCallback=void 0,i?(this.normalTexture=new BK.Texture(i),this.normalTexture&&(this.normalTextureOffset.frame.x=0,this.normalTextureOffset.frame.y=0,this.normalTextureOffset.frame.w=this.normalTexture.size.width,this.normalTextureOffset.frame.h=this.normalTexture.size.height,this.normalTextureOffset.rotated=!1)):this.normalTexture={},r&&(this.touchInsideCallback=r),this.__nativeObj=new BK.Sprite(e,t,this.normalTexture,0,1,1,1);try{Object.getOwnPropertyNames(this.__nativeObj).forEach(function(e){var t=e;Object.defineProperty(this,t,{get:function(){return this.__nativeObj[t]},set:function(e){this.__nativeObj[t]=e}})},this)}catch(e){BK.Script.log(1,1," error :"+e)}this.enable=!0,Object.defineProperty(this,"disable",{get:function(){return!this.enable},set:function(e){1==e?this.updateTexture(2):this.updateTexture(0),this.enable=!e}}),this.updateTexture=function(e){if(0==e){if(this.normalTexture){this.__nativeObj.setTexture(this.normalTexture);t=this.normalTextureOffset;this.__nativeObj.adjustTexturePosition(t.frame.x,t.frame.y,t.frame.w,t.frame.h,t.rotated)}}else if(1==e){if(this.pressTexture){this.__nativeObj.setTexture(this.pressTexture);t=this.pressTextureOffset;this.__nativeObj.adjustTexturePosition(t.frame.x,t.frame.y,t.frame.w,t.frame.h,t.rotated)}}else if(2==e&&this.disableTexture){this.__nativeObj.setTexture(this.disableTexture);var t=this.disableTextureOffset;this.__nativeObj.adjustTexturePosition(t.frame.x,t.frame.y,t.frame.w,t.frame.h,t.rotated)}},this.changeStatus=function(e){this.touchStatus=e,this.updateTexture(this.touchStatus)},this.updateStatus=function(){this.updateTexture(this.touchStatus)},this.changeStatus(0),this.isCancelClick=void 0,UIEventHandler.addNodeEvent(this,1,function(e,t,i,r){e.isCancelClick=!1,e.enable?e.changeStatus(1):e.changeStatus(2)}),UIEventHandler.addNodeEvent(this,2,function(e,t,i,r){var n={x:i,y:r};0==e.hittest(n)&&(e.isCancelClick=!0)}),UIEventHandler.addNodeEvent(this,3,function(e,t,i,r){e.enable?e.changeStatus(0):e.changeStatus(2),0==e.isCancelClick&&e.touchInsideCallback&&e.touchInsideCallback(e)}),this.canUserInteract=!0}return e.prototype.setTouchInsideCallback=function(e){this.touchInsideCallback=e},e.prototype.setNormalTexturePath=function(e){var t=new BK.Texture(e);t&&this.setNormalTexture(t)},e.prototype.setPressTexturePath=function(e){var t=new BK.Texture(e);t&&this.setPressTexture(t)},e.prototype.setDisableTexturePath=function(e){var t=new BK.Texture(e);t&&this.setDisableTexture(t)},e.prototype.setNormalTexture=function(e){this.normalTexture=e,this.normalTexture&&(this.normalTextureOffset.frame.x=0,this.normalTextureOffset.frame.y=0,this.normalTextureOffset.frame.w=this.normalTexture.size.width,this.normalTextureOffset.frame.h=this.normalTexture.size.height,this.normalTextureOffset.rotated=!1),this.updateStatus()},e.prototype.setPressTexture=function(e){this.pressTexture=e,this.pressTexture&&(this.pressTextureOffset.frame.x=0,this.pressTextureOffset.frame.y=0,this.pressTextureOffset.frame.w=this.pressTexture.size.width,this.pressTextureOffset.frame.h=this.pressTexture.size.height,this.pressTextureOffset.rotated=!1),this.updateStatus()},e.prototype.setDisableTexture=function(e){this.disableTexture=e,this.disableTexture&&(this.disableTextureOffset.frame.x=0,this.disableTextureOffset.frame.y=0,this.disableTextureOffset.frame.w=this.disableTexture.size.width,this.disableTextureOffset.frame.h=this.disableTexture.size.height,this.disableTextureOffset.rotated=!1),this.updateStatus()},e.prototype.setNormalTextureFromSheetInfo=function(e){if(e){var t=new BK.Texture(e.texturePath);t?(this.normalTexture=t,this.normalTextureOffset=e.frameInfo,this.updateStatus()):BK.Script.log(0,0,"setNormalTextureFromSheetInfo error! Create texture failed.")}else BK.Script.log(0,0,"setNormalTextureFromSheetInfo error! textureFrameInfo is null or undefined")},e.prototype.setPressTextureFromSheetInfo=function(e){if(e){var t=new BK.Texture(e.texturePath);t?(this.pressTexture=t,this.pressTextureOffset=e.frameInfo,this.updateStatus()):BK.Script.log(0,0,"setPressTextureFromSheetInfo error! Create texture failed.")}else BK.Script.log(0,0,"setPressTextureFromSheetInfo error! textureFrameInfo is null or undefined")},e.prototype.setDisableTextureFromSheetInfo=function(e){if(e){var t=new BK.Texture(e.texturePath);t?(this.disableTexture=t,this.disableTextureOffset=e.frameInfo,this.updateStatus()):BK.Script.log(0,0,"setDisableTextureFromSheetInfo error! Create texture failed.")}else BK.Script.log(0,0,"setDisableTextureFromSheetInfo error! textureFrameInfo is null or undefined")},e.prototype.hittest=function(e){return this.__nativeObj.hittest(e)},e.prototype.addChild=function(e){this.__nativeObj.addChild(e)},e.prototype.attach=function(e){this.__nativeObj.attach(e)},e.prototype.dispose=function(){this.__nativeObj.dispose()},e.prototype.setTexture=function(e){this.__nativeObj.setTexture(e)},e.prototype.removeFromParent=function(){this.__nativeObj.removeFromParent()},e.prototype.setNormalTextureFromUrl=function(e,t){this.normalUrl=e,new BK.HttpUtil(this.normalUrl).requestAsync(function(e,i){if(200==i){var r="GameSandBox://btntmp/"+this.normalUrl;BK.FileUtil.writeBufferToFile(r,e);var n=new BK.Texture(r);this.setNormalTexture(n)}else BK.Script.log(1,1,"Fetch advertisemSent image failed.");t&&t(this,i)}.bind(this))},e.prototype.setPressTextureFromUrl=function(e,t){this.pressUrl=e,new BK.HttpUtil(this.pressUrl).requestAsync(function(e,i){if(200==i){var r="GameSandBox://btntmp/"+this.pressUrl;BK.FileUtil.writeBufferToFile(r,e);var n=new BK.Texture(r);this.setPressTexture(n)}else BK.Script.log(1,1,"Fetch advertisement image failed.");t&&t(this,i)}.bind(this))},e.prototype.setDisableTextureFromUrl=function(e,t){this.disableUrl=e,new BK.HttpUtil(this.disableUrl).requestAsync(function(e,i){if(200==i){var r="GameSandBox://btntmp/"+this.disableUrl;BK.FileUtil.writeBufferToFile(r,e);var n=new BK.Texture(r);this.setDisableTexture(n)}else BK.Script.log(1,1,"Fetch advertisement image failed.");t&&t(this,i)}.bind(this))},e});var gl,isSupportTA,firstFrameUpload=!1,GL_COMMAND_ACTIVE_TEXTURE=0,GL_COMMAND_ATTACH_SHADER=1,GL_COMMAND_BIND_ATTRIB_LOCATION=2,GL_COMMAND_BIND_BUFFER=3,GL_COMMAND_BIND_FRAME_BUFFER=4,GL_COMMAND_BIND_RENDER_BUFFER=5,GL_COMMAND_BIND_TEXTURE=6,GL_COMMAND_BLEND_COLOR=7,GL_COMMAND_BLEND_EQUATION=8,GL_COMMAND_BLEND_EQUATION_SEPARATE=9,GL_COMMAND_BLEND_FUNC=10,GL_COMMAND_BLEND_FUNC_SEPARATE=11,GL_COMMAND_BUFFER_DATA=12,GL_COMMAND_BUFFER_SUB_DATA=13,GL_COMMAND_CLEAR=14,GL_COMMAND_CLEAR_COLOR=15,GL_COMMAND_CLEAR_DEPTH=16,GL_COMMAND_CLEAR_STENCIL=17,GL_COMMAND_COLOR_MASK=18,GL_COMMAND_COMMIT=19,GL_COMMAND_COMPILE_SHADER=20,GL_COMMAND_COMPRESSED_TEX_IMAGE_2D=21,GL_COMMAND_COMPRESSED_TEX_SUB_IMAGE_2D=22,GL_COMMAND_COPY_TEX_IMAGE_2D=23,GL_COMMAND_COPY_TEX_SUB_IMAGE_2D=24,GL_COMMAND_CULL_FACE=25,GL_COMMAND_DELETE_BUFFER=26,GL_COMMAND_DELETE_FRAME_BUFFER=27,GL_COMMAND_DELETE_PROGRAM=28,GL_COMMAND_DELETE_RENDER_BUFFER=29,GL_COMMAND_DELETE_SHADER=30,GL_COMMAND_DELETE_TEXTURE=31,GL_COMMAND_DEPTH_FUNC=32,GL_COMMAND_DEPTH_MASK=33,GL_COMMAND_DEPTH_RANGE=34,GL_COMMAND_DETACH_SHADER=35,GL_COMMAND_DISABLE=36,GL_COMMAND_DISABLE_VERTEX_ATTRIB_ARRAY=37,GL_COMMAND_DRAW_ARRAYS=38,GL_COMMAND_DRAW_ELEMENTS=39,GL_COMMAND_ENABLE=40,GL_COMMAND_ENABLE_VERTEX_ATTRIB_ARRAY=41,GL_COMMAND_FINISH=42,GL_COMMAND_FLUSH=43,GL_COMMAND_FRAME_BUFFER_RENDER_BUFFER=44,GL_COMMAND_FRAME_BUFFER_TEXTURE_2D=45,GL_COMMAND_FRONT_FACE=46,GL_COMMAND_GENERATE_MIPMAP=47,GL_COMMAND_HINT=48,GL_COMMAND_LINE_WIDTH=49,GL_COMMAND_LINK_PROGRAM=50,GL_COMMAND_PIXEL_STOREI=51,GL_COMMAND_POLYGON_OFFSET=52,GL_COMMAND_RENDER_BUFFER_STORAGE=53,GL_COMMAND_SAMPLE_COVERAGE=54,GL_COMMAND_SCISSOR=55,GL_COMMAND_SHADER_SOURCE=56,GL_COMMAND_STENCIL_FUNC=57,GL_COMMAND_STENCIL_FUNC_SEPARATE=58,GL_COMMAND_STENCIL_MASK=59,GL_COMMAND_STENCIL_MASK_SEPARATE=60,GL_COMMAND_STENCIL_OP=61,GL_COMMAND_STENCIL_OP_SEPARATE=62,GL_COMMAND_TEX_IMAGE_2D=63,GL_COMMAND_TEX_PARAMETER_F=64,GL_COMMAND_TEX_PARAMETER_I=65,GL_COMMAND_TEX_SUB_IMAGE_2D=66,GL_COMMAND_UNIFORM_1F=67,GL_COMMAND_UNIFORM_1FV=68,GL_COMMAND_UNIFORM_1I=69,GL_COMMAND_UNIFORM_1IV=70,GL_COMMAND_UNIFORM_2F=71,GL_COMMAND_UNIFORM_2FV=72,GL_COMMAND_UNIFORM_2I=73,GL_COMMAND_UNIFORM_2IV=74,GL_COMMAND_UNIFORM_3F=75,GL_COMMAND_UNIFORM_3FV=76,GL_COMMAND_UNIFORM_3I=77,GL_COMMAND_UNIFORM_3IV=78,GL_COMMAND_UNIFORM_4F=79,GL_COMMAND_UNIFORM_4FV=80,GL_COMMAND_UNIFORM_4I=81,GL_COMMAND_UNIFORM_4IV=82,GL_COMMAND_UNIFORM_MATRIX_2FV=83,GL_COMMAND_UNIFORM_MATRIX_3FV=84,GL_COMMAND_UNIFORM_MATRIX_4FV=85,GL_COMMAND_USE_PROGRAM=86,GL_COMMAND_VALIDATE_PROGRAM=87,GL_COMMAND_VERTEX_ATTRIB_1F=88,GL_COMMAND_VERTEX_ATTRIB_2F=89,GL_COMMAND_VERTEX_ATTRIB_3F=90,GL_COMMAND_VERTEX_ATTRIB_4F=91,GL_COMMAND_VERTEX_ATTRIB_1FV=92,GL_COMMAND_VERTEX_ATTRIB_2FV=93,GL_COMMAND_VERTEX_ATTRIB_3FV=94,GL_COMMAND_VERTEX_ATTRIB_4FV=95,GL_COMMAND_VERTEX_ATTRIB_POINTER=96,GL_COMMAND_VIEW_PORT=97,total_size=1e5,next_index=0,buffer_data,bufferdata_array,bufferdata_view,bufferdata_pointer=0;!function(e,t){if("object"==typeof e){var i=function(){function e(e){return.01745329251994*e}return{Matrix:function(){function t(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];if(this.data=new Float32Array(16),arguments.length){if(1==arguments.length){if(arguments[0]instanceof t==1)for(r=0;r<16;r++)this.data[r]=arguments[0].data[r]}else if(16==arguments.length)for(var r=0;r<16;r++)this.data[r]=arguments[r]}else this.data[0]=1,this.data[5]=1,this.data[10]=1,this.data[15]=1}return t.prototype.clone=function(){return new t(this)},t.prototype.mul=function(e){var t=this.data[0],i=this.data[1],r=this.data[2],n=this.data[3],o=this.data[4],a=this.data[5],s=this.data[6],h=this.data[7],c=this.data[8],l=this.data[9],u=this.data[10],d=this.data[11],_=this.data[12],f=this.data[13],g=this.data[14],p=this.data[15],m=e.data[0],v=e.data[1],S=e.data[2],b=e.data[3],T=e.data[4],B=e.data[5],E=e.data[6],y=e.data[7],x=e.data[8],C=e.data[9],R=e.data[10],A=e.data[11],I=e.data[12],O=e.data[13],M=e.data[14],D=e.data[15];return this.data[0]=t*m+o*v+c*S+_*b,this.data[1]=i*m+a*v+l*S+f*b,this.data[2]=r*m+s*v+u*S+g*b,this.data[3]=n*m+h*v+d*S+p*b,this.data[4]=t*T+o*B+c*E+_*y,this.data[5]=i*T+a*B+l*E+f*y,this.data[6]=r*T+s*B+u*E+g*y,this.data[7]=n*T+h*B+d*E+p*y,this.data[8]=t*x+o*C+c*R+_*A,this.data[9]=i*x+a*C+l*R+f*A,this.data[10]=r*x+s*C+u*R+g*A,this.data[11]=n*x+h*C+d*R+p*A,this.data[12]=t*I+o*O+c*M+_*D,this.data[13]=i*I+a*O+l*M+f*D,this.data[14]=r*I+s*O+u*M+g*D,this.data[15]=n*I+h*O+d*M+p*D,this},t.prototype.mulPoint=function(e){var t=this.data[0],i=this.data[1],r=this.data[2],n=this.data[3],o=this.data[4],a=this.data[5],s=this.data[6],h=this.data[7],c=this.data[8],l=this.data[9],u=this.data[10],d=this.data[11],_=this.data[12],f=this.data[13],g=this.data[14],p=this.data[15];void 0===e.z&&(e.z=0);var m={x:0,y:0,z:0};m.x=t*e.x+o*e.y+c*e.z+_,m.y=i*e.x+a*e.y+l*e.z+f,m.z=r*e.x+s*e.y+u*e.z+g;e.x,e.y,e.z;return m},t.prototype.inverse=function(){var e=this.data[10]*this.data[15]-this.data[14]*this.data[11],t=this.data[6]*this.data[15]-this.data[14]*this.data[7],i=this.data[6]*this.data[11]-this.data[10]*this.data[7],r=this.data[2]*this.data[15]-this.data[14]*this.data[3],n=this.data[2]*this.data[11]-this.data[10]*this.data[3],o=this.data[2]*this.data[7]-this.data[6]*this.data[3],a=this.data[9]*this.data[15]-this.data[13]*this.data[11],s=this.data[5]*this.data[15]-this.data[13]*this.data[7],h=this.data[5]*this.data[11]-this.data[9]*this.data[7],c=this.data[1]*this.data[15]-this.data[13]*this.data[3],l=this.data[1]*this.data[11]-this.data[9]*this.data[3],u=this.data[1]*this.data[7]-this.data[5]*this.data[3],d=this.data[9]*this.data[14]-this.data[13]*this.data[10],_=this.data[5]*this.data[14]-this.data[13]*this.data[6],f=this.data[5]*this.data[10]-this.data[9]*this.data[6],g=this.data[1]*this.data[14]-this.data[13]*this.data[2],p=this.data[1]*this.data[10]-this.data[9]*this.data[2],m=this.data[1]*this.data[6]-this.data[5]*this.data[2],v=this.data[5]*e-this.data[9]*t+this.data[13]*i,S=this.data[9]*r-this.data[1]*e-this.data[13]*n,b=this.data[1]*t-this.data[5]*r+this.data[13]*o,T=this.data[5]*n-this.data[1]*i-this.data[9]*o,B=this.data[8]*t-this.data[4]*e-this.data[12]*i,E=this.data[0]*e-this.data[8]*r+this.data[12]*n,y=this.data[4]*r-this.data[0]*t-this.data[12]*o,x=this.data[0]*i-this.data[4]*n+this.data[8]*o,C=this.data[4]*a-this.data[8]*s+this.data[12]*h,R=this.data[8]*c-this.data[0]*a-this.data[12]*l,A=this.data[0]*s-this.data[4]*c+this.data[12]*u,I=this.data[4]*l-this.data[0]*h-this.data[8]*u,O=this.data[8]*_-this.data[4]*d-this.data[12]*f,M=this.data[0]*d-this.data[8]*g+this.data[12]*p,D=this.data[4]*g-this.data[0]*_-this.data[12]*m,N=this.data[0]*f-this.data[4]*p+this.data[8]*m,P=this.data[0]*v+this.data[1]*B+this.data[2]*C+this.data[3]*O;return 0!=P&&(this.data[0]=v/P,this.data[4]=B/P,this.data[8]=C/P,this.data[12]=O/P,this.data[1]=S/P,this.data[5]=E/P,this.data[9]=R/P,this.data[13]=M/P,this.data[2]=b/P,this.data[6]=y/P,this.data[10]=A/P,this.data[14]=D/P,this.data[3]=T/P,this.data[7]=x/P,this.data[11]=I/P,this.data[15]=N/P),this},t.prototype.scale=function(e,i,r){var n=t.fromScale(e,i,r);return this.mul(n)},t.prototype.rotate=function(e,i,r){var n=t.fromEulerAngle(e,i,r);return this.mul(n)},t.prototype.translate=function(e,i,r){var n=t.fromTranslate(e,i,r);return this.mul(n)},t.prototype.transform=function(e,t,i){return{x:e*this.data[0]+t*this.data[4]+i*this.data[8]+1*this.data[12],y:e*this.data[1]+t*this.data[5]+i*this.data[9]+1*this.data[13],z:e*this.data[2]+t*this.data[6]+i*this.data[10]+1*this.data[14]}},t.prototype.toEulerAngle=function(){var e=0,t=0,i=0,r=this.data[0],n=this.data[4],o=this.data[8],a=this.data[5],s=this.data[2],h=this.data[6],c=this.data[10],l=-h;t=l<=-1?-1.570796:l>=1?1.570796:Math.asin(l),Math.abs(l)>.9999?(i=0,e=Math.atan2(-o,r)):(e=Math.atan2(s,c),i=Math.atan2(n,a));var u=new Float32Array(3);return u[0]=t,u[1]=e,u[2]=i,u},t.fromScale=function(e,i,r){var n=new t;return n.data[0]=e,n.data[5]=i,n.data[10]=r,n},t.fromTranslate=function(e,i,r){var n=new t;return n.data[12]=e,n.data[13]=i,n.data[14]=r,n},t.fromEulerAngle=function(i,r,n){var o=-e(i),a=-e(r),s=-e(n),h=Math.cos(o),c=Math.sin(o),l=Math.cos(a),u=Math.sin(a),d=Math.cos(s),_=Math.sin(s);return new t(h*d+c*u*_,-h*_+c*u*d,c*l,0,_*l,d*l,-u,0,-c*d+h*u*_,_*c+h*u*d,h*l,0,0,0,0,1)},t.fromViewport=function(e,i,r,n,o,a){var s=new t;return s.data[0]=(i-e)/2,s.data[5]=(n-r)/2,s.data[10]=(a-o)/2,s.data[12]=(e+i)/2,s.data[13]=(n+r)/2,s.data[14]=(o+a)/2,s.data[15]=1,s},t.fromOrthographic=function(e,i,r,n,o,a){var s=new t;return s.data[0]=2/(i-e),s.data[5]=2/(n-r),s.data[10]=2/(o-a),s.data[12]=(e+i)/(e-i),s.data[13]=(n+r)/(r-n),s.data[14]=(o+a)/(o-a),s.data[15]=1,s},t}()}}();e.JSMatrix=i.Matrix}}(BK),function(e,t){"object"==typeof e&&(e.JSTransform=function(){return function(){function e(t){if(void 0==t)this.transform=new Float32Array(19),this.transform[2]=1,this.transform[3]=1,this.transform[4]=1,this._localAnchorOrPivot=void 0,this._parentAnchorOrPivot=void 0,this._needUpdate=!0;else{if(t instanceof e!=1)throw new Error("BK.Transform.constructor!paramater error");this.transform=new Float32Array(19),this._localAnchorOrPivot=t._localAnchorOrPivot,this._parentAnchorOrPivot=t._parentAnchorOrPivot,this._needUpdate=t._needUpdate;for(var i=0;i<19;i++)this.transform[i]=t.transform[i]}this.matrix={get:function(){return null},set:function(e,t,i,r,n,o){this._needUpdate=!0,this.transform[2]=e,this.transform[3]=r,this.transform[4]=1,this.transform[5]=i,this.transform[6]=t,this.transform[7]=0,this.transform[8]=n,this.transform[9]=o,this.transform[10]=0}}}return Object.defineProperty(e.prototype,"needUpdate",{get:function(){return this._needUpdate},set:function(e){this._needUpdate=e},enumerable:!0,configurable:!0}),e.prototype.getNeedUpdate=function(){return this._needUpdate},e.prototype.setNeedUpdate=function(e){this._needUpdate=e},Object.defineProperty(e.prototype,"scale",{get:function(){return{x:this.transform[2],y:this.transform[3],z:this.transform[4]}},set:function(e){this.transform[2]==e.x&&this.transform[3]==e.y&&this.transform[4]==e.z||(this._needUpdate=!0,this.transform[2]=void 0==e.x?1:e.x,this.transform[3]=void 0==e.y?1:e.y,this.transform[4]=void 0==e.z?1:e.z)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return{x:this.transform[5],y:this.transform[6],z:this.transform[7]}},set:function(e){this.transform[5]==e.x&&this.transform[6]==e.y&&this.transform[7]==e.z||(this._needUpdate=!0,this.transform[5]=void 0==e.x?0:e.x,this.transform[6]=void 0==e.y?0:e.y,this.transform[7]=void 0==e.z?0:e.z)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return{x:this.transform[8],y:this.transform[9],z:this.transform[10]}},set:function(e){this.transform[8]==e.x&&this.transform[9]==e.y&&this.transform[10]==e.z||(this._needUpdate=!0,this.transform[8]=void 0==e.x?0:e.x,this.transform[9]=void 0==e.y?0:e.y,this.transform[10]=void 0==e.z?0:e.z)},enumerable:!0,configurable:!0}),e.prototype.getPosition=function(){return{x:this.transform[8],y:this.transform[9],z:this.transform[10]}},e.prototype.setPosition=function(e,t,i){this.transform[8]==e&&this.transform[9]==t&&this.transform[10]==i||(this._needUpdate=!0,this.transform[8]=void 0==e?0:e,this.transform[9]=void 0==t?0:t,this.transform[10]=void 0==i?0:i)},Object.defineProperty(e.prototype,"localPivot",{get:function(){if(void 0!=this._localAnchorOrPivot&&0!=this._localAnchorOrPivot)throw new Error("BK.Transform.localPivot!current mode is localAnchor!!");return this._localAnchorOrPivot=0,{x:this.transform[11],y:this.transform[12]}},set:function(e){0==this._localAnchorOrPivot&&this.transform[11]==e.x&&this.transform[12]==e.y||(this._needUpdate=!0,this._localAnchorOrPivot=0,this.transform[11]=void 0==e.x?0:e.x,this.transform[12]=void 0==e.y?0:e.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localAnchor",{get:function(){if(void 0!=this._localAnchorOrPivot&&1!=this._localAnchorOrPivot)throw new Error("BK.Transform.localAnchor!current mode is localPivot!!");return this._localAnchorOrPivot=1,{x:this.transform[13],y:this.transform[14]}},set:function(e){1==this._localAnchorOrPivot&&this.transform[13]==e.x&&this.transform[14]==e.y||(this._needUpdate=!0,this._localAnchorOrPivot=1,this.transform[13]=void 0==e.x?0:e.x,this.transform[14]=void 0==e.y?0:e.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pivotParent",{get:function(){if(void 0!=this._parentAnchorOrPivot&&0!=this._parentAnchorOrPivot)throw new Error("BK.Transform.pivotParent!current mode is anchorParent!!");return this._parentAnchorOrPivot=0,{x:this.transform[15],y:this.transform[16]}},set:function(e){0==this._parentAnchorOrPivot&&this.transform[15]==e.x&&this.transform[16]==e.y||(this._needUpdate=!0,this._parentAnchorOrPivot=0,this.transform[15]=void 0==e.x?0:e.x,this.transform[16]=void 0==e.y?0:e.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchorParent",{get:function(){if(void 0!=this._parentAnchorOrPivot&&1!=this._parentAnchorOrPivot)throw new Error("BK.Transform.anchorParent!current mode is pivotParent!!");return this._parentAnchorOrPivot=1,{x:this.transform[17],y:this.transform[18]}},set:function(e){1==this._parentAnchorOrPivot&&this.transform[17]==e.x&&this.transform[18]==e.y||(this._needUpdate=!0,this._parentAnchorOrPivot=1,this.transform[17]=void 0==e.x?0:e.x,this.transform[18]=void 0==e.y?0:e.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentSize",{get:function(){return{width:this.transform[0],height:this.transform[1]}},set:function(e){this.transform[0]==e.width&&this.transform[1]==e.height||(this._needUpdate=!0,this.transform[0]=void 0==e.width?0:e.width,this.transform[1]=void 0==e.height?0:e.height)},enumerable:!0,configurable:!0}),e.prototype.getContentSize=function(){return{width:this.transform[0],height:this.transform[1]}},e.prototype.setContentSize=function(e,t){this.transform[0]==e&&this.transform[1]==t||(this._needUpdate=!0,this.transform[0]=void 0==e?0:e,this.transform[1]=void 0==t?0:t)},e.prototype.update=function(e,t){return 1==this._needUpdate&&(1==this._localAnchorOrPivot&&(this.transform[11]=this.transform[13]*this.transform[0],this.transform[12]=this.transform[14]*this.transform[1]),1==this._parentAnchorOrPivot&&(this.transform[15]=this.transform[17]*e,this.transform[16]=this.transform[18]*t),this._needUpdate=!1),this.transform},e}()}())}(BK);var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(e,t){if("object"==typeof e){var i=function(){var e=function(){function e(){this.getTypeSize=function(e){return this._gl.BYTE==e?1:this._gl.UNSIGNED_BYTE==e?1:this._gl.SHORT==e?2:this._gl.UNSIGNED_SHORT==e?2:this._gl.INT==e?4:this._gl.UNSIGNED_INT==e?4:this._gl.FLOAT==e?4:void 0},this._ibo=0,this._vbo=0,this._program=0,this._hasLoadShader=!1,this._gl=bkWebGLGetInstance()}return e.__hookGlCommit=function(){var e=bkWebGLGetInstance();BK.GLRenderContext.__updataCallback(e),e.oldGlCommit()},e.hookGLCommit=function(e){this.__updataCallback=e,this.__gl=bkWebGLGetInstance(),this.__oldGlCommit=this.__gl.glCommit,this.__gl.glCommit=this.__hookGlCommit,this.__gl.oldGlCommit=this.__oldGlCommit,this.__hookGlCommit.bind(this.__gl)},e.exit=function(){this.__gl=bkWebGLGetInstance(),this.__oldGlCommit&&(this.__gl.glCommit=this.__oldGlCommit)},Object.defineProperty(e.prototype,"gl",{get:function(){return this._gl},enumerable:!0,configurable:!0}),e.prototype.__loadShader=function(e,t){var i,r=e||"uniform mat4 worldMat; uniform mat4 projMat; attribute vec2 pos; attribute vec2 inUVs; varying lowp vec2 outUVs;                       void main() { gl_Position = projMat * worldMat * vec4(pos, 0, 1); outUVs = inUVs; }",n=t||"varying lowp vec2 outUVs; uniform sampler2D uSampler; void main() { gl_FragColor = texture2D(uSampler, outUVs); }",o=this._gl.createShader(this._gl.VERTEX_SHADER);e&&(this._gl.enable(this._gl.BLEND),this._gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA)),0!=o&&(this._gl.shaderSource(o,r),this._gl.compileShader(o));var a=this._gl.createShader(this._gl.FRAGMENT_SHADER);0!=a&&(this._gl.shaderSource(a,n),this._gl.compileShader(a));var s=this._gl.createProgram();return this._gl.attachShader(s,o),this._gl.attachShader(s,a),this._gl.linkProgram(s),this._gl.deleteShader(o),this._gl.deleteShader(a),this._gl.getError()==this._gl.NO_ERROR?(this._program=s,this._gl.useProgram(this._program)):(i=this._gl.getProgramInfoLog(s),BK.Script.log(1,-1,"link program fail, err = "+i)),this.calculateProjection(),this._program},e.prototype.getProgram=function(){return this._program},e.prototype.__loadArrayBuffer=function(){var e=this._gl.getAttribLocation(this._program,"pos"),t=this._gl.getAttribLocation(this._program,"inUVs");0==this._vbo&&(this._vbo=this._gl.createBuffer()),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._vbo),this._gl.enableVertexAttribArray(e),this._gl.enableVertexAttribArray(t),this._gl.glVertexAttribPointer(e,2,this._gl.FLOAT,!1,16,0,!0),this._gl.glVertexAttribPointer(t,2,this._gl.FLOAT,!1,16,8,!0),0==this._ibo&&(this._ibo=this._gl.createBuffer())},e.prototype.dispose=function(){0!=this._vbo&&this._gl.deleteBuffer(this._vbo),0!=this._ibo&&this._gl.deleteBuffer(this._ibo),0!=this._program&&this._gl.deleteProgram(this._program),this._gl=null},e.prototype.save=function(){this._prevVP=this._gl.glGetParameterInt(this._gl.VIEWPORT,4),this._prevVBO=this._gl.glGetParameterInt(this._gl.ARRAY_BUFFER_BINDING,1),this._prevIBO=this._gl.glGetParameterInt(this._gl.ELEMENT_ARRAY_BUFFER_BINDING,1),this._prevProgram=this._gl.glGetParameterInt(this._gl.CURRENT_PROGRAM,1),this._prevTextureID=this._gl.glGetParameterInt(this._gl.TEXTURE_BINDING_2D,1),this._prevTextureUnit=this._gl.glGetParameterInt(this._gl.ACTIVE_TEXTURE,1),this._prevFrameBuffer=this._gl.glGetParameterInt(this._gl.FRAMEBUFFER_BINDING,1),this._prevRenderBuffer=this._gl.glGetParameterInt(this._gl.RENDERBUFFER_BINDING,1),this._activeAttribusInfo=[];for(var e=this._gl.glGetProgramParameter(this._prevProgram,gl.ACTIVE_ATTRIBUTES),t=0;t<e;++t){var i=this._gl.getActiveAttrib(this._prevProgram,t),r=i.name,n=this._gl.getAttribLocation(this._prevProgram,r),o=this._gl.getVertexAttrib(n,this._gl.VERTEX_ATTRIB_ARRAY_SIZE),a=this._gl.getVertexAttrib(n,this._gl.VERTEX_ATTRIB_ARRAY_TYPE),s=this._gl.getVertexAttrib(n,this._gl.VERTEX_ATTRIB_ARRAY_NORMALIZED),h=this._gl.getVertexAttrib(n,this._gl.VERTEX_ATTRIB_ARRAY_STRIDE),c=this._gl.getVertexAttribOffset(n,gl.VERTEX_ATTRIB_ARRAY_POINTER);if(i.name=r,i.index=n,i.size=o,i.type=a,i.normalized=s,i.stride=h,i.offset=c,void 0!==this._gl.recordVertexAttribPointer)for(var l=0;l<this._gl.recordVertexAttribPointer.length;l++){var u=this._gl.recordVertexAttribPointer[l];if(i.index==u.index&&i.type==u.type&&i.stride==u.stride&&i.offset==u.offset){i.index=u.index,i.size=u.size,i.type=u.type,i.normalized=u.normalized,i.stride=u.stride,i.offset=u.offset;break}}this.debugLog("save name:"+i.name+" index:"+i.index+" size:"+i.size+" type:"+i.type+" normalized:"+i.normalized+" stride:"+i.stride+" offset:"+i.offset),this._activeAttribusInfo.push(i)}},e.prototype.restore=function(){if(this._gl.viewport(this._prevVP[0],this._prevVP[1],this._prevVP[2],this._prevVP[3]),this._gl.useProgram(this._prevProgram),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._prevVBO),this._activeAttribusInfo.length>0){this._activeAttribusInfo[0].stride;for(var e=0;e<this._activeAttribusInfo.length;e++){var t=this._activeAttribusInfo[e],i=(t.name,t.index),r=t.size,n=t.type,o=t.normalized,a=t.offset,s=t.stride,h=0!=o;this.debugLog("restore name:"+t.name+" index:"+i+" size:"+r+" type:"+n+" normalized:"+o+" stride:"+s+" offset:"+a),this._gl.vertexAttribPointer(i,r,n,h,s,a,!0)}}this._activeAttribusInfo=[],this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this._prevIBO),this._gl.activeTexture(this._prevTextureUnit),this._gl.bindTexture(this._gl.TEXTURE_2D,this._prevTextureID),this._gl.glBindFramebuffer(this._gl.FRAMEBUFFER,this._prevFrameBuffer),this._gl.glBindRenderbuffer(this._gl.RENDERBUFFER,this._prevRenderBuffer)},e.prototype.setViewport=function(e,t,i,r){this._gl.viewport(e,t,i,r)},e.prototype.setProjection=function(e){this._projMat=e},e.prototype.calculateProjection=function(){var e=this._projMat.data;this._gl.useProgram(this._program);var t=this._gl.getUniformLocation(this._program,"projMat");this._gl.uniformMatrix4fv(t,!1,e);var i=this._gl.getUniformLocation(this._program,"uSampler");this._gl.uniform1i(i,0);this._gl.getError()},e.prototype.debugLog=function(e){},e.prototype.getProjection=function(){return this._projMat},e.prototype.drawMesh=function(e,t,i,r,n){this._program=n,this._gl.useProgram(this._program),this.__loadArrayBuffer();var o=this._gl.getUniformLocation(this._program,"worldMat");this._gl.uniformMatrix4fv(o,!1,i.data),this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,r),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._vbo),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.STATIC_DRAW),this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this._ibo),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,t,this._gl.STATIC_DRAW),this._gl.drawElements(this._gl.TRIANGLES,t.length,this._gl.UNSIGNED_SHORT,0)},e}();return{GLRenderNode:function(){function e(e,t){this._context=e,this._parent=null,this._childrens=new Array,this._textureID=0,this._localMatrix=new BK.JSMatrix,this._worldMatrix=new BK.JSMatrix,this._localTransform=new BK.JSTransform,this._zOrder=0,this._needSort=!1,this._needUpdate=!0,this._needUpdateWorldMatrix=!0,this.canUserInteract=!1,this.hidden=!1,this._hasDispose=!1,this.program=void 0,this._vs=t&&t.vs?t.vs:null,this._fs=t&&t.fs?t.fs:null}return Object.defineProperty(e.prototype,"path",{set:function(e){this._path!=e&&(this._path=e,0!=this._textureID&&(this._context.gl.deleteTexture(this._textureID),this._textureID=0))},enumerable:!0,configurable:!0}),e.prototype.setUrlPath=function(e,t){new BK.HttpUtil(e).requestAsync(function(i,r){if(1!=this._hasDispose){if(200==r){var n="GameSandBox://ad/"+e;BK.FileUtil.writeBufferToFile(n,i),this.path=n}else BK.Script.log(1,1,"Fetch advertisement Sent image failed.");t&&t(this,r)}else BK.Script.log(1,1,"node hasn been disposed.response ignore")}.bind(this))},Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},set:function(e){this._parent=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zOrder",{get:function(){return this._zOrder},set:function(e){this._zOrder!=e&&(this._needSort=!0,this._zOrder=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this._localTransform.scale},set:function(e){var t=this._localTransform.scale;t.x==e.x&&t.y==e.y&&t.z==e.z||(this._needUpdate=!0,this._localTransform.scale=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this._localTransform.rotation},set:function(e){var t=this._localTransform.rotation;t.x==e.x&&t.y==e.y&&t.z==e.z||(this._localTransform.rotation=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this._localTransform.position},set:function(e){var t=this._localTransform.position;t.x==e.x&&t.y==e.y&&t.z==e.z||(this._localTransform.position=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentSize",{get:function(){return this._localTransform.getContentSize()},set:function(e){var t=this._localTransform.contentSize;t.width==e.width&&t.height==e.height||(this._needUpdate=!0,this._localTransform.contentSize=e)},enumerable:!0,configurable:!0}),e.prototype.getContentSize=function(){return this._localTransform.getContentSize()},e.prototype.setContentSize=function(e,t){this._localTransform.setContentSize(e,t)},Object.defineProperty(e.prototype,"localPivot",{get:function(){return this._localTransform.localPivot},set:function(e){var t=this._localTransform.localPivot;t.x==e.x&&t.y==e.y||(this._localTransform.localPivot=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localAnchor",{get:function(){return this._localTransform.localAnchor},set:function(e){var t=this._localTransform.localAnchor;t.x==e.x&&t.y==e.y||(this._localTransform.localAnchor=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pivotParent",{get:function(){return this._localTransform.pivotParent},set:function(e){var t=this._localTransform.pivotParent;t.x==e.x&&t.y==e.y||(this._localTransform.pivotParent=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchorParent",{get:function(){return this._localTransform.anchorParent},set:function(e){var t=this._localTransform.anchorParent;t.x==e.x&&t.y==e.y||(this._localTransform.anchorParent=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"worldMatrix",{get:function(){if(0==this.__needUpdateTransform())return this._worldMatrix.clone();var e=this.matrixFromLocal(),t=null!=this._parent?this._parent.worldMatrix:new BK.JSMatrix;return this.__updateWorldMatrix(t.mul(e)),this._worldMatrix.clone()},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){if(this.children)for(var e=0;e<this.children.length;e++)this.children[e].dispose();this._context.gl.deleteTexture(this._textureID),this._hasDispose=!0},e.prototype.addChild=function(e){for(var t=0;t<this._childrens.length;t++)if(this._childrens[t]==e||null!=e.parent)return BK.Script.log(0,0,"BK.Node.addChild!node has been in node tree"),!1;return e.parent=this,this._needSort=!0,this._childrens.push(e),!0},Object.defineProperty(e.prototype,"children",{get:function(){return this._childrens},enumerable:!0,configurable:!0}),e.prototype.__needUpdateTransform=function(){return 1==this._needUpdateWorldMatrix||1==this._localTransform.getNeedUpdate()||null!=this._parent&&(this._needUpdateWorldMatrix=this._parent.__needUpdateTransform(),this._needUpdateWorldMatrix)},e.prototype.__updateWorldMatrix=function(e){this._worldMatrix=e,this._needUpdateWorldMatrix=!1,this._childrens.forEach(function(e){e._needUpdateWorldMatrix=!0})},e.prototype.matrixFromLocal=function(){if(0==this._localTransform.getNeedUpdate())return this._localMatrix.clone();var e;e=null!=this._parent?this._localTransform.update(this._parent._localTransform.transform[0],this._parent._localTransform.transform[1]):this._localTransform.update(0,0);var t=new BK.JSMatrix;t.translate(e[8],e[9],e[10]),t.rotate(e[5],e[6],e[7]),t.scale(e[2],e[3],e[4]);var i=new BK.JSMatrix;if(i.data[12]=-e[11],i.data[13]=-e[12],this._localMatrix=t.mul(i),null!=this._parent){var r=new BK.JSMatrix;r.data[12]=e[15],r.data[13]=e[16],this._localMatrix=r.mul(t)}return this._localMatrix.clone()},e.prototype.loadTexture=function(){if(0==this._textureID){if(this._path){var e=BK.Image.loadImage(this._path);if(!e)return 0;var t=this._context.gl;this._textureID=t.createTexture(),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this._textureID),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.glTexParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.glTexParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e)}return 1}return this._textureID},e.prototype.render=function(){if(1!=this.hidden){1==this._needSort&&(this._needSort=!1,this._childrens.sort(function(e,t){return e._zOrder<t._zOrder?1:0}));var e=this._localTransform.transform[0],t=this._localTransform.transform[1],i=new Uint16Array([0,1,2,0,2,3]),r=new Float32Array([0,0,0,1,e,0,1,1,e,t,1,0,0,t,0,0]),n=this.loadTexture();0!=n&&(this.program||(this.program=this._context.__loadShader(this._vs,this._fs)),this._context.drawMesh(r,i,this.worldMatrix,n,this.program));for(var o=0;o<this._childrens.length;o++)this._childrens[o].render()}},e.prototype.__log=function(e){BK.Script.log(1,1,"GLRenderNode:"+e)},e.prototype.hittest=function(e){this._context.getProjection();var t=this.worldMatrix,i={x:0,y:0},r={x:i.x+this.contentSize.width,y:i.y+this.contentSize.height},n=t.mulPoint(i),o=t.mulPoint(r);return e.x>=n.x&&e.x<=o.x&&e.y>=n.y&&e.y<=o.y},e}(),GLRenderContext:e}}();e.GLRenderNode=i.GLRenderNode,e.GLRenderContext=i.GLRenderContext}}(BK),function(e,t){"object"==typeof e&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.GLRenderButton=t())}(BK,function(){return function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.updateTexture=function(e){},n.__nativeObj=new BK.GLRenderNode(t),n.contentSize={width:i,height:r},n.isCancelClick=void 0,n.touchStatus=0,n.canUserInteract=!0,n.enable=!0,n.canClick=!0,n.addTouchListener(),n}return __extends(t,e),t.prototype.addTouchListener=function(){"undefined"!=typeof UIEventHandler?(UIEventHandler.addNodeEvent(this,1,function(e,t,i,r){e.isCancelClick=!1,e.enable?e.changeStatus(1):e.changeStatus(2)}.bind(this)),UIEventHandler.addNodeEvent(this,2,function(e,t,i,r){var n={x:i,y:r};0==e.hittest(n)&&(e.isCancelClick=!0)}.bind(this)),UIEventHandler.addNodeEvent(this,3,function(e,t,i,r){e.enable?e.changeStatus(0):e.changeStatus(2),0==e.isCancelClick&&e.touchInsideCallback&&1==this.canClick&&e.touchInsideCallback(e)}.bind(this))):BK.Script.log(1,1,"UIEventHandler is undefined")},t.prototype.dispose=function(){UIEventHandler.removeNodeEvent(this,1),UIEventHandler.removeNodeEvent(this,2),UIEventHandler.removeNodeEvent(this,3),e.prototype.dispose.call(this)},t.prototype.changeStatus=function(e){this.touchStatus=e,this.updateTexture(e)},t.prototype.setTouchInsideCallback=function(e){this.touchInsideCallback=e},t}(BK.GLRenderNode)}),function(e,t){"object"==typeof e&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=void 0:"function"==typeof define&&define.amd?define(t):e.PlusTips=void 0)}(BK,function(){}),function(e,t){if("object"==typeof e){var i=function(){var e="attribute vec3 Position;    attribute vec2 TexCoordIn;    attribute vec4 SourceColor;    uniform mat4 ModelView;    uniform mat4 Projection;    varying vec4 DestColor;    varying vec2 TexCoordOut;    void main()    {        mat4 gWVP = Projection * ModelView;        gl_Position = gWVP * vec4(Position, 1);        DestColor = SourceColor;        TexCoordOut = TexCoordIn;    }",t="varying lowp vec2 TexCoordOut;    uniform int formatYUV;    uniform sampler2D samplerY;    uniform sampler2D samplerU;    uniform sampler2D samplerV;    uniform sampler2D samplerUV;    const lowp vec3 defyuv = vec3(-0.0/255.0, -128.0/255.0, -128.0/255.0);    void main(void)    {        lowp vec3 yuv = vec3(0.0);        if (formatYUV == 0) {            yuv.x = texture2D(samplerY, TexCoordOut).r;            yuv.y = texture2D(samplerU, TexCoordOut).r;            yuv.z = texture2D(samplerV, TexCoordOut).r;            yuv += defyuv;        } else if (formatYUV == 1) {            yuv.x = texture2D(samplerY, TexCoordOut).r;            yuv.y = texture2D(samplerUV, TexCoordOut).a;            yuv.z = texture2D(samplerUV, TexCoordOut).r;            yuv += defyuv;        } else if (formatYUV == 3) {            yuv.x = texture2D(samplerY, TexCoordOut).r;            yuv.y = texture2D(samplerUV, TexCoordOut).r;            yuv.z = texture2D(samplerUV, TexCoordOut).a;            yuv += defyuv;        }        lowp vec3 rgb = mat3(1.0, 1.0, 1.0,                            0.0, -.34414, 1.772,                            1.402, -.71414, 0.0) * yuv;        gl_FragColor = vec4(rgb, 1.0);    }",i=(function(){function e(){}}(),function(){function e(){}}(),function(){function e(){this.videoViews=new Array,void 0!==BK.Director.setQAVDelegate&&BK.Director.setQAVDelegate(this)}return e.prototype.addView=function(e){var t=this.videoViews.filter(function(t){return e==t});return t.length||this.videoViews.push(e),0==t.length},e.prototype.delView=function(e){var t=this.videoViews.length;return this.videoViews=this.videoViews.filter(function(t){return e!=t}),t!=this.videoViews.length},e.prototype.onRemoveVideoPreview=function(e){this.videoViews.forEach(function(t){t.identifier==e.identifier&&t.render(e)})},e.prototype.onLocalVideoPreview=function(e){this.videoViews.forEach(function(t){if(t.identifier==e.identifier){var i=e,r=t;r.onPrePreview&&(i=r.onPrePreview.call(r,e)),t.render(i)}})},e.prototype.onLocalVideoPreProcess=function(e){this.videoViews.forEach(function(t){if(t.identifier==e.identifier){var i=t;i.onPreProcess&&i.onPreProcess.call(i,e)}})},e.Instance=new e,e}()),r=function(){function r(e,t,r,n,o,a,s){this.identifier=e,this.__nativeObj=new BK.Sprite(t,r,null,0,0,1,1),this._innerBindMethods4NativeObj(),null!=n&&void 0!=n||(n=!0),a&&(this.position=a),o?o.addChild(this):BK.Director.root.addChild(this),s&&(this.zOrder=s),1==n&&i.Instance.addView(this)}return r.prototype._innerBindMethods4NativeObj=function(e){var t=this;Object.getOwnPropertyNames(this.__nativeObj).forEach(function(i,r,n){var o=i;e&&-1!=e.indexOf(o)||Object.defineProperty(t,o,{get:function(){return this.__nativeObj[o]},set:function(e){this.__nativeObj[o]=e},enumerable:!0,configurable:!0})})},r.prototype.addChild=function(e){this.__nativeObj&&this.__nativeObj.addChild(e)},r.prototype._restartRenderTimer=function(){this.__renderTimeoutCallback&&this.__renderTimeoutThreshold>0&&(BK.Director.ticker.removeTimeout(this),BK.Director.ticker.setTimeout(function(e,t,i){this.__renderTimeoutCallback&&this.__renderTimeoutCallback.call(this)},this.__renderTimeoutThreshold,this))},r.prototype._innerUseRGBA=function(e,t){if(this.__bitmap){var i=this.__bitmap.size;i.width==e&&i.height==t||(BK.Script.log(0,0,"BK.QAVView.useRGBA!size change, ow = "+i.width+", oh = "+i.height+", nw = "+e+", nh = "+t),this.__bitmap=BK.Texture.createBitmapTexture(e,t),this.__nativeObj.setTexture(this.__bitmap))}else this.__bitmap=BK.Texture.createBitmapTexture(e,t),this.__nativeObj.setTexture(this.__bitmap)},r.prototype._innerUseYUVMaterial_I420=function(i,r){if(this.__yuvMaterial||(this.__yuvMaterial=new BK.Render.Material(e,t,!0),this.__nativeObj.attachComponent(this.__yuvMaterial),this.__yuvMaterial.uniforms.samplerY=0,this.__yuvMaterial.uniforms.samplerU=1,this.__yuvMaterial.uniforms.samplerV=2,this.__yuvMaterial.uniforms.samplerUV=3),this.__bitmapY?(n=this.__bitmapY.size).width==i&&n.height==r||(BK.Script.log(0,0,"BK.QAVView.useYUVMaterial_I420!Y size change, ow = "+n.width+", oh = "+n.height+", nw = "+i+", nh = "+r),this.__bitmapY=BK.Texture.createBitmapTexture(i,r,7),this.__yuvMaterial.setTexture(0,this.__bitmapY)):(this.__bitmapY=BK.Texture.createBitmapTexture(i,r,7),this.__yuvMaterial.setTexture(0,this.__bitmapY)),this.__bitmapU?(n=this.__bitmapU.size).width==i/2&&n.height==r/2||(BK.Script.log(0,0,"BK.QAVView.useYUVMaterial_I420!U size change, ow = "+n.width+", oh = "+n.height+", nw = "+i+", nh = "+r),this.__bitmapU=BK.Texture.createBitmapTexture(i/2,r/2,7),this.__yuvMaterial.setTexture(1,this.__bitmapU)):(this.__bitmapU=BK.Texture.createBitmapTexture(i/2,r/2,7),this.__yuvMaterial.setTexture(1,this.__bitmapU)),this.__bitmapV){var n=this.__bitmapV.size;n.width==i/2&&n.height==r/2||(BK.Script.log(0,0,"BK.QAVView.useYUVMaterial_I420!V size change, ow = "+n.width+", oh = "+n.height+", nw = "+i+", nh = "+r),this.__bitmapV=BK.Texture.createBitmapTexture(i/2,r/2,7),this.__yuvMaterial.setTexture(2,this.__bitmapV))}else this.__bitmapV=BK.Texture.createBitmapTexture(i/2,r/2,7),this.__yuvMaterial.setTexture(2,this.__bitmapV)},r.prototype._innerUseYUVMaterial_NVxx=function(i,r){if(this.__yuvMaterial||(this.__yuvMaterial=new BK.Render.Material(e,t,!0),this.__nativeObj.attachComponent(this.__yuvMaterial),this.__yuvMaterial.uniforms.samplerY=0,this.__yuvMaterial.uniforms.samplerU=1,this.__yuvMaterial.uniforms.samplerV=2,this.__yuvMaterial.uniforms.samplerUV=3),this.__bitmapY?(n=this.__bitmapY.size).width==i&&n.height==r||(BK.Script.log(0,0,"BK.QAVView.useYUVMaterial_NVxx!Y size change, ow = "+n.width+", oh = "+n.height+", nw = "+i+", nh = "+r),this.__bitmapY=BK.Texture.createBitmapTexture(i,r,7),this.__yuvMaterial.setTexture(0,this.__bitmapY)):(this.__bitmapY=BK.Texture.createBitmapTexture(i,r,7),this.__yuvMaterial.setTexture(0,this.__bitmapY)),this.__bitmapUV){var n=this.__bitmapUV.size;n.width==i/2&&n.height==r/2||(BK.Script.log(0,0,"BK.QAVView.useYUVMaterial_NVxx!UV size change, ow = "+n.width+", oh = "+n.height+", nw = "+i+", nh = "+r),this.__bitmapUV=BK.Texture.createBitmapTexture(i/2,r/2,2),this.__yuvMaterial.setTexture(3,this.__bitmapUV))}else this.__bitmapUV=BK.Texture.createBitmapTexture(i/2,r/2,2),this.__yuvMaterial.setTexture(3,this.__bitmapUV)},r.prototype.render=function(e){var t=e.frameDesc.width,i=e.frameDesc.height;if(this.__nativeObj){switch(this._restartRenderTimer(),e.frameDesc.rotate){case 0:this.cameraPos&&1==this.cameraPos?this.__nativeObj.setUVFlip(1,0):this.__nativeObj.setUVFlip(1,1);break;case 1:case 2:this.cameraPos&&1==this.cameraPos?(this.__nativeObj.setUVFlip(0,1),this.__nativeObj.setUVRotate(1)):(this.__nativeObj.setUVFlip(0,0),this.__nativeObj.setUVRotate(1));break;case 3:this.cameraPos&&1==this.cameraPos?(this.__nativeObj.setUVFlip(0,1),this.__nativeObj.setUVRotate(3)):(this.__nativeObj.setUVFlip(0,0),this.__nativeObj.setUVRotate(3))}switch(e.frameDesc.colorFormat){case 10:this._innerUseRGBA(t,i),this.__bitmap.uploadSubData(0,0,t,i,e.extraData.buffer);break;case 0:this._innerUseYUVMaterial_I420(t,i),this.__yuvMaterial.uniforms.formatYUV=e.frameDesc.colorFormat,this.__bitmapY.uploadSubData(0,0,t,i,e.extraData.Y),this.__bitmapU.uploadSubData(0,0,t/2,i/2,e.extraData.U),this.__bitmapV.uploadSubData(0,0,t/2,i/2,e.extraData.V);break;case 3:case 1:this._innerUseYUVMaterial_NVxx(t,i),this.__yuvMaterial.uniforms.formatYUV=e.frameDesc.colorFormat,this.__bitmapY.uploadSubData(0,0,t,i,e.extraData.Y),this.__bitmapUV.uploadSubData(0,0,t/2,i/2,e.extraData.UV);break;default:BK.Script.log(1,-1,"BK.QAVView.render!unknown format = "+e.frameDesc.colorFormat)}}},r.prototype.renderAsCache=function(e,t,i,r,n,o,a,s){switch(o){case 0:this._innerUseYUVMaterial_I420(e,t),this.__yuvMaterial.uniforms.formatYUV=o,this.__bitmapY.uploadSubData(0,0,e,t,s.Y),this.__bitmapU.uploadSubData(0,0,e/2,t/2,s.U),this.__bitmapV.uploadSubData(0,0,e/2,t/2,s.V);break;case 3:case 1:this._innerUseYUVMaterial_NVxx(e,t),this.__yuvMaterial.uniforms.formatYUV=o,this.__bitmapY.uploadSubData(0,0,e,t,s.Y),this.__bitmapUV.uploadSubData(0,0,e/2,t/2,s.UV);break;default:return BK.Script.log(1,-1,"BK.QAVView.renderAsCache!unknown format = "+o),null}if(this.__graphic||(this.__graphic=new BK.Graphics),this.__cacheTexture?(h=this.__cacheTexture.size).width==i&&h.height==r||(BK.Script.log(0,0,"BK.QAVView.renderAsCache!cache tex size change, ow = "+h.width+", oh = "+h.height+", nw = "+i+", nh = "+r),this.__cacheTexture=new BK.RenderTexture(i,r,a)):this.__cacheTexture=new BK.RenderTexture(i,r,a),this.__cacheSprite){var h=this.__cacheSprite.size;h.width==i&&h.height==r||(this.__cacheSprite.size={width:i,height:r})}else this.__cacheSprite=new BK.Sprite(i,r,null,0,0,1,1),this.__cacheSprite.attachComponent(this.__yuvMaterial);switch(n){case 0:this.__cacheSprite.setUVFlip(1,0),this.__cacheSprite.setUVRotate(0);break;case 1:this.__cacheSprite.setUVFlip(1,0),this.__cacheSprite.setUVRotate(1);break;case 2:this.__cacheSprite.setUVFlip(0,1),this.__cacheSprite.setUVRotate(0);break;case 3:this.__cacheSprite.setUVFlip(1,0),this.__cacheSprite.setUVRotate(4)}var c=this;return this.__graphic.drawRenderTexture(this.__cacheTexture,function(){this.drawSprite(c.__cacheSprite)}),this.__cacheTexture.readPixels(0,0,i,r,a)},r.prototype.renderAsTexture=function(){var e=new BK.RenderTexture(this.__nativeObj.size.width,this.__nativeObj.size.height,6);return BK.Render.renderToTexture(this.__nativeObj,e),e},r.prototype.hittest=function(e){return this.__nativeObj.hittest(e)},r.prototype.removeFromParent=function(){this.__nativeObj&&this.__nativeObj.removeFromParent()},r.prototype.setRenderTimeout=function(e,t){this.__renderTimeoutCallback=t,this.__renderTimeoutThreshold=e,this.__renderTimeoutThreshold>0&&this._restartRenderTimer()},r}(),n=function(){function e(){this.skipNum=-1}return e.prototype.start=function(e){function t(e,t,i){if(BK.Script.log(0,0,"BK.Camera.switchCameraEvent222!data = "+JSON.stringify(i)),0==e){BK.Script.log(0,0,"BK.Camera.switchCameraEvent!data = "+JSON.stringify(i));var r=this;BK.Director.ticker.removeTimeout(this),BK.Director.ticker.setTimeout(function(e,t,n){r.view.cameraPos=i.cameraPos,r=null},160,this)}}var n=e.identifier?e.identifier:"";if(e.width&&e.height){BK.Script.log(1,0,"BK.Camera!options = "+JSON.stringify(e)),this.options=e,this.identifier=n,this.view=new r(n,e.width,e.height,!1,e.parent,e.position),i.Instance.addView(this),this.options.needFaceTracker&&(this.detector=new BK.AI.FaceDetector(!0,!0));return BK.MQQ.SsoRequest.addListener("cs.audioRoom_camera_switch.local",this,t.bind(this)),this.isStart=!1,this}},e.prototype.configCamera=function(e){if(e&&(BK.Script.log(0,0,"configCamera"),BK.Script.log(0,0,"configCamera BK.Room ok1"),e.beauty&&(BK.Script.log(0,0,"configCamera BK.Room audioRoomSetBeauty1"),this.setBeauty(e.beauty)),e.cameraPos)){BK.Script.log(0,0,"configCamera BK.Room cameraPos");e.onSwitchCamera&&e.onSwitchCamera.bind(this);this.switchCamera(e.cameraPos,function(e,t,i){BK.Script.log(0,0,"configCamera BK.Room cameraPos errCode:"+e+" cmd:"+t+" data:"+i),this.options.onSwitchCamera&&this.options.onSwitchCamera(e,t,i)})}},e.prototype.switchCamera=function(e,t){var i={cameraPos:e},r="cs.audioRoom_cameraswitch.local";BK.MQQ.SsoRequest.addListener(r,this,t.bind(this)),BK.MQQ.SsoRequest.send(i,r)},e.prototype.setBeauty=function(e){var t={beauty:e};BK.MQQ.SsoRequest.send(t,"cs.audioRoom_set_beauty.local")},e.prototype.setSpeaker=function(e){var t={speaker:e};BK.MQQ.SsoRequest.send(t,"cs.audioRoom_set_speaker.local")},e.prototype.close=function(){},e.prototype._innerConvertRGBA=function(e){var t=this.options.scaleSample?this.options.scaleSample:1,i=e.frameDesc.width,r=e.frameDesc.height,n=function(e,t,i){var r={width:e,height:t};switch(i){case 1:case 3:r.width=t,r.height=e}return r}(e.frameDesc.width,e.frameDesc.height,e.frameDesc.rotate),o={};return o.frameDesc={},o.extraData={},o.frameDesc.width=n.width*t,o.frameDesc.height=n.height*t,o.frameDesc.rotate=0,o.frameDesc.colorFormat=10,o.frameDesc.videoSrcType=e.frameDesc.videoSrcType,o.extraData.buffer=this.view.renderAsCache(i,r,n.width*t,n.height*t,e.frameDesc.rotate,e.frameDesc.colorFormat,6,e.extraData),o},e.prototype.onPrePreview=function(e){if(this.options.onPrePreview){var t=e;if(this.detector){t=this._innerConvertRGBA(e);var i=this._innerExtractBitmap(t);(this.hasFace||-1==this.skipNum)&&(this.skipNum=0,t.faceFeatures=this.detector.detectForBitmapSync(i)),void 0==t.faceFeatures||t.faceFeatures.length<=0?(this.hasFace=!1,this.skipNum=this.skipNum+1,(this.skipNum>this.options.skipFaceTrackerNum||this.skipNum==this.options.skipFaceTrackerNum)&&(t.faceFeatures=this.detector.detectForBitmapSync(i),this.skipNum=0,t.faceFeatures&&(this.hasFace=!0))):this.hasFace=!0}this.options.onPrePreview.call(this,t)}return 0==this.isStart&&(this.configCamera(this.options),this.isStart=!0),e},e.prototype.onPreProcess=function(e){return this.options.onPreProcess?this.options.onPreProcess.call(this,e):e},e.prototype.render=function(e){this.view&&this.view.render(e)},e.prototype.renderAsTexture=function(){return this.view?this.view.renderAsTexture():null},e.prototype._innerExtractBitmap=function(e){var t={};switch(t.width=e.frameDesc.width,t.height=e.frameDesc.height,t.format=e.frameDesc.colorFormat,e.frameDesc.colorFormat){case 7:t.format=3;break;case 10:t.buffer=e.extraData.buffer,t.format=6;break;default:BK.Script.log(1,-1,"BK.QAVCamera.extractBitmap!unknown format = "+e.frameDesc.colorFormat)}switch(e.frameDesc.rotate){case 0:t.oreintation=0;break;case 1:t.oreintation=1;break;case 2:t.oreintation=5;break;case 3:t.oreintation=6}return t},e.Instance=new e,e}();return{QAVView:r,QAVCamera:new n}}();e.QAVView=i.QAVView,e.AVCamera=i.QAVCamera}}(BK),function(e,t){"object"==typeof e&&(BK.QQAVManager=function(){return new(function(){function e(){this._hasInitFlag=!1,this._hasSuccEnter=!1,this._iosHasInitFlag=!1,this._isFrontCamera=!1,this._hasStartQAVRoomFlag=!1,this._callbackQueue=[],BK.MQQ.SsoRequest.addListener("cs.audioRoom_disconnect.local",this,this.__handleRoomDisconnect.bind(this)),BK.MQQ.SsoRequest.addListener("cs.audioRoom_update_userinfo.local",this,this.__handleUserUpdate.bind(this))}return e.prototype.log=function(e){BK.Script.log(0,0,"QQAVManager:"+e)},e.prototype.errorLog=function(e){BK.Script.log(1,1,"QQAVManager Error:"+e)},e.prototype.setQAVCfg=function(e){this.qavCfg=e},e.prototype.setUpdateUserInfoCallback=function(e){var t="cs.audioRoom_update_userinfo.local";BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,e)},e.prototype.setEventCallbackConfig=function(e){this.eventCallbackConfig=e},e.prototype.initQAV=function(e,t){this.setQAVCfg(e),this.__startQAVRoom(t)},e.prototype.setMic=function(e,t){this.__enterQAVRoomIfNeed(function(i){if(0==i){var r={switch:e},n="cs.audioRoom_set_mic.local";BK.MQQ.SsoRequest.removeListener(n,this),BK.MQQ.SsoRequest.addListener(n,this,t),BK.MQQ.SsoRequest.send(r,n)}else this.errorLog("setMic failed!start qav room failed")}.bind(this))},e.prototype.setSpeaker=function(e,t){this.__enterQAVRoomIfNeed(function(i){if(0==i){var r={switch:e},n="cs.audioRoom_set_speaker.local";BK.MQQ.SsoRequest.removeListener(n,this),BK.MQQ.SsoRequest.addListener(n,this,t),BK.MQQ.SsoRequest.send(r,n)}else this.errorLog("setSpeaker failed!start qav room failed")}.bind(this))},e.prototype.switchCamera=function(e,t){this.__enterQAVRoomIfNeed(function(i){if(0==i){var r={cameraPos:e},n="cs.audioRoom_camera_switch.local";BK.MQQ.SsoRequest.removeListener(n,this),BK.MQQ.SsoRequest.addListener(n,this,function(i,r,n){0==i&&(this._isFrontCamera=0==e),t(i,r,n)}.bind(this)),BK.MQQ.SsoRequest.send(r,n)}else this.errorLog("switchCamera failed!start qav room failed")}.bind(this))},e.prototype.enableCamera=function(e,t){this.__enterQAVRoomIfNeed(function(i){if(0==i){var r={switch:e},n="cs.audioRoom_camera_enable.local";this._isFrontCamera=!0,BK.MQQ.SsoRequest.removeListener(n,this),BK.MQQ.SsoRequest.addListener(n,this,t),BK.MQQ.SsoRequest.send(r,n)}else this.errorLog("enableCamera failed!start qav room failed")}.bind(this))},e.prototype.setBeauty=function(e){this.__enterQAVRoomIfNeed(function(t){if(0==t){var i={beauty:e};BK.MQQ.SsoRequest.send(i,"cs.audioRoom_set_beauty.local")}else this.errorLog("setBeauty failed!start qav room failed")}.bind(this))},e.prototype.setLocalVideo=function(e){this.__enterQAVRoomIfNeed(function(t){if(0==t){var i={switch:e};BK.MQQ.SsoRequest.send(i,"cs.audioRoom_set_local_video.local")}else this.errorLog("setLocalVideo failed!start qav room failed")}.bind(this))},e.prototype.watchRemoteVideo=function(e){this.__enterQAVRoomIfNeed(function(t){if(0==t){this.log("watchRemoteVideo ok1");var i={openIdList:e};BK.MQQ.SsoRequest.send(i,"cs.audioRoom_watch_remote_video.local"),this.log("watchRemoteVideo ok2")}else this.errorLog("watchRemoteVideo failed!start qav room failed")}.bind(this))},e.prototype.setRemoteVideo=function(e){this.__enterQAVRoomIfNeed(function(t){if(0==t){var i={switch:e};BK.MQQ.SsoRequest.send(i,"cs.audioRoom_set_remote_video.local")}else this.errorLog("setMic failed!start qav room failed")}.bind(this))},e.prototype.exitRoom=function(e){this._hasInitFlag=!1,this.__exitQAVRoom(function(t,i,r){this.log("exit qav room errCode:"+t),e(t,i,r)}.bind(this))},e.prototype.getEndpointList=function(e){var t={},i="cs.audioRoom_get_endpointList.local";e&&(BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,e)),BK.MQQ.SsoRequest.send(t,i)},e.prototype.isFrontCamera=function(){return this._isFrontCamera},e.prototype.getFluidCtrlCfg=function(e,t){var i="cs.audioRoom_get_fluid_ctrl_cfg.local";t&&(BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,t)),BK.MQQ.SsoRequest.send(e,i)},e.prototype.changeAudioCategory=function(e,t){var i="cs.audioRoom_change_audio_category.local",r={category:e};t&&(BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,t)),BK.MQQ.SsoRequest.send(r,i)},e.prototype.changeQAVRole=function(e,t){var i="cs.audioRoom_change_qav_role.local",r={role:e};t&&(BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,t)),BK.MQQ.SsoRequest.send(r,i)},e.prototype.__enterQAVRoomIfNeed=function(e){this._hasSuccEnter?e(0):(this.log("__enterQAVRoomIfNeed entering qav room."),this._callbackQueue.push(e),0==this._hasStartQAVRoomFlag&&(this._hasStartQAVRoomFlag=!0,this.__startQAVRoom(function(e,t,i){for(var r=0;r<this._callbackQueue.length;r++)(0,this._callbackQueue[r])(e);this._callbackQueue.splice(0,this._callbackQueue.length)}.bind(this))))},e.prototype.initQAVRoom=function(e,t){var i="cs.audioRoom_init.local";if("ios"==GameStatusInfo.platform&&1==this._iosHasInitFlag)return this.log("ios init once "),void t(0,i,this._initData);1!=this._hasInitFlag?(BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,function(e,i,r){this.log("cmd:"+i+" errCode:"+e+" data:"+JSON.stringify(r)),0==e&&(this._hasInitFlag=!0,this._initData=r,"ios"==GameStatusInfo.platform&&(this._iosHasInitFlag=!0,this.log("_iosHasInitFlag"))),t(e,i,r)}.bind(this)),BK.MQQ.SsoRequest.send(e,i)):this.log("AVRoom has been init .can't init Room twice !!")},e.prototype.enterQAVRoom=function(e,t){var i=e.gameRoomId,r=e.avRoomId,n=e.avRoleName,o={avRoomId:r,gameRoomId:i,avRoleName:n,avKey:e.avKey};this.avRoomId=r,this.gameRoomId=i,this.avRoleName=n;var a="cs.audioRoom_enter.local";BK.MQQ.SsoRequest.removeListener(a,this),BK.MQQ.SsoRequest.addListener(a,this,function(e,i,r){this.log("cmd:"+i+" errCode:"+e+" data:"+JSON.stringify(r)),t(e,i,r)}.bind(this)),BK.MQQ.SsoRequest.send(o,a),BK.MQQ.SsoRequest.removeListener("cs.close_room.local",this),BK.MQQ.SsoRequest.addListener("cs.close_room.local",this,function(e,t,i){this.log("BK.QAVManager.closeGame!exitQAVRoom, avRoomId = "+this.avRoomId),this.__exitQAVRoom()}.bind(this)),BK.MQQ.SsoRequest.removeListener("cs.audioRoom_req_audio_session.local",this),BK.MQQ.SsoRequest.addListener("cs.audioRoom_req_audio_session.local",this,function(e,t,i){this.log("BK.QAVManager.reqAudioSession!result = "+JSON.stringify(i))}.bind(this))},e.prototype.__exitQAVRoom=function(e){var t={avRoomId:this.avRoomId},i="cs.audioRoom_exit.local";BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,e),BK.MQQ.SsoRequest.send(t,i)},e.prototype.__checkGameStatusInfoParam=function(){return GameStatusInfo.avAppId?GameStatusInfo.avAccountType?GameStatusInfo.avRoomId?GameStatusInfo.roomId?{sdkAppId:GameStatusInfo.avAppId,accountType:GameStatusInfo.avAccountType,avRoomId:GameStatusInfo.avRoomId,gameRoomId:GameStatusInfo.roomId}:(this.log("GameStatusInfo.roomId is null"),null):(this.log("GameStatusInfo.avRoomId is null"),null):(this.log("GameStatusInfo.avAccountType is null"),null):(this.log("GameStatusInfo.avAppId is null"),null)},e.prototype.__addQAVCfg=function(e){if(this.qavCfg)for(var t in this.qavCfg)if(this.qavCfg.hasOwnProperty(t)){var i=this.qavCfg[t];e[t]=i}return e},e.prototype.__startQAVRoom=function(e){if(GameStatusInfo.devPlatform){var t={sdkAppId:1400035750,accountType:14181,avRoomId:122333,gameRoomId:54321,selfOpenId:GameStatusInfo.openId};t=this.__addQAVCfg(t),this.initAndEnterRoom(t,e)}else(t=this.__checkGameStatusInfoParam())?(t=this.__addQAVCfg(t),this.initAndEnterRoom(t,function(t,i,r){e(t,i,r)}.bind(this))):BK.QQ.addSSOJoinRoomCallBack(function(t,i,r){r.gameRoomId&&r.avRoomId&&r.sdkAppId&&r.accountType?(r=this.__addQAVCfg(r),this.initAndEnterRoom(r,e)):BK.Script.log(0,0,"addSSOJoinRoomCallBack data is incorrect.")}.bind(this))},e.prototype.initAndEnterRoom=function(e,t){void 0!=e.sdkAppId?void 0!=e.accountType?void 0!=e.avRoomId?void 0!=e.gameRoomId?(this.setQAVCfg(e),this.log("initAndEnterRoom step1 initRoom cfg:"+JSON.stringify(e)),this.initQAVRoom(e,function(i,r,n){0==i?(this.log("initAndEnterRoom step2 enterRoom"),this.enterQAVRoom(e,function(e,i,r){0==e?(this.log("initAndEnterRoom step2 enterRoom succ!"),this._hasSuccEnter=!0):this._hasStartQAVRoomFlag=!1,t(e,i,r)}.bind(this))):(this.log("initAndEnterRoom failed cmd:"+r+" errCode:"+i+" data:"+JSON.stringify(n)),this._hasStartQAVRoomFlag=!1,t(i,r,n))}.bind(this))):this.log("initAndEnterRoom gameRoomId is null;"):this.log("initAndEnterRoom avRoomId is null;"):this.log("initAndEnterRoom accountType is null;"):this.log("initAndEnterRoom sdkAppId is null;")},e.prototype.__handleUserUpdate=function(e,t,i){i&&(this.log("handleUserUpdate data:"+JSON.stringify(i)),1==i.eventId?(this.log("\u8fdb\u5165\u623f\u95f4\u4e8b\u4ef6:"+JSON.stringify(i.userInfo)),this.eventCallbackConfig&&this.eventCallbackConfig.eventEnterCallback&&this.eventCallbackConfig.eventEnterCallback(i.eventId,i)):2==i.eventId?(this.log("\u9000\u51fa\u623f\u95f4\u4e8b\u4ef6:"+JSON.stringify(i.userInfo)),this.eventCallbackConfig&&this.eventCallbackConfig.eventExitCallback&&this.eventCallbackConfig.eventExitCallback(i.eventId,i)):3==i.eventId?(this.log("\u6709\u53d1\u6444\u50cf\u5934\u89c6\u9891\u4e8b\u4ef6\u3002:"+JSON.stringify(i.userInfo)),this.eventCallbackConfig&&this.eventCallbackConfig.eventHasCameraVideoCallback&&this.eventCallbackConfig.eventHasCameraVideoCallback(i.eventId,i)):4==i.eventId?(this.log("\u65e0\u53d1\u6444\u50cf\u5934\u89c6\u9891\u4e8b\u4ef6\u3002:"+JSON.stringify(i.userInfo)),this.eventCallbackConfig&&this.eventCallbackConfig.eventNoCameraVideoCallback&&this.eventCallbackConfig.eventNoCameraVideoCallback(i.eventId,i)):5==i.eventId?(this.log("\u6709\u53d1\u8bed\u97f3\u4e8b\u4ef6\u3002:"+JSON.stringify(i.userInfo)),this.eventCallbackConfig&&this.eventCallbackConfig.eventHasAudioCallback&&this.eventCallbackConfig.eventHasAudioCallback(i.eventId,i)):6==i.eventId?(this.log("\u65e0\u53d1\u8bed\u97f3\u4e8b\u4ef6\u3002:"+JSON.stringify(i.userInfo)),this.eventCallbackConfig&&this.eventCallbackConfig.eventNoAudioCallback&&this.eventCallbackConfig.eventNoAudioCallback(i.eventId,i)):7==i.eventId?(this.log("\u6709\u53d1\u5c4f\u5e55\u89c6\u9891\u4e8b\u4ef6\u3002:"+JSON.stringify(i.userInfo)),this.eventCallbackConfig&&this.eventCallbackConfig.eventHasScreenVideoCallback&&this.eventCallbackConfig.eventHasScreenVideoCallback(i.eventId,i)):8==i.eventId?(this.log("\u65e0\u53d1\u5c4f\u5e55\u89c6\u9891\u4e8b\u4ef6\u3002:"+JSON.stringify(i.userInfo)),this.eventCallbackConfig&&this.eventCallbackConfig.eventNoScreenVideoCallback&&this.eventCallbackConfig.eventNoScreenVideoCallback(i.eventId,i)):9==i.eventId?(this.log("\u6709\u53d1\u6587\u4ef6\u89c6\u9891\u4e8b\u4ef6\u3002:"+JSON.stringify(i.userInfo)),this.eventCallbackConfig&&this.eventCallbackConfig.eventHasMediaFileCallback&&this.eventCallbackConfig.eventHasMediaFileCallback(i.eventId,i)):10==i.eventId?(this.log("\u65e0\u53d1\u6587\u4ef6\u89c6\u9891\u4e8b\u4ef6\u3002:"+JSON.stringify(i.userInfo)),this.eventCallbackConfig&&this.eventCallbackConfig.eventNoMediaFileCallback&&this.eventCallbackConfig.eventNoMediaFileCallback(i.eventId,i)):42==i.eventId?(this.log("\u65b0\u6210\u5458\u8bf4\u8bdd:"+JSON.stringify(i.userInfo)),this.eventCallbackConfig&&this.eventCallbackConfig.eventNewSpeakCallback&&this.eventCallbackConfig.eventNewSpeakCallback(i.eventId,i)):43==i.eventId&&(this.log("\u65e7\u6210\u5458\u505c\u6b62\u8bf4\u8bdd:"+JSON.stringify(i.userInfo)),this.eventCallbackConfig&&this.eventCallbackConfig.eventOldStopSpeakCallback&&this.eventCallbackConfig.eventOldStopSpeakCallback(i.eventId,i)))},e.prototype.__handleRoomDisconnect=function(e,t,i){this.eventCallbackConfig&&this.eventCallbackConfig.eventRoomDisconnectCallback&&this.eventCallbackConfig.eventRoomDisconnectCallback(i)},e}())}())}(BK),function(e,t){"object"==typeof e&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.QRCode=t())}(BK,function(){function e(e){this.mode=s.MODE_8BIT_BYTE,this.data=e,this.parsedData=[];for(var t=0,i=this.data.length;t<i;t++){var r=[],n=this.data.charCodeAt(t);n>65536?(r[0]=240|(1835008&n)>>>18,r[1]=128|(258048&n)>>>12,r[2]=128|(4032&n)>>>6,r[3]=128|63&n):n>2048?(r[0]=224|(61440&n)>>>12,r[1]=128|(4032&n)>>>6,r[2]=128|63&n):n>128?(r[0]=192|(1984&n)>>>6,r[1]=128|63&n):r[0]=n,this.parsedData.push(r)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function t(e,t){this.typeNumber=e,this.errorCorrectLevel=t,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function i(e,t){if(void 0==e.length)throw new Error(e.length+"/"+t);for(var i=0;i<e.length&&0==e[i];)i++;this.num=new Array(e.length-i+t);for(var r=0;r<e.length-i;r++)this.num[r]=e[r+i]}function r(e,t){this.totalCount=e,this.dataCount=t}function n(){this.buffer=[],this.length=0}function o(e,t){for(var i=1,r=a(e),n=0,o=_.length;n<=o;n++){var s=0;switch(t){case h.L:s=_[n][0];break;case h.M:s=_[n][1];break;case h.Q:s=_[n][2];break;case h.H:s=_[n][3]}if(r<=s)break;i++}if(i>_.length)throw new Error("Too long data");return i}function a(e){var t=encodeURI(e).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return t.length+(t.length!=e?3:0)}e.prototype={getLength:function(e){return this.parsedData.length},write:function(e){for(var t=0,i=this.parsedData.length;t<i;t++)e.put(this.parsedData[t],8)}},t.prototype={addData:function(t){var i=new e(t);this.dataList.push(i),this.dataCache=null},isDark:function(e,t){if(e<0||this.moduleCount<=e||t<0||this.moduleCount<=t)throw new Error(e+","+t);return this.modules[e][t]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(e,i){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++){this.modules[r]=new Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++)this.modules[r][n]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(e,i),this.typeNumber>=7&&this.setupTypeNumber(e),null==this.dataCache&&(this.dataCache=t.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,i)},setupPositionProbePattern:function(e,t){for(var i=-1;i<=7;i++)if(!(e+i<=-1||this.moduleCount<=e+i))for(var r=-1;r<=7;r++)t+r<=-1||this.moduleCount<=t+r||(this.modules[e+i][t+r]=0<=i&&i<=6&&(0==r||6==r)||0<=r&&r<=6&&(0==i||6==i)||2<=i&&i<=4&&2<=r&&r<=4)},getBestMaskPattern:function(){for(var e=0,t=0,i=0;i<8;i++){this.makeImpl(!0,i);var r=l.getLostPoint(this);(0==i||e>r)&&(e=r,t=i)}return t},createMovieClip:function(e,t,i){var r=e.createEmptyMovieClip(t,i);this.make();for(var n=0;n<this.modules.length;n++)for(var o=1*n,a=0;a<this.modules[n].length;a++){var s=1*a;this.modules[n][a]&&(r.beginFill(0,100),r.moveTo(s,o),r.lineTo(s+1,o),r.lineTo(s+1,o+1),r.lineTo(s,o+1),r.endFill())}return r},setupTimingPattern:function(){for(var e=8;e<this.moduleCount-8;e++)null==this.modules[e][6]&&(this.modules[e][6]=e%2==0);for(var t=8;t<this.moduleCount-8;t++)null==this.modules[6][t]&&(this.modules[6][t]=t%2==0)},setupPositionAdjustPattern:function(){for(var e=l.getPatternPosition(this.typeNumber),t=0;t<e.length;t++)for(var i=0;i<e.length;i++){var r=e[t],n=e[i];if(null==this.modules[r][n])for(var o=-2;o<=2;o++)for(var a=-2;a<=2;a++)this.modules[r+o][n+a]=-2==o||2==o||-2==a||2==a||0==o&&0==a}},setupTypeNumber:function(e){for(var t=l.getBCHTypeNumber(this.typeNumber),i=0;i<18;i++){r=!e&&1==(t>>i&1);this.modules[Math.floor(i/3)][i%3+this.moduleCount-8-3]=r}for(i=0;i<18;i++){var r=!e&&1==(t>>i&1);this.modules[i%3+this.moduleCount-8-3][Math.floor(i/3)]=r}},setupTypeInfo:function(e,t){for(var i=this.errorCorrectLevel<<3|t,r=l.getBCHTypeInfo(i),n=0;n<15;n++){o=!e&&1==(r>>n&1);n<6?this.modules[n][8]=o:n<8?this.modules[n+1][8]=o:this.modules[this.moduleCount-15+n][8]=o}for(n=0;n<15;n++){var o=!e&&1==(r>>n&1);n<8?this.modules[8][this.moduleCount-n-1]=o:n<9?this.modules[8][15-n-1+1]=o:this.modules[8][15-n-1]=o}this.modules[this.moduleCount-8][8]=!e},mapData:function(e,t){for(var i=-1,r=this.moduleCount-1,n=7,o=0,a=this.moduleCount-1;a>0;a-=2)for(6==a&&a--;;){for(var s=0;s<2;s++)if(null==this.modules[r][a-s]){var h=!1;o<e.length&&(h=1==(e[o]>>>n&1)),l.getMask(t,r,a-s)&&(h=!h),this.modules[r][a-s]=h,-1==--n&&(o++,n=7)}if((r+=i)<0||this.moduleCount<=r){r-=i,i=-i;break}}}},t.PAD0=236,t.PAD1=17,t.createData=function(e,i,o){for(var a=r.getRSBlocks(e,i),s=new n,h=0;h<o.length;h++){var c=o[h];s.put(c.mode,4),s.put(c.getLength(),l.getLengthInBits(c.mode,e)),c.write(s)}for(var u=0,h=0;h<a.length;h++)u+=a[h].dataCount;if(s.getLengthInBits()>8*u)throw new Error("code length overflow. ("+s.getLengthInBits()+">"+8*u+")");for(s.getLengthInBits()+4<=8*u&&s.put(0,4);s.getLengthInBits()%8!=0;)s.putBit(!1);for(;;){if(s.getLengthInBits()>=8*u)break;if(s.put(t.PAD0,8),s.getLengthInBits()>=8*u)break;s.put(t.PAD1,8)}return t.createBytes(s,a)},t.createBytes=function(e,t){for(var r=0,n=0,o=0,a=new Array(t.length),s=new Array(t.length),h=0;h<t.length;h++){var c=t[h].dataCount,u=t[h].totalCount-c;n=Math.max(n,c),o=Math.max(o,u),a[h]=new Array(c);for(p=0;p<a[h].length;p++)a[h][p]=255&e.buffer[p+r];r+=c;var d=l.getErrorCorrectPolynomial(u),_=new i(a[h],d.getLength()-1).mod(d);s[h]=new Array(d.getLength()-1);for(p=0;p<s[h].length;p++){var f=p+_.getLength()-s[h].length;s[h][p]=f>=0?_.get(f):0}}for(var g=0,p=0;p<t.length;p++)g+=t[p].totalCount;for(var m=new Array(g),v=0,p=0;p<n;p++)for(h=0;h<t.length;h++)p<a[h].length&&(m[v++]=a[h][p]);for(p=0;p<o;p++)for(h=0;h<t.length;h++)p<s[h].length&&(m[v++]=s[h][p]);return m};for(var s={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},h={L:1,M:0,Q:3,H:2},c={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},l={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(e){for(var t=e<<10;l.getBCHDigit(t)-l.getBCHDigit(l.G15)>=0;)t^=l.G15<<l.getBCHDigit(t)-l.getBCHDigit(l.G15);return(e<<10|t)^l.G15_MASK},getBCHTypeNumber:function(e){for(var t=e<<12;l.getBCHDigit(t)-l.getBCHDigit(l.G18)>=0;)t^=l.G18<<l.getBCHDigit(t)-l.getBCHDigit(l.G18);return e<<12|t},getBCHDigit:function(e){for(var t=0;0!=e;)t++,e>>>=1;return t},getPatternPosition:function(e){return l.PATTERN_POSITION_TABLE[e-1]},getMask:function(e,t,i){switch(e){case c.PATTERN000:return(t+i)%2==0;case c.PATTERN001:return t%2==0;case c.PATTERN010:return i%3==0;case c.PATTERN011:return(t+i)%3==0;case c.PATTERN100:return(Math.floor(t/2)+Math.floor(i/3))%2==0;case c.PATTERN101:return t*i%2+t*i%3==0;case c.PATTERN110:return(t*i%2+t*i%3)%2==0;case c.PATTERN111:return(t*i%3+(t+i)%2)%2==0;default:throw new Error("bad maskPattern:"+e)}},getErrorCorrectPolynomial:function(e){for(var t=new i([1],0),r=0;r<e;r++)t=t.multiply(new i([1,u.gexp(r)],0));return t},getLengthInBits:function(e,t){if(1<=t&&t<10)switch(e){case s.MODE_NUMBER:return 10;case s.MODE_ALPHA_NUM:return 9;case s.MODE_8BIT_BYTE:case s.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(t<27)switch(e){case s.MODE_NUMBER:return 12;case s.MODE_ALPHA_NUM:return 11;case s.MODE_8BIT_BYTE:return 16;case s.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else{if(!(t<41))throw new Error("type:"+t);switch(e){case s.MODE_NUMBER:return 14;case s.MODE_ALPHA_NUM:return 13;case s.MODE_8BIT_BYTE:return 16;case s.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}}},getLostPoint:function(e){for(var t=e.getModuleCount(),i=0,r=0;r<t;r++)for(l=0;l<t;l++){for(var n=0,o=e.isDark(r,l),a=-1;a<=1;a++)if(!(r+a<0||t<=r+a))for(var s=-1;s<=1;s++)l+s<0||t<=l+s||0==a&&0==s||o==e.isDark(r+a,l+s)&&n++;n>5&&(i+=3+n-5)}for(r=0;r<t-1;r++)for(l=0;l<t-1;l++){var h=0;e.isDark(r,l)&&h++,e.isDark(r+1,l)&&h++,e.isDark(r,l+1)&&h++,e.isDark(r+1,l+1)&&h++,0!=h&&4!=h||(i+=3)}for(r=0;r<t;r++)for(l=0;l<t-6;l++)e.isDark(r,l)&&!e.isDark(r,l+1)&&e.isDark(r,l+2)&&e.isDark(r,l+3)&&e.isDark(r,l+4)&&!e.isDark(r,l+5)&&e.isDark(r,l+6)&&(i+=40);for(l=0;l<t;l++)for(r=0;r<t-6;r++)e.isDark(r,l)&&!e.isDark(r+1,l)&&e.isDark(r+2,l)&&e.isDark(r+3,l)&&e.isDark(r+4,l)&&!e.isDark(r+5,l)&&e.isDark(r+6,l)&&(i+=40);for(var c=0,l=0;l<t;l++)for(r=0;r<t;r++)e.isDark(r,l)&&c++;return i+=10*(Math.abs(100*c/t/t-50)/5)}},u={glog:function(e){if(e<1)throw new Error("glog("+e+")");return u.LOG_TABLE[e]},gexp:function(e){for(;e<0;)e+=255;for(;e>=256;)e-=255;return u.EXP_TABLE[e]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},d=0;d<8;d++)u.EXP_TABLE[d]=1<<d;for(d=8;d<256;d++)u.EXP_TABLE[d]=u.EXP_TABLE[d-4]^u.EXP_TABLE[d-5]^u.EXP_TABLE[d-6]^u.EXP_TABLE[d-8];for(d=0;d<255;d++)u.LOG_TABLE[u.EXP_TABLE[d]]=d;i.prototype={get:function(e){return this.num[e]},getLength:function(){return this.num.length},multiply:function(e){for(var t=new Array(this.getLength()+e.getLength()-1),r=0;r<this.getLength();r++)for(var n=0;n<e.getLength();n++)t[r+n]^=u.gexp(u.glog(this.get(r))+u.glog(e.get(n)));return new i(t,0)},mod:function(e){if(this.getLength()-e.getLength()<0)return this;for(var t=u.glog(this.get(0))-u.glog(e.get(0)),r=new Array(this.getLength()),n=0;n<this.getLength();n++)r[n]=this.get(n);for(n=0;n<e.getLength();n++)r[n]^=u.gexp(u.glog(e.get(n))+t);return new i(r,0).mod(e)}},r.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],r.getRSBlocks=function(e,t){var i=r.getRsBlockTable(e,t);if(void 0==i)throw new Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+t);for(var n=i.length/3,o=[],a=0;a<n;a++)for(var s=i[3*a+0],h=i[3*a+1],c=i[3*a+2],l=0;l<s;l++)o.push(new r(h,c));return o},r.getRsBlockTable=function(e,t){switch(t){case h.L:return r.RS_BLOCK_TABLE[4*(e-1)+0];case h.M:return r.RS_BLOCK_TABLE[4*(e-1)+1];case h.Q:return r.RS_BLOCK_TABLE[4*(e-1)+2];case h.H:return r.RS_BLOCK_TABLE[4*(e-1)+3];default:return}},n.prototype={get:function(e){var t=Math.floor(e/8);return 1==(this.buffer[t]>>>7-e%8&1)},put:function(e,t){for(var i=0;i<t;i++)this.putBit(1==(e>>>t-i-1&1))},getLengthInBits:function(){return this.length},putBit:function(e){var t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var _=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],f=function(){};return f.createQRModel=function(e,i){var r,n=new t(o(e,(r=void 0===i?{width:256,height:256,colorDark:{r:0,g:0,b:0,a:1},colorLight:{r:1,g:1,b:1,a:1},correctLevel:2}:i).correctLevel),r.correctLevel);return n.addData(e),n.make(),n},f.createQRCodeNode=function(e,t){var i;i=void 0===t?{width:256,height:256,colorDark:{r:0,g:0,b:0,a:1},colorLight:{r:1,g:1,b:1,a:1},correctLevel:2}:t;for(var r=new BK.Canvas(i.width,i.height),n=f.createQRModel(e,t),o=n.getModuleCount(),a=i.width/o,s=i.height/o,h=Math.round(a),c=Math.round(s),l=0;l<o;l++)for(var u=0;u<o;u++){var d=n.isDark(l,u),_=u*a,g=l*s;r.lineWidth=1,r.fillColor=d?i.colorDark:i.colorLight,r.drawStyle=0,r.fillRect(_,g,a,s),r.strokeColor=d?i.colorDark:i.colorLight,r.strokeRect(Math.ceil(_)-.5,Math.ceil(g)-.5,h,c),r.strokeRect(Math.ceil(_)+.5,Math.ceil(g)+.5,h,c)}return r},f.createQRCodeToFile=function(e,t,i){var r=f.createQRCodeNode(t,i);return r.saveTo(e),r.dispose(),!0},f.compose=function(e,t,i,r){var n=BK.Director.screenPixelSize.width,o=BK.Director.screenPixelSize.height,a=new BK.Canvas(n,o);a.drawImage(e,0,0),a.drawImage(t,0,0),a.saveTo("GameSandBox://compose.png"),a.dispose()},f}),function(e,t){var i=function(){function e(e,t){this.loadJsonAtlasArray(e,function(e,i){for(var r=0;r<i.length;r++){var n=i[r],o=n.jsonInfo,a=n.atlasInfo,s=o.data,h=a.data,c=o.path,l=a.path;this.loadAccessory(s,c,h,l)}t(e,i)}.bind(this))}function t(e,t){var i=[e];this.loadJsonAtlasArray(i,function(i,r){if(0==i){var n=r[0],o=n.jsonInfo,a=n.atlasInfo,s=o.data,h=a.data,c=o.path,l=a.path,u=this.load(s,c,h,l);t(u,e)}else t(-1,null)}.bind(this))}function i(e,t,i){BK.fileSystem.readFile({file:[{path:e},{path:t}],success:function(e){BK.Script.log(1,0,"res = "+JSON.stringify(e));for(var t,r,n=0;n<e.length;n++){var o=e[n],a=o.path,s=a.substring(a.lastIndexOf("."));".json"==s?t=o:".atlas"==s&&(r=o)}i(0,t,r)}})}function r(e,t){for(var i=[],r=0;r<e.length;r++){var n=e[r],o={path:n.json},a={path:n.atlas};i.push(o),i.push(a)}BK.fileSystem.readFile({file:i,success:function(i){BK.Script.log(1,0,"res = "+JSON.stringify(i));for(var r=0;r<i.length;r++){var n=i[r],o=n.path,a=o.substring(o.lastIndexOf(".")),s=!1;".json"==a?s=!0:".atlas"==a&&(s=!1);for(var h=0;h<e.length;h++){var c=e[h],l=null;if(s){u=(l=c.json).substring(l.indexOf("://")+3,l.length);o.indexOf(u)>0&&(e[h].jsonInfo=n)}else{var u=(l=c.atlas).substring(l.indexOf("://")+3,l.length);o.indexOf(u)>0&&(e[h].atlasInfo=n)}}}t(0,e)}})}function n(e,t,i){var r=[e];this.loadJsonAtlasArray(r,function(r,n){if(0==r){var o=n[0],a=o.jsonInfo,s=o.atlasInfo,h=a.data,c=s.data,l=a.path,u=s.path,d=this.loadAccessoryAnimation(h,l,c,u,t);i(d,t,e)}else i(-1,t,null)}.bind(this))}return{setAccessoryAsync:e,loadJsonAtlas:i,loadSkeletonAsync:t,setAccessoryAnimationAsync:n,loadJsonAtlasArray:r}}();e.SkeletonAnimation.__proto__.setAccessoryAsync=i.setAccessoryAsync,e.SkeletonAnimation.__proto__.loadJsonAtlas=i.loadJsonAtlas,e.SkeletonAnimation.__proto__.loadSkeletonAsync=i.loadSkeletonAsync,e.SkeletonAnimation.__proto__.setAccessoryAnimationAsync=i.setAccessoryAnimationAsync,e.SkeletonAnimation.__proto__.loadJsonAtlasArray=i.loadJsonAtlasArray}(BK),function(e,t){"object"==typeof e&&(e.AdBannerHandler=function(){return{AdBannerHandler:function(){function e(e,t){this.closeUrl="https://i.hudongcdn.com/game_cdn/ad_close.png",this.adIconUrl="https://i.hudongcdn.com/game_cdn/ad_icon.png",this.pos_id=e,this.event={},this.adInfo=t,this.sizeW=.78*BK.Director.screenPixelSize.width;var i=BK.Director.screenPixelSize.width;i>BK.Director.screenPixelSize.height&&(this.sizeW=.44*i),this.sizeH=166*this.sizeW/582,this.closeBtnW=46*this.sizeW/582,this.clsoeBtnH=46*this.sizeH/166,this.btnSpace=14*this.sizeH/166,BK.Script.log(1,1," constructor: "+this.btnSpace),this.adIconW=74*this.sizeW/582,this.adIconH=46*this.sizeH/166}return e.prototype.isUseWebGL=function(){return void 0!==gl},e.prototype.onClickContent=function(e){this.event.onClickContent=e},e.prototype.onClickClose=function(e){this.event.onClickClose=e},e.prototype.show=function(e){this.isUseWebGL()?this.showWebGLNode(e):this.showBKNode(e)},e.prototype._onLoadBackgroundCallback=function(e,t,i){200==t?(this.exposeureReport(),i(0,"OK",this)):(i(-1,"load image failed!",this),this.close())},e.prototype._jumpToDestPage=function(){BK.MQQ.Webview.open(this.adInfo.report_info.click_url)},e.prototype._emmitClickEvent=function(){this.event.onClickContent&&this.event.onClickContent()},e.prototype._onClickContentBtn=function(){this._emmitClickEvent(),this._jumpToDestPage()},e.prototype._reportClick=function(){this.clickReport(),this.cmshowReport(3)},e.prototype._onClickCloseBtn=function(){this.event.onClickClose&&this.event.onClickClose(),this.closeReport(),this.close()},e.prototype.showBKNode=function(e){this.rootNode=new BK.Node,this.rootNode.canUserInteract=!0,this.backgound=new BK.Button(this.sizeW,this.sizeH),this.backgound.setNormalTextureFromUrl(this.adInfo.display_info.basic_info.img,function(t,i){this._onLoadBackgroundCallback(t,i,e)}.bind(this)),this.rootNode.addChild(this.backgound),this.closeBtn=new BK.Button(this.closeBtnW,this.clsoeBtnH),this.closeBtn.position={x:this.sizeW-this.closeBtnW-this.btnSpace,y:this.sizeH-this.clsoeBtnH-this.btnSpace},this.closeBtn.setNormalTextureFromUrl(this.closeUrl,function(e,t){}.bind(this)),this.rootNode.addChild(this.closeBtn),this.adIconBtn=new BK.Button(this.adIconW,this.adIconH),this.adIconBtn.position={x:this.btnSpace,y:this.btnSpace},this.adIconBtn.setNormalTextureFromUrl(this.adIconUrl,function(e,t){200!=t&&BK.Script.log(1,1,"")}.bind(this)),this.rootNode.addChild(this.adIconBtn),this.backgound.setTouchInsideCallback(function(e){this._onClickContentBtn()}.bind(this)),this.closeBtn.setTouchInsideCallback(function(e){this._onClickCloseBtn()}.bind(this)),this.renderBKNode()},e.prototype.renderBKNode=function(){var e=BK.Director.screenPixelSize.width/BK.Director.root.scale.x,t=this.sizeW*(1/BK.Director.root.scale.x);this.rootNode.position={x:(e-t)/2,y:0},this.rootNode.scale={x:1/BK.Director.root.scale.x,y:1/BK.Director.root.scale.y},BK.Director.root.addChild(this.rootNode)},e.prototype.closeBKNode=function(){this.rootNode.removeFromParent()},e.prototype.showWebGLNode=function(e){this.context=new BK.GLRenderContext;var t=BK.JSMatrix.fromOrthographic(0,BK.Director.screenPixelSize.width,0,BK.Director.screenPixelSize.height,-1,1);this.context.setProjection(t);var i=BK.Director.screenPixelSize.width;BK.Director.screenPixelSize.height;this.glRootNode=new BK.GLRenderButton(this.context,this.sizeW,this.sizeH),this.glRootNode.canUserInteract=!0,this.glRootNode.canClick=!1,this.glRootNode.setUrlPath(this.adInfo.display_info.basic_info.img,function(t,i){this.glRootNode.canClick=!0,this._onLoadBackgroundCallback(t,i,e)}.bind(this)),this.glRootNode.position={x:(i-this.sizeW)/2,y:0},this.glCloseBtn=new BK.GLRenderButton(this.context,this.closeBtnW,this.clsoeBtnH),this.glCloseBtn.setUrlPath(this.closeUrl),this.glCloseBtn.position={x:this.sizeW-this.closeBtnW-this.btnSpace,y:this.sizeH-this.clsoeBtnH-this.btnSpace},this.glRootNode.addChild(this.glCloseBtn),this.glAdIconBtn=new BK.GLRenderButton(this.context,this.adIconW,this.adIconH),this.glAdIconBtn.setUrlPath(this.adIconUrl),this.glAdIconBtn.position={x:this.btnSpace,y:this.btnSpace},this.glRootNode.addChild(this.glAdIconBtn),this.glRootNode.setTouchInsideCallback(function(e){this._onClickContentBtn(),this._reportClick()}.bind(this)),this.glCloseBtn.setTouchInsideCallback(function(e){this._onClickCloseBtn()}.bind(this)),this.renderWebGLNode()},e.prototype.renderWebGLNode=function(){UIEventHandler.setRootNode(this.glRootNode),BK.GLRenderContext.hookGLCommit(function(e){if(this.context&&this.glRootNode){if(0==e.methodWorking)return;this.context.save(),e.viewport(0,0,BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height),e.disable(e.DEPTH_TEST),e.useProgram(this.context.getProgram()),this.glRootNode.render(),this.context.restore()}}.bind(this))},e.prototype.closeWebGLNode=function(){this.glRootNode&&this.glRootNode.dispose(),this.context&&this.context.dispose(),this.glRootNode=null,this.context=null,BK.GLRenderContext.exit()},e.prototype.close=function(){this.isUseWebGL()?this.closeWebGLNode():this.closeBKNode()},e.prototype.exposeureReport=function(e,t,i){if(this.adInfo.report_info&&this.adInfo.report_info.exposure_url){var r=this.adInfo.report_info.exposure_url,n=new BK.HttpUtil(r);BK.Script.log(0,0,"exposeureReport param:"+e+" exposure_url:"+r),n.requestAsync(function(e,t){200==t?BK.Script.log(1,1,"exposeureReport succ."):BK.Script.log(1,1,"exposeureReport failed.statuscode:"+t)}.bind(this)),this.cmshowReport(0,e,t,i)}else BK.Script.log(1,1,"exposeureReport failed. no report_info ")},e.prototype.clickReport=function(){},e.prototype.closeReport=function(e,t,i){if(this.adInfo.report_info&&this.adInfo.report_info.negative_feedback_url){var r=this.adInfo.report_info.negative_feedback_url;r=r.replace("__ACT_TYPE__","2001"),new BK.HttpUtil(r).requestAsync(function(e,t){200==t?BK.Script.log(1,1,"negative_feedback succ."):BK.Script.log(1,1,"negative_feedback failed.statuscode:"+t)}.bind(this)),this.cmshowReport(3,e,t,i)}else BK.Script.log(1,1,"closeReport failed.can not find the negative_feedback_url")},e.prototype.cmshowReport=function(e,t,i,r){var n=this.pos_id,o=e.toString(),a="",s="",h="";t&&(a=t),i&&(s=i),r&&(h=r),BK.QQ.uploadData("banner_SPA",n,o,a,s,h)},e.prototype.reportParamToString=function(){var e=this.adInfo.report_info.trace_info,t="";if("object"==typeof e){for(var i in e)t=t+i+"="+e[i]+"&";t=t.substring(0,t.length-1)}return t},e}()}}().AdBannerHandler)}(BK),function(e,t){"object"==typeof e&&(e.AdAnimateBanner=function(){function e(){return IS_IPHONE_X}function t(){return!!e()}function i(){return e()?BK.Director.screenPixelSize.height>BK.Director.screenPixelSize.width?.015*BK.Director.screenPixelSize.height:.035*BK.Director.screenPixelSize.height:0}function r(e,t,i,r,n,o,a,s,h,c,l,u,d,_,f,g){this._data=void 0!==e?[e,t,i,r,n,o,a,s,h,c,l,u,d,_,f,g]:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function n(e,t,i,n,o,a){return new r(2/(t-e),0,0,0,0,2/(n-i),0,0,0,0,2/(o-a),0,(e+t)/(e-t),(n+i)/(i-n),(o+a)/(o-a),1)}function o(e){return new r(1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,e.z,1)}function s(e){return new r(e.x,0,0,0,0,e.y,0,0,0,0,1,0,0,0,0,1)}function h(e){return.01745329251994*e}function c(e){var t=h(-e.y),i=h(-e.x),n=h(-e.z),o=Math.cos(t),a=Math.sin(t),s=Math.cos(i),c=Math.sin(i),l=Math.cos(n),u=Math.sin(n);return new r(o*l+a*c*u,-o*u+a*c*l,a*s,0,u*s,l*s,-c,0,-a*l+o*c*u,u*a+o*c*l,o*s,0,0,0,0,1)}function l(e,t){this._gl=e;var i=e.createShader(e.VERTEX_SHADER);e.shaderSource(i,t.vs_source),e.compileShader(i);var r=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(r,t.fs_source),e.compileShader(r),this._shader_program=e.createProgram(),e.attachShader(this._shader_program,i),e.attachShader(this._shader_program,r),e.linkProgram(this._shader_program),this._attributes=[];for(a=0;a<t.attributes.length;++a){var n=t.attributes[a],o=e.getAttribLocation(this._shader_program,n.name);this._attributes.push({name:n.name,size:n.size,location:o})}this._uniforms=[];for(var a=0;a<t.uniforms.length;++a){var s=t.uniforms[a];this._uniforms.push({name:s.name,type:s.type,location:e.getUniformLocation(this._shader_program,s.name),value:s.default_value})}}function u(){this._parent=null,this._children=[],this._rotation_matrix=new r,this._scalar_matrix=new r,this._local_matrix=new r,this._world_matrix=new r,this._canUserInteract=!1,this._dirty_flags=0,this._need_update_flag=!1,this._position={x:0,y:0,z:0},this._hidden=!1,Object.defineProperty(this,"canUserInteract",{configurable:!0,get:function(){return this._canUserInteract},set:function(e){this._canUserInteract=e}}),Object.defineProperty(this,"children",{configurable:!0,get:function(){return this._children}}),Object.defineProperty(this,"hidden",{configurable:!0,get:function(){return this._hidden},set:function(e){this._hidden=e}}),Object.defineProperty(this,"position",{configurable:!0,get:function(){return this._position},set:function(e){this._position.x=void 0!==e.x?e.x:this._position.x,this._position.y=void 0!==e.y?e.y:this._position.y,this._position.z=void 0!==e.z?e.z:this._position.z,this._need_update_flag=!0,this._dirty_flags|=DIRTY_TRANSLATION|DIRTY_WORLD_MATRIX}}),this._scale={x:1,y:1,z:1},Object.defineProperty(this,"scale",{configurable:!0,get:function(){return this._scale},set:function(e){this._scale.x=void 0!==e.x?e.x:this._scale.x,this._scale.y=void 0!==e.y?e.y:this._scale.y,this._scale.z=void 0!==e.z?e.z:this._scale.z,this._need_update_flag=!0,this._dirty_flags|=DIRTY_SCALE|DIRTY_WORLD_MATRIX}}),this._rotation={x:0,y:0,z:0},Object.defineProperty(this,"rotation",{configurable:!0,get:function(){return this._rotation},set:function(e){this._rotation.x=void 0!==e.x?e.x:this._rotation.x,this._rotation.y=void 0!==e.y?e.y:this._rotation.y,this._rotation.z=void 0!==e.z?e.z:this._rotation.z,this._need_update_flag=!0,this._dirty_flags|=DIRTY_ROTATION|DIRTY_WORLD_MATRIX}}),this._visible=!0,Object.defineProperty(this,"visible",{configurable:!0,get:function(){return this._visible},set:function(e){this._visible=e}})}function d(e,t,i,r,n,o,a){u.call(this),this._color={r:1,g:1,b:1,a:1},Object.defineProperty(this,"color",{configurable:!0,get:function(){return this._color},set:function(e){this._color.r=void 0!==e.r?e.r:this._color.r,this._color.g=void 0!==e.g?e.g:this._color.g,this._color.b=void 0!==e.b?e.b:this._color.b,this._color.a=void 0!==e.a?e.a:this._color.a,this._dirty_flags|=DIRTY_COLOR}}),this._anchor={x:.5,y:.5},Object.defineProperty(this,"anchor",{configurable:!0,get:function(){return this._anchor},set:function(e){this._anchor.x=void 0!==e.x?e.x:this._anchor.x,this._anchor.y=void 0!==e.y?e.y:this._anchor.y,this._dirty_flags|=DIRTY_ANCHOR}}),this.setTexture(i),this._uv_rotate=BK_SPRITE_UV_ROTATE_NONE,this._origin_tex_uv=[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1}],this._flip_u=void 0!==r&&r,this._flip_v=void 0!==n&&n,this._stretch_x=void 0!==o&&o,this._stretch_y=void 0!==a&&a,this._blend_mode=BK_BLEND_MODE_MULTIPLY,this._content_size={width:e,height:t},Object.defineProperty(this,"size",{configurable:!0,get:function(){return this._content_size},set:function(e){this._content_size=e,this._dirty_flags|=DIRTY_CONTENT_SIZE}});var s=.5*this._content_size.width,h=.5*this._content_size.height;this._vertices=new Float32Array([-s,h,0,1,1,1,1,0,0,s,h,0,1,1,1,1,1,0,s,-h,0,1,1,1,1,1,1,-s,-h,0,1,1,1,1,0,1]),this._vbo=null,this._ibo=null}function _(e,t,i,r,n,o,a){d.call(this,e,t,i,r,n,o,a),this.contentSize={width:e,height:t},this.isCancelClick=void 0,this.touchStatus=0,this.canUserInteract=!0,this.enable=!0,this.canClick=!0,this.touchInsideCallback=void 0,this.addTouchListener()}function f(e){var t=Math.floor(255*e.a);return t<<=8,t|=Math.floor(255*e.r),t<<=8,t|=Math.floor(255*e.g),t<<=8,(t|=Math.floor(255*e.b))>>>0}function g(r){this._ad_final_size=[],this._clickInsideCallback=void 0;for(var n=0;n<AD_DESIGN_SIZE.length;++n)this._ad_final_size.push({width:Math.ceil(AD_DESIGN_SIZE[n].width*STANDARD_SCALE),height:Math.ceil(AD_DESIGN_SIZE[n].height*STANDARD_SCALE)});this._is_webgl=void 0!==gl,this._is_webgl&&this.webGL_init();var o="GameRes://res/bg_left.png",a="GameRes://res/bg_bg_1.png",s="GameRes://res/bg_bg_2.png",h="GameRes://res/bg_fg_1.png",c="GameRes://res/bg_fg_2.png",l="GameRes://res/bg_right.png";r&&(o=r.bg_left_path,l=r.bg_right_path,a=r.bg_bg_1_path,s=r.bg_bg_2_path,h=r.bg_fg_1_path,c=r.bg_fg_2_path),this._tex_bg_left=this.create_texture(o,!1),this._tex_bg_bg_1=this.create_texture(a,!1),this._tex_bg_bg_2=this.create_texture(s,!1),this._tex_bg_fg_1=this.create_texture(h,!1),this._tex_bg_fg_2=this.create_texture(c,!1),this._tex_bg_right=this.create_texture(l,!1),this._root_node=this.create_node(),this._root_node.canUserInteract=!0,this._mv_node=this.create_clip_node(this._root_node,{x:.5*-this._ad_final_size[AD_BANNER_TYPE_RESERVED_CLIP_RECT].width,y:e()?2*STANDARD_SCALE:0,width:this._ad_final_size[AD_BANNER_TYPE_RESERVED_CLIP_RECT].width,height:this._ad_final_size[AD_BANNER_TYPE_RESERVED_CLIP_RECT].height}),this._mv_node.canUserInteract=!0,t()?this._mv_node.position={x:.5*BK.Director.screenPixelSize.width,y:i()}:this._mv_node.position={x:.5*BK.Director.screenPixelSize.width,y:0},this._node_1=this.node_extend(this.create_button(this._mv_node,this._tex_bg_left,this._ad_final_size[AD_BANNER_TYPE_RESERVED_0],this._onTouchInside.bind(this))),this._node_2=this.node_extend(this.create_node(this._mv_node)),this._node_2.canUserInteract=!0,this._node_2_1=this.create_button(this._node_2,this._tex_bg_bg_1,this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1],this._onTouchInside.bind(this)),this._content_node=this.create_node(this._node_2),this._real_content_node=void 0,this._node_2_2=this.create_sprite_with_texture(this._node_2,this._tex_bg_fg_1,this._ad_final_size[AD_BANNER_TYPE_RESERVED_2_1]),this._node_3=this.node_extend(this.create_button(this._mv_node,this._tex_bg_right,this._ad_final_size[AD_BANNER_TYPE_RESERVED_3],this._onTouchInside.bind(this)));var u=new BK.Ticker;u.interval=.033,u.setTickerCallBack(function(e,t){this.update(t)}.bind(this))}AD_BANNER_TYPE_DYNAMIC_193_582_166=0,AD_BANNER_TYPE_DYNAMIC_194_147_147=1,AD_BANNER_TYPE_DYNAMIC_184_240_180=2,AD_BANNER_TYPE_DYNAMIC_285_240_180_3=3,AD_BANNER_TYPE_DYNAMIC_210_640_288=4,AD_BANNER_TYPE_DYNAMIC_65_1000_560=5,AD_BANNER_TYPE_STATIC_193_582_166=6,AD_BANNER_TYPE_STATIC_194_147_147=7,AD_BANNER_TYPE_STATIC_184_240_180=8,AD_BANNER_TYPE_STATIC_285_240_180_3=9,AD_BANNER_TYPE_STATIC_210_640_288=10,AD_BANNER_TYPE_STATIC_65_1000_560=11,AD_BANNER_TYPE_RESERVED_0=12,AD_BANNER_TYPE_RESERVED_1_1=13,AD_BANNER_TYPE_RESERVED_1_2=14,AD_BANNER_TYPE_RESERVED_2_1=15,AD_BANNER_TYPE_RESERVED_2_2=16,AD_BANNER_TYPE_RESERVED_3=17,AD_BANNER_TYPE_RESERVED_CLIP_RECT=18,AD_DESIGN_SIZE=[{width:490,height:140},{width:147,height:147},{width:193,height:145},{width:147,height:110},{width:322,height:145},{width:263,height:147},{width:582,height:166},{width:166,height:166},{width:221,height:166},{width:179,height:132},{width:368,height:166},{width:297,height:166},{width:114,height:87},{width:530,height:166},{width:581,height:166},{width:530,height:38},{width:60,height:30},{width:115,height:115},{width:730,height:166}],IPHONE_X_WIDTH=375,IPHONE_X_HEIGHT=812;var p=BK.Director.queryDeviceInfo();return"ios"===p.platform&&p.screenWidth===IPHONE_X_WIDTH&&p.screenHeight===IPHONE_X_HEIGHT?IS_IPHONE_X=!0:IS_IPHONE_X=!1,STANDARD_HEIGHT=function(){return e()?BK.Director.screenPixelSize.height>BK.Director.screenPixelSize.width?.1*BK.Director.screenPixelSize.height:.2*BK.Director.screenPixelSize.height:BK.Director.screenPixelSize.height*(BK.Director.screenPixelSize.height>BK.Director.screenPixelSize.width?.12:.22)}(),STANDARD_SCALE=STANDARD_HEIGHT/AD_DESIGN_SIZE[AD_BANNER_TYPE_RESERVED_1_1].height,NODE_TWEEN_ATTR_TYPE_NONE=0,NODE_TWEEN_ATTR_TYPE_SCALE=1,NODE_TWEEN_ATTR_TYPE_SCALE_X=2,NODE_TWEEN_ATTR_TYPE_SCALE_Y=3,NODE_TWEEN_ATTR_TYPE_POSITION_X=4,NODE_TWEEN_ATTR_TYPE_POSITION_Y=5,NODE_TWEEN_ATTR_TYPE_OPACITY=6,NODE_TWEEN_ATTR_TYPE_ROTATION_X=7,NODE_TWEEN_ATTR_TYPE_ROTATION_Y=8,NODE_TWEEN_ATTR_TYPE_ROTATION_Z=9,r.prototype={constructor:r,is_identity:function(){return 1===this._data[0]&&0===this._data[1]&&0===this._data[2]&&0===this._data[3]&&0===this._data[4]&&1===this._data[5]&&0===this._data[6]&&0===this._data[7]&&0===this._data[8]&&0===this._data[9]&&1===this._data[10]&&0===this._data[11]&&0===this._data[12]&&0===this._data[13]&&0===this._data[14]&&1===this._data[15]},set_translation:function(e,t,i){this._data[12]=e,this._data[13]=t,this._data[14]=i},set_scale:function(e,t,i){this._data[0]=e,this._data[5]=t,this._data[10]=i},set:function(e,t,i,r,n,o,a,s,h,c,l,u,d,_,f,g){this._data[0]=e,this._data[1]=t,this._data[2]=i,this._data[3]=r,this._data[4]=n,this._data[5]=o,this._data[6]=a,this._data[7]=s,this._data[8]=h,this._data[9]=c,this._data[10]=l,this._data[11]=u,this._data[12]=d,this._data[13]=_,this._data[14]=f,this._data[15]=g},setTo:function(e){return this._data=e._data.slice(0),this},multiply:function(e){if(this.is_identity())return this.setTo(e);if(e.is_identity())return this;var t=this._data[0]*e._data[0]+this._data[4]*e._data[1]+this._data[8]*e._data[2]+this._data[12]*e._data[3],i=this._data[1]*e._data[0]+this._data[5]*e._data[1]+this._data[9]*e._data[2]+this._data[13]*e._data[3],r=this._data[2]*e._data[0]+this._data[6]*e._data[1]+this._data[10]*e._data[2]+this._data[14]*e._data[3],n=this._data[3]*e._data[0]+this._data[7]*e._data[1]+this._data[11]*e._data[2]+this._data[15]*e._data[3],o=this._data[0]*e._data[4]+this._data[4]*e._data[5]+this._data[8]*e._data[6]+this._data[12]*e._data[7],a=this._data[1]*e._data[4]+this._data[5]*e._data[5]+this._data[9]*e._data[6]+this._data[13]*e._data[7],s=this._data[2]*e._data[4]+this._data[6]*e._data[5]+this._data[10]*e._data[6]+this._data[14]*e._data[7],h=this._data[3]*e._data[4]+this._data[7]*e._data[5]+this._data[11]*e._data[6]+this._data[15]*e._data[7],c=this._data[0]*e._data[8]+this._data[4]*e._data[9]+this._data[8]*e._data[10]+this._data[12]*e._data[11],l=this._data[1]*e._data[8]+this._data[5]*e._data[9]+this._data[9]*e._data[10]+this._data[13]*e._data[11],u=this._data[2]*e._data[8]+this._data[6]*e._data[9]+this._data[10]*e._data[10]+this._data[14]*e._data[11],d=this._data[3]*e._data[8]+this._data[7]*e._data[9]+this._data[11]*e._data[10]+this._data[15]*e._data[11],_=this._data[0]*e._data[12]+this._data[4]*e._data[13]+this._data[8]*e._data[14]+this._data[12]*e._data[15],f=this._data[1]*e._data[12]+this._data[5]*e._data[13]+this._data[9]*e._data[14]+this._data[13]*e._data[15],g=this._data[2]*e._data[12]+this._data[6]*e._data[13]+this._data[10]*e._data[14]+this._data[14]*e._data[15],p=this._data[3]*e._data[12]+this._data[7]*e._data[13]+this._data[11]*e._data[14]+this._data[15]*e._data[15];return this.set(t,i,r,n,o,a,s,h,c,l,u,d,_,f,g,p),this},multiplyXY:function(e){return{x:e.x*this._data[0]+e.y*this._data[4]+this._data[12],y:e.x*this._data[1]+e.y*this._data[5]+this._data[13]}}},SHADER_UNIFORM_TYPE_FLOAT1=1,SHADER_UNIFORM_TYPE_FLOAT2=2,SHADER_UNIFORM_TYPE_FLOAT3=3,SHADER_UNIFORM_TYPE_FLOAT4=4,SHADER_UNIFORM_TYPE_INT1=5,SHADER_UNIFORM_TYPE_INT2=6,SHADER_UNIFORM_TYPE_INT3=7,SHADER_UNIFORM_TYPE_INT4=8,SHADER_UNIFORM_TYPE_FLOATV1=9,SHADER_UNIFORM_TYPE_FLOATV2=10,SHADER_UNIFORM_TYPE_FLOATV3=11,SHADER_UNIFORM_TYPE_FLOATV4=12,SHADER_UNIFORM_TYPE_INTV1=13,SHADER_UNIFORM_TYPE_INTV2=14,SHADER_UNIFORM_TYPE_INTV3=15,SHADER_UNIFORM_TYPE_INTV4=16,SHADER_UNIFORM_TYPE_MATRIX2=17,SHADER_UNIFORM_TYPE_MATRIX3=18,SHADER_UNIFORM_TYPE_MATRIX4=19,SHADER_UNIFORM_TYPE_TEXTURE0=20,SHADER_UNIFORM_TYPE_TEXTURE1=21,SHADER_UNIFORM_TYPE_TEXTURE2=22,SHADER_UNIFORM_TYPE_TEXTURE3=23,SHADER_UNIFORM_TYPE_TEXTURE4=24,SHADER_UNIFORM_TYPE_TEXTURE5=25,SHADER_UNIFORM_TYPE_TEXTURE6=26,SHADER_UNIFORM_TYPE_TEXTURE7=27,l.prototype={set_uniform:function(e,t,i){for(var r=0;r<this._uniforms.length;++r)this._uniforms[r].name===e&&(this._uniforms[r].value=t,i&&this.update_uniform(this._uniforms[r]))},bind:function(){this._gl.useProgram(this._shader_program);for(t=0;t<this._uniforms.length;++t)this.update_uniform(this._uniforms[t]);for(var e=0,t=0;t<this._attributes.length;++t){var i=this._attributes[t];this._gl.vertexAttribPointer(i.location,i.size,this._gl.FLOAT,!1,36,e),this._gl.enableVertexAttribArray(i.location),e+=4*i.size}},update_uniform:function(e){var t=this._gl;switch(e.type){case SHADER_UNIFORM_TYPE_FLOAT1:t.uniform1f(e.location,e.value);break;case SHADER_UNIFORM_TYPE_FLOAT2:t.uniform2f(e.location,e.value.x,e.value.y);break;case SHADER_UNIFORM_TYPE_FLOAT3:t.uniform3f(e.location,e.value.x,e.value.y,e.value.z);break;case SHADER_UNIFORM_TYPE_FLOAT4:t.uniform4f(e.location,e.value.x,e.value.y,e.value.z,e.value.w);break;case SHADER_UNIFORM_TYPE_INT1:t.uniform1i(e.location,e.value);break;case SHADER_UNIFORM_TYPE_INT2:t.uniform2i(e.location,e.value.x,e.value.y);break;case SHADER_UNIFORM_TYPE_INT3:t.uniform3i(e.location,e.value.x,e.value.y,e.value.z);break;case SHADER_UNIFORM_TYPE_INT4:t.uniform4i(e.location,e.value.x,e.value.y,e.value.z,e.value.w);break;case SHADER_UNIFORM_TYPE_FLOATV1:t.uniform1fv(e.location,e.value);break;case SHADER_UNIFORM_TYPE_FLOATV2:t.uniform2fv(e.location,e.value);break;case SHADER_UNIFORM_TYPE_FLOATV3:t.uniform3fv(e.location,e.value);break;case SHADER_UNIFORM_TYPE_FLOATV4:t.uniform4fv(e.location,e.value);break;case SHADER_UNIFORM_TYPE_INTV1:t.uniform1iv(e.location,e.value);break;case SHADER_UNIFORM_TYPE_INTV2:t.uniform2iv(e.location,e.value);break;case SHADER_UNIFORM_TYPE_INTV3:t.uniform3iv(e.location,e.value);break;case SHADER_UNIFORM_TYPE_INTV4:t.uniform4iv(e.location,e.value);break;case SHADER_UNIFORM_TYPE_MATRIX2:t.uniformMatrix2fv(e.location,!1,e.value._data);break;case SHADER_UNIFORM_TYPE_MATRIX3:t.uniformMatrix3fv(e.location,!1,e.value._data);break;case SHADER_UNIFORM_TYPE_MATRIX4:t.uniformMatrix4fv(e.location,!1,e.value._data);break;case SHADER_UNIFORM_TYPE_TEXTURE0:t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,e.value);break;case SHADER_UNIFORM_TYPE_TEXTURE1:t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,e.value);break;case SHADER_UNIFORM_TYPE_TEXTURE2:t.activeTexture(t.TEXTURE2),t.bindTexture(t.TEXTURE_2D,e.value);break;case SHADER_UNIFORM_TYPE_TEXTURE3:t.activeTexture(t.TEXTURE3),t.bindTexture(t.TEXTURE_2D,e.value);break;case SHADER_UNIFORM_TYPE_TEXTURE4:t.activeTexture(t.TEXTURE4),t.bindTexture(t.TEXTURE_2D,e.value);break;case SHADER_UNIFORM_TYPE_TEXTURE5:t.activeTexture(t.TEXTURE5),t.bindTexture(t.TEXTURE_2D,e.value);break;case SHADER_UNIFORM_TYPE_TEXTURE6:t.activeTexture(t.TEXTURE6),t.bindTexture(t.TEXTURE_2D,e.value);break;case SHADER_UNIFORM_TYPE_TEXTURE7:t.activeTexture(t.TEXTURE7),t.bindTexture(t.TEXTURE_2D,e.value)}}},DIRTY_TRANSLATION=1,DIRTY_SCALE=2,DIRTY_ROTATION=4,DIRTY_UV=8,DIRTY_CONTENT_SIZE=16,DIRTY_COLOR=32,DIRTY_WORLD_MATRIX=64,DIRTY_ANCHOR=128,u.prototype={constructor:u,dispose:function(){for(var e=0;e<this._children.length;++e)this._children[e].dispose()},addChild:function(e){e._parent!==this&&(e._parent&&e._parent.removeChild(e),this._children.push(e),e._parent=this)},removeChild:function(e){if(e._parent===this)for(var t=0;t<this._children.length;++t)this._children[t]===e&&(this._children.splice(t,1),e._parent=null,e.dispose())},getLocalMatrix:function(){return this._local_matrix=o(this.position),0===this.rotation.x&&0===this.rotation.y&&0===this.rotation.z||(this._rotation_matrix=c(this.rotation),this._local_matrix.multiply(this._rotation_matrix)),1===this.scale.x&&1===this.scale.y&&1===this.scale.z||(this._scalar_matrix=s(this.scale),this._local_matrix.multiply(this._scalar_matrix)),this._dirty_flags&=~(DIRTY_TRANSLATION|DIRTY_SCALE|DIRTY_ROTATION),this._local_matrix},getWorldMatrix:function(e){return(e||this._dirty_flags&DIRTY_WORLD_MATRIX)&&(this._parent?(this._world_matrix.setTo(this._parent.getWorldMatrix()),this._world_matrix.multiply(this.getLocalMatrix())):this._world_matrix.setTo(this.getLocalMatrix()),this._dirty_flags&=~DIRTY_WORLD_MATRIX),this._world_matrix},render:function(e,t,i){if(this.visible){i&&this.getWorldMatrix(i);for(var r=0;r<this._children.length;++r)this._children[r].render(e,t,this._need_update_flag||i);this._need_update_flag=!1}},hittest:function(e){return!1}},BK_SPRITE_UV_ROTATE_NONE=0,BK_SPRITE_UV_ROTATE_CW_90=1,BK_SPRITE_UV_ROTATE_CW_180=2,BK_SPRITE_UV_ROTATE_CW_270=3,BK_SPRITE_UV_ROTATE_CCW_90=4,BK_SPRITE_UV_ROTATE_CCW_180=5,BK_SPRITE_UV_ROTATE_CCW_270=6,BK_BLEND_MODE_ADDITIVE=0,BK_BLEND_MODE_MULTIPLY=1,BK_BLEND_MODE_INTERPOLATIVE=2,BK_BLEND_MODE_SCREEN=3,d.prototype=Object.create(u.prototype),d.prototype.constructor=d,d.prototype.dispose=function(){var e=bkWebGLGetInstance();this._tex&&this._tex.need_delete&&(e.deleteTexture(this._tex.texture),this._tex=null),this._vbo&&(e.deleteBuffer(this._vbo),e.deleteBuffer(this._ibo),this._vbo=null,this._ibo=null),u.prototype.dispose.call(this)},d.prototype.setTexture=function(e){void 0!==this._tex&&this._tex.need_delete&&bkWebGLGetInstance().deleteTexture(this._tex.texture),this._tex=e,e?(this._tex_width=e.width,this._tex_height=e.height):(this._tex_width=0,this._tex_height=0)},d.prototype.adjustTexturePosition=function(e,t,i,r,n){n?(this._origin_tex_uv[0].x=(e+r)/this._tex_width,this._origin_tex_uv[0].y=(t+i)/this._tex_height,this._origin_tex_uv[1].x=(e+r)/this._tex_width,this._origin_tex_uv[1].y=t/this._tex_height,this._origin_tex_uv[2].x=e/this._tex_width,this._origin_tex_uv[2].y=t/this._tex_height,this._origin_tex_uv[3].x=e/this._tex_width,this._origin_tex_uv[3].y=(t+i)/this._tex_height):(this._origin_tex_uv[0].x=e/this._tex_width,this._origin_tex_uv[0].y=t/this._tex_height,this._origin_tex_uv[1].x=(e+i)/this._tex_width,this._origin_tex_uv[1].y=t/this._tex_height,this._origin_tex_uv[2].x=(e+i)/this._tex_width,this._origin_tex_uv[2].y=(t+r)/this._tex_height,this._origin_tex_uv[3].x=e/this._tex_width,this._origin_tex_uv[3].y=(t+r)/this._tex_height),this.dirty(DIRTY_UV)},d.prototype.render=function(e,t,i){if(this.visible){if(i&&this.getWorldMatrix(i),this._vbo||(this._vbo=e.createBuffer(),this._ibo=e.createBuffer(),this._indices=new Uint16Array([0,3,1,1,3,2]),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._ibo),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this._indices,e.STATIC_DRAW)),this._dirty_flags&DIRTY_UV){var r=1;this._stretch_x||0===this._content_size.width||0===this._tex_width||(r=this._content_size.width/this._tex_width);var n=1;this._stretch_y||0===this._content_size.height||0===this._tex_height||(n=this._content_size.height/this._tex_height);var o=this._origin_tex_uv.slice(0);this.flip_u&&(o=[o[1],o[0],o[3],o[2]]),this.flip_v&&(o=[o[3],o[2],o[1],o[0]]),this._uv_rotate===BK_SPRITE_UV_ROTATE_CW_90||this._uv_rotate===BK_SPRITE_UV_ROTATE_CCW_270?o=[o[3],o[0],o[1],o[2]]:this._uv_rotate===BK_SPRITE_UV_ROTATE_CW_270||this._uv_rotate===BK_SPRITE_UV_ROTATE_CW_270?o=[o[1],o[2],o[3],o[0]]:this._uv_rotate!==BK_SPRITE_UV_ROTATE_CW_180&&this._uv_rotate!==BK_SPRITE_UV_ROTATE_CCW_180||(o=[o[2],o[3],o[0],o[1]]),this._vertices[7]=r*o[0].x,this._vertices[8]=n*o[0].y,this._vertices[16]=r*o[1].x,this._vertices[17]=n*o[1].y,this._vertices[25]=r*o[2].x,this._vertices[26]=n*o[2].y,this._vertices[34]=r*o[3].x,this._vertices[35]=n*o[3].y,this._dirty_flags&=~DIRTY_UV}if(i||this._dirty_flags&(DIRTY_CONTENT_SIZE|DIRTY_WORLD_MATRIX|DIRTY_ANCHOR)){var s=this.getWorldMatrix(i),h={x:-this._content_size.width*this._anchor.x,y:this._content_size.height*(1-this._anchor.y)},c={x:this._content_size.width*(1-this._anchor.x),y:this._content_size.height*(1-this._anchor.y)},l={x:-this._content_size.width*this._anchor.x,y:-this._content_size.height*this._anchor.y},d={x:this._content_size.width*(1-this._anchor.x),y:-this._content_size.height*this._anchor.y},h=s.multiplyXY(h),c=s.multiplyXY(c),l=s.multiplyXY(l),d=s.multiplyXY(d);this._vertices[0]=h.x,this._vertices[1]=h.y,this._vertices[9]=c.x,this._vertices[10]=c.y,this._vertices[18]=d.x,this._vertices[19]=d.y,this._vertices[27]=l.x,this._vertices[28]=l.y,this._dirty_flags&=~(DIRTY_CONTENT_SIZE|DIRTY_ANCHOR)}if(this._dirty_flags&DIRTY_COLOR){var _=this.color.a,f=this.color.r*_,g=this.color.g*_,p=this.color.b*_;this._vertices[3]=f,this._vertices[4]=g,this._vertices[5]=p,this._vertices[6]=a,this._vertices[12]=f,this._vertices[13]=g,this._vertices[14]=p,this._vertices[15]=a,this._vertices[21]=f,this._vertices[22]=g,this._vertices[23]=p,this._vertices[24]=a,this._vertices[30]=f,this._vertices[31]=g,this._vertices[32]=p,this._vertices[33]=a,this._dirty_flags&=~DIRTY_COLOR}e.bindBuffer(e.ARRAY_BUFFER,this._vbo),e.bufferData(e.ARRAY_BUFFER,this._vertices,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._ibo),t.set_uniform("Texture",this._tex.texture),t.bind(),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0),u.prototype.render.call(this,e,t,i)}},d.prototype.hittest=function(e){var t=this.getWorldMatrix(),i=t.multiplyXY({x:-this._content_size.width*this._anchor.x,y:-this._content_size.height*this._anchor.y}),r=t.multiplyXY({x:this._content_size.width*(1-this._anchor.x),y:this._content_size.height*(1-this._anchor.y)});return e.x>=i.x&&e.x<=r.x&&e.y>=i.y&&e.y<=r.y},_.prototype=Object.create(d.prototype),_.prototype.constructor=_,_.prototype.addTouchListener=function(){"undefined"!=typeof UIEventHandler?(UIEventHandler.addNodeEvent(this,1,function(e,t,i,r){e.isCancelClick=!1,e.enable?e.changeStatus(1):e.changeStatus(2)}.bind(this)),UIEventHandler.addNodeEvent(this,2,function(e,t,i,r){var n={x:i,y:r};0==e.hittest(n)&&(e.isCancelClick=!0)}.bind(this)),UIEventHandler.addNodeEvent(this,3,function(e,t,i,r){e.enable?e.changeStatus(0):e.changeStatus(2),0==e.isCancelClick&&e.touchInsideCallback&&1==this.canClick&&e.touchInsideCallback(e)}.bind(this))):BK.Script.log(1,1,"UIEventHandler is undefined")},_.prototype.setTouchInsideCallback=function(e){this.touchInsideCallback=e},_.prototype.dispose=function(){UIEventHandler.removeNodeEvent(this,1),UIEventHandler.removeNodeEvent(this,2),UIEventHandler.removeNodeEvent(this,3),d.prototype.dispose.call(this)},_.prototype.changeStatus=function(e){this.touchStatus=e,this.updateTexture(e)},_.prototype.updateTexture=function(e){},g.prototype={constructor:g,setHidden:function(e){this._root_node?this._root_node.hidden=e:BK.Script.log(1,1,"set hidden error.root_node is null")},dispose:function(){this._is_webgl?(this._root_node.dispose(),this._root_node=void 0,this.webGL_exit()):this._root_node.removeFromParent()},_onTouchInside:function(){BK.Script.log(1,1,"_onTouchInside"),this._clickInsideCallback&&this._clickInsideCallback()},setClickContentCallback:function(e){this._clickInsideCallback=e},create_texture:function(e,t){if(this._is_webgl){var i=this._gl,r=i.RGBA,n=i.RGBA,o=i.UNSIGNED_BYTE,a=BK.Image.loadImage(e,6),s=i.createTexture();return i.bindTexture(i.TEXTURE_2D,s),i.texImage2D(i.TEXTURE_2D,0,r,n,o,a),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),{width:a.width,height:a.height,texture:s,tex_file:e,need_delete:t}}return new BK.Texture(e)},create_clip_node:function(e,r){if(this._is_webgl){t()&&(r.x+=.5*BK.Director.screenPixelSize.width,r.y=i());var n=new u;return this._clip_rect=r,e.addChild(n),n}return(n=new BK.ClipRectNode(r.x,r.y,r.width,r.height)).enableClip=!0,e.addChild(n),n},create_node:function(e){if(this._is_webgl){t=new u;return void 0!==e?e.addChild(t):this._gl_root_node.addChild(t),t}var t=new BK.Node;return void 0!==e?e.addChild(t):BK.Director.root.addChild(t),t},create_sprite:function(e,t,i,r){var n=this.create_texture(t,r);return this.create_sprite_with_texture(e,n,i)},create_button:function(e,t,i,r){if(this._is_webgl){var n=new _(i.width,i.height,t,0,1,1,1);return r&&n.setTouchInsideCallback(r),void 0!==e?e.addChild(n):this._gl_root_node.addChild(n),n}return(n=new BK.Button(i.width,i.height)).setNormalTexture(t),n.updateTexture=function(){},r&&n.setTouchInsideCallback(r),void 0!==e?e.addChild(n):BK.Director.root.addChild(n),n},create_sprite_with_texture:function(e,t,i){if(this._is_webgl){r=new d(i.width,i.height,t,0,1,1,1);return void 0!==e?e.addChild(r):this._gl_root_node.addChild(r),r}var r=new BK.Sprite(i.width,i.height,t,0,1,1,1);return void 0!==e?e.addChild(r):BK.Director.root.addChild(r),r},create_text:function(e,t){if(this._is_webgl){var i=new BK.CanvasNode(e.maxWidth,e.maxHeight);i.fillColor=e.textColor,i.strokeColor=e.strokeColor,i.setTextAlign(e.textAlign),i.setTextSize(e.fontSize),i.setTextItalic(e.italic),i.setTextBold(e.bold),i.setTextShadow(e.shadowDx,e.shadowDy,e.shadowRadius,e.shadowColor);var r=i.measureText(t,e.maxWidth,e.maxHeight);i.drawText(t,0,0,r.width,r.height);var n=i.getBitmap(),o=this._gl,a=o.RGBA,s=o.RGBA,h=o.UNSIGNED_BYTE,c=o.createTexture();o.bindTexture(o.TEXTURE_2D,c),o.texImage2D(o.TEXTURE_2D,0,a,s,h,n),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR);var l={width:n.width,height:n.height,texture:c,tex_file:t,need_delete:!0},u=new d(n.width,n.height,l,0,1,1,1);return u.anchor={x:0,y:0},u.width=r.width,u.height=r.height,u}return e.textColor=f(e.textColor),e.strokeColor=f(e.strokeColor),e.shadowColor=f(e.shadowColor),new BK.TextNode(e,t)},show:function(e){if(!this._is_webgl){var i=BK.Director.root.scale;this._root_node.scale={x:1/i.x,y:1/i.y,z:1/i.z},this._root_node.enableClip=t()}void 0!==this._real_content_node&&this._content_node.removeChild(this._real_content_node),this._real_content_node=this.create_node(this._content_node),void 0!==e.content&&e.content.length>20&&(e.content=e.content.substring(0,20),e.content=e.content+"...");var r=this._ad_final_size[e.ad_type];switch(e.ad_type){case AD_BANNER_TYPE_DYNAMIC_193_582_166:case AD_BANNER_TYPE_STATIC_193_582_166:(g=this.create_sprite(this._real_content_node,e.tex_files[0],r,!0)).anchor={x:0,y:1};break;case AD_BANNER_TYPE_DYNAMIC_194_147_147:case AD_BANNER_TYPE_STATIC_194_147_147:(g=this.create_sprite(this._real_content_node,e.tex_files[0],r,!0)).anchor={x:0,y:1};var n=15*STANDARD_SCALE,o=0;o=e.ad_type===AD_BANNER_TYPE_DYNAMIC_194_147_147?(p=this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1].width)-r.width-80*STANDARD_SCALE-n:(p=this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_2].width)-r.width-2*n;var a=26,s=this.create_text({fontSize:a*STANDARD_SCALE,textColor:{r:.2,g:.2,b:.2,a:1},maxWidth:o,maxHeight:30*STANDARD_SCALE,width:o,height:30*STANDARD_SCALE,textAlign:0,bold:1,italic:0,strokeColor:{r:1,g:1,b:1,a:1},strokeSize:0,shadowRadius:0,shadowDx:0,shadowDy:0,shadowColor:{r:1,g:1,b:1,a:1}},e.title);s.position={x:r.width+n,y:-50*STANDARD_SCALE},this._real_content_node.addChild(s),(m=this.create_text({fontSize:a*STANDARD_SCALE,textColor:{r:.4,g:.4,b:.4,a:1},maxWidth:o,maxHeight:60*STANDARD_SCALE,width:o,height:60*STANDARD_SCALE,textAlign:0,bold:0,italic:0,strokeColor:{r:1,g:1,b:1,a:1},strokeSize:0,shadowRadius:0,shadowDx:0,shadowDy:0,shadowColor:{r:1,g:1,b:1,a:1}},e.content)).anchor={x:0,y:1},m.position={x:r.width+n,y:-65*STANDARD_SCALE},this._real_content_node.addChild(m);break;case AD_BANNER_TYPE_DYNAMIC_184_240_180:case AD_BANNER_TYPE_STATIC_184_240_180:(g=this.create_sprite(this._real_content_node,e.tex_files[0],r,!0)).anchor={x:0,y:1};var n=15*STANDARD_SCALE,o=0;o=e.ad_type===AD_BANNER_TYPE_DYNAMIC_184_240_180?(p=this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1].width)-r.width-60*STANDARD_SCALE-n:(p=this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_2].width)-r.width-2*n;a=26;(m=this.create_text({fontSize:a*STANDARD_SCALE,textColor:{r:.2,g:.2,b:.2,a:1},maxWidth:o,maxHeight:60*STANDARD_SCALE,width:o,height:60*STANDARD_SCALE,textAlign:0,bold:0,italic:0,strokeColor:{r:1,g:1,b:1,a:1},strokeSize:0,shadowRadius:0,shadowDx:0,shadowDy:0,shadowColor:{r:1,g:1,b:1,a:1}},e.content)).anchor={x:0,y:1},m.position={x:r.width+n,y:.5*(m.height-r.height)},this._real_content_node.addChild(m);break;case AD_BANNER_TYPE_DYNAMIC_285_240_180_3:case AD_BANNER_TYPE_STATIC_285_240_180_3:var h=23*STANDARD_SCALE,c=0,l=0,u=3*STANDARD_SCALE;e.ad_type===AD_BANNER_TYPE_STATIC_285_240_180_3&&(h=11*STANDARD_SCALE,c=11*STANDARD_SCALE,l=-6*STANDARD_SCALE,u=4*STANDARD_SCALE);var d=this.create_sprite(this._real_content_node,e.tex_files[0],r,!0);d.anchor={x:0,y:1},d.position={x:c,y:l};var _=this.create_sprite(this._real_content_node,e.tex_files[1],r,!0);_.anchor={x:0,y:1},_.position={x:c+r.width+h,y:l};var f=this.create_sprite(this._real_content_node,e.tex_files[2],r,!0);f.anchor={x:0,y:1},f.position={x:c+2*(r.width+h),y:l};o=0;o=e.ad_type===AD_BANNER_TYPE_DYNAMIC_285_240_180_3?(p=this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1].width)-40*STANDARD_SCALE:(p=this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_2].width)-40*STANDARD_SCALE;a=24;(m=this.create_text({fontSize:a*STANDARD_SCALE,textColor:{r:.2,g:.2,b:.2,a:1},maxWidth:o,maxHeight:30*STANDARD_SCALE,width:o,height:30*STANDARD_SCALE,textAlign:1,bold:0,italic:0,strokeColor:{r:1,g:1,b:1,a:1},strokeSize:0,shadowRadius:0,shadowDx:0,shadowDy:0,shadowColor:{r:1,g:1,b:1,a:1}},e.content)).anchor={x:.5,y:1},m.position={x:.5*o,y:-r.height-u},this._real_content_node.addChild(m);break;case AD_BANNER_TYPE_DYNAMIC_210_640_288:case AD_BANNER_TYPE_STATIC_210_640_288:(g=this.create_sprite(this._real_content_node,e.tex_files[0],r,!0)).anchor={x:0,y:1};var n=10*STANDARD_SCALE,o=0;o=e.ad_type===AD_BANNER_TYPE_DYNAMIC_210_640_288?(p=this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1].width)-r.width-50*STANDARD_SCALE-n:(p=this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_2].width)-r.width-2*n;a=24;(m=this.create_text({fontSize:a*STANDARD_SCALE,textColor:{r:.2,g:.2,b:.2,a:1},maxWidth:o,maxHeight:120*STANDARD_SCALE,width:o,height:120*STANDARD_SCALE,textAlign:0,bold:0,italic:0,strokeColor:{r:1,g:1,b:1,a:1},strokeSize:0,shadowRadius:0,shadowDx:0,shadowDy:0,shadowColor:{r:1,g:1,b:1,a:1}},e.content)).anchor={x:0,y:.5},m.position={x:r.width+n,y:.5*-r.height},this._real_content_node.addChild(m);break;case AD_BANNER_TYPE_DYNAMIC_65_1000_560:case AD_BANNER_TYPE_STATIC_65_1000_560:var g=this.create_sprite(this._real_content_node,e.tex_files[0],r,!0);g.anchor={x:0,y:1};var n=10*STANDARD_SCALE,o=0;if(e.ad_type===AD_BANNER_TYPE_DYNAMIC_65_1000_560)o=(p=this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1].width)-r.width-50*STANDARD_SCALE-n;else{var p=this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_2].width;o=p-r.width-2*n}var a=26,m=this.create_text({fontSize:a*STANDARD_SCALE,textColor:{r:.2,g:.2,b:.2,a:1},maxWidth:o,maxHeight:120*STANDARD_SCALE,width:o,height:120*STANDARD_SCALE,textAlign:0,bold:0,italic:0,strokeColor:{r:1,g:1,b:1,a:1},strokeSize:0,shadowRadius:0,shadowDx:0,shadowDy:0,shadowColor:{r:1,g:1,b:1,a:1}},e.content);m.anchor={x:0,y:.5},m.position={x:r.width+n,y:.5*-r.height},this._real_content_node.addChild(m)}var v=e.ad_type>=AD_BANNER_TYPE_DYNAMIC_193_582_166&&e.ad_type<=AD_BANNER_TYPE_DYNAMIC_65_1000_560;this.anim_node_1(v),this.anim_node_2(v,e.ad_type===AD_BANNER_TYPE_STATIC_285_240_180_3?11*STANDARD_SCALE:0,e.ad_type===AD_BANNER_TYPE_STATIC_285_240_180_3?25*STANDARD_SCALE:0),this.anim_node_3(v)},update:function(e){this._node_1.update_tweens(e),this._node_2.update_tweens(e),this._node_3.update_tweens(e)},node_extend:function(e){return e._next_tween_handler=0,e._all_tween_data=[],e.tween_from_to=function(e,t,i,r,n,o,a){var s=this._next_tween_handler;return this._next_tween_handler+=1,this._all_tween_data.push({attr_type:e,duration:t,delay:i,interval:r,from:n,to:o,loop_count:a,pass_time:-i,handler:s,is_stop:!1}),s},e.remove_tween=function(e){for(;0<this._all_tween_data.length;)if(this._all_tween_data[0].handler===e)return void(this._all_tween_data[0].is_stop=!0)},e.update_tweens=function(e){for(var t=0;t<this._all_tween_data.length;){var i=this._all_tween_data[t];if(i.is_stop)this._all_tween_data.splice(t,1);else{if(i.pass_time+=e,i.pass_time>=i.duration)i.pass_time-=i.duration,-1===i.loop_count?(i.pass_time-=i.interval,this.update_tween_value(i,i.to)):(i.loop_count-=1,i.loop_count>=0?(i.pass_time-=i.interval,this.update_tween_value(i,i.to)):(this.update_tween_value(i,i.to),i.is_stop=!0));else if(i.pass_time>0){var r=(i.to-i.from)*(i.pass_time/i.duration)+i.from;this.update_tween_value(i,r)}++t}}},e.update_tween_value=function(e,t){switch(e.attr_type){case NODE_TWEEN_ATTR_TYPE_SCALE:this.scale={x:t,y:t};break;case NODE_TWEEN_ATTR_TYPE_SCALE_X:this.scale={x:t,y:this.scale.y};break;case NODE_TWEEN_ATTR_TYPE_SCALE_Y:this.scale={x:this.scale.x,y:t};break;case NODE_TWEEN_ATTR_TYPE_POSITION_X:this.position={x:t,y:this.position.y};break;case NODE_TWEEN_ATTR_TYPE_POSITION_Y:this.position={x:this.position.x,y:t};break;case NODE_TWEEN_ATTR_TYPE_OPACITY:this.opacity=t;break;case NODE_TWEEN_ATTR_TYPE_ROTATION_X:this.rotation={x:t,y:this.rotation.y,z:this.rotation.z};break;case NODE_TWEEN_ATTR_TYPE_ROTATION_Y:this.rotation={x:this.rotation.x,y:t,z:this.rotation.z};break;case NODE_TWEEN_ATTR_TYPE_ROTATION_Z:this.rotation={x:this.rotation.x,y:this.rotation.y,z:t}}},e},anim_node_1:function(e){if(e){var t={x:.8,y:.2},i=.5*-this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1].width+.4*this._ad_final_size[AD_BANNER_TYPE_RESERVED_0].width,r=0-.7*this._ad_final_size[AD_BANNER_TYPE_RESERVED_0].height;this._node_1.anchor=t,this._node_1.visible=!0,this._node_1.position={x:i,y:r},this._node_1.rotation={x:0,y:0,z:120},this._node_1.tween_from_to(NODE_TWEEN_ATTR_TYPE_POSITION_Y,.1,.2,0,r,0,0),this._node_1.tween_from_to(NODE_TWEEN_ATTR_TYPE_ROTATION_Z,.3,.2,0,120,10,0)}else this._node_1.visible=!1},anim_node_2:function(e,t,i){var r={x:.8,y:0},n=(e?this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1].width:this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_2].width)*(r.x-.5);this._node_2.position={x:n,y:0},e?(this._node_2.rotation={x:0,y:0,z:120},this._node_2.tween_from_to(NODE_TWEEN_ATTR_TYPE_ROTATION_Z,.3,0,0,120,0,0),this._node_2_1.anchor={x:.5,y:.5},this._node_2_1.size=this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1],this._node_2_1.setTexture(this._tex_bg_bg_1),this._node_2_1.position={x:this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1].width*(.5-r.x),y:.5*this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1].height},this._content_node.position={x:20*STANDARD_SCALE-this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1].width*r.x,y:this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1].height-6*STANDARD_SCALE},this._node_2_2.anchor={x:.5,y:.5},this._node_2_2.setTexture(this._tex_bg_fg_1),this._node_2_2.size=this._ad_final_size[AD_BANNER_TYPE_RESERVED_2_1],this._node_2_2.position={x:this._ad_final_size[AD_BANNER_TYPE_RESERVED_2_1].width*(.5-r.x),y:.5*this._ad_final_size[AD_BANNER_TYPE_RESERVED_2_1].height}):(this._node_2.rotation={x:0,y:0,z:0},this._node_2_1.anchor={x:.5,y:.5},this._node_2_1.size=this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_2],this._node_2_1.setTexture(this._tex_bg_bg_2),this._node_2_1.position={x:this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_2].width*(.5-r.x),y:.5*this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_2].height},this._content_node.position={x:-this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_2].width*r.x,y:this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_2].height},this._node_2_2.anchor={x:0,y:0},this._node_2_2.size=this._ad_final_size[AD_BANNER_TYPE_RESERVED_2_2],this._node_2_2.setTexture(this._tex_bg_fg_2),this._node_2_2.position={x:5*STANDARD_SCALE+this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_2].width*-r.x+t,y:5*STANDARD_SCALE+i})},anim_node_3:function(e){if(e){var t={x:.5,y:.5},i=.5*this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1].width+.15*this._ad_final_size[AD_BANNER_TYPE_RESERVED_3].width,r=.5*this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1].height-.1*this._ad_final_size[AD_BANNER_TYPE_RESERVED_3].height,n=.3*this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1].width,o=-this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1].height,a=Math.sqrt((i-n)*(i-n)+(r-o)*(r-o)),s={x:(i-n)/a,y:(r-o)/a},h=i+this._ad_final_size[AD_BANNER_TYPE_RESERVED_3].width*s.x*.2,c=r+this._ad_final_size[AD_BANNER_TYPE_RESERVED_3].height*s.y*.2,l=i-this._ad_final_size[AD_BANNER_TYPE_RESERVED_3].width*s.x*.1,u=r-this._ad_final_size[AD_BANNER_TYPE_RESERVED_3].height*s.y*.1;this._node_3.anchor=t,this._node_3.visible=!0,this._node_3.position={x:n,y:o},this._node_3.tween_from_to(NODE_TWEEN_ATTR_TYPE_POSITION_X,.3,.1,0,n,h,0),this._node_3.tween_from_to(NODE_TWEEN_ATTR_TYPE_POSITION_Y,.3,.1,0,o,c,0),this._node_3.tween_from_to(NODE_TWEEN_ATTR_TYPE_POSITION_X,.15,.4,0,h,l,0),this._node_3.tween_from_to(NODE_TWEEN_ATTR_TYPE_POSITION_Y,.15,.4,0,c,u,0),this._node_3.tween_from_to(NODE_TWEEN_ATTR_TYPE_ROTATION_Z,.15,.4,0,0,5,0),this._node_3.tween_from_to(NODE_TWEEN_ATTR_TYPE_POSITION_X,.08,.55,0,l,i,0),this._node_3.tween_from_to(NODE_TWEEN_ATTR_TYPE_POSITION_Y,.08,.55,0,u,r,0),this._node_3.tween_from_to(NODE_TWEEN_ATTR_TYPE_ROTATION_Z,.08,.55,0,5,0,0)}else this._node_3.visible=!1},gl_commit:function(e){var t=e._gl;UIEventHandler&&UIEventHandler.setRootNode(e._root_node),e.webGL_save(),t.viewport(0,0,BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height),t.disable(t.DEPTH_TEST),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA);var i=n(0,BK.Director.screenPixelSize.width,0,BK.Director.screenPixelSize.height,-1,1);e._webgl_shader.set_uniform("Projection",i);var o=new r;e._webgl_shader.set_uniform("ModelView",o),e._gl_root_node.render(t,e._webgl_shader,!0),e.webGL_restore(),t.superGLCommit()},webGL_init:function(){this._gl=bkWebGLGetInstance(),this._gl_root_node=new u,this._webgl_shader=this.webGL_load_shader(),this._gl.superGLCommit=this._gl.glCommit,this._gl.glCommit=this.gl_commit.bind(this._gl,this)},webGL_load_shader:function(){var e=new r,t={vs_source:"attribute vec3 Position;attribute vec4 SourceColor;varying vec4 DestinationColor;uniform mat4 Projection;uniform mat4 ModelView;attribute vec2 TexCoordIn;varying vec2 TexCoordOut;void main(void) {    DestinationColor = SourceColor;    mat4 mp = Projection * ModelView;    gl_Position = mp * vec4(Position, 1.0);    TexCoordOut = TexCoordIn;}",fs_source:"varying lowp vec4 DestinationColor;varying lowp vec2 TexCoordOut;uniform sampler2D Texture;void main(void) {    lowp vec4 tc = texture2D(Texture, TexCoordOut);    gl_FragColor = DestinationColor * tc;}",attributes:[{name:"Position",size:3},{name:"SourceColor",size:4},{name:"TexCoordIn",size:2}],uniforms:[{name:"Projection",type:SHADER_UNIFORM_TYPE_MATRIX4,default_value:e},{name:"ModelView",type:SHADER_UNIFORM_TYPE_MATRIX4,default_value:e},{name:"Texture",type:SHADER_UNIFORM_TYPE_TEXTURE0,default_value:0}]};return new l(this._gl,t)},webGL_exit:function(){void 0!==this._gl.superGLCommit&&(this._gl.glCommit=this._gl.superGLCommit,this._gl.superGLCommit=void 0),this._tex_bg_left&&(this._gl.deleteTexture(this._tex_bg_left.texture),this._gl.deleteTexture(this._tex_bg_bg_1.texture),this._gl.deleteTexture(this._tex_bg_bg_2.texture),this._gl.deleteTexture(this._tex_bg_fg_1.texture),this._gl.deleteTexture(this._tex_bg_fg_2.texture),this._gl.deleteTexture(this._tex_bg_right.texture))},webGL_save:function(){t()&&(this._is_clip_enabled=this._gl.glIsEnabled(this._gl.SCISSOR_TEST),this._is_clip_enabled?this._old_scissor=this._gl.glGetParameterInt(this._gl.SCISSOR_BOX,4):this._gl.glEnable(this._gl.SCISSOR_TEST),this._gl.glScissor(this._clip_rect.x,this._clip_rect.y,this._clip_rect.width,this._clip_rect.height)),this._is_enable_blend=this._gl.glIsEnabled(this._gl.BLEND),this._is_enable_blend&&(this._blend_color=this._gl.glGetParameterFloat(this._gl.BLEND_COLOR,4),this._blend_equation_rgb=this._gl.getParameter(this._gl.BLEND_EQUATION_RGB),this._blend_equation_alpha=this._gl.getParameter(this._gl.BLEND_EQUATION_ALPHA),this._blend_src_rgb=this._gl.getParameter(this._gl.BLEND_SRC_RGB),this._blend_src_alpha=this._gl.getParameter(this._gl.BLEND_SRC_ALPHA),this._blend_dst_rgb=this._gl.getParameter(this._gl.BLEND_DST_RGB),this._blend_dst_alpha=this._gl.getParameter(this._gl.BLEND_DST_ALPHA)),this._prevVP=this._gl.glGetParameterInt(this._gl.VIEWPORT,4),this._prevVBO=this._gl.glGetParameterInt(this._gl.ARRAY_BUFFER_BINDING,1),this._prevIBO=this._gl.glGetParameterInt(this._gl.ELEMENT_ARRAY_BUFFER_BINDING,1),this._prevProgram=this._gl.glGetParameterInt(this._gl.CURRENT_PROGRAM,1),this._prevTextureID=this._gl.glGetParameterInt(this._gl.TEXTURE_BINDING_2D,1),this._prevTextureUnit=this._gl.glGetParameterInt(this._gl.ACTIVE_TEXTURE,1),this._prevFrameBuffer=this._gl.glGetParameterInt(this._gl.FRAMEBUFFER_BINDING,1),this._prevRenderBuffer=this._gl.glGetParameterInt(this._gl.RENDERBUFFER_BINDING,1),this._activeAttribusInfo=[];for(var e=this._gl.glGetProgramParameter(this._prevProgram,gl.ACTIVE_ATTRIBUTES),i=0;i<e;++i){var r=this._gl.getActiveAttrib(this._prevProgram,i),n=r.name,o=this._gl.getAttribLocation(this._prevProgram,n),a=this._gl.getVertexAttrib(o,this._gl.VERTEX_ATTRIB_ARRAY_SIZE),s=this._gl.getVertexAttrib(o,this._gl.VERTEX_ATTRIB_ARRAY_TYPE),h=this._gl.getVertexAttrib(o,this._gl.VERTEX_ATTRIB_ARRAY_NORMALIZED),c=this._gl.getVertexAttrib(o,this._gl.VERTEX_ATTRIB_ARRAY_STRIDE),l=this._gl.getVertexAttribOffset(o,gl.VERTEX_ATTRIB_ARRAY_POINTER);if(r.name=n,r.index=o,r.size=a,r.type=s,r.normalized=h,r.stride=c,r.offset=l,void 0!==this._gl.recordVertexAttribPointer)for(var u=0;u<this._gl.recordVertexAttribPointer.length;u++){var d=this._gl.recordVertexAttribPointer[u];if(r.index==d.index&&r.type==d.type&&r.stride==d.stride&&r.offset==d.offset){r.index=d.index,r.size=d.size,r.type=d.type,r.normalized=d.normalized,r.stride=d.stride,r.offset=d.offset;break}}this._activeAttribusInfo.push(r)}},webGL_restore:function(){if(this._is_enable_blend?(this._gl.glEnable(this._gl.BLEND),this._gl.blendColor(this._blend_color[0],this._blend_color[1],this._blend_color[2],this._blend_color[3]),this._gl.blendEquationSeparate(this._blend_equation_rgb,this._blend_equation_alpha),this._gl.blendFuncSeparate(this._blend_src_rgb,this._blend_dst_rgb,this._blend_src_alpha,this._blend_dst_alpha)):this._gl.glDisable(this._gl.BLEND),this._gl.viewport(this._prevVP[0],this._prevVP[1],this._prevVP[2],this._prevVP[3]),this._gl.useProgram(this._prevProgram),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._prevVBO),this._activeAttribusInfo.length>0){this._activeAttribusInfo[0].stride;for(var e=0;e<this._activeAttribusInfo.length;e++){var i=this._activeAttribusInfo[e],r=(i.name,i.index),n=i.size,o=i.type,a=i.normalized,s=i.offset,h=i.stride,c=0!=a;this._gl.vertexAttribPointer(r,n,o,c,h,s,!0)}}this._activeAttribusInfo=[],this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this._prevIBO),this._gl.activeTexture(this._prevTextureUnit),this._gl.bindTexture(this._gl.TEXTURE_2D,this._prevTextureID),this._gl.glBindFramebuffer(this._gl.FRAMEBUFFER,this._prevFrameBuffer),this._gl.glBindRenderbuffer(this._gl.RENDERBUFFER,this._prevRenderBuffer),t()&&(this._is_clip_enabled?this._gl.glScissor(this._old_scissor[0],this._old_scissor[1],this._old_scissor[2],this._old_scissor[3]):this._gl.glDisable(this._gl.SCISSOR_TEST))}},{AdAnimateBanner:g}}().AdAnimateBanner)}(BK);var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(e,t){"object"==typeof e&&(e.AdAnimateBannerHandler=function(){var e=function(){function e(e,t){this.info=e,this.download(t)}return e.prototype.download=function(e){var t="GameSandBox://__bkDownloadCache/"+BK.Crypt.hex_md5(this.info.url);this.info.savePath&&(t=this.info.savePath);var i=!0;if(1==(!!this.info.useCache&&this.info.useCache)&&1==BK.FileUtil.isFileExist(t)){i=!1;var r={url:this.info.url,statueCode:200,savePath:t};e(r)}1==i&&new BK.HttpUtil(this.info.url).requestAsync(function(i,r){200==r?BK.FileUtil.writeBufferToFile(t,i):BK.Script.log(1,1,"Fetch banner image failed.url:"+this.info.url);var n={url:this.info.url,statueCode:r,savePath:t};e(n)}.bind(this))},e}(),t=function(){function t(){}return t.download=function(t,i){this.completeTasks=[],this.reqTasks=t;for(var r=0;r<t.length;r++){var n=t[r];new e(n,function(e){this.completeTasks.push(e),this.check()&&i(this.completeTasks)}.bind(this))}BK.Director.ticker.setTimeout(function(){this.fillUncomplete(),i(this.completeTasks)}.bind(this),3e4,this)},t.cancelTimeOut=function(){BK.Director.ticker.removeTimeout(this)},t.fillUncomplete=function(){for(var e=0;e<this.reqTasks.length;e++){for(var t=this.reqTasks[e],i=!1,r=0;r<this.completeTasks.length;r++){var n=this.completeTasks[r];t.url==n.url&&(i=!0)}if(0==i){var o={url:t.url,statueCode:-1,savePath:t.savePath};this.completeTasks.push(o)}}},t.check=function(){return this.completeTasks.length==this.reqTasks.length&&(this.cancelTimeOut(),!0)},t}();return{AdAnimateBannerHandler:function(e){function i(t,i){var r=e.call(this,t,i)||this;return r.bannerContentInfo=r.parseInfo(r.adInfo),r.banner=null,r}return __extends(i,e),i.prototype.setHidden=function(e){this.banner?this.banner.setHidden(e):BK.Script.log(1,1,"set hidden fail ,this.banner is null")},i.prototype.show=function(e){this.bannerType=1,this._show(function(t,i,r){if(0==t)if(void 0!==this.bannerContentInfo.staticBannerType){this.banner=new BK.AdAnimateBanner(i),this.bannerContentInfo.ad_type=this.bannerContentInfo,this.bannerContentInfo.tex_files=r;var n={ad_type:this.bannerContentInfo.staticBannerType,tex_files:r,title:this.bannerContentInfo.title,content:this.bannerContentInfo.content};this.banner.setClickContentCallback(this._onClickContentCallback.bind(this)),this.banner.show(n),this._onShowCallback(),e(t,"show ok",this)}else e(-1,"show failed",null);else e(t,"show _show failed",null)}.bind(this))},i.prototype.showAnimate=function(e){this.bannerType=2,this._show(function(t,i,r){if(0==t)if(void 0!==this.bannerContentInfo.dynamicBannerType){this.banner=new BK.AdAnimateBanner(i),this.bannerContentInfo.ad_type=this.bannerContentInfo,this.bannerContentInfo.tex_files=r;var n={ad_type:this.bannerContentInfo.dynamicBannerType,tex_files:r,title:this.bannerContentInfo.title,content:this.bannerContentInfo.content};this.banner.setClickContentCallback(this._onClickContentCallback.bind(this)),this.banner.show(n),this._onShowCallback(),e(t,"showAnimate ok",this)}else e(-1,"fshowAnimate ailed",null);else e(t,"showAnimate _show failed",null)}.bind(this))},i.prototype._onShowCallback=function(){this.cmshowReport(1,"","",this.bannerType.toString()),this.exposeureReport()},i.prototype._jumpToGDTDestPage=function(){var e=this.adInfo;BK.MQQ.SsoRequest.send(e,"cs.xy_ad_banner_jump.local")},i.prototype._onClickContentCallback=function(){this.cmshowReport(3,"","",this.bannerType.toString()),this.clickReport(),1==BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5")||"android"===GameStatusInfo.platform&&1==BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.8.0")?this._onClickContentBtn():(this._emmitClickEvent(),this._jumpToGDTDestPage())},i.prototype._show=function(e){if(!this.bannerContentInfo)return BK.Script.log(1,1,"show failed.ad info is illegal!"),void e(-2,null,null);this.loadRes(function(t,i){0==t?this.loadImage(function(t,r){e(t,i,r)}.bind(this)):e(-1,null,null)}.bind(this))},i.prototype.close=function(){this.banner?(this.banner.dispose(),this.banner=null):BK.Script.log(1,1,"close banner failed. banner has not been inited!")},i.prototype.loadImage=function(e){for(var i=[],r=0;r<this.bannerContentInfo.image.length;r++){var n={url:this.bannerContentInfo.image[r]};i.push(n)}t.download(i,function(t){for(var r=!0,n=[],o=0;o<i.length;o++)for(var a=i[o],s=0;s<t.length;s++){var h=t[s];a.url==h.url&&(200!=h.statueCode?(BK.Script.log(1,1,"banner load image failed.url:"+h.url),r=!1):n.push(h.savePath))}e(1==r?0:-1,n)}.bind(this))},i.prototype.loadRes=function(e){t.download([{url:"https://qzonestyle.gtimg.cn/aoi/sola/20180713161350_Jwn4D4m83k.png",savePath:"GameSandBox://_bkAd/bg_left.png",useCache:!0},{url:"https://qzonestyle.gtimg.cn/aoi/sola/20180713161350_A8Q8Sow7O2.png",savePath:"GameSandBox://_bkAd/bg_right.png",useCache:!0},{url:"https://qzonestyle.gtimg.cn/aoi/sola/20180713161350_ufpiWlVIBh.png",savePath:"GameSandBox://_bkAd/bg_bg_2.png",useCache:!0},{url:"https://qzonestyle.gtimg.cn/aoi/sola/20180713161350_bb7MoaVYPP.png",savePath:"GameSandBox://_bkAd/bg_fg_2.png",useCache:!0},{url:"https://qzonestyle.gtimg.cn/aoi/sola/20180713161349_490ORk1ziJ.png",savePath:"GameSandBox://_bkAd/bg_fg_1.png",useCache:!0},{url:"https://qzonestyle.gtimg.cn/aoi/sola/20180713161349_I3ZMMhw8al.png",savePath:"GameSandBox://_bkAd/bg_bg_1.png",useCache:!0}],function(t){for(var i="",r="",n="",o="",a="",s="",h=!0,c=0;c<t.length;c++){var l=t[c];200!=l.statueCode&&(h=!1),l.savePath.indexOf("bg_bg_1")>0?n=l.savePath:l.savePath.indexOf("bg_bg_2")>0?o=l.savePath:l.savePath.indexOf("bg_fg_1")>0?a=l.savePath:l.savePath.indexOf("bg_fg_2")>0?s=l.savePath:l.savePath.indexOf("bg_left")>0?i=l.savePath:l.savePath.indexOf("bg_right")>0&&(r=l.savePath)}e(1==h?0:-1,{bg_left_path:i,bg_right_path:r,bg_bg_1_path:n,bg_bg_2_path:o,bg_fg_1_path:a,bg_fg_2_path:s})}.bind(this))},i.prototype.parseInfo=function(e){var t=e.display_info.creative_size;this.creativeSize=t;var i={creative_size:t,content:"",title:""};switch(t){case 193:i.image=[e.display_info.basic_info.img],i.staticBannerType=6,i.dynamicBannerType=0;break;case 194:i.image=[e.display_info.basic_info.img],i.title=e.display_info.basic_info.txt,i.content=e.display_info.basic_info.desc,i.staticBannerType=7,i.dynamicBannerType=1;break;case 285:i.image=e.display_info.muti_pic_text_info.image,i.content=e.display_info.basic_info.txt,i.staticBannerType=9,i.dynamicBannerType=3;break;case 184:i.image=[e.display_info.basic_info.img],i.content=e.display_info.basic_info.txt,i.staticBannerType=8,i.dynamicBannerType=2;break;case 210:i.image=[e.display_info.basic_info.img],i.content=e.display_info.basic_info.txt,i.staticBannerType=10,i.dynamicBannerType=4;break;case 65:i.image=[e.display_info.basic_info.img],i.content=e.display_info.basic_info.txt,i.staticBannerType=11,i.dynamicBannerType=5;break;default:return BK.Script.log(1,1,"parseInfo failed."),null}return i},i}(BK.AdBannerHandler)}}().AdAnimateBannerHandler)}(BK)}!function(e,t){e.Crypt=function(){function e(){this.hexcase=0,this.b64pad="",this.chrsz=8}return e.prototype.hex_md5=function(e){return this.bin2hex(this.core_md5(this.str2bin(e),e.length*this.chrsz))},e.prototype.b64_md5=function(e){return this.bin2b64(this.core_md5(this.str2bin(e),e.length*this.chrsz))},e.prototype.str_md5=function(e){return this.bin2str(this.core_md5(this.str2bin(e),e.length*this.chrsz))},e.prototype.hex_hmac_md5=function(e,t){return this.bin2hex(this.core_hmac_md5(e,t))},e.prototype.b64_hmac_md5=function(e,t){return this.bin2b64(this.core_hmac_md5(e,t))},e.prototype.str_hmac_md5=function(e,t){return this.bin2str(this.core_hmac_md5(e,t))},e.prototype.md5_vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"==this.hex_md5("abc")},e.prototype.core_md5=function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var i=1732584193,r=-271733879,n=-1732584194,o=271733878,a=0;a<e.length;a+=16){var s=i,h=r,c=n,l=o;i=this.md5_ff(i,r,n,o,e[a+0],7,-680876936),o=this.md5_ff(o,i,r,n,e[a+1],12,-389564586),n=this.md5_ff(n,o,i,r,e[a+2],17,606105819),r=this.md5_ff(r,n,o,i,e[a+3],22,-1044525330),i=this.md5_ff(i,r,n,o,e[a+4],7,-176418897),o=this.md5_ff(o,i,r,n,e[a+5],12,1200080426),n=this.md5_ff(n,o,i,r,e[a+6],17,-1473231341),r=this.md5_ff(r,n,o,i,e[a+7],22,-45705983),i=this.md5_ff(i,r,n,o,e[a+8],7,1770035416),o=this.md5_ff(o,i,r,n,e[a+9],12,-1958414417),n=this.md5_ff(n,o,i,r,e[a+10],17,-42063),r=this.md5_ff(r,n,o,i,e[a+11],22,-1990404162),i=this.md5_ff(i,r,n,o,e[a+12],7,1804603682),o=this.md5_ff(o,i,r,n,e[a+13],12,-40341101),n=this.md5_ff(n,o,i,r,e[a+14],17,-1502002290),r=this.md5_ff(r,n,o,i,e[a+15],22,1236535329),i=this.md5_gg(i,r,n,o,e[a+1],5,-165796510),o=this.md5_gg(o,i,r,n,e[a+6],9,-1069501632),n=this.md5_gg(n,o,i,r,e[a+11],14,643717713),r=this.md5_gg(r,n,o,i,e[a+0],20,-373897302),i=this.md5_gg(i,r,n,o,e[a+5],5,-701558691),o=this.md5_gg(o,i,r,n,e[a+10],9,38016083),n=this.md5_gg(n,o,i,r,e[a+15],14,-660478335),r=this.md5_gg(r,n,o,i,e[a+4],20,-405537848),i=this.md5_gg(i,r,n,o,e[a+9],5,568446438),o=this.md5_gg(o,i,r,n,e[a+14],9,-1019803690),n=this.md5_gg(n,o,i,r,e[a+3],14,-187363961),r=this.md5_gg(r,n,o,i,e[a+8],20,1163531501),i=this.md5_gg(i,r,n,o,e[a+13],5,-1444681467),o=this.md5_gg(o,i,r,n,e[a+2],9,-51403784),n=this.md5_gg(n,o,i,r,e[a+7],14,1735328473),r=this.md5_gg(r,n,o,i,e[a+12],20,-1926607734),i=this.md5_hh(i,r,n,o,e[a+5],4,-378558),o=this.md5_hh(o,i,r,n,e[a+8],11,-2022574463),n=this.md5_hh(n,o,i,r,e[a+11],16,1839030562),r=this.md5_hh(r,n,o,i,e[a+14],23,-35309556),i=this.md5_hh(i,r,n,o,e[a+1],4,-1530992060),o=this.md5_hh(o,i,r,n,e[a+4],11,1272893353),n=this.md5_hh(n,o,i,r,e[a+7],16,-155497632),r=this.md5_hh(r,n,o,i,e[a+10],23,-1094730640),i=this.md5_hh(i,r,n,o,e[a+13],4,681279174),o=this.md5_hh(o,i,r,n,e[a+0],11,-358537222),n=this.md5_hh(n,o,i,r,e[a+3],16,-722521979),r=this.md5_hh(r,n,o,i,e[a+6],23,76029189),i=this.md5_hh(i,r,n,o,e[a+9],4,-640364487),o=this.md5_hh(o,i,r,n,e[a+12],11,-421815835),n=this.md5_hh(n,o,i,r,e[a+15],16,530742520),r=this.md5_hh(r,n,o,i,e[a+2],23,-995338651),i=this.md5_ii(i,r,n,o,e[a+0],6,-198630844),o=this.md5_ii(o,i,r,n,e[a+7],10,1126891415),n=this.md5_ii(n,o,i,r,e[a+14],15,-1416354905),r=this.md5_ii(r,n,o,i,e[a+5],21,-57434055),i=this.md5_ii(i,r,n,o,e[a+12],6,1700485571),o=this.md5_ii(o,i,r,n,e[a+3],10,-1894986606),n=this.md5_ii(n,o,i,r,e[a+10],15,-1051523),r=this.md5_ii(r,n,o,i,e[a+1],21,-2054922799),i=this.md5_ii(i,r,n,o,e[a+8],6,1873313359),o=this.md5_ii(o,i,r,n,e[a+15],10,-30611744),n=this.md5_ii(n,o,i,r,e[a+6],15,-1560198380),r=this.md5_ii(r,n,o,i,e[a+13],21,1309151649),i=this.md5_ii(i,r,n,o,e[a+4],6,-145523070),o=this.md5_ii(o,i,r,n,e[a+11],10,-1120210379),n=this.md5_ii(n,o,i,r,e[a+2],15,718787259),r=this.md5_ii(r,n,o,i,e[a+9],21,-343485551),i=this.safe_add(i,s),r=this.safe_add(r,h),n=this.safe_add(n,c),o=this.safe_add(o,l)}return Array(i,r,n,o)},e.prototype.md5_cmn=function(e,t,i,r,n,o){return this.safe_add(this.rol(this.safe_add(this.safe_add(t,e),this.safe_add(r,o)),n),i)},e.prototype.md5_ff=function(e,t,i,r,n,o,a){return this.md5_cmn(t&i|~t&r,e,t,n,o,a)},e.prototype.md5_gg=function(e,t,i,r,n,o,a){return this.md5_cmn(t&r|i&~r,e,t,n,o,a)},e.prototype.md5_hh=function(e,t,i,r,n,o,a){return this.md5_cmn(t^i^r,e,t,n,o,a)},e.prototype.md5_ii=function(e,t,i,r,n,o,a){return this.md5_cmn(i^(t|~r),e,t,n,o,a)},e.prototype.core_hmac_md5=function(e,t){var i=this.str2bin(e);i.length>16&&(i=this.core_md5(i,e.length*this.chrsz));for(var r=Array(16),n=Array(16),o=0;o<16;o++)r[o]=909522486^i[o],n[o]=1549556828^i[o];var a=this.core_md5(r.concat(this.str2bin(t)),512+t.length*this.chrsz);return this.core_md5(n.concat(a),640)},e.prototype.hex_sha1=function(e){return this.bin2hex(this.core_sha1(this.str2bin(e),e.length*this.chrsz))},e.prototype.b64_sha1=function(e){return this.bin2b64(this.core_sha1(this.str2bin(e),e.length*this.chrsz))},e.prototype.str_sha1=function(e){return this.bin2str(this.core_sha1(this.str2bin(e),e.length*this.chrsz))},e.prototype.hex_hmac_sha1=function(e,t){return this.bin2hex(this.core_hmac_sha1(e,t))},e.prototype.b64_hmac_sha1=function(e,t){return this.bin2b64(this.core_hmac_sha1(e,t))},e.prototype.str_hmac_sha1=function(e,t){return this.bin2str(this.core_hmac_sha1(e,t))},e.prototype.sha1_vm_test=function(){return"a9993e364706816aba3e25717850c26c9cd0d89d"==this.hex_sha1("abc")},e.prototype.core_sha1=function(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;for(var i=Array(80),r=1732584193,n=-271733879,o=-1732584194,a=271733878,s=-1009589776,h=0;h<e.length;h+=16){for(var c=r,l=n,u=o,d=a,_=s,f=0;f<80;f++){i[f]=f<16?e[h+f]:this.rol(i[f-3]^i[f-8]^i[f-14]^i[f-16],1);var g=this.safe_add(this.safe_add(this.rol(r,5),this.sha1_ft(f,n,o,a)),this.safe_add(this.safe_add(s,i[f]),this.sha1_kt(f)));s=a,a=o,o=this.rol(n,30),n=r,r=g}r=this.safe_add(r,c),n=this.safe_add(n,l),o=this.safe_add(o,u),a=this.safe_add(a,d),s=this.safe_add(s,_)}return Array(r,n,o,a,s)},e.prototype.sha1_ft=function(e,t,i,r){return e<20?t&i|~t&r:e<40?t^i^r:e<60?t&i|t&r|i&r:t^i^r},e.prototype.sha1_kt=function(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514},e.prototype.core_hmac_sha1=function(e,t){var i=this.str2bin(e);i.length>16&&(i=this.core_sha1(i,e.length*this.chrsz));for(var r=Array(16),n=Array(16),o=0;o<16;o++)r[o]=909522486^i[o],n[o]=1549556828^i[o];var a=this.core_sha1(r.concat(this.str2bin(t)),512+t.length*this.chrsz);return this.core_sha1(n.concat(a),672)},e.prototype.safe_add=function(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i},e.prototype.rol=function(e,t){return e<<t|e>>>32-t},e.prototype.str2bin=function(e){for(var t=Array(),i=(1<<this.chrsz)-1,r=0;r<e.length*this.chrsz;r+=this.chrsz)t[r>>5]|=(e.charCodeAt(r/this.chrsz)&i)<<24-r%32;return t},e.prototype.bin2str=function(e){for(var t="",i=(1<<this.chrsz)-1,r=0;r<32*e.length;r+=this.chrsz)t+=String.fromCharCode(e[r>>5]>>>24-r%32&i);return t},e.prototype.bin2hex=function(e){for(var t=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",i="",r=0;r<4*e.length;r++)i+=t.charAt(e[r>>2]>>8*(3-r%4)+4&15)+t.charAt(e[r>>2]>>8*(3-r%4)&15);return i},e.prototype.bin2b64=function(e){for(var t="",i=0;i<4*e.length;i+=3)for(var r=(e[i>>2]>>8*(3-i%4)&255)<<16|(e[i+1>>2]>>8*(3-(i+1)%4)&255)<<8|e[i+2>>2]>>8*(3-(i+2)%4)&255,n=0;n<4;n++)8*i+6*n>32*e.length?t+=this.b64pad:t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>6*(3-n)&63);return t},new e}()}(BK);var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();if(function(e,t){"object"==typeof e&&(e.AdVideoHandler=t().AdVideoHandler,e.AdVideoHandlerNative=t().AdVideoHandlerNative)}(BK,function(){var e=function(){function e(e,t,i,r){this._onStartPlay=function(e){this.event&&this.event.onStartPlay?this.event.onStartPlay(e.code,e.msg):this.log("lack of onStartPlay callback"),this.log("_onStartPlay")},this.hasJump=!1,this.videoType=e;var n="";i.display_info&&i.display_info.button_info&&i.display_info.button_info.length>0&&(n=i.display_info.button_info[0].txt);i.display_info.advertiser_info.corporation_name,i.display_info.advertiser_info.corporate_image_name,i.display_info.advertiser_info.corporate_logo;var o=0;if(i.display_info.button_info.length>0)for(var a=i.display_info.button_info,s=0;s<a.length;s++){var h=a[s];if(void 0!=typeof h.pos){o=h.pos;break}}this.adVideoInfo={pos_id:t,tencent_video_id:i.display_info.video_info.tencent_video_id,creative_size:i.display_info.creative_size,dest_info:i.dest_info,buttonInfo_txt:n,buttonInfo_pos:o,corporation_name:i.display_info.advertiser_info.corporation_name,corporate_image_name:i.display_info.advertiser_info.corporate_image_name,corporate_logo:i.display_info.advertiser_info.corporate_logo,base_info:i.display_info.basic_info.txt,product_type:i.product_type,video_preview_url:i.display_info.basic_info.img,pkg_download_schema:i.app_info.pkg_download_schema},this.adFullVideoInfo=i,this.adVideoInfo.dksjs=Math.random().toString(),this.gameOrientation=r}return e.prototype._onEnterForeground=function(){this.log("_onEnterForeground"),void 0!==this.envType?this._resumeAllMusic():BK.Audio.switch=!1},e.prototype._removeListener=function(){BK.MQQ.SsoRequest.removeListener("sc.game_enter_foreground.local",this),BK.MQQ.SsoRequest.removeListener("sc.apolloGameWebMessage.local",this)},e.prototype._addListener=function(){BK.MQQ.SsoRequest.addListener("sc.game_enter_foreground.local",this,this._onEnterForeground.bind(this))},e.prototype.jump=function(){if(1!=this.hasJump){this.hasJump=!0,this._addListener(),BK.Advertisement.videoCMReport(this.videoType,3),this._pauseAllMusic();var e=this.gameOrientation,t=this.adVideoInfo,i="https://cmshow.qq.com/apollo/html/game-platform/game-ad.html?_wv=4099&_fv=0&";i=(i=(i=i+"gameOrientation="+(void 0===e?1:e)+"&")+"gameId="+GameStatusInfo.gameId+"&")+"adInfo="+encodeURI(JSON.stringify(t));var r={gameOrientation:e,transparent:1,businessType:2,openId:GameStatusInfo.openId,url:i};BK.MQQ.SsoRequest.addListener("sc.apolloGameWebMessage.local",this,function(e,t,i){0==e&&i.op&&("apolloGamePlatform.endAdVideo"==i.op?i.data?this._onEndAdVideo(i.data):(this._onEndAdVideo(null),BK.Script.log(1,1,"video ad end failed. data.data is null")):"apolloGamePlatform.closeGame"==i.op?i.data?this._onCloseGame(i.data):(this._onCloseGame(null),BK.Script.log(1,1,"video ad close failed. data.data is null")):"apolloGamePlatform.miniGame"==i.op?"number"==typeof i.ggspd&&(BK.Advertisement.ggspd=i.ggspd):"apolloGamePlatform.closeWv"==i.op?(this._onCloseWebView(i.data),this.log("closeWv:"+JSON.stringify(i))):"apolloGamePlatform.startAdVideo"==i.op?(this._onStartPlay(i.data),this.log("startAdVideo:"+JSON.stringify(i))):"apolloGamePlatform.report"==i.op?this._onWebViewReport(i.data):"apolloGamePlatform.openUrl"==i.op&&this._onWebViewOpenUrl(i.data))}.bind(this)),BK.MQQ.SsoRequest.send(r,"cs.openWebViewWithoutUrl.local")}else this.log("jump failed!Can't call jump twice!")},e.prototype._isEmptyObject=function(e){for(var t in e)return!1;return!0},e.prototype._formatUrl=function(e){var t="";return"exposure_url"==e.type?t=this.adFullVideoInfo.report_info.exposure_url:"click_url"==e.type&&(t=this.adFullVideoInfo.report_info.click_url),delete e.type,0==this._isEmptyObject(e)&&(t=t+"&video="+encodeURIComponent(JSON.stringify(e))),t},e.prototype._onWebViewReport=function(e){var t=this._formatUrl(e);BK.Script.log(1,1,"_onWebViewReport req url:"+t),new BK.HttpUtil(t).requestAsync(function(e,t){BK.Script.log(1,1,"_onWebViewReport resp code:"+t)})},e.prototype._onWebViewOpenUrl=function(e){var t=this._formatUrl(e);BK.Script.log(1,1,"_onWebViewOpenUrl url:"+t),BK.MQQ.Webview.open(t)},e.prototype._onCloseWebView=function(e){var t=0;void 0!==e.type&&(0==(t=e.type)?(this._resumeAllMusic(),this._removeListener()):1==t&&(this.envType=1),this.log("_onCloseWebView "+t)),this.event&&this.event.onCloseVideo?this.event.onCloseVideo(e.code,e.msg):this.log("lack of onCloseWebView callback"),this.event.onCloseVideo=null},e.prototype._onMini=function(){},e.prototype._onCloseGame=function(e){e?this.event&&this.event.onCloseGame?e&&e.code?this.event.onCloseGame(e.code,e.msg):this.event.onCloseGame(0,""):this.log("lack of onClose callback"):this.event.onCloseGame(-1,"_onCloseGame failed data is null"),BK.QQ.notifyCloseGame(),this.event.onCloseGame=null},e.prototype._onEndAdVideo=function(e){e?this.event&&this.event.onEndVideo?e.dksjs==this.adVideoInfo.dksjs?this.event.onEndVideo(e.code,e.msg):(BK.Script.log(1,1,"data.dksjs:"+e.dksjs+" this.adInfo[dksjs]:"+this.adVideoInfo.dksjs),this.event.onEndVideo(-1,"end video failed! illegal end viedo")):this.log("lack of onEnd callback"):this.event.onEndVideo(-1,"_onEndAdVideo failed.data is null"),this.event.onEndVideo=void 0},e.prototype._pauseAllMusic=function(){void 0===BK.isBrowser&&BK.Audio.pauseAllBackground()},e.prototype._resumeAllMusic=function(){void 0===BK.isBrowser&&BK.Audio.resumeAllBackground()},e.prototype.setEventCallack=function(e,t,i,r){void 0===this.event?this.event={onCloseGame:e,onEndVideo:t,onCloseVideo:i,onStartPlay:r}:(this.event.onCloseGame=e,this.event.onEndVideo=t,this.event.onCloseVideo=i,this.event.onStartPlay=r)},e.prototype.setEventCallback=function(e,t,i,r){this.setEventCallack(e,t,i,r)},e.prototype.log=function(e){BK.Script.log(1,1,"AdVideoHandler:"+e)},e.prototype.debugLog=function(e){BK.Script.log(0,0,"AdVideoHandler Debug:"+e)},e.prototype.errorLog=function(e){BK.Script.log(1,1,"AdVideoHandler Error:"+e)},e}();return{AdVideoHandler:e,AdVideoHandlerNative:function(e){function t(t,i,r,n){var o=e.call(this,t,i,r,n)||this;return o.CMSHOW_SC_CMD_AD_VIDEO_START="sc.game_ad_video_start.local",o.CMSHOW_SC_CMD_AD_VIDEO_END="sc.game_ad_video_end.local",o.CMSHOW_SC_CMD_AD_VIDEO_CLOSE="sc.game_ad_video_view_close.local",o.CMSHOW_SC_CMD_SHELL_CLOSE="sc.game_shell_close.local",o.CMSHOW_CS_CMD_AD_VIDEO_JUMP="cs.game_ad_video_jump.local",o.CMSHOW_CS_CMD_AD_VIDEO_CLOSE="cs.game_ad_video_close.local",o.posid=i,o.adInfo=r,o}return __extends(t,e),t.prototype.jump=function(){this.addNativeListener(),BK.Advertisement.videoCMReport(this.videoType,3),this._pauseAllMusic(),BK.MQQ.SsoRequest.send(this.adInfo,this.CMSHOW_CS_CMD_AD_VIDEO_JUMP)},t.prototype.close=function(){BK.MQQ.SsoRequest.send({},this.CMSHOW_CS_CMD_AD_VIDEO_CLOSE)},t.prototype.setEventCallack=function(e,t,i,r){void 0===this.event?this.event={onCloseGame:e,onEndVideo:t,onCloseVideo:i,onStartPlay:r}:(this.event.onCloseGame=e,this.event.onEndVideo=t,this.event.onCloseVideo=i,this.event.onStartPlay=r)},t.prototype._startVideo=function(e,t,i){this.event&&this.event.onStartPlay?this.event.onStartPlay(e,""):this.log("lack of onStartPlay callback"),this.log("_onStartPlay")},t.prototype._endVideo=function(e,t,i){this.event&&this.event.onEndVideo?this.event.onEndVideo(e,""):this.log("lack of onEnd callback"),this.log("_endVideo")},t.prototype._closeVideo=function(e,t,i){this._resumeAllMusic(),this.event&&this.event.onCloseVideo?this.event.onCloseVideo(e,""):this.log("lack of onEnd callback"),this.log("_closeVideo"),this.removeNativeListener()},t.prototype._closeGame=function(e,t,i){this.event&&this.event.onCloseGame?this.event.onCloseGame(e,""):this.log("lack of onClose callback"),this.event.onCloseGame=null},t.prototype.removeNativeListener=function(){BK.MQQ.SsoRequest.removeListener(this.CMSHOW_SC_CMD_AD_VIDEO_START,this),BK.MQQ.SsoRequest.removeListener(this.CMSHOW_SC_CMD_AD_VIDEO_END,this),BK.MQQ.SsoRequest.removeListener(this.CMSHOW_SC_CMD_AD_VIDEO_CLOSE,this),BK.MQQ.SsoRequest.removeListener(this.CMSHOW_SC_CMD_SHELL_CLOSE,this)},t.prototype.addNativeListener=function(){BK.MQQ.SsoRequest.addListener(this.CMSHOW_SC_CMD_AD_VIDEO_START,this,this._startVideo.bind(this)),BK.MQQ.SsoRequest.addListener(this.CMSHOW_SC_CMD_AD_VIDEO_END,this,this._endVideo.bind(this)),BK.MQQ.SsoRequest.addListener(this.CMSHOW_SC_CMD_AD_VIDEO_CLOSE,this,this._closeVideo.bind(this)),BK.MQQ.SsoRequest.addListener(this.CMSHOW_SC_CMD_SHELL_CLOSE,this,this._closeGame.bind(this))},t}(e)}}),function(e,t){"object"==typeof e&&(e.Advertisement=function(){return{Advertisement:function(){function e(){}return e.fetch=function(e,t){if(this.forbiden(e))t(-1,"ad not found.Current posid is forbidden.",null);else if(GameStatusInfo.devPlatform){var i=this.getDebugRetData();this.parseQQAdGetRsp(i,t)}else{var r="apollo_router_game.game_ad_linkcmd_get_ad";BK.MQQ.SsoRequest.removeListener(r,this),BK.MQQ.SsoRequest.addListener(r,this,function(e,i,r){0==e?this.parseQQAdGetRsp(r,t):t(e,"sso respose not 0.",null)}.bind(this));var n={game_id:GameStatusInfo.gameId,posid:e};BK.isBrowser?BK.MQQ.SsoRequest.sendSSO(n,r):BK.MQQ.SsoRequest.send(n,r)}},e.forbiden=function(e){if(e&&GameStatusInfo.adForbitPosId){var t=GameStatusInfo.adForbitPosId.split(";");if(!t)return!1;for(var i=0;i<t.length;i++)if(t[i]===e)return BK.Script.log(1,1,"current game"),!0}return!1},e.videoCMReport=function(e,t){var i=e.toString(),r=t.toString(),n=GameStatusInfo.openId;BK.QQ.uploadData("enter_SPA",i,r,n,"","")},e.parseQQAdGetRsp=function(e,t){if(0==e.ret)if(e.pos_ads_info.length>0){var i=e.pos_ads_info[0];if(0==i.ret){BK.Script.log(1,1,"fetch ad \u5e7f\u544a\u4f4did:"+i.pos_id);var r=i.ads_info;r.length>0&&t(0,"OK",r[0])}else BK.Script.log(1,1,"\u5e7f\u544a\u4f4d\u4fe1\u606f\u8fd4\u56de\u5931\u8d25\u4e3a\u7a7a ret:"+i.ret+" msg:"+i.msg),t(-1,"posAdInfo.ret not succeed 0. Detail:"+JSON.stringify(e),null)}else BK.Script.log(1,1,"fetch ad \u5e7f\u544a\u4fe1\u606f\u4e3a\u7a7a"),t(-1,"pos_ads_info.length is 0.Detail:"+JSON.stringify(e),null);else BK.Script.log(1,1,"fetch ad failed.ret:"+e.ret+" msg:"+e.msg),t(-1,"fetch ad failed. Detail:"+JSON.stringify(e),null)},e.canReqBanner=function(){var e=!0;return void 0==this.lastBannerReqTs?(this.lastBannerReqTs=BK.Time.timestamp,e):(BK.Time.timestamp-this.lastBannerReqTs>1?(e=!0,this.lastBannerReqTs=BK.Time.timestamp):e=!1,e)},e.fetchBannerAd=function(e){if(0!=this.canReqBanner()){var t="6060137618613664";this.fetch(t,function(i,r,n){if(0==i){if(0==this.bannerCreativeSizeFilter(n))return void e(-1,"ad data is creative is illegal.",null);this.currentAdBannerHandle&&(this.currentAdBannerHandle.close(),this.currentAdBannerHandle=void 0);var o=new BK.AdAnimateBannerHandler(t,n);this.currentAdBannerHandle=o,e(i,r,o)}else e(i,r,null)}.bind(this))}else e(-1,"frequency is limited",null)},e.videoCreativeSizeFilter=function(e){var t=[185,585],i=[185,585,564,565],r=[];return r=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5")?t:i,this.createSizeFilter(r,e)},e.bannerCreativeSizeFilter=function(e){var t=[193,65,184,194,210,285];return this.createSizeFilter(t,e)},e.createSizeFilter=function(e,t){var i=-1;if(t&&t.display_info&&t.display_info.creative_size){i=t.display_info.creative_size;for(var r=0;r<e.length;r++){var n=e[r];if(BK.Script.log(1,1,"createSizeFilter:"+n),Math.abs(i-n)<.01)return BK.Script.log(1,1,"compare found:"+i),!0}return BK.Script.log(1,1,"data is error!creative size is not illegal! current:"+i),!1}return BK.Script.log(1,1,"data is error!creative size is not found!"),!1},e.fetchVideoAd=function(e,t){var i="2090532727455152";this.videoCMReport(e,4),this.fetch(i,function(r,n,o){if(o)if(0!=this.videoCreativeSizeFilter(o)){var a=1;o&&o.display_info&&o.display_info.creative_size?185==o.display_info.creative_size?a=3:585==o.display_info.creative_size&&(a=1):BK.Script.log(1,1,"fetch ad has problem.lack of display_info.creative_size property.");var s=1,h=this.getGameConfig();h&&void 0!==h.viewMode&&(s=h.viewMode);var c=!0,l="";if(o.display_info&&o.display_info.video_info&&o.display_info.video_info.tencent_video_id&&"string"==typeof o.display_info.video_info.tencent_video_id&&o.display_info.video_info.tencent_video_id.length>0?c=!0:(c=!1,l="can not find video id"),1==BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.0")&&(3!=s&&2!=s||1!=a||(c=!1,l="device oriation compare failed.device :"+s.toString()+" ad:"+a.toString())),1==c)if(0==r){this.videoCMReport(e,5);var u=void 0;u=1==BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.0")?new BK.AdVideoHandler(e,i,o,s):new BK.AdVideoHandlerNative(e,i,o,s),t(r,n,u)}else t(r,n,null);else t(-1,"no ads found."+l,null)}else t(-1,"ad data is creative is illegal.",null);else t(-1,"ad data is undefined or null",null)}.bind(this))},e.getGameConfig=function(){if(!BK.isBrowser){var e=BK.FileUtil.readFile("GameRes://gameConfig.json");if(e&&e.length>0){var t=e.readAsString();return JSON.parse(t)}}},e.getDebugRetData=function(){var e=BK.FileUtil.readFile("GameRes://script/demo/data/adBanner285.json");if(e&&e.length>0){var t=e.readAsString();return JSON.parse(t)}return{ret:0,msg:"s",pos_ads_info:[{ret:0,msg:"string",pos_id:"string",ads_info:[{product_type:1,display_info:{pattern_type:1,creative_size:1,animation_effect:1,basic_info:{img:"http://mat1.gtimg.com/ipad/qq_time/imgs/20180505_lixia_base.jpg",img_s:"http://mat1.gtimg.com/ipad/images/time/timelogo.jpg",txt:"\u5e7f\u544a\u7d20\u6750\u7684\u6807\u9898",desc:"\u5e7f\u544a\u7684\u8be6\u7ec6\u63cf\u8ff0"},button_info:[{txt:"\u6309\u94ae",url:"http://www.qq.com",pos:1}],muti_pic_text_info:{txt:["txt1","txt2"],image:["http://txt2.png","http://txt2.png"],url:["http://txt2.png","http://txt2.png"]},advertiser_info:{corporation_name:"string",corporate_image_name:"string",corporate_logo:"string"},video_info:{video_url:"string",media_duration:30}},report_info:void 0,dest_info:{dest_url_display_type:1,landing_page:"https://www.qq.com",canvas_json:"string",dest_type:1},app_info:void 0}]}],gdt_cookie:"string",busi_cookie:"string"}},e.openAdVideo=function(e,t){var i="https://cmshow.qq.com/apollo/html/game-platform/game-ad.html";i=(i=(i=i+"?gameOrientation="+(void 0===t?1:t)+"&")+"gameId="+GameStatusInfo.gameId+"&")+"adInfo="+JSON.stringify(e);var r={gameOrientation:t,transparent:1,businessType:2,openId:GameStatusInfo.openId,url:i};BK.MQQ.SsoRequest.send(r,"cs.openWebViewWithoutUrl.local")},e.lastBannerReqTs=void 0,e}()}}().Advertisement)}(BK),SandBoxCanvas.prototype.setImagePath=function(e){if(e){this.imagePath=e;var t=new BK.Texture(e);this.__nativeObj.setTexture(t)}},SandBoxCanvas.prototype.getImagePath=function(){return this.imagePath},SandBoxCanvas.prototype.setTexture=function(e){this.__nativeObj.setTexture(e)},SandBoxCanvas.prototype.setFlipXY=function(e,t){this.__nativeObj.setUVFlip(e,t)},SandBoxCanvas.prototype.setUVFlip=function(e,t){this.__nativeObj.setUVFlip(e,t)},SandBoxCanvas.prototype.setUVWrap=function(e,t){this.__nativeObj.setUVWrap(e,t)},SandBoxCanvas.prototype.setXYStretch=function(e,t){this.__nativeObj.setXYStretch(e,t)},SandBoxCanvas.prototype.adjustTexturePosition=function(e,t,i,r,n){this.__nativeObj.adjustTexturePosition(e,t,i,r,n)},SandBoxCanvas.prototype.addChild=function(e){return this.__nativeObj.addChild(e)},SandBoxCanvas.prototype.dispose=function(){return this.__nativeObj.dispose()},SandBoxCanvas.prototype.removeChild=function(e){return this.__nativeObj.removeChild(e)},SandBoxCanvas.prototype.removeChildById=function(e){return this.__nativeObj.removeChildById(e)},SandBoxCanvas.prototype.removeChildByName=function(e){return this.__nativeObj.removeChildByName(e)},SandBoxCanvas.prototype.removeChildByTag=function(e){return this.__nativeObj.removeChildByTag(e)},SandBoxCanvas.prototype.queryChildAtIndex=function(e){return this.__nativeObj.queryChildAtIndex(e)},SandBoxCanvas.prototype.queryChildById=function(e){return this.__nativeObj.queryChildById(e)},SandBoxCanvas.prototype.queryChildByName=function(e){return this.__nativeObj.queryChildByName(e)},SandBoxCanvas.prototype.queryChildByTag=function(e){return this.__nativeObj.queryChildByTag(e)},SandBoxCanvas.prototype.getChildCount=function(){return this.__nativeObj.getChildCount()},SandBoxCanvas.prototype.removeFromParent=function(){return this.__nativeObj.removeFromParent()},SandBoxCanvas.prototype.attachComponent=function(e){return this.__nativeObj.attachComponent(e)},SandBoxCanvas.prototype.detachComponent=function(e){return this.__nativeObj.detachComponent(e)},SandBoxCanvas.prototype.queryComponent=function(e){return this.__nativeObj.queryComponent(e)},SandBoxCanvas.prototype.queryComponentList=function(e){return this.__nativeObj.queryComponentList(e)},SandBoxCanvas.prototype.hittest=function(e){return this.__nativeObj.hittest(e)},SandBoxCanvas.prototype.isEqual=function(e){return this.__nativeObj.isEqual(e)},SandBoxCanvas.prototype.convertToWorldSpace=function(e){return this.__nativeObj.convertToWorldSpace(e)},SandBoxCanvas.prototype.convertToNodeSpace=function(e){return this.__nativeObj.convertToNodeSpace(e)},SandBoxCanvas.prototype.setAtlas=function(e,t){if(this.__nativeObj){BK.CanvasSheetCache.loadSheet(e);var i=BK.CanvasSheetCache.getTexturePathByFilename(t),r=new BK.Texture(i);this.__nativeObj.setTexture(r);var n=BK.CanvasSheetCache.getFrameInfoByFilename(t);this.__nativeObj.adjustTexturePosition(n.frame.x,n.frame.y,n.frame.w,n.frame.h,n.rotated)}return 0},SandBoxCanvas.prototype.useH5Mode=function(){return this.__nativeObj?(this._useH5Mode=1,1==arguments.length?(this._useH5Mode=arguments[0],this.__nativeObj.useH5Mode(arguments[0])):this.__nativeObj.useH5Mode()):0},SandBoxCanvas.prototype.drawCircle=function(){return this.__nativeObj?this.__nativeObj.drawCircle(arguments[0],arguments[1],arguments[2]):0},SandBoxCanvas.prototype.drawEllipse=function(){return this.__nativeObj?this.__nativeObj.drawEllipse(arguments[0],arguments[1],arguments[2],arguments[3]):0},SandBoxCanvas.prototype.drawImage=function(){if(this.__nativeObj){var e=arguments.length;if(9==e)this.__nativeObj.drawImage(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8]);else if(5==e)this.__nativeObj.drawImage(arguments[0],0,0,0,0,arguments[1],arguments[2],arguments[3],arguments[4]);else{if(3!=e)return;this.__nativeObj.drawImage(arguments[0],0,0,0,0,arguments[1],arguments[2],0,0)}this._innerSetTransform()}return 0},SandBoxCanvas.prototype.fill=function(){return this.__nativeObj?this.__nativeObj.fill():0},SandBoxCanvas.prototype.stroke=function(){return this.__nativeObj?this.__nativeObj.stroke():0},SandBoxCanvas.prototype.rect=function(){return this.__nativeObj?this.__nativeObj.rect(arguments[0],arguments[1],arguments[2],arguments[3]):0},SandBoxCanvas.prototype.fillRect=function(){return this.__nativeObj?this.__nativeObj.fillRect(arguments[0],arguments[1],arguments[2],arguments[3]):0},SandBoxCanvas.prototype.strokeRect=function(){return this.__nativeObj?this.__nativeObj.strokeRect(arguments[0],arguments[1],arguments[2],arguments[3]):0},SandBoxCanvas.prototype.clearRect=function(){return this.__nativeObj?this.__nativeObj.clearRect(arguments[0],arguments[1],arguments[2],arguments[3]):0},SandBoxCanvas.prototype.beginPath=function(){return this.__nativeObj?this.__nativeObj.beginPath():0},SandBoxCanvas.prototype.closePath=function(){return this.__nativeObj?this.__nativeObj.closePath():0},SandBoxCanvas.prototype.moveTo=function(){return this.__nativeObj?this.__nativeObj.moveTo(arguments[0],arguments[1]):0},SandBoxCanvas.prototype.lineTo=function(){return this.__nativeObj?this.__nativeObj.lineTo(arguments[0],arguments[1]):0},SandBoxCanvas.prototype.arcTo=function(){return this.__nativeObj?this.__nativeObj.arcTo(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]):0},SandBoxCanvas.prototype.arc=function(){if(this.__nativeObj){var e=arguments.length;if(5==e)return this.__nativeObj.arc(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);if(6==e)return this.__nativeObj.arc(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])}return 0},SandBoxCanvas.prototype.quadraticCurveTo=function(){return this.__nativeObj?this.__nativeObj.quadraticCurveTo(arguments[0],arguments[1],arguments[2],arguments[3]):0},SandBoxCanvas.prototype.bezierCurveTo=function(){return this.__nativeObj?this.__nativeObj.bezierCurveTo(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]):0},SandBoxCanvas.prototype.save=function(){return this.__nativeObj?this.__nativeObj.save():0},SandBoxCanvas.prototype.restore=function(){return this.__nativeObj?this.__nativeObj.restore():0},SandBoxCanvas.prototype.fillTextWithSize=function(e,t,i,r,n,o,a){if(7==arguments.length){switch(1==n?2-o:o){case 1:t-=.5*r;break;case 2:t-=1*r}switch(a){case 1:e-=.5*i;break;case 2:e-=1*i}var s=new Object;return s.x=e,s.y=t,s.width=Math.min(2048,i),s.height=Math.min(1024,r),s}return 0},SandBoxCanvas.prototype.fillText=function(){if(3==arguments.length){var e=this.measureText(arguments[0],2048,1024),t=arguments[1],i=arguments[2];switch(1==this._useH5Mode?2-this._textBaseLine:this._textBaseLine){case 1:i-=.5*e.height;break;case 2:i-=1*e.height}switch(this._textAlign){case 1:t-=.5*e.width;break;case 2:t-=1*e.width}this.__nativeObj.fillText(arguments[0],t,i,Math.min(2048,e.width),Math.min(1024,e.height)),this._innerSetTransform()}return 0},SandBoxCanvas.prototype.clip=function(){return this.__nativeObj?this.__nativeObj.clip():0},SandBoxCanvas.prototype.isPointInPath=function(){if(this.__nativeObj)return this.__nativeObj.isPointInPath(arguments[0],arguments[1])},SandBoxCanvas.prototype.createImageData=function(){var e=arguments.length;if(this.__nativeObj&&2==e){var t=new BK.Buffer(arguments[0]*arguments[1]*4);return t.__inner_image_width=arguments[0],t.__inner_image_height=arguments[1],t}},SandBoxCanvas.prototype.getImageData=function(){},SandBoxCanvas.prototype.putImageData=function(){var e=arguments.length;if(this.__nativeObj&&3==e){var t=arguments[0],i=arguments[1],r=arguments[2],n=t.__inner_image_width,o=t.__inner_image_height;return this.__nativeObj.putImageData(arguments[0],i,r,n,o)}},SandBoxCanvas.prototype.scale=function(){if(this.__nativeObj)return BK.Script.log(0,0,"bk.canvas. scale  :"+arguments[0]+" , "+arguments[1]),this.__nativeObj.scales(arguments[0],arguments[1])},SandBoxCanvas.prototype.scales=function(){if(this.__nativeObj)return BK.Script.log(0,0,"bk.canvas. scales  :"+arguments[0]+" , "+arguments[1]),this.__nativeObj.scales(arguments[0],arguments[1])},SandBoxCanvas.prototype.rotate=function(){if(this.__nativeObj)return BK.Script.log(0,0,"bk.canvas. rotate  :"+arguments[0]),this.__nativeObj.rotate(arguments[0])},SandBoxCanvas.prototype.translate=function(){if(this.__nativeObj){var e=GameStatusInfo.QQVer.split(".");7==Number(e[0])&&Number(7==e[1]&&Number(e[2])<=5)?(this._tx=arguments[0],this._ty=arguments[1],this._innerSetTransform()):this.__nativeObj.translate(arguments[0],arguments[1])}},SandBoxCanvas.prototype.transform=function(){if(this.__nativeObj)return this.__nativeObj.transforms(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},SandBoxCanvas.prototype.transforms=function(){var e=GameStatusInfo.QQVer.split(".");return Number(e[0])<7||7==Number(e[0])&&Number(e[1])<7?this.__nativeObj.transforms(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]):this.setTransform(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},SandBoxCanvas.prototype.setTransform=function(){if(this.__nativeObj)return this._a=arguments[0],this._b=arguments[1],this._c=arguments[2],this._d=arguments[3],this._tx=arguments[4],this._ty=arguments[5],this.__nativeObj.setTransform(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},SandBoxCanvas.prototype._innerSetTransform=function(){if(this.__nativeObj){var e=GameStatusInfo.QQVer.split(".");if(7==Number(e[0])&&Number(7==e[1]&&Number(e[2])<=5))return this.__nativeObj.setTransform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},SandBoxCanvas.prototype.shadowColor=function(){if(this._shadowColor=arguments[0],this.__nativeObj)return this.__nativeObj.setTextShadow(this._shadowOffset.x,this._shadowOffset.y,this._shadowRadius,this._shadowColor)},SandBoxCanvas.prototype.shadowRadius=function(){if(this._shadowRadius=arguments[0],this.__nativeObj)return this.__nativeObj.setTextShadow(this._shadowOffset.x,this._shadowOffset.y,this._shadowRadius,this._shadowColor)},SandBoxCanvas.prototype.shadowOffsetX=function(){if(this._shadowOffset.x=arguments[0],this.__nativeObj)return this.__nativeObj.setTextShadow(this._shadowOffset.x,this._shadowOffset.y,this._shadowRadius,this._shadowColor)},SandBoxCanvas.prototype.shadowOffsetY=function(){if(this._shadowOffset.y=arguments[0],this.__nativeObj)return this.__nativeObj.setTextShadow(this._shadowOffset.x,this._shadowOffset.y,this._shadowRadius,this._shadowColor)},SandBoxCanvas.prototype.clear=function(){if(this.__nativeObj)return this.__nativeObj.clear()},SandBoxCanvas.prototype.getTexture=function(){return null},SandBoxCanvas.prototype.drawText=function(){return this.__nativeObj&&(this.__nativeObj.drawText(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]),this._innerSetTransform()),null},SandBoxCanvas.prototype.setTextSize=function(){return this.__nativeObj?this.__nativeObj.setTextSize(arguments[0]):null},SandBoxCanvas.prototype.setTextAlign=function(){if(this.__nativeObj){switch(arguments[0]){case 0:case 1:case 2:this._textAlign=arguments[0];break;case"left":this._textAlign=0;break;case"center":this._textAlign=1;break;case"right":this._textAlign=2}return this.__nativeObj.setTextAlign(this._textAlign)}return null},SandBoxCanvas.prototype.setTextBold=function(){return this.__nativeObj?this.__nativeObj.setTextBold(arguments[0]):null},SandBoxCanvas.prototype.setTextItalic=function(){return this.__nativeObj?this.__nativeObj.setTextItalic(arguments[0]):null},SandBoxCanvas.prototype.measureText=function(){return this.__nativeObj?this.__nativeObj.measureText(arguments[0],arguments[1],arguments[2]):null},SandBoxCanvas.prototype.updateCanvasTexture=function(){return this.__nativeObj?this.__nativeObj.updateCanvasTexture():null},SandBoxCanvas.prototype.saveTo=function(){return null},SandBoxCanvas.prototype.drawHead=function(){var e=arguments.length;return this.__nativeObj&&4==e&&this.__nativeObj.drawHead(arguments[0],arguments[1],arguments[2],arguments[3]),null},BK.SandBoxCanvas=SandBoxCanvas,BK.Script.log(0,0,"Load SandBoxCanvas.js succeed."),function(e,t){"object"==typeof e&&(e.QQNickCanvas=function(){return function(){function e(e,t,i,r,n){this.__nativeObj=new BK.SandBoxCanvas(t,i),this.maxHeight=2048,this.maxWidth=1024;var o=0,a=0;1==r.useH5Mode&&this.__nativeObj.useH5Mode(),r.x&&(o=r.x),r.y&&(a=r.y),r.fontSize&&this.__nativeObj.setTextSize(r.fontSize),r.textColor&&(this.__nativeObj.fillColor=r.textColor),r.textAlign&&(this.__nativeObj.textAlign=r.textAlign),r.textBaseLine&&(this.__nativeObj.textBaseLine=r.textBaseLine),r.bold&&this.__nativeObj.setTextBold(r.bold),r.italic&&this.__nativeObj.setTextItalic(r.italic),r.strokeColor&&this.__nativeObj.setStrokeColor(r.strokeColor),r.shadowColor&&this.__nativeObj.shadowColor(r.shadowColor),r.shadowRadius&&this.__nativeObj.shadowRadius(r.shadowColor),r.shadowOffsetX&&this.__nativeObj.shadowOffsetX(r.shadowOffsetX),r.shadowOffsetY&&this.__nativeObj.shadowOffsetY(r.shadowOffsetY),r.fontPath&&(this.__nativeObj.fontPath=r.fontPath),this.callback=n,BK.MQQ.Account.drawNick(this.__nativeObj.__nativeObj,e,o,a,this.maxHeight,this.maxWidth,this.__nativeObj._useH5Mode,this.__nativeObj.textBaseLine,this.__nativeObj.textAlign,this.__nativeObj.fillTextWithSize,function(e,t){this.callback(e,t)}.bind(this))}return e.prototype.getNode=function(){return this.__nativeObj},e}()}())}(BK),function(e,t){"object"==typeof e&&(e.QQAvatarCanvas=function(){return function(){function e(e,t,i,r,n,o){this.openid=e,this.__nativeObj=new BK.SandBoxCanvas(t,i),this.post=o,r.isRound&&(this.__nativeObj.beginPath(),this.__nativeObj.arc(t/2,t/2,t/2,0,2*Math.PI),this.__nativeObj.closePath(),this.__nativeObj.clip()),n&&n(),BK.MQQ.Account.drawHead(this.__nativeObj.__nativeObj,e,t,i,function(e,t,i,r){this.post&&this.post(e,t)}.bind(this))}return e}()}())}(BK),isBrowser){var __browserMsgHdl={};BK.MQQ.SsoRequest.listenerInfos=[],BK.MQQ.SsoRequest.addListener=function(e,t,i){var r={cmd:e,target:t,callback:i};BK.MQQ.SsoRequest.listenerInfos.forEach(function(r){r.cmd==e&&r.target==t&&(r.callback=i)},this),BK.MQQ.SsoRequest.listenerInfos.push(r)},BK.MQQ.SsoRequest.removeListener=function(e,t){for(var i=BK.MQQ.SsoRequest.listenerInfos.length,r=-1,n=0;n<i;n++){var o=BK.MQQ.SsoRequest.listenerInfos[n];o.cmd==e&&o.target==t&&(r=n)}-1!=r&&BK.MQQ.SsoRequest.listenerInfos.splice(r,1)},__browserMsgHdl.listenerInfos=[],__browserMsgHdl.addListener=function(e,t,i){var r={cmd:e,target:t,callback:i},n=!1;__browserMsgHdl.listenerInfos.forEach(function(r){r.cmd==e&&r.target==t&&(r.callback=i,n=!0)},this),0==n&&__browserMsgHdl.listenerInfos.push(r)},__browserMsgHdl.removeListener=function(e,t){for(var i=__browserMsgHdl.listenerInfos.length,r=-1,n=0;n<i;n++){var o=__browserMsgHdl.listenerInfos[n];o.cmd==e&&o.target==t&&(r=n)}-1!=r&&__browserMsgHdl.listenerInfos.splice(r,1)}}!function(e,t){"object"==typeof e&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Game=t())}(1==isBrowser?window:BK,function(){var e;!function(e){e[e.load=0]="load",e[e.min=1]="min",e[e.max=2]="max",e[e.share=3]="share",e[e.enterBackground=4]="enterBackground",e[e.enterForeground=5]="enterForeground"}(e||(e={}));var t;return function(e){e[e.native=0]="native",e[e.browser=1]="browser"}(t||(t={})),function(){function e(e){this.CMSHOW_CS_CMD_CLOSE_WND="cs.close_room.local",this.CMSHOW_CS_CMD_SHARE_INFO="cs.game_shell_share_callback.local",this.CMSHOW_SC_CMD_SHELL_PACK_UP="sc.game_shell_pack_up.local",this.CMSHOW_SC_CMD_SHELL_SHARE="sc.game_shell_share.local",this.CMSHOW_SC_CMD_SHELL_SHARE_COMPLETE="sc.share_game_to_friend_result.local",this.CMSHOW_SC_CMD_SHELL_CLOSE="sc.game_shell_close.local",this.CMD_CMSHOW_GAME_ENTER_BACKGROUND="sc.game_enter_background.local",this.CMD_CMSHOW_GAME_ENTER_FORGROUND="sc.game_enter_foreground.local",this.CMD_CMSHOW_GAME_MAXIMIZE="sc.game_maximize.local",this.CMD_CMSHOW_GAME_MINIMIZE="sc.game_minimize.local",this.CMD_CMSHOW_GAME_INIT_GLOBAL_VAR="sc.init_global_var.local",this.CMD_CMSHOW_GAME_NETWORK_CHANGE="sc.network_change.local",this.CMD_CMSHOW_GAME_WEBMESSAGE_HANDLE="sc.web_callback_game.local",this.cfg=e,this.addAllListener(),this.cfg.onLoad&&(!isBrowser||isBrowser&&"undefined"!=typeof GameStatusInfo)&&(this.formatInfo(),this.cfg.onLoad(this,GameStatusInfo.src,GameStatusInfo.roomId))}return e.prototype.formatInfo=function(){GameStatusInfo.gameId&&(GameStatusInfo.gameId=Number(GameStatusInfo.gameId)),GameStatusInfo.isMaster&&(GameStatusInfo.isMaster=Number(GameStatusInfo.isMaster)),GameStatusInfo.roomId&&(GameStatusInfo.roomId=Number(GameStatusInfo.roomId)),GameStatusInfo.gameVersion&&(GameStatusInfo.gameVersion=String(GameStatusInfo.gameVersion)),GameStatusInfo.platform&&(GameStatusInfo.platform=String(GameStatusInfo.platform)),GameStatusInfo.openId&&(GameStatusInfo.openId=String(GameStatusInfo.openId)),GameStatusInfo.QQVer&&(GameStatusInfo.QQVer=String(GameStatusInfo.QQVer)),GameStatusInfo.networkType&&(GameStatusInfo.networkType=Number(GameStatusInfo.networkType)),GameStatusInfo.src&&(GameStatusInfo.src=Number(GameStatusInfo.src))},e.prototype.log=function(e){BK.Script.log(0,0,"Game:"+e)},e.prototype.errorMessage=function(){return this.err.message},e.prototype.errorStacktrace=function(){return this.err.stacktrace},e.prototype.__isBrowser=function(){return isBrowser},e.prototype.platform=function(){return this.__isBrowser()?t.browser:t.native},e.prototype.addAllListener=function(){this.platform()==t.native?(BK.Script.setErrorObserver(function(e,t){this.cfg.onException&&(this.err={message:e,stacktrace:t},this.cfg.onException(this))}.bind(this)),BK.MQQ.SsoRequest.addListener(this.CMD_CMSHOW_GAME_ENTER_BACKGROUND,this,this._onEnterBackground.bind(this)),BK.MQQ.SsoRequest.addListener(this.CMD_CMSHOW_GAME_ENTER_FORGROUND,this,this._onEnterForeground.bind(this)),BK.MQQ.SsoRequest.addListener(this.CMD_CMSHOW_GAME_MAXIMIZE,this,this._onMax.bind(this)),BK.MQQ.SsoRequest.addListener(this.CMD_CMSHOW_GAME_MINIMIZE,this,this._onMin.bind(this)),BK.MQQ.SsoRequest.addListener(this.CMSHOW_SC_CMD_SHELL_SHARE,this,this._onShare.bind(this)),BK.MQQ.SsoRequest.addListener(this.CMSHOW_SC_CMD_SHELL_SHARE_COMPLETE,this,this._onShareComplete.bind(this)),BK.MQQ.SsoRequest.addListener(this.CMSHOW_SC_CMD_SHELL_CLOSE,this,this._onClose.bind(this)),BK.MQQ.SsoRequest.addListener(this.CMD_CMSHOW_GAME_NETWORK_CHANGE,this,this._onNetworkChange.bind(this))):(__browserMsgHdl.addListener(this.CMD_CMSHOW_GAME_ENTER_BACKGROUND,this,this._onEnterBackground.bind(this)),__browserMsgHdl.addListener(this.CMD_CMSHOW_GAME_ENTER_FORGROUND,this,this._onEnterForeground.bind(this)),__browserMsgHdl.addListener(this.CMD_CMSHOW_GAME_MINIMIZE,this,this._onMin.bind(this)),__browserMsgHdl.addListener(this.CMD_CMSHOW_GAME_MAXIMIZE,this,this._onMax.bind(this)),__browserMsgHdl.addListener(this.CMSHOW_SC_CMD_SHELL_SHARE,this,this._onShare.bind(this)),__browserMsgHdl.addListener(this.CMSHOW_SC_CMD_SHELL_SHARE_COMPLETE,this,this._onShareComplete.bind(this)),__browserMsgHdl.addListener(this.CMSHOW_SC_CMD_SHELL_CLOSE,this,this._onClose.bind(this)),__browserMsgHdl.addListener(this.CMD_CMSHOW_GAME_INIT_GLOBAL_VAR,this,this._onInitGlobalVar.bind(this)),__browserMsgHdl.addListener(this.CMD_CMSHOW_GAME_NETWORK_CHANGE,this,this._onNetworkChange.bind(this)),__browserMsgHdl.addListener(this.CMD_CMSHOW_GAME_WEBMESSAGE_HANDLE,this,this._onWebMessageHandle.bind(this)))},e.prototype.removeAllListener=function(){this.platform()==t.native?(BK.Script.setErrorObserver(void 0),BK.MQQ.SsoRequest.removeListener(this.CMD_CMSHOW_GAME_ENTER_BACKGROUND,this),BK.MQQ.SsoRequest.removeListener(this.CMD_CMSHOW_GAME_ENTER_FORGROUND,this),BK.MQQ.SsoRequest.removeListener(this.CMD_CMSHOW_GAME_MAXIMIZE,this),BK.MQQ.SsoRequest.removeListener(this.CMSHOW_SC_CMD_SHELL_PACK_UP,this),BK.MQQ.SsoRequest.removeListener(this.CMSHOW_SC_CMD_SHELL_SHARE,this),BK.MQQ.SsoRequest.removeListener(this.CMSHOW_SC_CMD_SHELL_CLOSE,this),BK.MQQ.SsoRequest.removeListener(this.CMD_CMSHOW_GAME_NETWORK_CHANGE,this)):(__browserMsgHdl.removeListener(this.CMD_CMSHOW_GAME_ENTER_BACKGROUND,this),__browserMsgHdl.removeListener(this.CMD_CMSHOW_GAME_ENTER_FORGROUND,this),__browserMsgHdl.removeListener(this.CMD_CMSHOW_GAME_MAXIMIZE,this),__browserMsgHdl.removeListener(this.CMSHOW_SC_CMD_SHELL_PACK_UP,this),__browserMsgHdl.removeListener(this.CMSHOW_SC_CMD_SHELL_SHARE,this),__browserMsgHdl.removeListener(this.CMSHOW_SC_CMD_SHELL_CLOSE,this),__browserMsgHdl.removeListener(this.CMD_CMSHOW_GAME_INIT_GLOBAL_VAR,this),__browserMsgHdl.removeListener(this.CMD_CMSHOW_GAME_NETWORK_CHANGE,this),__browserMsgHdl.removeListener(this.CMD_CMSHOW_GAME_WEBMESSAGE_HANDLE,this))},e.prototype._onEnterBackground=function(){this.cfg.onEnterBackground&&this.cfg.onEnterBackground(this)},e.prototype._onEnterForeground=function(){this.cfg.onEnterForeground&&this.cfg.onEnterForeground(this)},e.prototype._onMax=function(){this.cfg.onMaximize&&this.cfg.onMaximize(this)},e.prototype._onMin=function(){this.cfg.onMinimize&&this.cfg.onMinimize(this)},e.prototype._generatedefaultSharePic=function(){var e={width:256,height:256,colorDark:{r:0,g:0,b:0,a:1},colorLight:{r:1,g:1,b:1,a:1},correctLevel:2},t="http://cmshow.qq.com/apollo/html/game-platform/scan-game.html?gameId="+GameStatusInfo.gameId.toString()+"&src=203";return BK.QRCode.createQRCodeToFile("GameSandBox://qrcode.png",t,e),"GameSandBox://qrcode.png"},e.prototype._onShare=function(){var e=void 0;if(this.cfg.onShare&&(e=this.cfg.onShare(this)),e||(e={}),void 0===e.localPicPath){var t=e.gameName,i=e.summary;BK.QQ.defaultSharePic(t,i,function(t,i,r){3==i&&(e.localPicPath=r),this.confirmShare(e)}.bind(this))}else this.confirmShare(e)},e.prototype._onShareComplete=function(e,t,i){if(this.cfg.onShareComplete)if(0==i.reqCode){var r=i.ret,n=0==i.isFirstTimeShare,o=i.shareTo;this.cfg.onShareComplete(this,r,o,n)}else this.cfg.onShareComplete(this,e,-1,!1)},e.prototype._onClose=function(){this.cfg.onClose&&this.cfg.onClose(this)},e.prototype.confirmShare=function(e){var i=e||{};i.reqCode=0,this.platform()==t.native?BK.MQQ.SsoRequest.send(i,this.CMSHOW_CS_CMD_SHARE_INFO):BK.MQQ.SsoRequest.sendTo(i,this.CMSHOW_CS_CMD_SHARE_INFO)},e.prototype._onInitGlobalVar=function(e,t,i){void 0!==i.uin&&delete i.uin,GameStatusInfo=i,this.cfg.onLoad&&(this.formatInfo(),this.cfg.onLoad(this,GameStatusInfo.src,GameStatusInfo.roomId))},e.prototype._onNetworkChange=function(e,t,i){this.cfg.onNetworkChange&&(void 0===i.type?BK.Script.log(1,1,"net work change .data is worng!"):this.cfg.onNetworkChange(this,i.type))},e.prototype._onWebMessageHandle=function(e,t,i){this.cfg.onWebMessageHandle&&(void 0===t||void 0===i?BK.Script.log(1,1,"WebMessageHandle data is worng!"):this.cfg.onWebMessageHandle(this,t,i))},e}()}),registerRedPackageListener(),function(e){function t(r){if(i[r])return i[r].exports;var n=i[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}BK.buildInfo={debug:!0,buildPath:"/trunk/master",version:"5877",creator:"wesleyxiao",buildTime:"Fri Nov 09 2018 13:20:39 GMT+0800 (GMT+08:00)"};var i={};t.m=e,t.c=i,t.d=function(e,i,r){t.o(e,i)||Object.defineProperty(e,i,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,i){if(1&i&&(e=t(e)),8&i)return e;if(4&i&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&i&&"string"!=typeof e)for(var n in e)t.d(r,n,function(t){return e[t]}.bind(null,n));return r},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s="./webpack/pack.ts")}({"./src/basics/Storage/StorageEventListener.ts":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i("./src/common/emitter.ts"),n=function(){function e(){this.storageEmitter=new r}return e.prototype.addEventListener=function(e,t){this.storageEmitter.on(e,t)},e.prototype.removeEventListener=function(e,t){this.storageEmitter.off(e,t)},e.prototype.dispatchEvent=function(e,t){this.storageEmitter.emit(e,t)},e}();t.BKStorageEventLisener=n,e.exports=new n},"./src/basics/device/device.ts":function(e,t,i){"use strict";function r(){BK.Script.log(1,1,"keepScreenOn CMD_CMSHOW_GAME_ENTER_FORGROUND "),t.device.isKeepScreenOnInit?t.device.innerSetKeepScreenOn(t.device.userSetDeviceScreenValue):t.device.innerSetKeepScreenOn(!1)}function n(){BK.Script.log(1,1,"keepScreenOn CMD_CMSHOW_GAME_ENTER_BACKGROUND "),t.device.innerSetKeepScreenOn(!1)}function o(){BK.Script.log(1,1,"keepScreenOn CMD_CMSHOW_GAME_MINIMIZE "),t.device.innerSetKeepScreenOn(!1)}function a(){BK.Script.log(1,1,"keepScreenOn CMD_CMSHOW_GAME_MAXIMIZE "),t.device.isKeepScreenOnInit?t.device.innerSetKeepScreenOn(t.device.userSetDeviceScreenValue):t.device.innerSetKeepScreenOn(!1)}function s(){BK.Script.log(1,1,"keepScreenOn CMSHOW_SC_CMD_STOP_GAME "),t.device.innerSetKeepScreenOn(!1)}Object.defineProperty(t,"__esModule",{value:!0});var h=function(){function e(){this.isKeepScreenOnInit=!1,BK.Director.isKeepScreenOn=!1}return e.prototype.innerSetKeepScreenOn=function(e){t.device.isKeepScreenOnInit?(GameStatusInfo.src&&BK.QQ.uploadData("call_screen_on",GameStatusInfo.src.toString(),e?"1":"0","","",""),BK.Director.isKeepScreenOn=e):BK.Script.log(1,1,"user unset keepScreenOn,ignore the value")},e.prototype.keepScreenOn=function(e){if(void 0===e)throw Error("param can not be undefined!");t.device.userSetDeviceScreenValue=e.isKeepOn,t.device.isKeepScreenOnInit=!0,t.device.innerSetKeepScreenOn(e.isKeepOn)},e}();t.device=new h,BK.onEnterBackground(n),BK.onEnterForeground(r),BK.onMaximize(a),BK.onMinimize(o),BK.SsoRequest.on("sc.force_stop_game.local",function(e){s()}),e.exports=t.device},"./src/basics/lifecycle/lifecycle.ts":function(e,t,i){"use strict";var r;!function(e){function t(e){var t=e.cmd,i=e.data;switch(t){case y:A.emit(I.foreground);break;case E:A.emit(I.background);break;case x:A.emit(I.maximize);break;case C:A.emit(I.minimize);break;case B:A.emit(I.close);break;case b:A.emit(I.share);break;case T:if(0==i.reqCode){r={retCode:i.ret,isFirstShare:0==i.isFirstTimeShare,shareDest:i.shareTo};A.emit(I.shareComplete,r)}break;case R:if(void 0===i.type)BK.Script.log(1,1,"net work change .data is worng!");else{var r={state:i.type};A.emit(I.networkChange,r)}}}function r(e){if(void 0===e)throw new Error("callback can't be undefined!")}function n(e){r(e),A.on(I.background,e)}function o(e){r(e),A.off(I.background,e)}function a(e){r(e),A.on(I.foreground,e)}function s(e){r(e),A.off(I.foreground,e)}function h(e){r(e),A.on(I.close,e)}function c(e){r(e),A.off(I.close,e)}function l(e){r(e),A.on(I.share,e)}function u(e){r(e),A.off(I.share,e)}function d(e){r(e),A.on(I.shareComplete,e)}function _(e){r(e),A.off(I.shareComplete,e)}function f(e){r(e),A.on(I.networkChange,e)}function g(e){r(e),A.off(I.networkChange,e)}function p(e){r(e),A.on(I.maximize,e)}function m(e){r(e),A.off(I.maximize,e)}function v(e){r(e),A.on(I.minimize,e)}function S(e){r(e),A.off(I.minimize,e)}var b="sc.game_shell_share.local",T="sc.share_game_to_friend_result.local",B="sc.game_shell_close.local",E="sc.game_enter_background.local",y="sc.game_enter_foreground.local",x="sc.game_maximize.local",C="sc.game_minimize.local",R="sc.network_change.local";!function(e){e[e.NoneToMobileNetwork=1]="NoneToMobileNetwork",e[e.NoneToWifi=2]="NoneToWifi",e[e.MobileNetworkToWifi=3]="MobileNetworkToWifi",e[e.MobileNetworkToNone=4]="MobileNetworkToNone",e[e.WifiToNone=5]="WifiToNone",e[e.WifiToMobileNetwork=6]="WifiToMobileNetwork"}(e.NetworkState||(e.NetworkState={}));var A=new(i("./src/common/emitter.ts")),I={foreground:"foreground",background:"background",maximize:"maximize",minimize:"minimize",share:"share",shareComplete:"shareComplete",networkChange:"networkChange",close:"close"};BK.SsoRequest.on(y,t),BK.SsoRequest.on(E,t),BK.SsoRequest.on(x,t),BK.SsoRequest.on(C,t),BK.SsoRequest.on(B,t),BK.SsoRequest.on(b,t),BK.SsoRequest.on(T,t),BK.SsoRequest.on(R,t),e.onEnterBackground=n,e.offEnterBackground=o,e.onEnterForeground=a,e.offEnterForeground=s,e.onGameClose=h,e.offGameClose=c,e.onGameShare=l,e.offGameShare=u,e.onGameShareComplete=d,e.offGameShareComplete=_,e.onNetworkChange=f,e.offNetworkChange=g,e.onMaximize=p,e.offMaximize=m,e.onMinimize=v,e.offMinimize=S}(r||(r={})),BK.NetworkState=r.NetworkState,e.exports=r},"./src/basics/storage/Storage.ts":function(e,t,i){"use strict";function r(e,t){if(t){if("length"===(t=t.toString()))return e[t];if("_kv"===t||"_storageType"===t)return e.getItem(t);for(var i=["setItem","getItem","removeItem","key","clear"],r=0;r<i.length;r++)if(t===i[r])return e[t].bind(e);return e.getItem(t)}}function n(e,t,i){if(t&&i)if(t=t.toString(),i=i.toString(),"length"!==t)if("_kv"!==t&&"_storageType"!==t){for(var r=["setItem","getItem","removeItem","key","clear"],n=0;n<r.length;n++)if(t===r[n])return e[t].bind(e);e.setItem(t,i)}else e.setItem(t,i);else BK.Script.log(1,0,"property "+t+" readOnly")}function o(e){if("android"===GameStatusInfo.platform)return BK.Script.log(1,0,"Proxy create "),new Proxy(new s(e),h);var t=GameStatusInfo.osVersion.split(".");return t.length>0&&Number(t[0])>9?(BK.Script.log(1,0,"Proxy create "),new Proxy(new s(e),h)):BK.Proxy?(BK.Script.log(1,0,"BK.Proxy create "),new BK.Proxy(new s(e),n,r)):{}}Object.defineProperty(t,"__esModule",{value:!0});var a=i("./src/basics/storage/StorageEvent.ts"),s=function(){function e(e){if(this._storageType=e,this._kv={},this._bytes=2,this._url="default",this.length=0,0===this._storageType&&BK.getStorageData){var t=BK.getStorageData(GameStatusInfo.gameId);if(!t)return;try{this._bytes=t.length,this._kv=JSON.parse(t),this.length=Object.keys(this._kv).length}catch(e){throw BK.Script.log(1,1,"parse string failed, storage load failed!"),this.flush(),Error("Storage setItem failed, item bytes is too large")}}}return e.prototype.key=function(e){return e>=this.length?null:Object.keys(this._kv)[e]},e.prototype.getItem=function(e){return this._kv[e]},e.prototype.setItem=function(e,t){var i=t.length,r=0,n=0;if(this._kv[e]&&(r=JSON.stringify(this._kv[e]).length),!((n=i-r)<0||n+this._bytes<4194304))throw BK.Script.log(1,1,"Storage setItem failed, item bytes is too large!"),Error("Storage setItem failed, item bytes is too large");var o=this._kv[e];this._kv[e]=t,this.length=Object.keys(this._kv).length,this.flush(),BK.storageEventListener.dispatchEvent("storage",new a(e,o,t,this._url,this))},e.prototype.removeItem=function(e){delete this._kv[e],this.length=Object.keys(this._kv).length,this.flush()},e.prototype.clear=function(){this._kv={},this.length=Object.keys(this._kv).length,this.flush()},e.prototype.flush=function(){var e=JSON.stringify(this._kv);this._bytes=e.length,0===this._storageType&&BK.setStorageData&&BK.setStorageData(e,GameStatusInfo.gameId)},e.prototype.bindUrl=function(e){e!==this._url&&""!==e&&(this._url=e)},e}();t.BKStorage=s,t.getProperty=r,t.setProperty=n;var h={get:r,set:n,deleteProperty:function(e,t){BK.Script.log(1,1,"localStorage delete property : "+t)}};e.exports={localStorage:o(0),sessionStorage:o(1)}},"./src/basics/storage/StorageEvent.ts":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,i,r,n){this.key=e,this.oldValue=t,this.newValue=i,this.url=r,this.storageArea=n}return e}();t.BKStorageEvent=r,e.exports=r},"./src/basics/subpackage/subpackage.ts":function(e,t,i){"use strict";var r,n=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(e){function t(e){var t=new o(e.name);if(!GameStatusInfo||"xcode"===GameStatusInfo.devPlatform){n={name:e.name,code:-1,msg:"develop environment no support!"};return e.complete&&e.complete(),e.fail&&e.fail(n),BK.Script.log(1,1,"bk.qq.loadpackage xcode demo."),t}var i=GameStatusInfo.QQVer.split(".");if(Number(i[0])<7||7==Number(i[0])&&Number(i[1])<7||7==Number(i[0])&&7==Number(i[1])&&Number(i[2])<5){BK.Script.log(1,0,"775 \u4ee5\u4e0b\u624bq \u7248\u672c");n={name:e.name,code:-2,msg:"current qq no support subpackage feature!Upgrade to QQ 7.7.5"};return e.complete&&e.complete(),e.fail&&e.fail(n),t}if(!r.subPackageDataReadConfig()){var n={name:e.name,code:-3,msg:"gameConfig.json can not find configure!"};return e.complete&&e.complete(),e.fail&&e.fail(n),t}return e.complete&&e.complete(),r.downloadPackage(e.name),r.on("download_finish_"+e.name,function(t){r.checkPackage({packageName:e.name,success:function(){if(r.loadPackage(e.name),e.success)try{e.success({name:e.name})}catch(e){BK.Console.log("ERROR:"+e)}},fail:function(){var t={name:e.name,code:-4,msg:"load subpackge failed.correctness failed"};if(e.fail)try{e.fail(t)}catch(e){BK.Console.log("ERROR:"+e)}}})}),t}var r=new(function(e){function t(){var t=e.call(this)||this;return BK.SsoRequest.on("sc.load_percentage_nofity.local",t.onLoadPackagePercentage.bind(t)),t._subPackagesInfo=void 0,t}return n(t,e),t.prototype.setSubPackageInfo=function(e){this._subPackagesInfo=e},t.prototype.getEntryMainPath=function(e){this._subPackagesInfo||(this._subPackagesInfo=this.subPackageDataReadConfig());for(var t=0;t<this._subPackagesInfo.length;t++){var i=this._subPackagesInfo[t];if(i.name===e)return"GameRes://"+i.root+"/main.js"}},t.prototype.subPackageDataReadConfig=function(){if(this._subPackagesInfo)return this._subPackagesInfo;var e=BK.FileUtil.readFile("GameRes://gameConfig.json");if(e){var t=JSON.parse(e.readAsString(!0));return t&&t.subpackages?(this._subPackagesInfo=t.subpackages,t.subpackages):void 0}},t.prototype.checkPackage=function(e){var t={xyId:GameStatusInfo.gameId,packName:e.packageName};BK.SsoRequest.request({data:t,reqCmd:"cs.file_correctness_check.local",success:function(t){t.code,t.cmd;var i=t.data;e.success&&e.success(i)},fail:function(t){var i=t.code;t.cmd,t.data;if(e.fail){var r={name:e.packageName,code:i,msg:"failed"};e.fail(r)}},complete:function(){e.complete&&e.complete()}})},t.prototype.downloadPackage=function(e){var t={xyId:GameStatusInfo.gameId,packName:e};BK.SsoRequest.request({data:t,reqCmd:"cs.load_subpackage.local",success:function(e){if(e.data.packName){var t="download_finish_"+e.data.packName;this.emit(t,e.data.result)}}.bind(this),fail:function(t){if(t.data.packName){i="download_finish_"+t.data.packName;this.emit(i,t.code)}else{var i=e;this.emit(i,t.code)}},complete:function(){}})},t.prototype._innserLoadLibFunc=function(e){return e.Script.loadlib},t.prototype.loadPackage=function(e){var t=this.getEntryMainPath(e);return!!t&&(!!BK.fileSystem.accessSync(t)&&(this._innserLoadLibFunc(BK)(t),!0))},t.prototype.onLoadPackagePercentage=function(e){if(e.data.packName){var t="percentage_"+e.data.packName;this.emit(t,e.data.percentage)}},t.prototype.onLoadPackageFinish=function(e,t,i){if(i.packName){var r="download_finish_"+i.packName;this.emit(r,i.result)}},t}(i("./src/common/emitter.ts"))),o=function(){function e(e){this.packName=e}return e.prototype.onProgressUpdate=function(e){r.on("percentage_"+this.packName,e)},e}();e.loadSubpackage=t}(r||(r={})),e.exports=r.loadSubpackage},"./src/basics/system/system.ts":function(e,t,i){"use strict";function r(){return GameStatusInfo}e.exports={getSystemInfoSync:r}},"./src/common/crypt.ts":function(e,t,i){"use strict";var r=function(){function e(){this.hexcase=0,this.b64pad="",this.chrsz=8,this.cryptQueue=Array(),this.safe_add=function(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i},this.rol=function(e,t){return e<<t|e>>>32-t};var e=this;"undefined"!=typeof BK&&BK.Director.ticker.add(function(t,i){if(e.cryptQueue.length>0){var r=e.cryptQueue[0];e.cryptQueue.splice(0,1);var n=void 0;try{n=r.doCrypt.call(e,r.param)}catch(e){if(!r.param.fail)throw e;r.param.fail({msg:e.message})}n&&r.param.success&&r.param.success({data:n}),r.param.complete&&r.param.complete()}}.bind(e))}return e.prototype.checkParam=function(e){if(!e)throw new Error("param can not be undefined");if("object"!=typeof e)throw new Error("param must be a object,can not be "+typeof e)},e.prototype.checkType=function(e,t){if(!("number"==typeof e||"string"==typeof e||e instanceof Array))throw Error(t+" must be string or binary array!")},e.md5ToHex=function(t){e.crypt.checkParam(t),e.crypt.checkType(t.data,"data"),e.crypt.cryptQueue.push({param:t,doCrypt:e.md5ToHexSync})},e.md5ToHexSync=function(t){e.crypt.checkParam(t);var i=t.data;return e.crypt.checkType(i,"data"),e.crypt.bin2hexLittle(e.crypt.core_md5(e.crypt.str2binLittle(i),i.length*e.crypt.chrsz))},e.md5ToBase64=function(t){e.crypt.checkParam(t),e.crypt.checkType(t.data,"data"),e.crypt.cryptQueue.push({param:t,doCrypt:e.md5ToBase64Sync})},e.md5ToBase64Sync=function(t){e.crypt.checkParam(t);var i=t.data;return e.crypt.checkType(i,"data"),e.crypt.bin2b64Little(e.crypt.core_md5(e.crypt.str2binLittle(i),i.length*e.crypt.chrsz))},e.hmacMd5ToHex=function(t){e.crypt.checkParam(t),e.crypt.checkType(t.data,"data"),e.crypt.checkType(t.key,"key"),e.crypt.cryptQueue.push({param:t,doCrypt:e.hmacMd5ToHexSync})},e.hmacMd5ToHexSync=function(t){e.crypt.checkParam(t);var i=t.key,r=t.data;return e.crypt.checkType(r,"data"),e.crypt.checkType(i,"key"),e.crypt.bin2hexLittle(e.crypt.core_hmac_md5(i,r))},e.hmacMd5ToBase64=function(t){e.crypt.checkParam(t),e.crypt.checkType(t.data,"data"),e.crypt.checkType(t.key,"key"),e.crypt.cryptQueue.push({param:t,doCrypt:e.hmacMd5ToBase64Sync})},e.hmacMd5ToBase64Sync=function(t){e.crypt.checkParam(t);var i=t.key,r=t.data;return e.crypt.checkType(r,"data"),e.crypt.checkType(i,"key"),e.crypt.bin2b64Little(e.crypt.core_hmac_md5(i,r))},e.prototype.core_md5=function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var i=1732584193,r=-271733879,n=-1732584194,o=271733878,a=0;a<e.length;a+=16){var s=i,h=r,c=n,l=o;i=this.md5_ff(i,r,n,o,e[a+0],7,-680876936),o=this.md5_ff(o,i,r,n,e[a+1],12,-389564586),n=this.md5_ff(n,o,i,r,e[a+2],17,606105819),r=this.md5_ff(r,n,o,i,e[a+3],22,-1044525330),i=this.md5_ff(i,r,n,o,e[a+4],7,-176418897),o=this.md5_ff(o,i,r,n,e[a+5],12,1200080426),n=this.md5_ff(n,o,i,r,e[a+6],17,-1473231341),r=this.md5_ff(r,n,o,i,e[a+7],22,-45705983),i=this.md5_ff(i,r,n,o,e[a+8],7,1770035416),o=this.md5_ff(o,i,r,n,e[a+9],12,-1958414417),n=this.md5_ff(n,o,i,r,e[a+10],17,-42063),r=this.md5_ff(r,n,o,i,e[a+11],22,-1990404162),i=this.md5_ff(i,r,n,o,e[a+12],7,1804603682),o=this.md5_ff(o,i,r,n,e[a+13],12,-40341101),n=this.md5_ff(n,o,i,r,e[a+14],17,-1502002290),r=this.md5_ff(r,n,o,i,e[a+15],22,1236535329),i=this.md5_gg(i,r,n,o,e[a+1],5,-165796510),o=this.md5_gg(o,i,r,n,e[a+6],9,-1069501632),n=this.md5_gg(n,o,i,r,e[a+11],14,643717713),r=this.md5_gg(r,n,o,i,e[a+0],20,-373897302),i=this.md5_gg(i,r,n,o,e[a+5],5,-701558691),o=this.md5_gg(o,i,r,n,e[a+10],9,38016083),n=this.md5_gg(n,o,i,r,e[a+15],14,-660478335),r=this.md5_gg(r,n,o,i,e[a+4],20,-405537848),i=this.md5_gg(i,r,n,o,e[a+9],5,568446438),o=this.md5_gg(o,i,r,n,e[a+14],9,-1019803690),n=this.md5_gg(n,o,i,r,e[a+3],14,-187363961),r=this.md5_gg(r,n,o,i,e[a+8],20,1163531501),i=this.md5_gg(i,r,n,o,e[a+13],5,-1444681467),o=this.md5_gg(o,i,r,n,e[a+2],9,-51403784),n=this.md5_gg(n,o,i,r,e[a+7],14,1735328473),r=this.md5_gg(r,n,o,i,e[a+12],20,-1926607734),i=this.md5_hh(i,r,n,o,e[a+5],4,-378558),o=this.md5_hh(o,i,r,n,e[a+8],11,-2022574463),n=this.md5_hh(n,o,i,r,e[a+11],16,1839030562),r=this.md5_hh(r,n,o,i,e[a+14],23,-35309556),i=this.md5_hh(i,r,n,o,e[a+1],4,-1530992060),o=this.md5_hh(o,i,r,n,e[a+4],11,1272893353),n=this.md5_hh(n,o,i,r,e[a+7],16,-155497632),r=this.md5_hh(r,n,o,i,e[a+10],23,-1094730640),i=this.md5_hh(i,r,n,o,e[a+13],4,681279174),o=this.md5_hh(o,i,r,n,e[a+0],11,-358537222),n=this.md5_hh(n,o,i,r,e[a+3],16,-722521979),r=this.md5_hh(r,n,o,i,e[a+6],23,76029189),i=this.md5_hh(i,r,n,o,e[a+9],4,-640364487),o=this.md5_hh(o,i,r,n,e[a+12],11,-421815835),n=this.md5_hh(n,o,i,r,e[a+15],16,530742520),r=this.md5_hh(r,n,o,i,e[a+2],23,-995338651),i=this.md5_ii(i,r,n,o,e[a+0],6,-198630844),o=this.md5_ii(o,i,r,n,e[a+7],10,1126891415),n=this.md5_ii(n,o,i,r,e[a+14],15,-1416354905),r=this.md5_ii(r,n,o,i,e[a+5],21,-57434055),i=this.md5_ii(i,r,n,o,e[a+12],6,1700485571),o=this.md5_ii(o,i,r,n,e[a+3],10,-1894986606),n=this.md5_ii(n,o,i,r,e[a+10],15,-1051523),r=this.md5_ii(r,n,o,i,e[a+1],21,-2054922799),i=this.md5_ii(i,r,n,o,e[a+8],6,1873313359),o=this.md5_ii(o,i,r,n,e[a+15],10,-30611744),n=this.md5_ii(n,o,i,r,e[a+6],15,-1560198380),r=this.md5_ii(r,n,o,i,e[a+13],21,1309151649),i=this.md5_ii(i,r,n,o,e[a+4],6,-145523070),o=this.md5_ii(o,i,r,n,e[a+11],10,-1120210379),n=this.md5_ii(n,o,i,r,e[a+2],15,718787259),r=this.md5_ii(r,n,o,i,e[a+9],21,-343485551),i=this.safe_add(i,s),r=this.safe_add(r,h),n=this.safe_add(n,c),o=this.safe_add(o,l)}return Array(i,r,n,o)},e.prototype.md5_cmn=function(e,t,i,r,n,o){return this.safe_add(this.rol(this.safe_add(this.safe_add(t,e),this.safe_add(r,o)),n),i)},e.prototype.md5_ff=function(e,t,i,r,n,o,a){return this.md5_cmn(t&i|~t&r,e,t,n,o,a)},e.prototype.md5_gg=function(e,t,i,r,n,o,a){return this.md5_cmn(t&r|i&~r,e,t,n,o,a)},e.prototype.md5_hh=function(e,t,i,r,n,o,a){return this.md5_cmn(t^i^r,e,t,n,o,a)},e.prototype.md5_ii=function(e,t,i,r,n,o,a){return this.md5_cmn(i^(t|~r),e,t,n,o,a)},e.prototype.core_hmac_md5=function(e,t){var i=this.str2binLittle(e);i.length>16&&(i=this.core_md5(i,e.length*this.chrsz));for(var r=Array(16),n=Array(16),o=0;o<16;o++)r[o]=909522486^i[o],n[o]=1549556828^i[o];var a=this.core_md5(r.concat(this.str2binLittle(t)),512+t.length*this.chrsz);return this.core_md5(n.concat(a),640)},e.sha1ToHex=function(t){e.crypt.checkParam(t),e.crypt.checkType(t.data,"data"),e.crypt.cryptQueue.push({param:t,doCrypt:e.sha1ToHexSync})},e.sha1ToHexSync=function(t){e.crypt.checkParam(t);var i=t.data;return e.crypt.checkType(i,"data"),e.crypt.bin2hex(e.crypt.core_sha1(e.crypt.str2bin(i),i.length*e.crypt.chrsz))},e.sha1ToBase64=function(t){e.crypt.checkParam(t),e.crypt.checkType(t.data,"data"),e.crypt.cryptQueue.push({param:t,doCrypt:e.sha1ToBase64Sync})},e.sha1ToBase64Sync=function(t){e.crypt.checkParam(t);var i=t.data;return e.crypt.checkType(i,"data"),e.crypt.bin2b64(e.crypt.core_sha1(e.crypt.str2bin(i),i.length*e.crypt.chrsz))},e.hmacSha1ToHex=function(t){e.crypt.checkParam(t),e.crypt.checkType(t.data,"data"),e.crypt.checkType(t.key,"key"),e.crypt.cryptQueue.push({param:t,doCrypt:e.hmacSha1ToHexSync})},e.hmacSha1ToHexSync=function(t){e.crypt.checkParam(t);var i=t.key,r=t.data;return e.crypt.checkType(r,"data"),e.crypt.checkType(i,"key"),e.crypt.bin2hex(e.crypt.core_hmac_sha1(i,r))},e.hmacSha1ToBase64=function(t){e.crypt.checkParam(t),e.crypt.checkType(t.data,"data"),e.crypt.checkType(t.key,"key"),e.crypt.cryptQueue.push({param:t,doCrypt:e.hmacSha1ToBase64Sync})},e.hmacSha1ToBase64Sync=function(t){e.crypt.checkParam(t);var i=t.key,r=t.data;return e.crypt.checkType(r,"data"),e.crypt.checkType(i,"key"),e.crypt.bin2b64(e.crypt.core_hmac_sha1(i,r))},e.prototype.core_sha1=function(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;for(var i=Array(80),r=1732584193,n=-271733879,o=-1732584194,a=271733878,s=-1009589776,h=0;h<e.length;h+=16){for(var c=r,l=n,u=o,d=a,_=s,f=0;f<80;f++){i[f]=f<16?e[h+f]:this.rol(i[f-3]^i[f-8]^i[f-14]^i[f-16],1);var g=this.safe_add(this.safe_add(this.rol(r,5),this.sha1_ft(f,n,o,a)),this.safe_add(this.safe_add(s,i[f]),this.sha1_kt(f)));s=a,a=o,o=this.rol(n,30),n=r,r=g}r=this.safe_add(r,c),n=this.safe_add(n,l),o=this.safe_add(o,u),a=this.safe_add(a,d),s=this.safe_add(s,_)}return Array(r,n,o,a,s)},e.prototype.sha1_ft=function(e,t,i,r){return e<20?t&i|~t&r:e<40?t^i^r:e<60?t&i|t&r|i&r:t^i^r},e.prototype.sha1_kt=function(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514},e.prototype.core_hmac_sha1=function(e,t){var i=this.str2bin(e);i.length>16&&(i=this.core_sha1(i,e.length*this.chrsz));for(var r=Array(16),n=Array(16),o=0;o<16;o++)r[o]=909522486^i[o],n[o]=1549556828^i[o];var a=this.core_sha1(r.concat(this.str2bin(t)),512+t.length*this.chrsz);return this.core_sha1(n.concat(a),672)},e.prototype.str2bin=function(e){var t=Array(),i=(1<<this.chrsz)-1;if("number"==typeof e&&(e=e.toString()),"string"==typeof e){for(var r=0;r<e.length*this.chrsz;r+=this.chrsz)t[r>>5]|=(e.charCodeAt(r/this.chrsz)&i)<<24-r%32;return t}for(var n=0;n<e.length*this.chrsz;n+=this.chrsz)t[n>>5]|=(e[n/this.chrsz]&i)<<24-n%32;return t},e.prototype.bin2str=function(e){for(var t="",i=(1<<this.chrsz)-1,r=0;r<32*e.length;r+=this.chrsz)t+=String.fromCharCode(e[r>>5]>>>24-r%32&i);return t},e.prototype.bin2hex=function(e){for(var t=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",i="",r=0;r<4*e.length;r++)i+=t.charAt(e[r>>2]>>8*(3-r%4)+4&15)+t.charAt(e[r>>2]>>8*(3-r%4)&15);return i},e.prototype.bin2b64=function(e){for(var t="",i=0;i<4*e.length;i+=3)for(var r=(e[i>>2]>>8*(3-i%4)&255)<<16|(e[i+1>>2]>>8*(3-(i+1)%4)&255)<<8|e[i+2>>2]>>8*(3-(i+2)%4)&255,n=0;n<4;n++)8*i+6*n>32*e.length?t+=this.b64pad:t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>6*(3-n)&63);return t},e.prototype.bin2b64Little=function(e){for(var t=this.bin2strLittle(e),i="",r=t.length,n=0;n<r;n+=3)for(var o=t.charCodeAt(n)<<16|(n+1<r?t.charCodeAt(n+1)<<8:0)|(n+2<r?t.charCodeAt(n+2):0),a=0;a<4;a++)8*n+6*a>8*t.length?i+=this.b64pad:i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(o>>>6*(3-a)&63);return i},e.prototype.str2binLittle=function(e){"number"==typeof e&&(e=e.toString());var t=Array();if("string"==typeof e){for(i=0;i<8*e.length;i+=8)t[i>>5]|=(255&e.charCodeAt(i/8))<<i%32;return t}for(var i=0;i<8*e.length;i+=8)t[i>>5]|=(255&e[i/8])<<i%32;return t},e.prototype.bin2strLittle=function(e){for(var t="",i=0;i<32*e.length;i+=8)t+=String.fromCharCode(e[i>>5]>>>i%32&255);return t},e.prototype.bin2hexLittle=function(e){for(var t,i=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",r=this.bin2strLittle(e),n="",o=0;o<r.length;o++)t=r.charCodeAt(o),n+=i.charAt(t>>>4&15)+i.charAt(15&t);return n},e.crypt=new e,e}();BK.Crypt.md5ToHex=function(e){r.md5ToHex(e)},BK.Crypt.md5ToBase64=function(e){r.md5ToBase64(e)},BK.Crypt.hmacMd5ToHex=function(e){r.hmacMd5ToHex(e)},BK.Crypt.hmacMd5ToBase64=function(e){r.hmacMd5ToBase64(e)},BK.Crypt.sha1ToHex=function(e){r.sha1ToHex(e)},BK.Crypt.sha1ToBase64=function(e){r.sha1ToBase64(e)},BK.Crypt.hmacSha1ToHex=function(e){r.hmacSha1ToHex(e)},BK.Crypt.hmacSha1ToBase64=function(e){r.hmacSha1ToBase64(e)},BK.Crypt.md5ToHexSync=function(e){return r.md5ToHexSync(e)},BK.Crypt.md5ToBase64Sync=function(e){return r.md5ToBase64Sync(e)},BK.Crypt.hmacMd5ToHexSync=function(e){return r.hmacMd5ToHexSync(e)},BK.Crypt.hmacMd5ToBase64Sync=function(e){return r.hmacMd5ToBase64Sync(e)},BK.Crypt.sha1ToHexSync=function(e){return r.sha1ToHexSync(e)},BK.Crypt.sha1ToBase64Sync=function(e){return r.sha1ToBase64Sync(e)},BK.Crypt.hmacSha1ToHexSync=function(e){return r.hmacSha1ToHexSync(e)},BK.Crypt.hmacSha1ToBase64Sync=function(e){return r.hmacSha1ToBase64Sync(e)},e.exports=BK.Crypt},"./src/common/emitter.ts":function(e,t,i){"use strict";var r=function(){function e(e,t,i){this.event=e,this.listener=t,this.once=i}return e}(),n=function(){function e(){this._emits={}}return e.prototype.__emit_get=function(e){return this._emits[e]||(this._emits[e]=new Array),this._emits[e]},e.prototype.__emit_exists=function(e){var t=this.__emit_get(e);return!!(t&&t.length>0)},e.prototype.__emit_put=function(e,t,i){var n=new r(e,t,i);return this.__emit_get(e).push(n),this},e.prototype.__emit_remove=function(e,t){if(1==this.__emit_exists(e)){for(var i=-1,r=this.__emit_get(e),n=r.length-1;n>=0;n--)if(t==r[n].listener){i=n;break}return i>-1&&r.splice(i,1),!0}return!1},e.prototype.on=function(e,t){return this.__emit_put(e,t,!1),this},e.prototype.once=function(e,t){return this.__emit_put(e,t,!0),this},e.prototype.off=function(e,t){return this.__emit_remove(e,t),this},e.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(this.__emit_exists(e)){for(var r=[],n=this.__emit_get(e),o=n.length,a=0;a<o;a++){var s=n[a];s.listener.apply(s,t),s.once&&r.push(s)}for(a=0;a<r.length;a++){var h=r[a];this.__emit_remove(e,h.listener)}return!0}return!1},e}();e.exports=n},"./src/common/qrcode.ts":function(e,t,i){"use strict";function r(e,t){for(var i=1,r=n(e),a=0,h=o.length;a<h;a++){var c=0;switch(t){case s.L:c=o[a][0];break;case s.M:c=o[a][1];break;case s.Q:c=o[a][2];break;case s.H:c=o[a][3]}if(r<=c)break;i++}if(i>o.length)throw new Error("Too long data");return i}function n(e){var t=encodeURI(e).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return t.length+(t.length!=e?3:0)}var o=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],a=i("./src/common/qrcodeModel.ts").QRCodeModel,s=i("./src/common/qrcodeModel.ts").QRErrorCorrectLevel,h=function(){function e(){BK.Director.ticker.add(function(t,i){if(0!==e.taskQueue.length){var r=e.taskQueue[0];e.taskQueue.splice(0,1);var n=!1;try{e.makeQRCodeToFileSync(r)}catch(e){if(n=!0,!r.fail)throw e;r.fail({msg:e.message})}n||r.success&&r.success({path:r.path}),r.complete&&r.complete()}})}return e.createQRModel=function(e,t){var i,n=new a(r(e,(i=void 0===t?{width:256,height:256,colorDark:{r:0,g:0,b:0,a:1},colorLight:{r:1,g:1,b:1,a:1},correctLevel:2}:t).correctLevel),i.correctLevel);return n.addData(e),n.make(),n},e.createQRCodeNode=function(t,i){var r;r=void 0===i?{width:256,height:256,colorDark:{r:0,g:0,b:0,a:1},colorLight:{r:1,g:1,b:1,a:1},correctLevel:s.H}:i;for(var n=new BK.Canvas(r.width,r.height),o=e.createQRModel(t,i),a=o.getModuleCount(),h=r.width/a,c=r.height/a,l=Math.round(h),u=Math.round(c),d=0;d<a;d++)for(var _=0;_<a;_++){var f=o.isDark(d,_),g=_*h,p=d*c;n.lineWidth=1,n.fillColor=f?r.colorDark:r.colorLight,n.drawStyle=0,n.fillRect(g,p,h,c),n.strokeColor=f?r.colorDark:r.colorLight,n.strokeRect(Math.ceil(g)-.5,Math.ceil(p)-.5,l,u),n.strokeRect(Math.ceil(g)+.5,Math.ceil(p)+.5,l,u)}return n},e.createQRCodeToFile=function(t,i,r){if(!t)throw new Error("path can not be undefined!");if(!i)throw new Error("content can not be undefined!");r||(r={});var n=r.width,o=void 0===n?256:n,a=r.height,h=void 0===a?256:a,c=r.colorDark,l=void 0===c?{r:0,g:0,b:0,a:1}:c,u=r.colorLight,d=void 0===u?{r:1,g:1,b:1,a:1}:u,_=r.correctLevel,f=void 0===_?s.H:_,g=e.createQRCodeNode(i,{width:o,height:h,colorDark:l,colorLight:d,correctLevel:f});g.saveTo(t),g.dispose()},e.makeQRCodeToFileSync=function(e){if(!e)throw new Error("param can not be undefined!");var t=e.path,i=e.content,r=e.config;if(!t)throw new Error("path can not be undefined!");if(0!==t.indexOf("GameSandBox://"))throw new Error("path must start with GameSandBox://");this.createQRCodeToFile(t,i,r)},e.makeQRCodeToFile=function(t){e.taskQueue.push(t)},e.compose=function(e,t){var i=BK.Director.screenPixelSize.width,r=BK.Director.screenPixelSize.height,n=new BK.Canvas(i,r);n.drawImage(e,0,0),n.drawImage(t,0,0),n.saveTo("GameSandBox://compose.png"),n.dispose()},e.taskQueue=new Array,e.instance=new e,e}();"undefined"!=typeof BK&&(BK.QRErrorCorrectLevel=s),e.exports=h},"./src/common/qrcodeModel.ts":function(e,t,i){"use strict";var r,n=function(){function e(e){this.mode=r.MODE_8BIT_BYTE,this.data=e,this.parsedData=[];for(var t=0,i=this.data.length;t<i;t++){var n=[],o=this.data.charCodeAt(t);o>65536?(n[0]=240|(1835008&o)>>>18,n[1]=128|(258048&o)>>>12,n[2]=128|(4032&o)>>>6,n[3]=128|63&o):o>2048?(n[0]=224|(61440&o)>>>12,n[1]=128|(4032&o)>>>6,n[2]=128|63&o):o>128?(n[0]=192|(1984&o)>>>6,n[1]=128|63&o):n[0]=o,this.parsedData.push(n)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}return e.prototype.getLength=function(e){return this.parsedData.length},e.prototype.write=function(e){for(var t=0;t<this.parsedData.length;t++)e.put(this.parsedData[t],8)},e}(),o=function(){function e(e,t){this.moduleCount=0,this.dataList=new Array,this.typeNumber=e,this.errorCorrectLevel=t,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=new Array}return e.prototype.addData=function(e){var t=new n(e);this.dataList.push(t),this.dataCache=null},e.prototype.isDark=function(e,t){if(e<0||this.moduleCount<=e||t<0||this.moduleCount<=t)throw new Error(e+","+t);return this.modules[e][t]},e.prototype.getModuleCount=function(){return this.moduleCount},e.prototype.make=function(){this.makeImpl(!1,this.getBestMaskPattern())},e.prototype.makeImpl=function(t,i){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++){this.modules[r]=new Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++)this.modules[r][n]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,i),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,i)},e.prototype.setupPositionProbePattern=function(e,t){for(var i=-1;i<=7;i++)if(!(e+i<=-1||this.moduleCount<=e+i))for(var r=-1;r<=7;r++)t+r<=-1||this.moduleCount<=t+r||(this.modules[e+i][t+r]=0<=i&&i<=6&&(0==r||6==r)||0<=r&&r<=6&&(0==i||6==i)||2<=i&&i<=4&&2<=r&&r<=4)},e.prototype.getBestMaskPattern=function(){for(var e=0,t=0,i=0;i<8;i++){this.makeImpl(!0,i);var r=h.getLostPoint(this);(0==i||e>r)&&(e=r,t=i)}return t},e.prototype.createMovieClip=function(e,t,i){var r=e.createEmptyMovieClip(t,i);this.make();for(var n=0;n<this.modules.length;n++)for(var o=1*n,a=0;a<this.modules[n].length;a++){var s=1*a;this.modules[n][a]&&(r.beginFill(0,100),r.moveTo(s,o),r.lineTo(s+1,o),r.lineTo(s+1,o+1),r.lineTo(s,o+1),r.endFill())}return r},e.prototype.setupTimingPattern=function(){for(var e=8;e<this.moduleCount-8;e++)null==this.modules[e][6]&&(this.modules[e][6]=e%2==0);for(var t=8;t<this.moduleCount-8;t++)null==this.modules[6][t]&&(this.modules[6][t]=t%2==0)},e.prototype.setupPositionAdjustPattern=function(){for(var e=h.getPatternPosition(this.typeNumber),t=0;t<e.length;t++)for(var i=0;i<e.length;i++){var r=e[t],n=e[i];if(null==this.modules[r][n])for(var o=-2;o<=2;o++)for(var a=-2;a<=2;a++)this.modules[r+o][n+a]=-2==o||2==o||-2==a||2==a||0==o&&0==a}},e.prototype.setupTypeNumber=function(e){for(var t=h.getBCHTypeNumber(this.typeNumber),i=0;i<18;i++){r=!e&&1==(t>>i&1);this.modules[Math.floor(i/3)][i%3+this.moduleCount-8-3]=r}for(i=0;i<18;i++){var r=!e&&1==(t>>i&1);this.modules[i%3+this.moduleCount-8-3][Math.floor(i/3)]=r}},e.prototype.setupTypeInfo=function(e,t){for(var i=this.errorCorrectLevel<<3|t,r=h.getBCHTypeInfo(i),n=0;n<15;n++){o=!e&&1==(r>>n&1);n<6?this.modules[n][8]=o:n<8?this.modules[n+1][8]=o:this.modules[this.moduleCount-15+n][8]=o}for(n=0;n<15;n++){var o=!e&&1==(r>>n&1);n<8?this.modules[8][this.moduleCount-n-1]=o:n<9?this.modules[8][15-n-1+1]=o:this.modules[8][15-n-1]=o}this.modules[this.moduleCount-8][8]=!e},e.prototype.mapData=function(e,t){for(var i=-1,r=this.moduleCount-1,n=7,o=0,a=this.moduleCount-1;a>0;a-=2)for(6==a&&a--;;){for(var s=0;s<2;s++)if(null==this.modules[r][a-s]){var c=!1;o<e.length&&(c=1==(e[o]>>>n&1)),h.getMask(t,r,a-s)&&(c=!c),this.modules[r][a-s]=c,-1==--n&&(o++,n=7)}if((r+=i)<0||this.moduleCount<=r){r-=i,i=-i;break}}},e.createData=function(t,i,r){for(var n=d.getRSBlocks(t,i),o=new _,a=0;a<r.length;a++){var s=r[a];o.put(s.mode,4),o.put(s.getLength(),h.getLengthInBits(s.mode,t)),s.write(o)}for(var c=0,a=0;a<n.length;a++)c+=n[a].dataCount;if(o.getLengthInBits()>8*c)throw new Error("code length overflow. ("+o.getLengthInBits()+">"+8*c+")");for(o.getLengthInBits()+4<=8*c&&o.put(0,4);o.getLengthInBits()%8!=0;)o.putBit(!1);for(;;){if(o.getLengthInBits()>=8*c)break;if(o.put(e.PAD0,8),o.getLengthInBits()>=8*c)break;o.put(e.PAD1,8)}return e.createBytes(o,n)},e.createBytes=function(e,t){for(var i=0,r=0,n=0,o=new Array(t.length),a=new Array(t.length),s=0;s<t.length;s++){var c=t[s].dataCount,l=t[s].totalCount-c;r=Math.max(r,c),n=Math.max(n,l),o[s]=new Array(c);for(p=0;p<o[s].length;p++)o[s][p]=255&e.buffer[p+i];i+=c;var d=h.getErrorCorrectPolynomial(l),_=new u(o[s],d.getLength()-1).mod(d);a[s]=new Array(d.getLength()-1);for(p=0;p<a[s].length;p++){var f=p+_.getLength()-a[s].length;a[s][p]=f>=0?_.get(f):0}}for(var g=0,p=0;p<t.length;p++)g+=t[p].totalCount;for(var m=new Array(g),v=0,p=0;p<r;p++)for(s=0;s<t.length;s++)p<o[s].length&&(m[v++]=o[s][p]);for(p=0;p<n;p++)for(s=0;s<t.length;s++)p<a[s].length&&(m[v++]=a[s][p]);return m},e.PAD0=236,e.PAD1=17,e}();!function(e){e[e.MODE_NUMBER=1]="MODE_NUMBER",e[e.MODE_ALPHA_NUM=2]="MODE_ALPHA_NUM",e[e.MODE_8BIT_BYTE=4]="MODE_8BIT_BYTE",e[e.MODE_KANJI=8]="MODE_KANJI"}(r||(r={}));var a;!function(e){e[e.L=1]="L",e[e.M=0]="M",e[e.Q=3]="Q",e[e.H=2]="H"}(a||(a={}));for(var s={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},h=function(){function e(){}return e.getBCHTypeInfo=function(t){for(var i=t<<10;e.getBCHDigit(i)-e.getBCHDigit(e.G15)>=0;)i^=e.G15<<e.getBCHDigit(i)-e.getBCHDigit(e.G15);return(t<<10|i)^e.G15_MASK},e.getBCHTypeNumber=function(t){for(var i=t<<12;e.getBCHDigit(i)-e.getBCHDigit(e.G18)>=0;)i^=e.G18<<e.getBCHDigit(i)-e.getBCHDigit(e.G18);return t<<12|i},e.getBCHDigit=function(e){for(var t=0;0!=e;)t++,e>>>=1;return t},e.getPatternPosition=function(t){return e.PATTERN_POSITION_TABLE[t-1]},e.getMask=function(e,t,i){switch(e){case s.PATTERN000:return(t+i)%2==0;case s.PATTERN001:return t%2==0;case s.PATTERN010:return i%3==0;case s.PATTERN011:return(t+i)%3==0;case s.PATTERN100:return(Math.floor(t/2)+Math.floor(i/3))%2==0;case s.PATTERN101:return t*i%2+t*i%3==0;case s.PATTERN110:return(t*i%2+t*i%3)%2==0;case s.PATTERN111:return(t*i%3+(t+i)%2)%2==0;default:throw new Error("bad maskPattern:"+e)}},e.getErrorCorrectPolynomial=function(e){for(var t=new u([1],0),i=0;i<e;i++)t=t.multiply(new u([1,c.gexp(i)],0));return t},e.getLengthInBits=function(e,t){if(1<=t&&t<10)switch(e){case r.MODE_NUMBER:return 10;case r.MODE_ALPHA_NUM:return 9;case r.MODE_8BIT_BYTE:case r.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(t<27)switch(e){case r.MODE_NUMBER:return 12;case r.MODE_ALPHA_NUM:return 11;case r.MODE_8BIT_BYTE:return 16;case r.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else{if(!(t<41))throw new Error("type:"+t);switch(e){case r.MODE_NUMBER:return 14;case r.MODE_ALPHA_NUM:return 13;case r.MODE_8BIT_BYTE:return 16;case r.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}}},e.getLostPoint=function(e){for(var t=e.getModuleCount(),i=0,r=0;r<t;r++)for(l=0;l<t;l++){for(var n=0,o=e.isDark(r,l),a=-1;a<=1;a++)if(!(r+a<0||t<=r+a))for(var s=-1;s<=1;s++)l+s<0||t<=l+s||0==a&&0==s||o==e.isDark(r+a,l+s)&&n++;n>5&&(i+=3+n-5)}for(r=0;r<t-1;r++)for(l=0;l<t-1;l++){var h=0;e.isDark(r,l)&&h++,e.isDark(r+1,l)&&h++,e.isDark(r,l+1)&&h++,e.isDark(r+1,l+1)&&h++,0!=h&&4!=h||(i+=3)}for(r=0;r<t;r++)for(l=0;l<t-6;l++)e.isDark(r,l)&&!e.isDark(r,l+1)&&e.isDark(r,l+2)&&e.isDark(r,l+3)&&e.isDark(r,l+4)&&!e.isDark(r,l+5)&&e.isDark(r,l+6)&&(i+=40);for(l=0;l<t;l++)for(r=0;r<t-6;r++)e.isDark(r,l)&&!e.isDark(r+1,l)&&e.isDark(r+2,l)&&e.isDark(r+3,l)&&e.isDark(r+4,l)&&!e.isDark(r+5,l)&&e.isDark(r+6,l)&&(i+=40);for(var c=0,l=0;l<t;l++)for(r=0;r<t;r++)e.isDark(r,l)&&c++;return i+=10*(Math.abs(100*c/t/t-50)/5)},e.PATTERN_POSITION_TABLE=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],e.G15=1335,e.G18=7973,e.G15_MASK=21522,e}(),c={glog:function(e){if(e<1)throw new Error("glog("+e+")");return c.LOG_TABLE[e]},gexp:function(e){for(;e<0;)e+=255;for(;e>=256;)e-=255;return c.EXP_TABLE[e]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},l=0;l<8;l++)c.EXP_TABLE[l]=1<<l;for(l=8;l<256;l++)c.EXP_TABLE[l]=c.EXP_TABLE[l-4]^c.EXP_TABLE[l-5]^c.EXP_TABLE[l-6]^c.EXP_TABLE[l-8];for(l=0;l<255;l++)c.LOG_TABLE[c.EXP_TABLE[l]]=l;var u=function(){function e(e,t){if(void 0==e.length)throw new Error(e.length+"/"+t);for(var i=0;i<e.length&&0==e[i];)i++;this.num=new Array(e.length-i+t);for(var r=0;r<e.length-i;r++)this.num[r]=e[r+i]}return e.prototype.get=function(e){return this.num[e]},e.prototype.getLength=function(){return this.num.length},e.prototype.multiply=function(t){for(var i=new Array(this.getLength()+t.getLength()-1),r=0;r<this.getLength();r++)for(var n=0;n<t.getLength();n++)i[r+n]^=c.gexp(c.glog(this.get(r))+c.glog(t.get(n)));return new e(i,0)},e.prototype.mod=function(t){if(this.getLength()-t.getLength()<0)return this;for(var i=c.glog(this.get(0))-c.glog(t.get(0)),r=new Array(this.getLength()),n=0;n<this.getLength();n++)r[n]=this.get(n);for(n=0;n<t.getLength();n++)r[n]^=c.gexp(c.glog(t.get(n))+i);return new e(r,0).mod(t)},e}(),d=function(){function e(e,t){this.totalCount=e,this.dataCount=t}return e.getRSBlocks=function(t,i){var r=e.getRsBlockTable(t,i);if(void 0==r)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+i);for(var n=r.length/3,o=[],a=0;a<n;a++)for(var s=r[3*a+0],h=r[3*a+1],c=r[3*a+2],l=0;l<s;l++)o.push(new e(h,c));return o},e.getRsBlockTable=function(t,i){switch(i){case a.L:return e.RS_BLOCK_TABLE[4*(t-1)+0];case a.M:return e.RS_BLOCK_TABLE[4*(t-1)+1];case a.Q:return e.RS_BLOCK_TABLE[4*(t-1)+2];case a.H:return e.RS_BLOCK_TABLE[4*(t-1)+3];default:return}},e.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],e}(),_=function(){function e(){this.buffer=new Array,this.length=0}return e.prototype.get=function(e){var t=Math.floor(e/8);return 1==(this.buffer[t]>>>7-e%8&1)},e.prototype.put=function(e,t){for(var i=0;i<t;i++)this.putBit(1==(e>>>t-i-1&1))},e.prototype.getLengthInBits=function(){return this.length},e.prototype.putBit=function(e){var t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++},e}();e.exports={QRCodeModel:o,QRErrorCorrectLevel:a}},"./src/deprecate/http-util.ts":function(e,t,i){"use strict";var r=BK.HttpUtil,n=function(){function e(e,t,i){this._headers={},this._isBodyCompatible=!1,this._url=e,this._method=t,"string"==typeof i?this._argu=i:i&&(this._body=i)}return e.prototype.setHttpHeader=function(e,t){this._headers[e]=t},e.prototype.setHttpRawBody=function(e){this._body=e},e.prototype.setHttpUploadProgressListener=function(e){this._uploadProgressListener=e},e.prototype.setHttpDownloadProgressListener=function(e){this._downloadProgressListener=e},e.prototype.sendRequest=function(e){var t=this._request=new r(this._url,this._method?this._method.toUpperCase():"GET");for(var i in this._headers)t.setHttpHeader(i,this._headers[i]);if(this._body)"string"==typeof this._body?((n=new BK.Buffer).writeAsString(this._body,!1),t.setHttpRawBody(n)):t.setHttpRawBody(this._body);else if(this._argu){this._isBodyCompatible&&t.setHttpHeader("PostBody",this._argu);var n=new BK.Buffer;n.writeAsString(this._argu,!1),t.setHttpRawBody(n)}t.setHttpUploadProgressListener&&this._uploadProgressListener&&t.setHttpUploadProgressListener(this._uploadProgressListener),t.setHttpDownloadProgressListener&&this._downloadProgressListener&&t.setHttpDownloadProgressListener(this._downloadProgressListener),t.sendRequest?t.sendRequest(e):t.requestAsync(function(t,i){e(i,{},t)})},e.prototype.setHttpUrl=function(e){this._url=e},e.prototype.setHttpMethod=function(e){this._method=e},e.prototype.requestAsync=function(e){this.sendRequest(function(t,i,r){e(r,t)})},e.prototype.setHttpReferer=function(e){this.setHttpHeader("Referer",e)},e.prototype.setHttpCookie=function(e){this.setHttpHeader("Cookie",e)},e.prototype.setBodyCompatible=function(e){this._isBodyCompatible=e},e.prototype.setHttpPostData=function(e){this._argu=e},e.prototype.setHttpRawBodyFix=function(e){this.setHttpRawBody(e)},e}();e.exports=n},"./src/fileSystem/FileSystem.ts":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i("./src/util/buffer.js"),n=function(){function e(){}return e.decode=function(t,i){if(t&&i){var r=t;switch(i){case"utf8":r=t.readAsString(!0);break;case"ascii":r=e.toASCII(t.readAsString(!0));break;case"binary":r=BK.Misc.BKBufferToArrayBuffer(t);break;case"base64":r=BK.Misc.encodeBase64FromBuffer(t)}return r}return BK.Console.error("invalid source or encode "+i),null},e.toASCII=function(t){return e.ESC.lastIndex=0,e.ESC.test(t)?t.replace(e.ESC,function(t){var i=e.META[t];return"string"==typeof i?i:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)}):t},e.ESC=/[\\\"\x00-\x1f\x7f-\uffff]/g,e.META={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},e}(),o=function(){function e(){}return e.prototype.readFile=function(e){if(0==BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.8.0")){if(e&&e.file){for(var t=[],i=0;i<e.file.length;i++)void 0!=e.file[i].path&&("utf8"===e.file[i].encoding&&(e.file[i].encoding="utf-8"),t.push({path:e.file[i].path,encoding:void 0==e.file[i].encoding?"binary":e.file[i].encoding}));var r=BK.FileUtil.addReadIOTask(t);BK.taskManager.pushTask(r,t,function(t){for(var i=0;i<t.length;i++)if(t[i].data){var r=t[i].data;if(r)switch(t[i].encoding){case"ascii":var o={data:n.decode(BK.FileUtil.readFile(t[i].path),"ascii"),errcode:0,path:t[i].path,errmsg:t[i].errmsg,encoding:"ascii"};t[i]=o;break;case"binary":t[i].data=BK.Misc.BKBufferToArrayBuffer(r);break;default:"utf-8"===t[i].encoding&&(t[i].encoding="utf8"),t[i].data=r.readAsString(!0)}else BK.Console.error("raw is invalid")}e.success&&e.success(t),e.complete&&e.complete()})}}else{var o=[];if(e&&e.file)for(i=0;i<e.file.length;i++){var a=e.file[i];if(a.path){var s=BK.FileUtil.readFile(a.path),h=n.decode(s,a.encoding||"binary");o.push({errcode:h?0:-1,errmsg:h?"":"read failed!",path:a.path,data:h})}}e.success&&e.success(o),e.complete&&e.complete()}},e.prototype.writeFile=function(e){if(0==BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.8.0")){if(e&&e.file){for(var t=[],i=0;i<e.file.length;i++)void 0!=e.file[i].path&&e.file[i].data&&t.push({path:e.file[i].path,encoding:void 0==e.file[i].encoding?"binary":e.file[i].encoding,data:r.arrayBufferToBKBuffer(e.file[i].data)});var n=BK.FileUtil.addWriteIOTask(t);BK.taskManager.pushTask(n,t,function(t){e.success&&e.success(t),e.complete&&e.complete()})}}else{var o=[];if(e&&e.file)for(i=0;i<e.file.length;i++){var a=e.file[i];if(a.path){var s=r.arrayBufferToBKBuffer(a.data),h=BK.FileUtil.writeBufferToFile(a.path,s);o.push({errcode:h?0:-1,errmsg:h?"":"write failed!",path:a.path})}}e.success&&e.success(o),e.complete&&e.complete()}},e.prototype.zip=function(e){if(0==BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.8.0")){if(e&&e.file){for(var t=[],i=0;i<e.file.length;i++)e.file[i].path&&e.file[i].zipPath&&t.push({path:e.file[i].path,zipPath:e.file[i].zipPath});var r=BK.FileUtil.addZipIOTask(t);BK.taskManager.pushTask(r,t,function(t){e.success&&e.success(t),e.complete&&e.complete()})}}else{var n=[];if(e&&e.file)for(i=0;i<e.file.length;i++){var o=e.file[i];if(o.path&&o.zipPath){var a=BK.FileUtil.zip(o.path,o.zipPath);n.push({errcode:a?0:-1,errmsg:a?"":"zip failed!",path:o.path,zipPath:o.zipPath})}}e.success&&e.success(n),e.complete&&e.complete()}},e.prototype.unzip=function(e){if(0==BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.8.0")){if(e&&e.file){for(var t=[],i=0;i<e.file.length;i++)e.file[i].path&&e.file[i].zipPath&&t.push({path:e.file[i].path,zipPath:e.file[i].zipPath});var r=BK.FileUtil.addUnzipIOTask(t);BK.taskManager.pushTask(r,t,function(t){e.success&&e.success(t),e.complete&&e.complete()})}}else{var n=[];if(e&&e.file)for(i=0;i<e.file.length;i++){var o=e.file[i];if(o.path&&o.zipPath){var a=BK.FileUtil.unzip(o.zipPath,o.path);n.push({errcode:a?0:-1,errmsg:a?"":"unzip failed!",path:o.path,zipPath:o.zipPath})}}e.success&&e.success(n),e.complete&&e.complete()}},e.prototype.readFileSync=function(e,t){return n.decode(BK.FileUtil.readFile(e),t||"binary")},e.prototype.writeFileSync=function(e,t){if(t instanceof String||"string"==typeof t)BK.FileUtil.writeFile(e,t);else{var i=r.arrayBufferToBKBuffer(t);BK.FileUtil.writeBufferToFile(e,i)}},e.prototype.zipSync=function(e,t){BK.FileUtil.zip(e,t)},e.prototype.unzipSync=function(e,t){BK.FileUtil.unzip(e,t)},e.prototype.makeDirSync=function(e){BK.FileUtil.makeDir(e)},e.prototype.unlinkSync=function(e){return BK.FileUtil.deleteFile(e)},e.prototype.copyFileSync=function(e,t){if(0==BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.8.0"))BK.FileUtil.copyFile(e,t);else{var i=BK.FileUtil.readFile(e);i&&BK.FileUtil.writeBufferToFile(t,i)}},e.prototype.accessSync=function(e){return BK.FileUtil.isFileExist(e)},e.prototype.isDirectory=function(e){return BK.FileUtil.isDirectory(e)},e.prototype.getFileInfoSync=function(e){return BK.FileUtil.getFileInfo(e)},e.prototype.readDir=function(e){return BK.FileUtil.getFileList(e,function(t,i){0==t?e.success&&e.success({files:i.files}):e.fail&&e.fail({msg:i.errMsg,errcode:t}),e.complete&&e.complete()})},e}();t.FileSystem=o,BK.FileUtil.readFileAsync=function(){return null},BK.FileUtil.removeFromCache=function(){return null},e.exports=o},"./src/gme/audio.ts":function(e,t,i){"use strict";var r,n=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),o=i("./src/common/emitter.ts");!function(e){function t(){return{MediaEvent:d,AudioFactory:f,NativeMethod:u,Audio2:p,AudioManager:g}}var i=0,r=1,a=2,s=3,h=4,c={log:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},error:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];BK.Script.log(1,1,"console error:"+e.join(" "))}},l={"Audio.play":"cs.audio_play.local","Audio.pause":"cs.audio_pause.local","Audio.load":"cs.audio_load.local","Audio.seek":"cs.audio_seek.local","Audio.destroy":"cs.audio_destroy.local","Audio.create":"cs.audio_create.local","Audio.onend":"cs.audio_onend.local","Audio.stop":"cs.audio_stop.local","Audio.resume":"cs.audio_effect_resume.local","NativeMethod.state":"cs.native_method_state.local","Audio.attribute.set":"cs.audio_attribute_set.local","Audio.attribute.get":"cs.audio_attribute_get.local","Audio.sys_event":"sc.audio_event.local"},u=function(){function e(t){this.callbackMap={},this.currentObjId=0,this.destroyed=!1,this.currentObjId=++e.OBJECT_ID,this.objContext=t;var i=function(e){e&&e.data&&e.data.message&&c.log("native method info:"+e.data.message)};this.callAlive(e.NATIVE_INFO,i)}return e.prototype.getCurrentTime=function(){return Date.now()},e.prototype.setObjectId=function(e){this.currentObjId=e},e.prototype.call=function(e,t,i){this.releaseCallback();var r=this.getKey(e);this.callbackMap[this.getCallbackId()]={CALLBACK:i,LOCK:!0,CMD:l[r]},this.innerCall(l[r],t)},e.prototype.callAlive=function(e,t){var i=this.getKey(e);BK.MQQ.SsoRequest.addListener(l[i],this,function(e,i,r){t&&t({code:e,cmd:i,data:r})})},e.prototype.offAlive=function(e){var t=this.getKey(e);BK.MQQ.SsoRequest.removeListener(l[t],this.objContext)},e.prototype.callSync=function(e,t){this.releaseCallback();var i=this.getKey(e);return this.callbackMap[this.getCallbackId()]={CALLBACK:{},LOCK:!0,CMD:l[i]},this.innerCallSync(l[i],t)},e.prototype.callBack=function(t,i,r){var n=r;n.code=t;var o=n[e.N_REQUEST_SE],a=this.callbackMap[o];a?(a.CALLBACK&&"function"==typeof a.CALLBACK&&a.CALLBACK.call(this.objContext,n),a.LOCK=!1):c.log("no callback "+o),this.releaseCallback();c.log("receive callback # "+o+" # "+i+" # "+JSON.stringify(r)+" cost "+(this.getCurrentTime()-r[e.N_R_TIME])+" ms")},e.prototype.getKey=function(e){return e},e.prototype.getCallbackId=function(){return++e.CALLBACK_ID},e.prototype.innerCall=function(t,i){i[e.N_REQUEST_SE]=e.CALLBACK_ID,i[e.N_REQUEST_O]=this.currentObjId,i[e.N_R_TIME]=this.getCurrentTime(),c.log("send message "+e.CALLBACK_ID+" # "+t+" # "+JSON.stringify(i));var r=this;BK.MQQ.SsoRequest.removeListener(t,this.objContext),BK.MQQ.SsoRequest.addListener(t,this.objContext,function(){r.callBack.apply(r,arguments)}),BK.MQQ.SsoRequest.send(i,t)},e.prototype.innerCallSync=function(t,i){if(i[e.N_REQUEST_SE]=e.CALLBACK_ID,i[e.N_REQUEST_O]=this.currentObjId,i[e.N_R_SYNC]=!0,i[e.N_R_TIME]=this.getCurrentTime(),c.log("send message sync "+e.CALLBACK_ID+" # "+t+" # "+JSON.stringify(i)),BK.MQQ.Native.syncSend)return BK.MQQ.Native.syncSend(i,t)},e.prototype.releaseCallback=function(){for(var e in this.callbackMap)e&&!this.callbackMap[e].LOCK&&delete this.callbackMap[e]},e.N_REQUEST_SE="N_R_SE",e.N_REQUEST_O="N_R_OBJ",e.CALLER="CALLER",e.CALLBACK="CALLBACK",e.NATIVE_INFO="NativeMethod.state",e.N_R_SYNC="N_R_SYNC",e.N_R_ALIVE="N_R_ALIVE",e.N_R_T="N_R_T",e.N_R_TIME="N_R_TIME",e.CALLBACK_ID=0,e.OBJECT_ID=0,e}(),d={NAME_SPACE:"MediaEvent",abort:"abort",canplay:"canplay",canplaythrough:"canplaythrough",durationchange:"durationchange",emptied:"emptied",encrypted:"encrypted",ended:"ended",error:"error",interruptbegin:"interruptbegin",interruptend:"interruptend",loadeddata:"loadeddata",loadedmetadata:"loadedmetadata",loadstart:"loadstart",mozaudioavailable:"mozaudioavailable",pause:"pause",play:"play",playing:"playing",progress:"progress",ratechange:"ratechange",seeked:"seeked",seeking:"seeking",stalled:"stalled",suspend:"suspend",timeupdate:"timeupdate",volumechange:"volumechange",waiting:"waiting",created:"created",destroyed:"destroyed"},_=function(e){function t(n){var o=e.call(this)||this;o._src="",o._volume=1,o._muted=!1,o._loop=!1,o._autoplay=!1,o._buffered={},o._controls={},o._preload=!1,o._played={},o._duration=0,o._paused=!1,o._currenTime=0,o._playing=!1,o._loaded=!1,o._loading=!1,o._playerType="normal",o._streamId=0,o._lastLeftVolume=1,o._lastRightVolume=1,o._loopCound=0,o._destroyed=!1,o._$sn=t.SN_SEED++,o.HAVE_NOTHING=i,o.HAVE_METADATA=r,o.HAVE_CURRENT_DATA=a,o.HAVE_FUTURE_DATA=s,o.HAVE_ENOUGH_DATA=h,o.readyState=i,o.nativeMethod=new u(o);var c="normal",l="";n.src&&(l=n.src),n.type&&(c=c===n.type?c:"effect"),o.create(n);var d=o;return l?d.src=l:d._src="",o}return n(t,e),t.prototype.create=function(e,t){void 0===e&&(e={}),void 0===t&&(t=!1);var i=e.type;if(i||(i="normal",e.type=i),e.id=GameStatusInfo.gameId,this._playerType=i,!this.isIOSEffect()||t){this.nativeMethod.callSync("Audio.create",e);this.onCreate()}},t.prototype.onCanPlay=function(){this.emit("load"),this.emit("loadend"),this.emit("canplay"),this.emit("canplaythrough"),this.emit(d.loadeddata),this.emit(d.loadedmetadata),this.readyState=a},t.prototype.onPlay=function(){this.emit(d.play),this.emit(d.playing),this._playing=!0},t.prototype.onCreate=function(){this.emit(d.created)},t.prototype.onDestroy=function(){this.emit(d.destroyed),BK.Director.ticker.remove(this),this._destroyed=!0},t.prototype.onPause=function(){this.emit(d.pause),this._paused=!0,this._playing=!1},t.prototype.onEnded=function(){this.emit("ended"),this.readyState=h,this._playing=!1,BK.Director.ticker.remove(this)},t.prototype.onError=function(e){this.emit("error"),BK.Director.ticker.remove(this)},t.prototype.onSeeking=function(){this.emit(d.seeking)},t.prototype.onSeeked=function(){this.emit(d.seeked),this.emit(d.playing)},t.prototype.onTimeUpdate=function(e){this.emit(d.timeupdate,{currentTime:e})},t.prototype.onLoad=function(){this._loaded=!0,this._loading=!1,this.onCanPlay(),this.nativeMethod.callSync("Audio.duration",{})},t.prototype.onVolumeChange=function(){this.emit(d.volumechange)},t.prototype.load=function(){var e=this;this._loaded&&this.emit(d.emptied),this._loading=!0,this.emit(d.loadstart),this.nativeMethod.call("Audio.load",{},function(t){0===t.code?e.onLoad():e.onError(t.message)})},t.prototype.play=function(e){if(void 0===e&&(e={}),!this.destroyed){var i=this;if(this._playing=!0,this._paused=!1,"effect"!==this._playerType){this.autoplay=!0,this.nativeMethod.callSync("Audio.play",e),this.nativeMethod.call("Audio.onend",{},i.onEnded);var r=(new Date).getTime();BK.Director.ticker.remove(this),BK.Director.ticker.add(function(e,t){var n=(new Date).getTime();n-r>=2e3&&(i.getAttribute({currentTime:0}),r=n)},this)}else{if(this.isIOSEffect()){var n=--t.IOS_OBJ_ID;this.nativeMethod.setObjectId(n),this.create({type:this._playerType,src:this._src,loop:this._loop},!0),e.complete&&e.complete({id:t.IOS_OBJ_ID})}var o=e.loopCount,a={loop:o||(this._loop?-1:0),src:this._src,volume:this._volume,complete:e.complete?e.complete:function(e){e&&(i._streamId=e.id,0===e.code||i.onError(e.message))}};this.nativeMethod.call("Audio.play",a,a.complete)}return this.onPlay(),this._streamId}},t.prototype.pause=function(e){void 0===e&&(e={}),this.destroyed||("effect"===this._playerType&&(e.id=e.id,e.id&&0!==e.id||(delete e.id,e.auto=!0)),BK.Director.ticker.remove(this),this._paused=!0,this.nativeMethod.callSync("Audio.pause",e),this.onPause())},t.prototype.seek=function(e){var t=this;this.nativeMethod.call("Audio.seek",{seek:e},function(e){0===e.code?t.onSeeked():t.onError(e.message)}),this.onSeeking()},t.prototype.destroy=function(e){if(void 0===e&&(e={}),!this.destroyed){var t=this;"effect"===this._playerType&&e.id&&(e.id=e.id),this.nativeMethod.callSync("Audio.destroy",{id:t._$sn}),BK.Director.ticker.remove(this),f.CURRENT_NUM--,f.removeAudio(this),this.onDestroy()}},t.prototype.canPlayType=function(e){return void 0===e&&(e=""),"string"!=typeof e?"":"audio/mpeg".indexOf(e)>-1||"audio/mp4".indexOf(e)>-1?"probably":""},t.prototype.stop=function(e){void 0===e&&(e={}),"effect"===this._playerType&&e.id&&(e.id=e.id),this.nativeMethod.callSync("Audio.stop",e)},t.prototype.resume=function(e){void 0===e&&(e={}),"effect"===this._playerType&&(e.id&&0!==e.id?this.isIOSEffect()&&this.nativeMethod.setObjectId(e.id):(delete e.id,e.audo=!0)),this.nativeMethod.callSync("Audio.resume",e)},t.prototype.setAttribute=function(e){this.nativeMethod.callSync("Audio.attribute.set",e)},t.prototype.getAttribute=function(e){void 0===e&&(e={});var t=this.nativeMethod.callSync("Audio.attribute.get",e);t&&!isNaN(t.duration)&&(this._duration=t.duration),t&&!isNaN(t.currentTime)&&(this._currenTime=t.currentTime,this.onTimeUpdate(t.currentTime)),t&&void 0!==t.paused&&(this._paused=t.paused)},Object.defineProperty(t.prototype,"currentTime",{get:function(){return this.getAttribute({currentTime:1}),this._currenTime},set:function(e){this.setAttribute({currentTime:e}),this.seek(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this.getAttribute({duration:1}),this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"src",{get:function(){return this._src},set:function(e){e&&"android"===GameStatusInfo.platform&&(e=e.replace("GameSandBox://","GameRes://sandbox/")),"effect"!==this._playerType&&(this.setAttribute({src:e,autoPlay:this.autoplay,loop:this.loop}),this.load()),this._src=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loop",{get:function(){return this._loop},set:function(e){"effect"!==this._playerType&&this.setAttribute({loop:e}),this._loop=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoplay",{get:function(){return this._autoplay},set:function(e){this.setAttribute({autoPlay:e}),this._autoplay=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paused",{get:function(){return this.getAttribute({paused:!1}),this._paused},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(e){this._muted||("effect"!==this._playerType&&(this.setAttribute({leftVolume:e,rightVolume:e,volume:e}),this.onVolumeChange()),this._lastLeftVolume=this.volume,this._lastRightVolume=this.volume,this._volume=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"muted",{get:function(){return this._muted},set:function(e){this._muted=e,"effect"!==this._playerType&&this.setAttribute({muted:e,leftVolume:this._lastLeftVolume,rightVolume:this._lastRightVolume})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buffered",{get:function(){return this._buffered},set:function(e){this._buffered=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"played",{get:function(){return this._played},set:function(e){this._played=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"preload",{get:function(){return this._preload},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"streamId",{get:function(){return this._streamId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this._playerType},enumerable:!0,configurable:!0}),t.prototype.isIOSEffect=function(){return"effect"===this._playerType&&"ios"===GameStatusInfo.platform},Object.defineProperty(t.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._$sn},enumerable:!0,configurable:!0}),t.SN_SEED=1,t.IOS_OBJ_ID=Math.pow(2,53)-1,t}(o),f=function(){function e(){}return e.createAudioContext=function(t){if(void 0===t&&(t={}),t.type&&"normal"!==t.type){if("effect"===t.type){return void 0===e.effect_instance||e.effect_instance.destroyed||(e.effect_instance.destroy(),e.removeAudio(e.effect_instance)),e.effect_instance=new _(t),e.audioMap.push(e.effect_instance),e.effect_instance}return c.log("invalid type "+t.type),new _({})}if(e.CURRENT_NUM<e.MAX_AUDIO_NUM){var i=new _(t);return e.CURRENT_NUM++,e.audioMap.push(i),i}return c.log("reach the max num of audio"),new _({})},e.getAudioList=function(){return e.audioMap},e.removeAudio=function(t){for(var i=-1,r=0;r<e.audioMap.length;r++)if(t.id==e.audioMap[r].id){i=r;break}-1!=i&&(e.audioMap=e.audioMap.slice(i,1))},e.MAX_AUDIO_NUM=8,e.MAX_EFFECT_NUM=3,e.CURRENT_NUM=0,e.audioMap=[],e.effectMap=[],e.CURRENT_EFFECT_NUM=0,e.effect_index=0,e}(),g=function(){function e(){this.nativeMethod=new u(this),this.nativeMethod.callAlive("Audio.sys_event",this.onEvent)}return e.prototype.onEvent=function(t){switch(void 0===t&&(t={}),(t.data||{}).event){case 1:e.AUDIO_INT_START&&"function"==typeof e.AUDIO_INT_START&&e.AUDIO_INT_START();break;case 2:e.AUDIO_INT_END&&"function"==typeof e.AUDIO_INT_END&&e.AUDIO_INT_END()}},e.newInstance=function(){e.INSTANCE||(e.INSTANCE=new e)},e.onAudioInterruptionStart=function(t){e.AUDIO_INT_START=t},e.onAudioInterruptionEnd=function(t){e.AUDIO_INT_END=t},e.pauseAllAudio=function(){for(var e=0,t=f.getAudioList();e<t.length;e++){var i=t[e];i&&!i.paused&&i.pause()}},e.resumeAllAudio=function(){for(var e=0,t=f.getAudioList();e<t.length;e++){var i=t[e];i&&("normal"===i.type?i.play():"effect"===i.type&&i.resume())}},e.destroyAllAudio=function(){for(var e=0,t=f.getAudioList();e<t.length;e++){var i=t[e];i&&i.destroy()}},e.INSTANCE=new e,e}(),p=function(){function e(e,t,i,r){void 0===i&&(i=1),void 0===r&&(r=!1),this._currentTime=0,this._volume=1,this._audioType=0,this._destroyAtComplete=!1,this._type=e,this._musicPath=t,this._loopCount=i,this._destroyAtComplete=r,BK.onEnterForeground(function(){g.resumeAllAudio()}),BK.onMaximize(function(){g.resumeAllAudio()})}return e.prototype.isEffect=function(){return 1===this._audioType},e.prototype.seekTo=function(e){this.audioObject&&this.audioObject.seek(e)},e.prototype.startMusic=function(t){if(void 0===t&&(t=function(){}),this.isEffect())(void 0===this.effectObject||this.effectObject.destroyed)&&(this.effectObject=f.createAudioContext({type:"effect",src:this._musicPath})||null),void 0!==this.effectObject&&(this.effectObject.loop=-1===this._loopCount,this.effectObject.muted=!e.switch,this.effectObject.src!==this._musicPath&&(this.effectObject.src=this._musicPath),this.effectObject.play({loopCount:this._loopCount}));else{(void 0===this.audioObject||this.audioObject.destroyed)&&(this.audioObject=f.createAudioContext({type:"normal",src:this._musicPath})||null);var i=this;void 0!==this.audioObject?(this.audioObject.muted=!e.switch,-1==this._loopCount?this._loopCount=Math.pow(2,53)-1:c.log("loo for "+this._loopCount),this.audioObject.on(d.loadeddata,function(){i.loopPlay(i._loopCount,t)})):c.log("create failed")}return this},e.prototype.loopPlay=function(e,t){if(void 0!==this.audioObject){var i=this;if(--e>0){var r=function(){void 0!==i.audioObject&&(i.audioObject.off(d.ended,r),i.loopPlay(e,t))};this.audioObject.on(d.ended,r)}if(e<=0){var n=function(){void 0!==i.audioObject&&(i.audioObject.off(d.ended,n),t&&t())};this.audioObject.on(d.ended,n)}this.audioObject.play()}},e.prototype.pauseMusic=function(){if(this.isEffect()){if(!this.effectObject)return void c.log("not init effect call play first");this.effectObject.pause()}else{if(!this.audioObject)return void c.log("not init audio call play first");this.audioObject.pause()}},e.prototype.resumeMusic=function(){if(this.isEffect()){if(!this.effectObject)return void c.log("not init effect call play first");this.effectObject.resume()}else{if(!this.audioObject)return void c.log("not init audio call play first");this.audioObject.play()}},e.prototype.stopMusic=function(){this.audioObject&&this.audioObject.destroy(),this.effectObject&&this.effectObject.destroy()},e.prototype.destroy=function(){this.audioObject&&this.audioObject.destroy(),this.effectObject&&this.effectObject.destroy()},Object.defineProperty(e.prototype,"volume",{set:function(e){this.audioObject?this.audioObject.volume=e:c.log("audio not init")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loopCount",{set:function(e){this.audioObject&&(this._loopCount=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{set:function(e){this._type=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"musicPath",{set:function(e){this._musicPath=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audioType",{get:function(){return this._audioType},set:function(e){this._audioType=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this.audioObject?this.audioObject.currentTime:(c.log("audio not init"),0)},set:function(e){this.audioObject?this.audioObject.currentTime=e:c.log("audio not init")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this.audioObject?this.audioObject.duration:(c.log("audio not init"),0)},enumerable:!0,configurable:!0}),e.playMusic=function(t,i,r){1===t?(void 0===e.effectAudioInstance&&(e.effectAudioInstance=new e(t,i,r)),e.effectAudioInstance.musicPath=i,e.effectAudioInstance.loopCount=r,e.effectAudioInstance.startMusic()):new e(t,i,r).startMusic()},e.pauseAllBackground=function(){BK.AudioManager.pauseAllAudio()},e.resumeAllBackground=function(){BK.AudioManager.resumeAllAudio()},e.switch=!0,e}();e.createContext=t}(r||(r={})),e.exports=r.createContext},"./src/mqq/advertisement/advertisement.ts":function(e,t,i){"use strict";var r,n=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),o=i("./src/common/emitter.ts");!function(e){function t(e){return new a(e)}function i(){return new s}var r=["succeed","internal error","frequency error","network error","invalid request","no ad fill","server error","formet mismatch","h5 game nonsupport"],a=function(e){function t(i){var n=e.call(this)||this;return n.ssoCMD={LOAD_REQ:"cs.game_ad_banner_load.local",LOAD_RESP:"sc.game_ad_banner_load.local",SHOW_REQ:"cs.game_ad_banner_show.local",HIDE_REQ:"cs.game_ad_banner_hide.local",RESIZE_REQ:"cs.game_ad_banner_resize.local",RESIZE_RESP:"sc.game_ad_banner_resize.local",CLOSE_REQ:"cs.game_ad_banner_close.local"},n.hasShow=!1,n.hasHide=!1,n.param=i,n.bannerId=t._bannerId(),n.param.viewId||(n.param.viewId=1001),n.eventCallBack={load:void 0,error:void 0},n.useNative=!1,n.param.viewId&&1003==n.param.viewId&&(n.useNative=!0),n.needAutoShow=!1,n.isLoadSucc=!1,n.fetch(function(e,t){if(BK.isBrowser&&"android"===GameStatusInfo.platform&&t.errCode&&(e=t.errCode),0==e)this.isLoadSucc=!0,this.emit("load"),1==this.needAutoShow&&this.show();else{var i="unknown error",n=e;t.errCode&&(n=t.errCode),n<r.length&&(i=r[n]);var o={msg:i,code:n};this.emit("error",o)}}.bind(n)),n}return n(t,e),t._bannerId=function(){return this.incBannerId||(this.incBannerId=0),++this.incBannerId},t.prototype.log=function(e){BK.Script.log(1,1,"BannerAd:"+e)},t.prototype.show=function(){this.hasShow?this.log("show error.can't show twice!"):1!=this.hasHide?1==this.isLoadSucc?(this.hasShow=!0,this.hasHide=!1,this.useNative?this._ssoShow():this._innerGameBanner?1001==this.param.viewId?this._innerGameBanner.show(function(e,t,i){BK.Script.log(1,1,"show static inner banner succCode"+e+" msg:"+t)}):1002==this.param.viewId&&this._innerGameBanner.showAnimate(function(e,t,i){BK.Script.log(1,1,"show animate banner succCode"+e+" msg:"+t)}):BK.Script.log(1,1,"show inner banner failed. handle is undefined")):this.needAutoShow=!0:this._setHidden(!1)},t.prototype.hide=function(){1!=this.hasHide?this._setHidden(!0):this.log("hide error.can't hide twice!")},t.prototype._setHidden=function(e){1==e?this.useNative?this._ssoHide():this._innerGameBanner?this._innerGameBanner.setHidden(!0):BK.Script.log(1,1,"hide inner banner failed. handle is undefined"):this.useNative?this._ssoShow():this._innerGameBanner?this._innerGameBanner.setHidden(!1):BK.Script.log(1,1,"hide inner banner failed. handle is undefined"),this.hasShow=!e,this.hasHide=e},t.prototype.destory=function(){this.useNative?this._ssoClose():this._innerGameBanner?this._innerGameBanner.close():BK.Script.log(1,1,"close inner banner failed. handle is undefined")},t.prototype.onError=function(e){this.on("error",e)},t.prototype.offError=function(e){this.off("error",e)},t.prototype.onLoad=function(e){this.on("load",e)},t.prototype.offLoad=function(e){this.off("load",e)},t.prototype.fetch=function(e){this.useNative?this._ssoLoad(e):BK.isBrowser?e(8,r[8]):BK.Advertisement.fetchBannerAd(function(t,i,r){0==t?this._innerGameBanner=r:BK.Script.log(1,1,"fetchBannerAd failed. retCode:"+t+"msg:"+i),e(t,i)}.bind(this))},t.prototype._sendSso=function(e){BK.MQQ.SsoRequest.send(e.reqData,e.reqCmd),e.respCmd&&BK.MQQ.SsoRequest.addListener(e.respCmd,this,function(t,i,r){void 0!==r&&void 0!==r.bannerId&&e.callback&&this.bannerId==r.bannerId&&e.callback(t,r)}.bind(this))},t.prototype._ssoLoad=function(e){var t=1001;this.param.viewId&&(t=this.param.viewId),this._sendSso({reqCmd:this.ssoCMD.LOAD_REQ,reqData:{bannerId:this.bannerId,viewId:t},respCmd:this.ssoCMD.LOAD_RESP,callback:e})},t.prototype._ssoShow=function(){this._sendSso({reqCmd:this.ssoCMD.SHOW_REQ,reqData:{bannerId:this.bannerId,style:this.param.style}})},t.prototype._ssoClose=function(){this._sendSso({reqCmd:this.ssoCMD.CLOSE_REQ,reqData:{bannerId:this.bannerId}})},t.prototype._ssoHide=function(){this._sendSso({reqCmd:this.ssoCMD.HIDE_REQ,reqData:{bannerId:this.bannerId}})},t}(o);e.BannerAd=a,e.createBannerAd=t;var s=function(e){function t(){var t=e.call(this)||this;return t.autoShow=!1,BK.Advertisement.fetchVideoAd(1,function(e,t,i){0==e?(this.emit("load"),i.setEventCallack(function(e,t){this.emit("close_game")}.bind(this),function(e,t){this.emit("play_finish")}.bind(this),function(e,t){0==e?this.emit("video_close"):this.emit("error",{msg:"close error",code:-1})}.bind(this),function(e,t){0==e&&this.emit("play_start")}.bind(this)),this.handle=i,1==this.autoShow&&this.handle.jump()):this.emit("error",{msg:t,code:e})}.bind(t)),t}return n(t,e),t.prototype.show=function(){this.handle?this.handle.jump():this.autoShow=!0},t.prototype.onPlayStart=function(e){this.on("play_start",e)},t.prototype.offPlayStart=function(e){this.off("play_start",e)},t.prototype.onPlayFinish=function(e){this.on("play_finish",e)},t.prototype.offPlayFinish=function(e){this.off("play_finish",e)},t.prototype.onLoad=function(e){this.on("load",e)},t.prototype.offLoad=function(e){this.off("load",e)},t.prototype.onError=function(e){this.on("error",e)},t.prototype.offError=function(e){this.off("error",e)},t.prototype.onClose=function(e){this.on("video_close",e)},t.prototype.offClose=function(e){this.off("video_close",e)},t}(o);e.createVideoAd=i}(r||(r={})),e.exports={createBannerAd:r.createBannerAd,createVideoAd:r.createVideoAd}},"./src/mqq/share/screenshot.ts":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r;!function(e){function t(e){(void 0===e.x||e.x<0||e.x>BK.Director.screenPixelSize.width)&&(e.x=0),(void 0===e.y||e.y<0||e.y>BK.Director.screenPixelSize.height)&&(e.y=0),(void 0===e.width||e.width<=0||e.width>BK.Director.screenPixelSize.width-e.x)&&(e.x=0,e.width=BK.Director.screenPixelSize.width),(void 0===e.height||e.height<=0||e.height>BK.Director.screenPixelSize.height-e.y)&&(e.y=0,e.height=BK.Director.screenPixelSize.height)}function i(e){BK.isBrowser?n(e):r(e)}function r(e){try{if(t(e.range),BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.6.1")){var i=c(BK.Director.root,e.range.x,e.range.y,e.range.width,e.range.height);i?(a(i,e),o(e)):(e.fail&&e.fail({code:-1,msg:"Error: fail to _compacibilityShot! framebuffer failed"}),e.complete&&e.complete())}else{var r=new BK.RenderTexture(BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height);BK.Render.renderToTexture(BK.Director.root,r),r.writeToDiskWithXY(e.path,e.range.x,e.range.y,e.range.width,e.range.height),o(e)}}catch(t){e.fail&&e.fail({code:-1,msg:JSON.stringify(t)}),e.complete&&e.complete()}}function n(e){BK.Notification.on("frame_final",BK.Screenshot.shotGL,function(){try{t(e.range),_=new BK.WebGL,h();var i=new BK.Buffer(e.range.height*e.range.width*4);_.glReadPixels(e.range.x,e.range.y,e.range.width,e.range.height,_.RGBA,_.UNSIGNED_BYTE,i),a(i,e),s(e),o(e)}catch(t){e.fail&&e.fail({code:-1,msg:JSON.stringify(t)}),e.complete&&e.complete()}}.bind(BK.Screenshot.shotGL),!0)}function o(e){BK.FileUtil.isFileExist(e.path)?e.isUpload?BK.Upload.upload({path:e.path,success:function(t){var i=t.code,r=t.url;e.success&&e.success({code:i,path:r}),e.complete&&e.complete()},fail:function(t){var i=t.code,r=t.msg;e.fail&&e.fail({code:i,msg:r}),e.complete&&e.complete()}}):(e.success&&e.success({code:0,path:e.path}),e.complete&&e.complete()):(e.fail&&e.fail({code:-1,msg:"Error: fail to shot, no such file or directory "+e.path}),e.complete&&e.complete())}function a(e,t){var i=t.path,r=t.range;BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.6.1")&&(e=l({buffer:e,width:r.width,height:r.height}));var n=i.substr(0,i.lastIndexOf(".")),o=i.substr(i.lastIndexOf(".")+1);BK.Image.saveImage(e,r.width,r.height,n,o)}function s(e){var t=e.path,i=e.range,r=new BK.Canvas(i.width,i.height);r.scales(1,-1),r.drawImage(t,0,0,i.width,i.height,0,-i.height,i.width,i.height),r.saveTo(t),r.dispose()}function h(){_.DEPTH_BUFFER_BIT=256,_.STENCIL_BUFFER_BIT=1024,_.COLOR_BUFFER_BIT=16384,_.TRIANGLES=4,_.TEXTURE_BINDING_2D=32873,_.ARRAY_BUFFER=34962,_.ARRAY_BUFFER_BINDING=34964,_.ELEMENT_ARRAY_BUFFER=34963,_.ELEMENT_ARRAY_BUFFER_BINDING=34965,_.STATIC_DRAW=35044,_.UNSIGNED_BYTE=5121,_.UNSIGNED_SHORT=5123,_.FLOAT=5126,_.RGBA=6408,_.FRAGMENT_SHADER=35632,_.VERTEX_SHADER=35633,_.LINK_STATUS=35714,_.CURRENT_PROGRAM=35725,_.NEAREST=9728,_.LINEAR=9729,_.TEXTURE_MAG_FILTER=10240,_.TEXTURE_MIN_FILTER=10241,_.TEXTURE_WRAP_S=10242,_.TEXTURE_WRAP_T=10243,_.TEXTURE_2D=3553,_.TEXTURE0=33984,_.TEXTURE1=33985,_.ACTIVE_TEXTURE=34016,_.REPEAT=10497,_.CLAMP_TO_EDGE=33071,_.MIRRORED_REPEAT=33648,_.FRAMEBUFFER=36160,_.RENDERBUFFER=36161,_.COLOR_ATTACHMENT0=36064,_.DEPTH_ATTACHMENT=36096,_.STENCIL_ATTACHMENT=36128,_.NONE=0,_.FRAMEBUFFER_COMPLETE=36053,_.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,_.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,_.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,_.FRAMEBUFFER_UNSUPPORTED=36061,_.FRAMEBUFFER_BINDING=36006,_.RENDERBUFFER_BINDING=36007,_.INVALID_FRAMEBUFFER_OPERATION=1286}function c(e,t,i,r,n){var o=_.glCreateTexture();_.glActiveTexture(_.TEXTURE1),_.glBindTexture(_.TEXTURE_2D,o),_.glTexParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.LINEAR),_.glTexParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.LINEAR),_.glTexParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.glTexParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.glTexImage2D(_.TEXTURE_2D,0,_.RGBA,BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height,0,_.RGBA,_.UNSIGNED_BYTE,new Int8Array(0));var a=_.glGetParameterInt(_.FRAMEBUFFER_BINDING,1),s=_.glGetParameterInt(_.RENDERBUFFER_BINDING,1),h=_.glCreateRenderbuffer();_.glBindRenderbuffer(_.RENDERBUFFER,h),_.glRenderbufferStorage(_.RENDERBUFFER,35056,BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height),_.glBindRenderbuffer(_.RENDERBUFFER,s);var c=_.glCreateFramebuffer();_.glBindFramebuffer(_.FRAMEBUFFER,c),_.glFramebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_2D,o,0),_.glFramebufferRenderbuffer(_.FRAMEBUFFER,_.DEPTH_ATTACHMENT,_.RENDERBUFFER,h),_.glFramebufferRenderbuffer(_.FRAMEBUFFER,_.STENCIL_ATTACHMENT,_.RENDERBUFFER,h);var l,u=_.glCheckFramebufferStatus(_.FRAMEBUFFER);return u==_.FRAMEBUFFER_COMPLETE?(BK.Render.render(e,0),l=new BK.Buffer(r*n*4),_.glReadPixels(t,i,r,n,_.RGBA,_.UNSIGNED_BYTE,l)):BK.Console.log("Error: _compacibilityShot! framebuffer failed, code = "+u),_.glBindFramebuffer(_.FRAMEBUFFER,a),_.glDeleteTexture(o),_.glDeleteRenderbuffer(h),_.glDeleteFramebuffer(c),l}function l(e){var t=u();_.glUseProgram(t);var i=_.glGetAttribLocation(t,"pos"),r=_.glGetAttribLocation(t,"inUVs"),n=_.glGetUniformLocation(t,"uSampler");_.glActiveTexture(_.TEXTURE0);var o=_.glCreateTexture(),a=_.glGetParameterInt(_.TEXTURE_BINDING_2D,1);_.glBindTexture(_.TEXTURE_2D,o),_.glTexParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.LINEAR),_.glTexParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.LINEAR),_.glTexParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.glTexParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.glTexImage2D(_.TEXTURE_2D,0,_.RGBA,_.RGBA,_.UNSIGNED_BYTE,e.buffer),_.glUniform1i(n,0);var s=_.glGetParameterInt(_.ARRAY_BUFFER_BINDING,1),h=_.glGetParameterInt(_.ELEMENT_ARRAY_BUFFER_BINDING,1),c=new Float32Array([-1,-1,0,1,1,-1,1,1,1,1,1,0,-1,1,0,0]),l=_.glCreateBuffer();_.glBindBuffer(_.ARRAY_BUFFER,l),_.glEnableVertexAttribArray(i),_.glVertexAttribPointer(i,2,_.FLOAT,!1,16,0),_.glVertexAttribPointer(r,2,_.FLOAT,!1,16,8),_.glBufferData(_.ARRAY_BUFFER,BK.Misc.typedArrayToBKBuffer(c),_.STATIC_DRAW);var f=new Uint16Array([0,1,2,0,2,3]),g=_.glCreateBuffer();_.glBindBuffer(_.ELEMENT_ARRAY_BUFFER,g),_.glBufferData(_.ELEMENT_ARRAY_BUFFER,BK.Misc.typedArrayToBKBuffer(f),_.STATIC_DRAW);var p=new BK.Buffer(e.width*e.height*4),m=_.glGetParameterInt(_.FRAMEBUFFER_BINDING,1),v=d(e.width,e.height);_.glClearColor(1,1,1,1),_.glClear(_.COLOR_BUFFER_BIT|_.DEPTH_BUFFER_BIT|_.STENCIL_BUFFER_BIT),_.glDrawElements(_.TRIANGLES,6,_.UNSIGNED_SHORT,0),_.glReadPixels(0,0,e.width,e.height,_.RGBA,_.UNSIGNED_BYTE,p),_.glBindFramebuffer(_.FRAMEBUFFER,m);for(var S=0,b=0,T=0,B=0,E=1;E<=10;E++)if(_.glUseProgram(E),b=_.glGetAttribLocation(E,"Position"),T=_.glGetAttribLocation(E,"SourceColor"),B=_.glGetAttribLocation(E,"TexCoordIn"),-1!=b&&-1!=T&&-1!=B){S=1;break}return _.glBindBuffer(_.ARRAY_BUFFER,s),1==S?(_.glEnableVertexAttribArray(b),_.glEnableVertexAttribArray(T),_.glEnableVertexAttribArray(B),_.glVertexAttribPointer(b,3,_.FLOAT,!1,36,0),_.glVertexAttribPointer(T,4,_.FLOAT,!1,36,12),_.glVertexAttribPointer(B,2,_.FLOAT,!1,36,28)):(_.glEnableVertexAttribArray(0),_.glEnableVertexAttribArray(1),_.glEnableVertexAttribArray(2),_.glVertexAttribPointer(0,3,_.FLOAT,!1,36,0),_.glVertexAttribPointer(1,4,_.FLOAT,!1,36,12),_.glVertexAttribPointer(2,2,_.FLOAT,!1,36,28)),_.glBindBuffer(_.ELEMENT_ARRAY_BUFFER,h),_.glActiveTexture(_.TEXTURE0),_.glBindTexture(_.TEXTURE_2D,a),_.glDeleteProgram(t),_.glDeleteTexture(o),_.glDeleteTexture(v.tex),_.glDeleteFramebuffer(v.fbo),p}function u(){var e=_.glCreateShader(_.VERTEX_SHADER);0!=e&&(_.glShaderSource(e,"attribute vec2 pos; attribute vec2 inUVs; varying lowp vec2 outUVs; void main() { gl_Position = vec4(pos, 0, 1); outUVs = inUVs; }"),_.glCompileShader(e));var t=_.glCreateShader(_.FRAGMENT_SHADER);0!=t&&(_.glShaderSource(t,"varying lowp vec2 outUVs; uniform sampler2D uSampler; void main() { gl_FragColor = texture2D(uSampler, outUVs); }"),_.glCompileShader(t));var i=_.glCreateProgram();return _.glAttachShader(i,e),_.glAttachShader(i,t),_.glLinkProgram(i),_.glDeleteShader(e),_.glDeleteShader(t),i}function d(e,t){_.glActiveTexture(_.TEXTURE1);var i=_.glCreateTexture(),r=_.glGetParameterInt(_.TEXTURE_BINDING_2D,1);_.glBindTexture(_.TEXTURE_2D,i),_.glTexParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.LINEAR),_.glTexParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.LINEAR),_.glTexParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.glTexParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.glTexImage2D(_.TEXTURE_2D,0,_.RGBA,e,t,0,_.RGBA,_.UNSIGNED_BYTE,new Int8Array(0));var n=_.glCreateFramebuffer();_.glBindFramebuffer(_.FRAMEBUFFER,n),_.glFramebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_2D,i,0);var o=_.glCheckFramebufferStatus(_.FRAMEBUFFER);return o!=_.FRAMEBUFFER_COMPLETE&&BK.Console.log("Error: _createFramebuffer! failed, status = "+o),_.glActiveTexture(_.TEXTURE1),_.glBindTexture(_.TEXTURE_2D,r),{tex:i,fbo:n}}var _;e.shot=i,e.shotBK=r,e.shotGL=n}(r=t.Screenshot||(t.Screenshot={})),e.exports=r},"./src/mqq/share/share.ts":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r;!function(e){function t(e){try{var t="cs.share_game_result.local",i={cmd:t,from:GameStatusInfo.platform,roomId:GameStatusInfo.roomId,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,gameVersion:GameStatusInfo.gameVersion,title:e.title?e.title:"\u8f7b\u6e38\u620f",summary:e.summary?e.summary:"\u4e00\u8d77\u6765\u73a9\u6e38\u620f\u5427~",picUrl:e.qqImgUrl?e.qqImgUrl:h({title:e.title?e.title:"\u8f7b\u6e38\u620f",subTitle:e.summary?e.summary:"\u4e00\u8d77\u6765\u73a9\u6e38\u620f\u5427~"}),detailUrl:e.msgUrl?e.msgUrl:""};BK.SsoRequest.request({reqCmd:t,data:i})}catch(t){e.fail&&e.fail({code:-1,msg:JSON.stringify(t)}),e.complete&&e.complete()}}function i(e){try{e.range?BK.Screenshot.shot({path:"GameSandBox://screenshot.png",range:e.range,isUpload:!0,success:function(t){BK.Share.share({qqImgUrl:t.path,socialPicPath:"GameSandBox://screenshot.png",title:e.title?e.title:"\u8f7b\u6e38\u620f",summary:e.summary?e.summary:"\u4e00\u8d77\u6765\u73a9\u6e38\u620f\u5427~",extendInfo:e.extendInfo?e.extendInfo:"",success:function(t){e.success&&e.success(t),e.complete&&e.complete()},fail:function(t){e.fail&&e.fail(t),e.complete&&e.complete()}})},fail:function(t){e.fail&&e.fail(t),e.complete&&e.complete()}}):(e.fail&&e.fail({code:-1,msg:"fail to shot, need range"}),e.complete&&e.complete())}catch(t){e.fail&&e.fail({code:-1,msg:JSON.stringify(t)}),e.complete&&e.complete()}}function r(e){e.msgUrl?t(e):e.range&&!BK.isBrowser?i(e):void 0!==e.isToFriend?o(e):BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.6.3")?o(e):n(e)}function n(e){try{var t="cs.game_shell_share_callback.local",i=e.success&&e.fail?"sc.share_game_to_friend_result.local":t;a({gameName:e.title?e.title:"\u8f7b\u6e38\u620f",summary:e.summary?e.summary:"\u4e00\u8d77\u6765\u73a9\u6e38\u620f\u5427~",extendInfo:e.extendInfo?e.extendInfo:"",localPicPath:e.socialPicPath?e.socialPicPath:h({title:e.title?e.title:"\u8f7b\u6e38\u620f",subTitle:e.summary?e.summary:"\u4e00\u8d77\u6765\u73a9\u6e38\u620f\u5427~"}),picUrl:e.qqImgUrl,activityId:0,reqCode:1,inner:1},t,i,e)}catch(t){e.fail&&e.fail({code:-1,msg:JSON.stringify(t)}),e.complete&&e.complete()}}function o(e){try{var t="cs.share_game_in_ark.local",i=e.success?"sc.share_game_to_friend_result.local":t;BK.isBrowser&&"android"===GameStatusInfo.platform&&0===GameStatusInfo.QQVer.indexOf("7.6.0")&&(t="cs.game_shell_share_callback.local"),a({cmd:t,gameId:GameStatusInfo.gameId,roomId:GameStatusInfo.roomId,gameMode:GameStatusInfo.gameMode,isSelectFriend:e.isToFriend?1:0,summary:e.summary?e.summary:"\u4e00\u8d77\u6765\u73a9\u6e38\u620f\u5427~",extendInfo:e.extendInfo?e.extendInfo:"",picUrl:e.qqImgUrl},t,i,e)}catch(t){e.fail&&e.fail({code:-1,msg:JSON.stringify(t)}),e.complete&&e.complete()}}function a(e,t,i,r){BK.SsoRequest.request({data:e,reqCmd:t,respCmd:i,success:function(e){var t=e.code,i=(e.cmd,e.data);r.success&&(s(0===t?0:1),r.success({code:t,data:i}))},fail:function(e){var t=e.code,i=(e.cmd,e.data);r.fail&&(s(0===t?0:1),r.fail({code:t,msg:i}))},complete:function(){r.complete&&r.complete()}})}function s(e){var t=e.toString();BK.QQ.uploadData("clickShowOffButton","",t,"","","")}function h(e){if(BK.FileUtil.isFileExist("GameSandBox://compose.png"))return"GameSandBox://compose.png";var t=BK.Image.loadImage("GameRes://inviteIcon.png");if(t){var i=t.height,r=t.width;if(Math.abs(i/r-304/540)<.01)return c(e)}return""}function c(e){var t=e.title,i=e.subTitle,r=new BK.Canvas(750,750);if(r.fillColor={r:1,g:1,b:1,a:1},r.fillRect(0,0,750,750),BK.FileUtil.isFileExist("GameRes://share_logo.png")){r.drawImage("GameRes://share_logo.png",0,0,125,28,32,32,126,27)}if(BK.FileUtil.isFileExist("GameRes://inviteIcon.png")){var n=BK.Image.loadImage("GameRes://inviteIcon.png");n&&r.drawImage("GameRes://inviteIcon.png",0,0,n.width,n.height,0,330,750,420)}r.fillColor={r:0,g:0,b:0,a:1},r.drawStyle=0,r.setTextAlign(1),r.setTextSize(40),r.textBaseLine="bottom",r.textAlign="left",r.fillText(t,35,258);r.fillColor={r:137/255,g:137/255,b:137/255,a:.5},r.drawStyle=0,r.setTextAlign(1),r.setTextSize(30),r.textBaseLine="bottom",r.textAlign="left",r.fillText(i,35,215);r.fillColor={r:1,g:1,b:1,a:1};var o="http://cmshow.qq.com/apollo/html/game-platform/scan-game.html?gameId="+GameStatusInfo.gameId.toString()+"&src=203";BK.QRCode.makeQRCodeToFileSync({path:"GameSandBox://qrcode.png",content:o,config:{width:256,height:256,colorDark:{r:0,g:0,b:0,a:1},colorLight:{r:1,g:1,b:1,a:1},correctLevel:2}}),r.drawImage("GameSandBox://qrcode.png",0,0,256,256,600,64,120,120);return r.fillColor={r:0,g:0,b:0,a:1},r.drawStyle=0,r.setTextAlign(1),r.setTextSize(19),r.textBaseLine="bottom",r.textAlign="left",r.fillText("\u957f\u6309\u626b\u7801\u5373\u73a9",600,28),r.saveTo("GameSandBox://compose.png"),r.dispose(),"GameSandBox://compose.png"}e.shareLink=t,e.shareShot=i,e.share=r}(r=t.Share||(t.Share={})),e.exports=r},"./src/mqq/share/upload.ts":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r;!function(e){function t(e){try{i(e.path,function(t,i){i&&i.length>0?r(function(t,r){0===t&&r?n(i,r,e):(e.fail&&e.fail({code:-1,msg:"fail to fetch signature"}),e.complete&&e.complete())}):(e.fail&&e.fail({code:-1,msg:"fail to get file data  "+e.path}),e.complete&&e.complete())})}catch(t){e.fail&&e.fail({code:-1,msg:JSON.stringify(t)}),e.complete&&e.complete()}}function i(e,t){if(BK.isBrowser){var i="cs.get_file_data.local",r={cmd:i,path:e};t&&BK.SsoRequest.request({data:r,reqCmd:i,respCmd:i,success:function(e){e.code,e.cmd;var i=s(e.data);t(0,i)},fail:function(e){e.code,e.cmd,e.data;t(-1)},complete:function(){}})}else{var n=BK.FileUtil.readFile(e);t(0,n)}}function r(e){var t="cs.fetch_cloud_signature.local",i={cmd:t,now:(new Date).getTime()/1e3-1,delta:600};e&&BK.SsoRequest.request({data:i,reqCmd:t,respCmd:t,success:function(t){var i=t.code,r=(t.cmd,t.data);e(i,r)},fail:function(t){var i=t.code,r=(t.cmd,t.data);e(i,r)},complete:function(){}})}function n(e,t,i){for(var r=e.length>1024?1024:e.length,n=new Uint8Array(r),s=0;s<r/2;s++)n[s]=e.readUint8Buffer();e.jumpBytes(e.length-r);for(s=r/2;s<r;s++)n[s]=e.readUint8Buffer();e.rewind();var h=new Date,c=h.getFullYear().toString()+(h.getMonth()+1<10?"0"+(h.getMonth()+1):""+h.getMonth()+1)+(h.getDate()<10?"0"+h.getDate():""+h.getDate())+(h.getHours()<10?"0"+h.getHours():""+h.getHours())+(h.getMinutes()<10?"0"+h.getMinutes():""+h.getMinutes()),l=t.signTime,u=t.tmpSecretId,d=t.sessionToken,_="/"+GameStatusInfo.gameId+"_"+BK.Crypt.md5ToHexSync({data:a(n)})+"_"+c+".png",f=t.upLoadPrefUrl.replace(new RegExp("http://","gm"),""),g=t.downloadUrl,p=t.signature,m="put\n"+_+"\n\nhost="+f+"&x-cos-storage-class=nearline\n",v="sha1\n"+l+"\n"+BK.Crypt.sha1ToHexSync({data:m})+"\n",S="q-sign-algorithm=sha1&q-ak="+u+"&q-sign-time="+l+"&q-key-time="+l+"&q-header-list=host;x-cos-storage-class&q-url-param-list=&q-signature="+BK.Crypt.hmacSha1ToHexSync({key:p,data:v}),b=new BK.HttpUtil("https://"+f+_,"put");b.setHttpHeader("host",f),b.setHttpHeader("x-cos-storage-class","nearline"),b.setHttpHeader("x-cos-security-token",d),b.setHttpHeader("authorization",S),b.setHttpRawBody(e),b.requestAsync(function(e,t){o(t,g+_,i)})}function o(e,t,i){200===e?(i.success&&i.success({code:0,url:t}),i.complete&&i.complete()):(i.fail&&i.fail({code:-1,msg:"fail to upload"}),i.complete&&i.complete())}function a(e){for(var t=[],i=0;i<e.byteLength;i++)t[i]=e[i];return t}function s(e){var t,i,r,n,o,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=.75*e.length,h=e.length,c=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var l=new ArrayBuffer(s),u=new Uint8Array(l);for(t=0;t<h;t+=4)i=a.indexOf(e[t]),r=a.indexOf(e[t+1]),n=a.indexOf(e[t+2]),o=a.indexOf(e[t+3]),u[c++]=i<<2|r>>4,u[c++]=(15&r)<<4|n>>2,u[c++]=(3&n)<<6|63&o;return u}e.upload=t}(r=t.Upload||(t.Upload={})),e.exports=r},"./src/mqq/sso/sso.ts":function(e,t,i){"use strict";var r=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.seqId=1,t.setCallback(),t}return r(t,e),t.prototype.request=function(e){var t=this;e.respCmd=e.respCmd?e.respCmd:e.reqCmd,null!=e.isListener&&void 0!=e.isListener||(e.isListener=!0);var i=e.reqCmd,r=e.respCmd,n=e.data,o=e.isListener,a=e.success,s=e.fail,h=e.complete;if(!i&&!r)throw new Error("Sso request cmd is required");if(o){var c=this.getEvent(r,n),l=function(e){0==e.code?(a&&a({code:e.code,cmd:e.cmd,data:e.data}),h&&h()):(s&&s({code:e.code,cmd:e.cmd,data:e.data}),h&&h())};return this.once(c,l),this.send(i,n),{abort:function(){t.off(c,l)}}}return this.send(i,n),null},t.prototype.send=function(e,t){BK.isBrowser?__browserMsg.send(JSON.stringify(t),e):BK.MQQ.SsoRequest.send(t,e)},t.prototype.getEvent=function(e,t){return t&&0==e.indexOf("apollo")?(t.seqId=this.seqId++,JSON.stringify({cmd:e,seqId:t.seqId})):e},t.prototype.setCallback=function(){var e=this,t=BK.MQQ.SsoRequest.callback;BK.MQQ.SsoRequest.callback=function(i,r,n){e.dispatchEvent(i,r,n),t(i,r,n)};var i=__dispatchEvent;__dispatchEvent=function(t,r,n){e.dispatchEvent(t,r,n),i(t,r,n)}},t.prototype.dispatchEvent=function(e,t,i){i?"number"==typeof i.seqId?this.emit(JSON.stringify({cmd:t,seqId:i.seqId}),{code:e,cmd:t,data:i}):this.emit(t,{code:e,cmd:t,data:i}):this.emit(t,{code:e,cmd:t,null:null})},t}(i("./src/common/emitter.ts"));t.SsoRequest=n,e.exports=new n},"./src/net/http.ts":function(e,t,i){"use strict";function r(e){var t=e.url,i=e.method,r=e.headers,s=e.body,h=e.success,c=e.fail,l=e.complete,u=e.uploadProgress,d=e.downloadProgress;if(!t)throw new Error("HTTP request url is required");var _=new n(t,i);if(s&&_.setHttpRawBody("string"==typeof s?s:o.arrayBufferToBKBuffer(s)),r)for(var f in r)_.setHttpHeader(f,r[f]);_.setHttpUploadProgressListener(u),_.setHttpDownloadProgressListener(d),h||c||l||BK.Script.log(0,1,"[WARNING] send HTTP request without any callback"),_.sendRequest(function(e,t,i){e<0?(c&&c({msg:i.readAsString(!0)}),l&&l()):(h&&h(new a(e,t,i)),l&&l())})}Object.defineProperty(t,"__esModule",{value:!0});var n=i("./src/deprecate/http-util.ts"),o=i("./src/util/buffer.js"),a=function(){function e(e,t,i){this.statusCode=e,this.headers=t,this._body=i}return e.prototype.text=function(){var e=this._body.readAsString(!0);return void 0===e?"":e},e.prototype.jsonObject=function(){var e=this._body.readAsString(!0);return e?JSON.parse(e):null},e.prototype.arrayBuffer=function(){return o.BKBufferToArrayBuffer(this._body)},e}();t.request=r},"./src/net/transparent-webview.ts":function(e,t,i){"use strict";function r(e){return new n(e)}var n=function(){function e(e){this.taskId=-1,this.opt=e}return e.prototype._requestOpen=function(e){if(!e||!e.url)throw Error("Url is null or undefined!");var t=1;e.transparent,t=e.transparent&&1==e.transparent?1:0;var i=1;e.orientation&&(i=e.orientation);var r={gameOrientation:i,openId:GameStatusInfo.openId,transparent:t,businessType:2,url:e.url};BK.SsoRequest.request({data:r,reqCmd:"cs.openWebViewWithoutUrl.local",success:function(e){BK.Console.log("requestOpen! success ",e.code,e.cmd,JSON.stringify(e.data)),this.taskId=e.data.taskId}.bind(this),fail:function(e){var t=e.code,i=e.cmd,r=e.data;BK.Console.log("requestOpen! fail",t,i,JSON.stringify(r))},complete:function(){BK.Console.log("requestOpen! complete")}})},e.prototype._prepareReceive=function(){var e=void 0;e="ios"==GameStatusInfo.platform?"sc.catchPeopleWebMessage.local":"sc.apolloGameWebMessage.local",BK.SsoRequest.on(e,function(e){this.receiveCallback&&this.receiveCallback(e.code,e.data)}.bind(this))},e.prototype.onReceiveMsg=function(e){this.receiveCallback=e},e.prototype.send=function(e){e.taskId=this.taskId;BK.SsoRequest.request({data:e,reqCmd:"cs.apolloGameTargetWebMessage.local",success:function(e){BK.Console.log("send! success ",e.code,e.cmd,JSON.stringify(e.data))}.bind(this),fail:function(e){var t=e.code,i=e.cmd,r=e.data;BK.Console.log("send! fail",t,i,JSON.stringify(r))},complete:function(){BK.Console.log("send! complete")}})},e.prototype.open=function(){this._requestOpen(this.opt),this._prepareReceive()},e.prototype.close=function(){var e={taskId:this.taskId};BK.SsoRequest.request({data:e,reqCmd:"cs.closeWebViewWithoutUrl.local",success:function(e){BK.Console.log("close! success ",e.code,e.cmd,JSON.stringify(e.data))}.bind(this),fail:function(e){var t=e.code,i=e.cmd,r=e.data;BK.Console.log("close! fail",t,i,JSON.stringify(r))},complete:function(){BK.Console.log("send! complete")}})},e}();e.exports=r},"./src/render/animationSprite.ts":function(e,t,i){"use strict";var r=function(){function e(e){this.paused=!1,this.delayUnits=1/30,this.tmpPlayingIdx=0,this.previousTs=-1,this.playedCount=0,this.currDisplayIdx=0,this.currTexturePath="",this.currDisplaySum=0,this.repeatCount=0,this.stoped=!1,this.size={width:0,height:0},this.readyTextureInfo(e),this.onInit(this.size.width,this.size.height),this.displayFrame(0),this.paused=!0,BK.Director.ticker.add(function(e,t,i){i.update(e,t)},this)}return e.prototype.readyTextureInfo=function(e){var t=this;this.textureInfoArr=[],e.forEach(function(e){e.texturePath&&(e.texture=new BK.Texture(e.texturePath),t.textureInfoArr.push(e),t.size={width:e.frameInfo.sourceSize.w,height:e.frameInfo.sourceSize.h})})},e.prototype.onInit=function(e,t){this.createSprites(e,t);var i=this;Object.getOwnPropertyNames(this.__nativeObj).forEach(function(e){var t=e;Object.defineProperty(i,t,{get:function(){return this.__nativeObj[t]},set:function(e){this.__nativeObj[t]=e}})},this),Object.defineProperty(this,"size",{get:function(){return this.__nativeObj.contentSize},set:function(e){this.__nativeObj.contentSize=e,this.displayFrame(this.currDisplayIdx)}}),Object.defineProperty(this,"anchor",{get:function(){return this.__nativeObj.localAnchor},set:function(e){this.__nativeObj.localAnchor=e,this.displayFrame(this.currDisplayIdx)}})},e.prototype.setTexture=function(e){this.__nativeObj.setTexture(e)},e.prototype.dispose=function(){BK.Director.ticker.remove(this),this.__nativeObj.dispose()},e.prototype.removeChild=function(e){return this.__nativeObj.removeChild(e)},e.prototype.removeChildById=function(e,t){return this.__nativeObj.removeChildById(e,t)},e.prototype.removeChildByName=function(e,t){return this.__nativeObj.removeChildByName(e,t)},e.prototype.removeFromParent=function(){return this.__nativeObj.removeFromParent()},e.prototype.addChild=function(e,t){return this.__nativeObj.addChild(e,t)},e.prototype.hittest=function(e){return this.__nativeObj.hittest(e)},e.prototype.convertToWorldSpace=function(e){return this.__nativeObj.convertToWorldSpace(e)},e.prototype.convertToNodeSpace=function(e){return this.__nativeObj.convertToNodeSpace(e)},e.prototype.createSprites=function(e,t){this.__nativeObj=new BK.SpriteNode(e,t,{},0,1,1,1),this.contentSprite=new BK.SpriteNode(e,t,{},0,1,1,1),this.__nativeObj.addChild(this.contentSprite)},e.prototype.displayFrame=function(e){if(this.textureInfoArr.length>0){var t=this.textureInfoArr[e];if(t){this.currDisplayIdx=e;var i=t.texture,r=t.frameInfo;if(1==t.frameInfo.trimmed){var n=t.frameInfo.spriteSourceSize.x,o=t.frameInfo.spriteSourceSize.y,a=t.frameInfo.spriteSourceSize.w,s=t.frameInfo.spriteSourceSize.h,h=t.frameInfo.sourceSize,c=this.__nativeObj.contentSize;n=c.width*n/h.w,o=c.height*o/h.h,a=c.width*a/h.w,s=c.height*s/h.h,this.contentSprite.position={x:n,y:o},this.contentSprite.contentSize={width:a,height:s}}else this.contentSprite.contentSize=this.__nativeObj.contentSize;this.currTexturePath&&this.currTexturePath==t.texturePath||(BK.Script.log(1,-1,"this.currTexture != tex"),this.currTexturePath=t.texturePath,this.contentSprite.setTexture(i)),this.contentSprite.adjustTexturePosition(r.frame.x,r.frame.y,r.frame.w,r.frame.h,r.rotated)}else BK.Script.log(1,-1,"displayFrame failed! textureInfo is null. index is "+e)}else BK.Script.log(1,-1,"displayFrame failed! textureInfoArr.length is 0")},e.prototype.render=function(){this.tmpPlayingIdx>this.textureInfoArr.length-1&&(this.tmpPlayingIdx=0),this.displayFrame(this.tmpPlayingIdx),this.tmpPlayingIdx++,this.currDisplaySum++,this.updateCallback()},e.prototype.update=function(e,t){0==this.paused&&(this.previousTs<0?(this.previousTs=e,this.render()):e-this.previousTs>1e3*this.delayUnits&&(this.previousTs=e,this.render()))},e.prototype.doPlay=function(e,t){void 0===e&&(e=0),void 0===t&&(t=-1),e>this.textureInfoArr.length-1?this.tmpPlayingIdx=0:this.tmpPlayingIdx=e,this.paused=!1,this.repeatCount=t,this.currDisplaySum=0,this.playedCount=0},e.prototype.doStop=function(e){this.stoped=!0,void 0===e&&(e=-1),this.paused=!0,e>-1&&this.displayFrame(e)},e.prototype.updateCallback=function(){var e=this.textureInfoArr.length;this.currDisplaySum%e==0&&(this.playedCount=parseInt(String(this.currDisplaySum/e)),this.completeCallback&&this.completeCallback(this,this.playedCount),this.repeatCount>0&&this.repeatCount<=this.playedCount&&(this.endCallback&&this.endCallback(this,this.playedCount),this.stop()))},e.prototype.setCompleteCallback=function(e){this.completeCallback=function(t,i){e({animationSprite:t,count:i})}},e.prototype.setEndCallback=function(e){this.endCallback=function(t,i){e({animationSprite:t,count:i})}},e.prototype.play=function(e){e?this.doPlay(e.beginFrameIndex,e.repeatCount):this.doPlay()},e.prototype.stop=function(e){this.doStop(e)},e.prototype.setPosition=function(e){if(!e)throw new Error("position can not be undefined!");if("number"!=typeof e.x)throw new Error("position.x must be a number!");if("number"!=typeof e.y)throw new Error("position.y must be a number!");this.position=e},e.prototype.setSize=function(e){if(!e)throw new Error("size can not be undefined!");if("number"!=typeof e.width)throw new Error("size.width must be a number!");if("number"!=typeof e.height)throw new Error("size.height must be a number!");this.size=e},e.prototype.setAnchor=function(e){if(!e)throw new Error("anchor can not be undefined!");if("number"!=typeof e.x)throw new Error("anchor.x must be a number!");if("number"!=typeof e.y)throw new Error("anchor.y must be a number!");this.anchor=e},e.prototype.setFrameDuration=function(e){if("number"!=typeof e)throw new Error("duration must be a number!");this.delayUnits=e},e.prototype.pause=function(){this.paused=!0},e.prototype.resume=function(){this.stoped?BK.Script.log(1,1,"animationSprite is stopped,can't continue!"):this.paused=!1},e}();e.exports=r},"./src/render/image.ts":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i("./src/util/buffer.js");BK.ImageNativeClass=BK.Image;var n=function(){function e(){}return e.dispose=function(e){return BK.ImageNativeClass.dispose(e)},e.saveImage=function(e,t,i,n,o,a){return e instanceof ArrayBuffer?e=r.arrayBufferToBKBuffer(e):e instanceof Object&&void 0===t&&(t=e.width,i=e.height,n=e.path,o=e.ext,a=e.isFlipY?e.isFlipY:0),BK.ImageNativeClass.saveImage(e,t,i,n,o,a)},e.loadImageWithBase64=function(e){if(!e)return BK.Script.log(1,0,"buffer is empty"),null;if(e.buffer&&(e=e.buffer),e instanceof ArrayBuffer&&(e=r.arrayBufferToBKBuffer(e)),e.readAsString&&(e=e.readAsString()),e){var t=e.indexOf("data:image"),i=e.indexOf("base64,");0==t&&i>0&&(e=e.substring(i+"base64,".length,e.length-1)),BK.Script.log(1,1,"loadImageWithBase64 "+e);var n=BK.Misc.decodeBase64FromString(e);return BK.ImageNativeClass.loadImage(n)}return null},e.loadImage=function(e,t){if(e)return e.image&&(t=e.format?e.format:void 0),e instanceof ArrayBuffer&&(e=r.arrayBufferToBKBuffer(e)),t?BK.ImageNativeClass.loadImage(e,t):BK.ImageNativeClass.loadImage(e);BK.Script.log(1,1,"BK.Image.loadImage failed! ")},e.loadImages=function(e){if(!e)return BK.Script.log(1,1,"object.file is null"),e.fail&&e.fail({errmsg:"object.file is null"}),void(e.complete&&e.complete());if(0==BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.8.0"))if(e&&e.file){for(var t=new Array,i=0;i<e.file.length;i++)e.file[i].path&&t.push({tag:3,path:e.file[i].path,format:e.file[i].format?e.file[i].format:6});var r=BK.ImageNativeClass.loadImageAsync(t);BK.taskManager.pushTask(r,t,function(t){e.success&&e.success(t),e.complete&&e.complete()})}else e.fail&&e.fail({errmsg:"object.file is null"}),e.complete&&e.complete();else{var n=[];if(e&&e.file)for(i=0;i<e.file.length;i++){var o=e.file[i];if(o.path){var a=BK.ImageNativeClass.loadImage(o.path,e.file[i].format?e.file[i].format:6);n.push({errcode:a?0:-1,errmsg:a?"":"load image failed!",path:o.path,image:a})}}e.success&&e.success(n),e.complete&&e.complete()}},e}();e.exports=n},"./src/render/spriteNine.ts":function(e,t,i){"use strict";var r=function(){function e(e){if(!e)throw Error("initParam can not be undefined!");if(!e.texture)throw Error("initParam.texture can not be undefined!");var t=e.textureWidth,i=e.textureHeight,r=e.texture,n=e.grid,o=e.offset,a=e.rotated;this._size={width:0,height:0},this.__nativeObj=new BK.Node,this.onInit(),i||(i=r.size.height),t||(t=r.size.width),n?this._grid=n:(this._grid={left:0,top:0,right:0,bottom:0},n=this._grid),o||(o={x:0,y:0}),this._size={width:i,height:i},this._leftTop=new BK.Sprite(n.left,n.top,r,0,1,1,1),this._leftTop.position={x:0,y:i-n.top},this._leftTop.zOrder=99999,this._leftTop.name="_leftTop",this.__nativeObj.addChild(this._leftTop),this._centerTop=new BK.Sprite(t-n.left-n.right,n.top,r,0,1,1,1),this._centerTop.position={x:n.left,y:i-n.top},this._centerTop.zOrder=99999,this._centerTop.name="_centerTop",this.__nativeObj.addChild(this._centerTop),this._rightTop=new BK.Sprite(n.right,n.top,r,0,1,1,1),this._rightTop.position={x:t-n.right,y:i-n.top},this._rightTop.zOrder=99999,this._rightTop.name="_rightTop",this.__nativeObj.addChild(this._rightTop),this._leftCenter=new BK.Sprite(n.left,i-n.top-n.bottom,r,0,1,1,1),this._leftCenter.position={x:0,y:n.bottom},this._leftCenter.name="_leftCenter",this.__nativeObj.addChild(this._leftCenter),this._centerCenter=new BK.Sprite(t-n.left-n.right,i-n.top-n.bottom,r,0,1,1,1),this._centerCenter.position={x:n.left,y:n.bottom},this._centerCenter.name="_centerCenter",this.__nativeObj.addChild(this._centerCenter),this._rightCenter=new BK.Sprite(n.right,i-n.bottom-n.top,r,0,1,1,1),this._rightCenter.position={x:t-n.right,y:n.bottom},this._rightCenter.name="_rightCenter",this.__nativeObj.addChild(this._rightCenter),this._leftBottom=new BK.Sprite(n.left,n.bottom,r,0,1,1,1),this._leftBottom.position={x:0,y:0},this._leftBottom.name="_leftBottom",this.__nativeObj.addChild(this._leftBottom),this._centerBottom=new BK.Sprite(t-n.left-n.right,n.bottom,r,0,1,1,1),this._centerBottom.position={x:n.left,y:0},this._centerBottom.name="_centerBottom",this.__nativeObj.addChild(this._centerBottom),this._rightBottom=new BK.Sprite(n.right,n.bottom,r,0,1,1,1),this._rightBottom.position={x:t-n.right,y:0},this._rightBottom.name="_rightBottom",this.__nativeObj.addChild(this._rightBottom),1==a?(this._leftTop.adjustTexturePosition(o.x+(i-n.top),o.y+(t-n.left),n.left,n.top,a),this._centerTop.adjustTexturePosition(o.x+(i-n.top),o.y+n.right,t-n.left-n.right,n.top,a),this._rightTop.adjustTexturePosition(o.x+(i-n.top),o.y,n.right,n.top,a),this._leftCenter.adjustTexturePosition(o.x+n.bottom,o.y+(t-n.left),n.left,i-n.top-n.bottom,a),this._centerCenter.adjustTexturePosition(o.x+n.bottom,o.y+n.right,t-n.left-n.right,i-n.top-n.bottom,a),this._rightCenter.adjustTexturePosition(o.x+n.bottom,o.y,n.right,i-n.bottom-n.top,a),this._leftBottom.adjustTexturePosition(o.x,o.y+(t-n.left),n.left,n.bottom,a),this._centerBottom.adjustTexturePosition(o.x,o.y+n.right,t-n.left-n.right,n.bottom,a),this._rightBottom.adjustTexturePosition(o.x,o.y,n.right,n.bottom,a)):(this._leftTop.adjustTexturePosition(0+o.x,i-n.top+o.y,n.left,n.top),this._centerTop.adjustTexturePosition(n.left+o.x,i-n.top+o.y,t-n.left-n.right,n.top),this._rightTop.adjustTexturePosition(t-n.right+o.x,i-n.top+o.y,n.right,n.top),this._leftCenter.adjustTexturePosition(0+o.x,n.bottom+o.y,n.left,i-n.top-n.bottom),this._centerCenter.adjustTexturePosition(n.left+o.x,n.bottom+o.y,t-n.left-n.right,i-n.top-n.bottom),this._rightCenter.adjustTexturePosition(t-n.right+o.x,n.bottom+o.y,n.right,i-n.bottom-n.top),this._leftBottom.adjustTexturePosition(0+o.x,0+o.y,n.left,n.bottom),this._centerBottom.adjustTexturePosition(n.left+o.x,0+o.y,t-n.left-n.right,n.bottom),this._rightBottom.adjustTexturePosition(t-n.right+o.x,0+o.y,n.right,n.bottom))}return e.prototype.onInit=function(){var e=this;Object.getOwnPropertyNames(this.__nativeObj).forEach(function(t){var i=t;"size"!=i&&Object.defineProperty(e,i,{get:function(){return this.__nativeObj[i]},set:function(e){this.__nativeObj[i]=e}})},this)},e.prototype.pos=function(e,t){this.__nativeObj.position={x:e,y:t}},e.prototype.dispose=function(){this.__nativeObj.dispose()},e.prototype.attachBody=function(e){this.__nativeObj.attachComponent(e)},e.prototype.addChild=function(e){this.__nativeObj.addChild(e)},e.prototype.removeChildById=function(e,t){return this.__nativeObj.removeChildById(e,t)},e.prototype.removeChildByName=function(e,t){return this.__nativeObj.removeChildByName(e,t)},e.prototype.removeFromParent=function(){return this.__nativeObj.removeFromParent()},e.prototype.hittest=function(e){return this.__nativeObj.hittest(e)},e.prototype.setSize=function(e){if(!e)throw Error("size can not be undefined!");if("number"!=typeof e.width)throw Error("size.width must be a number!");if("number"!=typeof e.height)throw Error("size.height must be a number!");this.size=e},e.prototype.setPosition=function(e){if(!e)throw Error("position can not be undefined!");if("number"!=typeof e.x)throw Error("position.x must be a number!");if("number"!=typeof e.y)throw Error("position.y must be a number!");this.position=e},e}();Object.defineProperty(r.prototype,"alpha",{get:function(){return this._rightBottom.vertexColor.a},set:function(e){this._leftTop.vertexColor={r:1,g:1,b:1,a:e},this._centerTop.vertexColor={r:1,g:1,b:1,a:e},this._rightTop.vertexColor={r:1,g:1,b:1,a:e},this._leftCenter.vertexColor={r:1,g:1,b:1,a:e},this._centerCenter.vertexColor={r:1,g:1,b:1,a:e},this._rightCenter.vertexColor={r:1,g:1,b:1,a:e},this._leftBottom.vertexColor={r:1,g:1,b:1,a:e},this._centerBottom.vertexColor={r:1,g:1,b:1,a:e},this._rightBottom.vertexColor={r:1,g:1,b:1,a:e}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"size",{get:function(){return this._size},set:function(e){this._size=e;var t=e.width-this._grid.left-this._grid.right,i=e.height-this._grid.top-this._grid.bottom;this._leftTop.position={x:0,y:e.height-this._grid.top},this._leftCenter.size={width:this._grid.left,height:i},this._leftCenter.position={x:0,y:this._grid.bottom},this._rightCenter.size={width:this._grid.right,height:i},this._rightCenter.position={x:e.width-this._grid.right,y:this._grid.bottom},this._centerCenter.size={width:t,height:i},this._centerTop.size={width:t,height:this._grid.top},this._centerTop.position={x:this._grid.left,y:e.height-this._grid.top},this._centerBottom.size={width:t,height:this._grid.bottom},this._centerBottom.position={x:this._grid.left,y:0},this._rightCenter.size={width:this._grid.right,height:i},this._rightCenter.position={x:e.width-this._grid.right,y:this._grid.bottom},this._rightBottom.position={x:e.width-this._grid.right,y:0},this._rightTop.position={x:e.width-this._grid.right,y:e.height-this._grid.top}},enumerable:!0,configurable:!0}),e.exports=r},"./src/render/spriteSet.ts":function(e,t,i){"use strict";var r=function(){function e(e){if(this.flipU=0,this.flipV=1,this.stretchX=1,this.stretchY=1,this.size={width:0,height:0},this.currTexturePath="",!e)throw Error("initParam can not be undefined!");if(!e.textureInfo)throw Error("initParam.textureInfo can not be undefined!");e.flipU&&(this.flipU=e.flipU),e.flipV&&(this.flipV=e.flipV),e.stretchX&&(this.stretchX=e.stretchX),e.stretchY&&(this.stretchY=e.stretchY),e.width&&(this.size.width=e.width),e.height&&(this.size.height=e.height),this.textureInfo=e.textureInfo,this.onInit(this.size.width,this.size.height),this.adjustWithTextureInfo(e.textureInfo)}return e.prototype.onInit=function(e,t){this.createSprites({width:e,height:t});var i=this;Object.getOwnPropertyNames(this.__nativeObj).forEach(function(e){var t=e;Object.defineProperty(i,t,{get:function(){return this.__nativeObj[t]},set:function(e){this.__nativeObj[t]=e}})},this),Object.defineProperty(this,"size",{get:function(){return this.__nativeObj.contentSize},set:function(e){this.__nativeObj.contentSize=e,this.updateSize(this.textureInfo)}}),Object.defineProperty(this,"anchor",{get:function(){return this.__nativeObj.localAnchor},set:function(e){this.__nativeObj.localAnchor=e}})},e.prototype.updateSize=function(e){if(1==e.frameInfo.trimmed){var t=e.frameInfo.spriteSourceSize.x,i=e.frameInfo.spriteSourceSize.y,r=e.frameInfo.spriteSourceSize.w,n=e.frameInfo.spriteSourceSize.h,o=e.frameInfo.sourceSize,a=this.__nativeObj.contentSize;t=a.width*t/o.w,i=a.height*i/o.h,r=a.width*r/o.w,n=a.height*n/o.h,this.contentSprite.position={x:t,y:i},this.contentSprite.contentSize={width:r,height:n}}else this.contentSprite.contentSize=this.__nativeObj.contentSize},e.prototype.adjustWithTextureInfo=function(e){if(e){this.textureInfo=e;var t=e.texture,i=e.frameInfo;this.updateSize(e),this.currTexturePath=e.texturePath,t=new BK.Texture(this.currTexturePath),this.contentSprite.setTexture(t),this.contentSprite.adjustTexturePosition(i.frame.x,i.frame.y,i.frame.w,i.frame.h,i.rotated)}},e.prototype.setTexture=function(e){this.__nativeObj.setTexture(e)},e.prototype.dispose=function(){BK.Director.ticker.remove(this),this.__nativeObj.dispose()},e.prototype.removeChild=function(e){return this.__nativeObj.removeChild(e)},e.prototype.removeChildById=function(e,t){return this.__nativeObj.removeChildById(e,t)},e.prototype.removeChildByName=function(e,t){return this.__nativeObj.removeChildByName(e,t)},e.prototype.removeFromParent=function(){return this.__nativeObj.removeFromParent()},e.prototype.addChild=function(e,t){return this.__nativeObj.addChild(e,t)},e.prototype.hittest=function(e){return this.__nativeObj.hittest(e)},e.prototype.convertToWorldSpace=function(e){return this.__nativeObj.convertToWorldSpace(e)},e.prototype.convertToNodeSpace=function(e){return this.__nativeObj.convertToNodeSpace(e)},e.prototype.createSprites=function(e){if(!e)throw Error("size can not be undefined!");if("number"!=typeof e.width)throw Error("size.width must be a number!");if("number"!=typeof e.height)throw Error("size.height must be a number!");this.__nativeObj=new BK.SpriteNode(e.width,e.height,{},this.flipU,this.flipV,this.stretchX,this.stretchY),this.contentSprite=new BK.SpriteNode(e.width,e.height,{},this.flipU,this.flipV,this.stretchX,this.stretchY),this.__nativeObj.addChild(this.contentSprite)},e}();e.exports=r},"./src/render/spriteSetCache.ts":function(e,t,i){"use strict";var r;!function(e){e[e.mirrorRepeat=0]="mirrorRepeat",e[e.repeatToEdge=1]="repeatToEdge",e[e.selfRepeat=2]="selfRepeat"}(r||(r={}));var n=function(){function e(){this.fullWidth=0,this.fullHeight=0,this.sheets={},this.jsonConfigs={}}return e.prototype.getFrameInfoByFilename=function(e){for(var t in this.jsonConfigs)if(this.jsonConfigs.hasOwnProperty(t)){var i=this.jsonConfigs[t],r=(this.sheets[t],i.frames),n=i.meta;this.fullWidth=n.size.w,this.fullHeight=n.size.h;for(var o=0;o<r.length;o++){var a=r[o];if(e==a.filename){var s={x:0,y:1,width:0,height:0},h=a.rotated,c=a.trimmed,l=a.spriteSourceSize,u=a.sourceSize;return h?(s.x=a.frame.x,s.y=this.fullHeight-a.frame.y-a.frame.w,s.width=a.frame.w,s.height=a.frame.h):(s.x=a.frame.x,s.y=this.fullHeight-a.frame.y-a.frame.h,s.width=a.frame.w,s.height=a.frame.h),l.y=u.h-l.y-l.h,u.width=u.w,u.height=u.h,l.width=l.w,l.height=l.h,{filename:e,frame:s,rotated:h,trimmed:c,spriteSourceSize:l,sourceSize:u}}}}return null},e.prototype.getTexturePathByFilename=function(e){for(var t in this.jsonConfigs)if(this.jsonConfigs.hasOwnProperty(t))for(var i=this.jsonConfigs[t].frames,r=0;r<i.length;r++)if(i[r].filename==e)return t;return null},e.prototype.getTextureByFilename=function(e){var t=this.getFrameInfoByFilename(e),i=this.getTexturePathByFilename(e);return t&&i?new BK.Texture(i):(BK.Script.log(0,0,"getTexture Failed.Please check path"),null)},e.prototype.getTextureInfoByFilename=function(e){var t=this.getFrameInfoByFilename(e),i=this.getTexturePathByFilename(e);return t&&i?{frameInfo:t,texturePath:i,texture:this.getTextureByFilename(e)}:null},e.prototype.loadSet=function(e){if(!e)throw Error("loadSetParam can not be undefined!");var t=e.jsonPath,i=e.texturePath,r=e.format,n=e.minFilter,o=e.magFilter,a=e.uWrap,s=e.vWrap,h=BK.FileUtil.readFile(t).readAsString();if(h){var c=JSON.parse(h);void 0===i&&(i=t.replace(/.json$/,".png")),this.jsonConfigs[i]=c,void 0===r&&(r=4),r=4,void 0===n&&(n=1),void 0===o&&(o=1),void 0===a&&(a=1),void 0===s&&(s=1);var l=new BK.Texture(i,r,n,o,a,s);this.sheets[i]=l}else BK.Script.log(0,0,"loadSheet Failed.Please check path")},e.prototype.removeSet=function(e){if(this.jsonConfigs[e])for(var t in this.jsonConfigs)if(this.jsonConfigs.hasOwnProperty(t)){i=this.jsonConfigs[t];t==e&&(delete this.jsonConfigs[e],BK.Script.log(0,0,"Delete jsonConfigs key:"+t+" val:"+i))}if(this.sheets[e])for(var t in this.sheets)if(this.sheets.hasOwnProperty(t)){var i=this.sheets[t];t==e&&(delete this.sheets[e],BK.Script.log(0,0,"Delete sheets key:"+t+" val:"+i))}},e.prototype.getSprite=function(e){if(!e)throw Error("spriteInfo can not be undefined!");var t=e.filename,i=e.width,r=e.height,n=this.getTextureInfoByFilename(t);if(n){var o=n.frameInfo,a=n.texturePath,s=new BK.Texture(a);if(i||(i=o.frame.width),r||(r=o.frame.height),BK.Script.log(0,0,"getSprite  texture:"+s+" width:"+i+" height:"+r),o.trimmed)return h=new BK.SpriteSet({textureInfo:n,width:i,height:r});var h=new BK.Sprite(i,r,s,0,1,1,1);return h.adjustTexturePosition(o.frame.x,o.frame.y,o.frame.width,o.frame.height,o.rotated),h}return null},e.prototype.createSpriteSet=function(e){if(!e)throw Error("spriteInfo can not be undefined!");var t=e.filename,i=e.width,r=e.height,n=this.getTextureInfoByFilename(t);if(n){var o=n.frameInfo,a=n.texturePath,s=new BK.Texture(a);return i||(i=o.frame.width),r||(r=o.frame.height),BK.Script.log(0,0,"SheetSprite  texture:"+s+" width:"+i+" height:"+r),new BK.SpriteSet({textureInfo:n,width:i,height:r})}return null},e}();BK&&(BK.RepeatMode=r),e.exports=new n},"./src/render/texture.ts":function(e,t,i){"use strict";BK.Texture.createTextures=function(e){if(!e)return BK.Script.log(1,1,"object.file is null"),e.fail&&e.fail({errmsg:"object.file is null"}),void(e.complete&&e.complete());if(e&&e.file){for(var t=[],i=0;i<e.file.length;i++)e.file[i].path&&t.push({path:e.file[i].path,format:e.file[i].format?e.file[i].format:6});BK.Image.loadImages({file:t,success:function(t){for(var i=0;i<t.length;i++)if(0==t[i].errcode){var r=t[i].image,n=null;(n=0==BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.8.0")?BK.Texture.createBitmapTexture(r.width,r.height,r.format,t[i].path):BK.Texture.createBitmapTexture(r.width,r.height,r.format))?(n.uploadData(r.buffer),t[i].texture=n):(t[i].errcode=-2,t[i].errmsg="createTexture null, failed"),delete t[i].image}else t[i].errcode=-3,t[i].errmsg="createImage null, failed";e.success&&e.success(t),e.complete&&e.complete()},fail:function(t){e.fail&&e.fail(t),e.complete&&e.complete()}})}else e.fail&&e.fail({errmsg:"object.file is null"}),e.complete&&e.complete()},e.exports=BK.Texture},"./src/task/TaskManager.js":function(e,t,i){"use strict";t.__esModule=!0;var r=function(){function e(){this.taskQ=[],this.initTaskObserver()}return e.prototype.initTaskObserver=function(){0==BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.8.0")&&BK.Director.ticker.add(function(){for(var e=BK.TaskManager.getCompleteQueue();e.length>0;)for(var t=e.shift(),i=0;i<this.taskQ.length;i++){var r=this.taskQ[i];if(r.taskId==t.id){this.taskQ.splice(i,1);var n=t.res.length;if(n!==r.taskInfo.length)BK.Console.error("task not complete");else for(var o=0;o<n;o++)t.res[o].encoding=r.taskInfo[n-1-o].encoding;r.callback(t.res);break}}}.bind(this))},e.prototype.pushTask=function(e,t,i){-1!=e&&this.taskQ.push({taskId:e,taskInfo:t,callback:i})},e.prototype.cancelTask=function(e){-1!=e&&0==BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.8.0")&&BK.TaskManager.cancelTask(e)},e}();t.TaskManager=r,e.exports=r},"./src/ui/dialog.ts":function(e,t,i){"use strict";var r;!function(e){var t=function(){function e(){}return e.show=function(e){if(e&&e.complete){var t="sc.xy_toast_show_complete.local";BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,function(t,i,r){e.complete()})}else BK.MQQ.SsoRequest.removeListener("sc.xy_toast_show_complete.local",this);BK.MQQ.dialog.show("toast",JSON.stringify(e))},e.hide=function(e){if(e&&e.complete){var t="sc.xy_toast_hide_complete.local";BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,function(t,i,r){e.complete()})}else BK.MQQ.SsoRequest.removeListener("sc.xy_toast_hide_complete.local",this);BK.MQQ.dialog.hide("toast")},e}();e.toast=t;var i=function(){function e(){}return e.show=function(e){if(e&&e.complete){var t="sc.xy_loading_show_complete.local";BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,function(t,i,r){e.complete()})}else BK.MQQ.SsoRequest.removeListener("sc.xy_loading_show_complete.local",this);BK.MQQ.dialog.show("loading",JSON.stringify(e))},e.hide=function(e){if(e&&e.complete){var t="sc.xy_loading_hide_complete.local";BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,function(t,i,r){e.complete()})}else BK.MQQ.SsoRequest.removeListener("sc.xy_loading_hide_complete.local",this);BK.MQQ.dialog.hide("loading")},e}();e.loading=i;var r=function(){function e(){}return e.show=function(e){if(e&&e.success){t="sc.xy_alert_show_success.local";BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,function(t,i,r){e.success(r)})}else BK.MQQ.SsoRequest.removeListener("sc.xy_alert_show_success.local",this);if(e&&e.complete){var t="sc.xy_alert_show_complete.local";BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,function(t,i,r){e.complete()})}else BK.MQQ.SsoRequest.removeListener("sc.xy_alert_show_complete.local",this);BK.MQQ.dialog.show("alert",JSON.stringify(e))},e}();e.alert=r}(r||(r={})),e.exports=r},"./src/ui/ui.ts":function(e,t,i){"use strict";var r;!function(e){function t(e){if(!e)throw new Error("listener can't be undefined!");p.on(m.keyboardInput,e)}function r(e){if(!e)throw new Error("listener can't be undefined!");p.off(m.keyboardInput,e)}function n(e){if(!e)throw new Error("listener can't be undefined!");p.on(m.keyboardConfirm,e)}function o(e){if(!e)throw new Error("listener can't be undefined!");p.off(m.keyboardConfirm,e)}function a(e){p.emit(m.keyboardConfirm,{text:e})}function s(e){p.emit(m.keyboardInput,{text:e})}function h(e){e&&e.defaultText&&BK.Editor.setText(e.defaultText+""),BK.Editor.showKeyBoard(a,s),e&&e.complete&&e.complete()}function c(e){BK.Editor.hideKeyBoard(),e&&e.complete&&e.complete()}function l(e){e&&(e.text?BK.Editor.setText(e.text+""):BK.Editor.setText(""),e.complete&&e.complete())}function u(e){v.toast.show(e)}function d(e){v.toast.hide(e)}function _(e){v.loading.show(e)}function f(e){v.loading.hide(e)}function g(e){v.alert.show(e)}var p=new(i("./src/common/emitter.ts")),m={keyboardInput:"keyboardInput",keyboardConfirm:"keyboardConfirm"},v=i("./src/ui/dialog.ts");e.onKeyboardInput=t,e.offKeyboardInput=r,e.onKeyboardConfirm=n,e.offKeyboardConfirm=o,e.showKeyboard=h,e.hideKeyboard=c,e.updateKeyboard=l,e.showToast=u,e.hideToast=d,e.showLoading=_,e.hideLoading=f,e.showAlert=g}(r||(r={})),e.exports=r},"./src/util/buffer.js":function(e,t,i){"use strict";function r(e,t,i){var r,n=new Uint8Array(e,t||0,i||e.byteLength),o=n.length,a="";for(r=0;r<o;r+=3)a+=S[n[r]>>2],a+=S[(3&n[r])<<4|n[r+1]>>4],a+=S[(15&n[r+1])<<2|n[r+2]>>6],a+=S[63&n[r+2]];return o%3==2?a=a.substring(0,a.length-1)+"=":o%3==1&&(a=a.substring(0,a.length-2)+"=="),a}function n(e){var t,i,r,n,o,a=.75*e.length,s=e.length,h=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var c=new ArrayBuffer(a),l=new Uint8Array(c);for(t=0;t<s;t+=4)i=S.indexOf(e[t]),r=S.indexOf(e[t+1]),n=S.indexOf(e[t+2]),o=S.indexOf(e[t+3]),l[h++]=i<<2|r>>4,l[h++]=(15&r)<<4|n>>2,l[h++]=(3&n)<<6|63&o;return c}function o(e){function t(e,t){var i=t.length,r={type:e,length:t.byteLength,offset:0};switch(e){case 0:for(a=0;i>0;){var n=Math.min(i,40960),o=new Int8Array(t.buffer,a*Int8Array.BYTES_PER_ELEMENT,n);r.offset=a,BK.Misc.transferArrayBuffer.apply(r,o),a+=40960,i-=40960}break;case 1:for(a=0;i>0;){var n=Math.min(i,40960),o=new Int16Array(t.buffer,a*Int16Array.BYTES_PER_ELEMENT,n);r.offset=a,BK.Misc.transferArrayBuffer.apply(r,o),a+=40960,i-=40960}break;case 2:for(a=0;i>0;){var n=Math.min(i,40960),o=new Int32Array(t.buffer,a*Int32Array.BYTES_PER_ELEMENT,n);r.offset=a,BK.Misc.transferArrayBuffer.apply(r,o),a+=40960,i-=40960}break;case 3:for(a=0;i>0;){var n=Math.min(i,40960),o=new Uint8Array(t.buffer,a*Uint8Array.BYTES_PER_ELEMENT,n);r.offset=a,BK.Misc.transferArrayBuffer.apply(r,o),a+=40960,i-=40960}break;case 5:for(a=0;i>0;){var n=Math.min(i,40960),o=new Uint16Array(t.buffer,a*Uint16Array.BYTES_PER_ELEMENT,n);r.offset=a,BK.Misc.transferArrayBuffer.apply(r,o),a+=40960,i-=40960}break;case 6:for(a=0;i>0;){var n=Math.min(i,40960),o=new Uint32Array(t.buffer,a*Uint32Array.BYTES_PER_ELEMENT,n);r.offset=a,BK.Misc.transferArrayBuffer.apply(r,o),a+=40960,i-=40960}break;case 7:for(var a=0;i>0;){var n=Math.min(i,40960),o=new Float32Array(t.buffer,a*Float32Array.BYTES_PER_ELEMENT,n);r.offset=a,BK.Misc.transferArrayBuffer.apply(r,o),a+=40960,i-=40960}}}return e instanceof Int8Array==!0?t(0,e):e instanceof Int16Array==!0?t(1,e):e instanceof Int32Array==!0?t(2,e):e instanceof Uint8Array==!0?t(3,e):e instanceof Uint16Array==!0?t(5,e):e instanceof Uint32Array==!0?t(6,e):e instanceof Float32Array==!0&&t(7,e),BK.Misc.getTransferedArrayBuffer()}function a(e,t){if(v&&BK.Misc.toArrayBuffer){var i=new ArrayBuffer(e.length);return BK.Misc.toArrayBuffer(e,i),i}return BK.Misc.toArrayBufferCompatible?BK.Misc.toArrayBufferCompatible(e,t):BK.Misc.BKBufferToArrayBuffer(e)}function s(e){if(v&&BK.Misc.toBKBuffer)return BK.Misc.toBKBuffer(e,e.byteOffset,e.byteLength);if(0==BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.8.5"))return o(e);var t=r(e.buffer,e.byteOffset,e.byteLength);return BK.Misc.decodeBase64FromString(t)}function h(e){return new Int8Array(a(e,0))}function c(e){return new Int16Array(a(e,1))}function l(e){return new Int32Array(a(e,2))}function u(e){return new Uint8Array(a(e,3))}function d(e){return new Uint16Array(a(e,5))}function _(e){return new Uint32Array(a(e,6))}function f(e){return new Float32Array(a(e,7))}function g(e){return a(e,0)}function p(e){return s(new Int8Array(e))}t.__esModule=!0;var m=BK.Director.queryDeviceInfo(),v=!("ios"===m.platform&&Number(m.version.split(".")[0])<10);t.isSupportArrayBuffer=v;var S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";BK.Misc.BKBufferToArrayBuffer=function(e){return e.rewind(),n(BK.Misc.encodeBase64FromBuffer(e))},BK.Misc.arrayBufferToBKBuffer=function(e,t,i){if(v&&BK.Misc.toBKBuffer)return BK.Misc.toBKBuffer(e,t,i);var n=r(e,t,i);return BK.Misc.decodeBase64FromString(n)},BK.Misc.typedArrayToBKBuffer=function(e){if(v&&BK.Misc.toBKBuffer)return BK.Misc.toBKBuffer(e,e.byteOffset,e.byteLength);var t=r(e.buffer,e.byteOffset,e.byteLength);return BK.Misc.decodeBase64FromString(t)},t.typedArrayToBKBuffer=s,t.BKBufferToInt8Array=h,t.BKBufferToInt16Array=c,t.BKBufferToInt32Array=l,t.BKBufferToUint8Array=u,t.BKBufferToUint16Array=d,t.BKBufferToUint32Array=_,t.BKBufferToFloat32Array=f,t.BKBufferToArrayBuffer=g,t.arrayBufferToBKBuffer=p},"./src/util/console.ts":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r;!function(e){function t(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];a(1,0,e)}function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];a(0,0,e)}function r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];a(1,-1,e)}function n(e){h[e]=BK.Time.timestamp}function o(e){t(e,":",1e3*(BK.Time.timestamp-h[e]),"ms"),delete h[e]}function a(e,t,i){for(var r="",n=0,o=i;n<o.length;n++){var a=o[n];-1!=r.indexOf("%d")&&"number"==typeof a?r=r.replace("%d",a.toString()):-1!=r.indexOf("%s")&&"string"==typeof a?r=r.replace("%s",a):-1!=r.indexOf("%o")&&"object"==typeof a?r=r.replace("%o",JSON.stringify(a)):"object"==typeof a?r=r+JSON.stringify(a)+" ":void 0==a?r+="undefined ":r=r+a.toString()+" "}if(r.length>s)for(var h=0;h<=r.length/s;h++)BK.Script.log(e,t,r.slice(h*s,(h+1)*s));else BK.Script.log(e,t,r)}var s=2048,h={};e.log=t,e.debug=i,e.error=r,e.time=n,e.timeEnd=o}(r=t.Console||(t.Console={})),e.exports=r},"./src/util/util.ts":function(e,t,i){"use strict";var r;!function(e){function t(){}e.buffer=t}(r||(r={})),e.exports=r},"./webpack/pack.ts":function(e,t,i){BK.isBrowser;if(BK.Console=i("./src/util/console.ts"),BK.SsoRequest=i("./src/mqq/sso/sso.ts"),!BK.isBrowser){BK.HttpUtil=i("./src/deprecate/http-util.ts"),BK.Http=i("./src/net/http.ts"),BK.Util=i("./src/util/util.ts"),BK.Util.Buffer=i("./src/util/buffer.js"),BK.UI=i("./src/ui/ui.ts");var r=i("./src/basics/lifecycle/lifecycle.ts");if(BK.onEnterForeground=r.onEnterForeground,BK.onEnterBackground=r.onEnterBackground,BK.onMaximize=r.onMaximize,BK.onMinimize=r.onMinimize,BK.onGameClose=r.onGameClose,BK.onNetworkChange=r.onNetworkChange,BK.onGameShare=r.onGameShare,BK.onGameShareComplete=r.onGameShareComplete,BK.offEnterForeground=r.offEnterForeground,BK.offEnterBackground=r.offEnterBackground,BK.offMaximize=r.offMaximize,BK.offMinimize=r.offMinimize,BK.offGameClose=r.offGameClose,BK.offNetworkChange=r.offNetworkChange,BK.offGameShare=r.offGameShare,BK.offGameShareComplete=r.offGameShareComplete,BK.Crypt=i("./src/common/crypt.ts"),0==BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.8.0")){var n=i("./src/gme/audio.ts")();BK.createAudioContext=n.AudioFactory.createAudioContext,BK.Audio=n.Audio2,BK.AudioManager=n.AudioManager,BK.onAudioInterruptionStart=n.AudioManager.onAudioInterruptionStart,BK.onAudioInterruptionEnd=n.AudioManager.onAudioInterruptionEnd}BK.Device=i("./src/basics/device/device.ts");var o=i("./src/task/TaskManager.js");BK.taskManager=new o;var a=i("./src/fileSystem/FileSystem.ts");BK.fileSystem=new a,BK.QRCode=i("./src/common/qrcode.ts");var s=i("./src/basics/storage/Storage.ts");BK.localStorage=s.localStorage,BK.sessionStorage=s.sessionStorage,BK.storageEventListener=i("./src/basics/Storage/StorageEventListener.ts"),BK.AnimationSprite=i("./src/render/animationSprite.ts"),BK.SpriteSet=i("./src/render/spriteSet.ts"),BK.SpriteSetCache=i("./src/render/spriteSetCache.ts"),BK.SpriteNine=i("./src/render/spriteNine.ts"),BK.loadSubpackage=i("./src/basics/subpackage/subpackage.ts"),BK.Texture=i("./src/render/texture.ts"),BK.Image=i("./src/render/image.ts"),BK.createWebView=i("./src/net/transparent-webview.ts")}BK.Share=i("./src/mqq/share/share.ts"),BK.Upload=i("./src/mqq/share/upload.ts"),BK.Screenshot=i("./src/mqq/share/screenshot.ts");var h=i("./src/mqq/advertisement/advertisement.ts");BK.Advertisement.createBannerAd=h.createBannerAd,BK.Advertisement.createVideoAd=h.createVideoAd,BK.getSystemInfoSync=i("./src/basics/system/system.ts").getSystemInfoSync}});BK.Script.log(1,1,"qqPlayCore.js load end");